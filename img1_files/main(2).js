define("vanilla-extract/public/js/core/Constants",[],function(){"use strict";var e={DefaultPPI:72,BaseFontDefaultSize:16,FontUnitType:{EMS:"em",REMS:"rem",PX:"px",PT:"pt"},ColorFormat:{RGB:"RGB",HEX:"Hex",HSL:"HSL"},DesignedAtMultiplier:{OneX:1,TwoX:2,ThreeX:3,FourX:4},MenuPosition:{BELOW:"0",TOP:"1"},MeasurementUnitType:{PX:"px",PCT:"%"},PREVIEW_SPACING:12,PREVIEW_SCROLLBAR_SPACING:17,Type:{LAYER_ARTBOARD:"artboardLayer",LAYER_GROUP:"layerSection",LAYER:"layer",LAYER_TEXT:"textLayer",LAYER_CONTENT:"contentLayer",LAYER_ADJUSTMENT:"adjustmentLayer",LAYER_BACKGROUND:"backgroundLayer",LAYER_SMARTOBJ:"smartObject"},Shape:{ELLIPSE:"ellipse",RECTANGLE:"rectangle",PATH:"path"},ContentType:{SOLID_COLOR:"solidColorLayer"},InterceptNames:{SHIFT_CLICK_MEASUREMENT:"shiftClickMeasurement"},LayerWarnings:{MULTI_LAYER_STYLES_WARNING:"Layer contains multiple layer styles that cannot be represented in CSS. Use the color picker or extract the layer as an image."},NotificationTooltip:{MIN_DURATION:3e3},Tool:{SELECT_DIRECT:0,DROPPER:1},Tab:{TAB_INSPECT:0,TAB_LAYERS:1},Shortcut:{LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,HELP:191,CLEAR:27,FUX:73,COLOR_PICKER:69,ALT:18,SHIFT:16,CTRL:17,CMD:91,SECONDARY_CMD:93,CMD_FF:224,TOGGLE_MEASUREMENT:88},Platform:{MAC:0,WINDOWS:1},topOffsetWithMessageBar:70,toolTipTimeout:2e3,flashTimeout:2300,CCWEB_FILES_URL:"https://assets.adobe.com/files",CCWEB_FILES_URL_STAGE:"https://stage.adobecc.com/files",RE_SHORT_URL:/^http:\/\/adobe\.ly\/\w+$/,WorkerErrorCodes:{UNSUPPORTED_INPUTFMT:"unsupported_input_format_exception",NOINPUTFILE:"no_input_file_exception",GRAPHITE_PROCESSING:"graphite_processing_exception",GRAPHITE_REJECTED:"graphite_file_rejected"},WorkerErrorMsgs:{UNSUPPORTED_INPUTFMT:"Unsupported Image Format",NOINPUTFILE:"No files specified",GR_JSONGENERATION:"Graphite JSON generation failed.",GR_THUMBNAIL:"Graphite Thumbnail generation failed.",GR_SPRITESHEET:"Graphite Spritesheet generation failed.",GR_UNKNOWNENCODING:"Unspecified Encoding Format",GR_MISSINGLAYERSPEC:"Missing Layer Specification",GR_CREATINGASSET:"Error generating asset"}};return e});define("vanilla-extract/public/js/core/collections/SubLayerCollection",["backbone"],function(e){"use strict";var t=e.Collection.extend({model:null,initialize:function(e){this.model=e}});return t});define("vanilla-extract/public/js/core/models/PSDSettingsModel",["underscore","../Constants","backbone"],function(e,t,i){"use strict";var n=i.Model.extend({initialize:function(e){i.Model.prototype.initialize.apply(this,arguments);this.on("change",this.save,this)},defaults:{baseFontSizeValue:t.BaseFontDefaultSize,baseFontSizeUnits:t.FontUnitType.PX,designedAtMultiplier:t.DesignedAtMultiplier.OneX},setup:function(e){this.psdGuid=e;this.reset();var t=this;window.graphite.getServerAPI().updateGenericData&&window.graphite.getServerAPI().loadGenericData(e,"extract_psd_settings",function(e){if(e.data){t.set(e.data,{silent:!0});window.graphite.events.trigger("psdSettingsChanged",this)}},function(){})},save:function(){var e,t=this;graphite.getServerAPI().updateGenericData&&graphite.getServerAPI().updateGenericData(this.psdGuid,"extract_psd_settings",function(i){var n,s=t.changedAttributes();e=i||t.toJSON();for(n in s)s.hasOwnProperty(n)&&(e[n]=t.get(n));return e},function(i){if(i.needsRefresh){t.set(e,{silent:!0});window.graphite.events.trigger("psdSettingsChanged",this)}},function(){},null)},reset:function(){this.clear({silent:!0}).set(this.defaults,{silent:!0});window.graphite&&window.graphite.events.trigger("psdSettingsChanged",this)}});return new n});define("vanilla-extract/public/js/core/models/UserSettingsModel",["underscore","../Constants","backbone"],function(e,t,i){"use strict";var n=i.Model.extend({defaults:{preferredFontUnits:t.FontUnitType.PX,preferredMeasurementUnits:t.MeasurementUnitType.PX,preprocessor:"css",scaleExtractedAssets:!1,assetScaleFactor:2,shownIntercepts:{shiftClickMeasurement:!0}},initialize:function(){this.off("change",this.save,this);var e,t,i=localStorage.getItem("extractUserSettings");if(i){t=JSON.parse(i);for(e in t)t.hasOwnProperty(e)&&this.set(e,t[e])}else this.reset();this.on("change",this.save,this)},reset:function(){this.off("change",this.save,this);this.clear().set(this.defaults);this.save();this.on("change",this.save,this)},save:function(){localStorage.setItem("extractUserSettings",JSON.stringify(this.attributes))},setInterceptShown:function(e,t){var i=this.get("shownIntercepts");i[e]=t;this.set("shownIntercepts",i);this.save()},shouldInterceptBeShown:function(e){var t=this.get("shownIntercepts");return t[e]}});return new n});define("vanilla-extract/public/js/core/utils/Matrix",[],function(){"use strict";function e(e,i,n,s,r,a){if(null!==i&&void 0!==i||"[object SVGMatrix]"!==t.call(e))if(null!==e&&void 0!==e){this.a=+e;this.b=+i;this.c=+n;this.d=+s;this.e=+r;this.f=+a}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}else{this.a=e.a;this.b=e.b;this.c=e.c;this.d=e.d;this.e=e.e;this.f=e.f}}var t=Object.prototype.toString,i=String,n=Math,s=function(e){return e%360*n.PI/180},r=function(e){return 180*e/n.PI%360};!function(t){function a(e){return e[0]*e[0]+e[1]*e[1]}function o(e){var t=n.sqrt(a(e));e[0]&&(e[0]/=t);e[1]&&(e[1]/=t)}t.add=function(t,i,n,s,r,a){var o,l,d,c,h=[[],[],[]],p=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],u=[[t,n,r],[i,s,a],[0,0,1]];t&&t instanceof e&&(u=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]);for(o=0;3>o;o++)for(l=0;3>l;l++){c=0;for(d=0;3>d;d++)c+=p[o][d]*u[d][l];h[o][l]=c}this.a=h[0][0];this.b=h[1][0];this.c=h[0][1];this.d=h[1][1];this.e=h[0][2];this.f=h[1][2];return this};t.invert=function(){var t=this,i=t.a*t.d-t.b*t.c;return new e(t.d/i,-t.b/i,-t.c/i,t.a/i,(t.c*t.f-t.d*t.e)/i,(t.b*t.e-t.a*t.f)/i)};t.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)};t.translate=function(e,t){return this.add(1,0,0,1,e,t)};t.scale=function(e,t,i,n){(null===t||void 0===t)&&(t=e);(i||n)&&this.add(1,0,0,1,i,n);this.add(e,0,0,t,0,0);(i||n)&&this.add(1,0,0,1,-i,-n);return this};t.rotate=function(e,t,i){e=s(e);t=t||0;i=i||0;var r=+n.cos(e).toFixed(9),a=+n.sin(e).toFixed(9);this.add(r,a,-a,r,t,i);return this.add(1,0,0,1,-t,-i)};t.x=function(e,t){return e*this.a+t*this.c+this.e};t.y=function(e,t){return e*this.b+t*this.d+this.f};t.get=function(e){return+this[i.fromCharCode(97+e)].toFixed(4)};t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};t.determinant=function(){return this.a*this.d-this.b*this.c};t.split=function(){var e={};e.dx=this.e;e.dy=this.f;var t=[[this.a,this.c],[this.b,this.d]];e.scalex=n.sqrt(a(t[0]));o(t[0]);e.shear=t[0][0]*t[1][0]+t[0][1]*t[1][1];t[1]=[t[1][0]-t[0][0]*e.shear,t[1][1]-t[0][1]*e.shear];e.scaley=n.sqrt(a(t[1]));o(t[1]);e.shear/=e.scaley;this.determinant()<0&&(e.scalex=-e.scalex);var i=-t[0][1],s=t[1][1];if(0>s){e.rotate=r(n.acos(s));0>i&&(e.rotate=360-e.rotate)}else e.rotate=r(n.asin(i));e.isSimple=!(Number(e.shear.toFixed(9))||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate);e.isSuperSimple=!Number(e.shear.toFixed(9))&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate;e.noRotation=!Number(e.shear.toFixed(9))&&!e.rotate;return e};t.toString=function(){var e=this.split(),t="";if(Number(e.shear.toFixed(9)))return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]+")";e.scalex=+e.scalex.toFixed(4);e.scaley=+e.scaley.toFixed(4);e.rotate=+e.rotate.toFixed(4);(e.dx||e.dy)&&(t+="translate("+[+e.dx.toFixed(4),+e.dy.toFixed(4)]+")");1===e.scalex?1!==e.scaley&&(t+=(t?" ":"")+"scaleY("+e.scaley+")"):t+=1===e.scaley?(t?" ":"")+"scaleX("+e.scalex+")":e.scalex===e.scaley?(t?" ":"")+"scale("+e.scalex+")":(t?" ":"")+"scale("+[e.scalex,e.scaley]+")";e.rotate&&(t+=(t?" ":"")+"rotate("+ +e.rotate.toFixed(3)+"deg)");return t}}(e.prototype);return e});define("vanilla-extract/public/js/core/utils/CSSUtil",["jquery","underscore","plugin-dependencies","../models/PSDSettingsModel","../models/UserSettingsModel","../Constants","./Matrix"],function(e,t,i,n,s,r,a){"use strict";var o={cssPreprocessors:{css:{displayName:"CSS",formatString:function(e,t,i){return e?e+": "+o.formatCSSValue(e,t)+";"+(i?" /* "+i+" */":""):i?"/* "+i+" */":void 0},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+': </span><span class="color-chip" style="background-color: '+e.value+';"></span> <span class="value">'+e.value+";</span>";case void 0:case null:if(e.comment)return'<span class="comment">/* '+e.comment+" */</span>";break;default:return'<span class="property">'+e.property+': </span> <span class="value">'+t.escape(e.value)+";</span>"+(e.comment?'<span class="comment">/* '+e.comment+" */</span>":"")}}},scssBourbon:{displayName:"SCSS+Bourbon",formatString:function(e,t,i){switch(e){case"background":return"@include "+e+"("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){switch(e.property){case"background":return'<span class="value">@include</span> <span class="property">'+e.property+'</span> <span class="value">('+e.value+");</span>";default:return o.cssPreprocessors.css.listItem(e)}}},sassCompass:{enabled:!i.parfait,displayName:"SCSS+Compass",formatString:function(e,t,i){switch(e){case"background":return"@include "+e+"("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background":return'<span class="value">@include</span> <span class="property">'+e.property+'</span> <span class="value">('+e.value+");</span>";case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+': </span><span class="color-chip" style="background-color: '+e.value+'"></span> <span class="value">'+e.value+";</span>";default:return'<span class="property">'+e.property+': </span> <span class="value">'+t.escape(e.value)+";</span>"}}},stylusNib:{enabled:!i.parfait,displayName:"Stylus+Nib",formatString:function(e,t,i){return e+" "+o.formatCSSValue(e,t,i)},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background":return'<span class="property">'+e.property+'</span> <span class="value">'+e.value+"</span>";case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+' </span><span class="color-chip" style="background-color: '+e.value+'"></span> <span class="value">'+e.value+"</span>";default:return'<span class="property">'+e.property+' </span> <span class="value">'+t.escape(e.value)+"</span>"}}},lessHat:{enabled:!0,displayName:"LESS+Hat",formatString:function(e,t,i){switch(e){case"background":return".background-image("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){switch(e.property){case"background":return'<span class="property">.background-image</span><span class="value">('+e.value+");</span>";default:return o.cssPreprocessors.css.listItem(e)}}}},getSpacer:function(e){var t="<br/>";e.label.length&&(t+='<span class="property">'+e.label+"</span>");return t},applyCSS:function(i,n,s){var r=n.getCSS(s);r&&t.each(r,function(t){e(i).css(t.property,t.value)})},formatCSSString:function(e,t){t=t||"css";return this.cssPreprocessors[t].formatString(e.property,e.value,e.comment)},formatCSSValue:function(e,t){var i=t?t.toString().trim():"";"font-family"===e&&-1!==i.indexOf(" ")&&0!==i.indexOf("'")&&i.lastIndexOf("'")!==i.length-1&&(i="'"+t+"'");return i},getDefaultColorString:function(e,t,i,n){var s;s=null!==n&&void 0!==n&&1!==n?"rgba("+Math.round(e)+", "+Math.round(t)+", "+Math.round(i)+", "+n+")":this.rgbToHEX(e,t,i);return s},rgbToHEX:function(e,t,i){return"#"+((1<<24)+(Math.round(e)<<16)+(Math.round(t)<<8)+Math.round(i)).toString(16).slice(1)},rgbaToHSL:function(e,t,i,n){(null===n||void 0===n)&&(n=1);var s,r,a,o="";s=e/255;r=t/255;a=i/255;var l,d,c=Math.max(s,r,a),h=Math.min(s,r,a),p=(c+h)/2;if(c===h)l=d=0;else{var u=c-h;d=p>.5?u/(2-c-h):u/(c+h);switch(c){case s:l=60*(r-a)/u;break;case r:l=60*(a-s)/u+120;break;case a:l=60*(s-r)/u+240}}l=Math.round(l+360)%360;d=Math.round(100*d);p=Math.round(100*p);o=1===n?"hsl("+l+", "+d+"%, "+p+"%)":"hsla("+l+", "+d+"%, "+p+"%, "+parseFloat(n)+")";return o},fontStyleNameToCSS:function(e){var t=[],i=e.toLowerCase();-1!==i.indexOf("regular")||-1!==i.indexOf("normal")?t.push({property:"font-weight",value:"400"}):-1!==i.indexOf("thin")?t.push({property:"font-weight",value:"100"}):-1!==i.indexOf("light")?-1!==i.indexOf("extra light")||-1!==i.indexOf("extralight")||-1!==i.indexOf("ultra light")||-1!==i.indexOf("ultralight")?t.push({property:"font-weight",value:"200"}):t.push({property:"font-weight",value:"300"}):-1!==i.indexOf("book")||-1!==i.indexOf("demi")?-1!==i.indexOf("demibold")?t.push({property:"font-weight",value:"600"}):t.push({property:"font-weight",value:"300"}):-1!==i.indexOf("medium")?t.push({property:"font-weight",value:"500"}):-1!==i.indexOf("semibold")?t.push({property:"font-weight",value:"600"}):-1!==i.indexOf("bold")?t.push({property:"font-weight",value:"700"}):-1!==i.indexOf("heavy")?t.push({property:"font-weight",value:"800"}):-1!==i.indexOf("black")&&t.push({property:"font-weight",value:"900"});-1!==e.indexOf("Italic")?t.push({property:"font-style",value:"italic"}):-1!==e.indexOf("Oblique")&&t.push({property:"font-style",value:"oblique"});return t},hasWhiteSpace:function(e){return e.indexOf(" ")>=0},_camelCapsToSpaces:function(e){return e.replace(/([A-Z]+)/g," $1").replace(/([A-Z][a-z])/g," $1").replace(/\s+/g," ").trim()},getFontInfo:function(e){var t,i,n={},s=e.fontName,r=s,a="Regular";n.coolTypeResolved=e.cooltypeFontResolved;e.hasOwnProperty("fontStyleName")&&(a=e.fontStyleName);if(n.coolTypeResolved)s&&(r=this._camelCapsToSpaces(s));else{t=e.postscriptFontName;i=t.indexOf("-");if(-1!==i){s=t.substring(0,i);a=t.substring(i+1,t.length)}else s=t;r=this._camelCapsToSpaces(s)}n.fontName=s;n.fontFace=a;n.friendlyName=r;var o=this.parseCSSMeasure(e.size);o.val=+parseFloat(o.val).toFixed(2);n.size=o.val+(o.units||"");return n},getTransformedFontScale:function(e){if(e.get("transform")){var t=o.getCSSTransform(e.get("transform"));if(t&&""!==t.toString()){var i=t.split();return Math.min(i.scalex,i.scaley)}}return 1},parseCSSMeasure:function(e){if("object"==typeof e&&(e.val||0===e.val)&&e.units)return e;if("number"==typeof e)return{val:e,units:r.FontUnitType.PX};if("string"!=typeof e)return{val:0,units:r.FontUnitType.PX};var t=e.match(/([+\-]?[\d\.]*)\s?([a-zA-Z%]+)/);return t?{val:t[1],units:t[2]||r.FontUnitType.PX}:void 0},layerEffectStrokesToCSS:function(e,i){var n=[];if(i&&i.length>0){e.type!==r.Shape.ELLIPSE&&e.type!==r.Shape.RECTANGLE&&(e.bottomLeftRadius||e.bottomRightRadius||e.topLeftRadius||e.topRightRadius)&&(n=this.getBorderRadiusCSS(e.bottomLeftRadius,e.bottomRightRadius,e.topLeftRadius,e.topRightRadius));t.each(i,function(e){if("normal"===e.mode.toLowerCase()&&"outsetframe"===e.style.toLowerCase()||"insetframe"===e.style.toLowerCase()){n.push({property:"border-style",value:"solid"});if(e.size>0){var t=this.parseCSSMeasure(e.size);n.push({property:"border-width",value:t.val+t.units})}var i=e.color;i&&"rgbcolor"===e.colorType.toLowerCase()&&n.push({property:"border-color",value:this.getDefaultColorString(i.red,i.green,i.blue,e.opacity<100?e.opacity:null)});"insetframe"===e.style.toLowerCase()&&n.push({property:"box-sizing",value:"border-box"})}},this)}return n},strokeToCSS:function(e,t){var i=[],n=e.stroke;(null===t||void 0===t)&&(t=1);e.type!==r.Shape.ELLIPSE&&e.type!==r.Shape.RECTANGLE&&(e.bottomLeftRadius||e.bottomRightRadius||e.topLeftRadius||e.topRightRadius)&&(i=this.getBorderRadiusCSS(e.bottomLeftRadius,e.bottomRightRadius,e.topLeftRadius,e.topRightRadius));if(n){if(n.strokeStyleLineWidth){var s=this.parseCSSMeasure(n.strokeStyleLineWidth,"px");if("pt"===s.units&&n.strokeStyleResolution){s.units="px";s.val=s.val*n.strokeStyleResolution/r.DefaultPPI}i.push({property:"border-width",value:s.val+s.units})}if(n.strokeStyleContent){var a=n.strokeStyleContent,o=a.color,l=+(t*n.strokeStyleOpacity/100).toFixed(2);a["class"]===r.ContentType.SOLID_COLOR&&o&&i.push({property:"border-color",value:this.getDefaultColorString(o.red,o.green,o.blue,l)})}if(n.strokeStyleLineDashSet){var d=n.strokeStyleLineDashSet;0===d.length?i.push({property:"border-style",value:"solid"}):2===d.length&&(0===this.parseCSSMeasure(d[0]).val?i.push({property:"border-style",value:"dotted"}):i.push({property:"border-style",value:"dashed"}))}}return i},getShadowCSS:function(e,t){var i,n={property:"",value:""};e===r.Type.LAYER_TEXT?n.property="text-shadow":n.property="box-shadow";if(Array.isArray(t))for(var s=0;s<t.length;s++)t[s].enabled&&(n.value+=(""!==n.value?", ":"")+this.getShadowCSSText(e,i,t[s]));else n.value=this.getShadowCSSText(e,i,t);return n},getShadowCSSText:function(e,t,i){var n,s,a,o,l,d,c;o=void 0===i.blur||null===i.blur?5:i.blur;l=i.chokeMatte||0;d=parseFloat((o*l/100).toFixed(2));n=Math.round(-i.distance*Math.cos(this.degreesToRadians(i.localLightingAngle)));s=Math.round(i.distance*Math.sin(this.degreesToRadians(i.localLightingAngle)));a=i.color;c=n+"px "+s+"px";c+=" "+ +(o-d).toFixed(2)+"px";e!==r.Type.LAYER_TEXT&&(c+=" "+d+"px");a&&(c+=" "+this.getDefaultColorString(a.red,a.green,a.blue,i.opacity/100));return c},degreesToRadians:function(e){return Math.PI/180*e},getBorderRadiusCSS:function(e,t,i,n){var s=[];if(e&&e===t&&i===n&&e===i)s.push({property:"border-radius",value:e+"px"});else{e&&s.push({property:"border-bottom-left-radius",value:e+"px"});t&&s.push({property:"border-bottom-right-radius",value:t+"px"});i&&s.push({property:"border-top-left-radius",value:i+"px"});n&&s.push({property:"border-top-right-radius",value:n+"px"})}return s},addCSS:function(e,t){e.push(t)},applyPrefixedStyle:function(e,t,i){var n={};n[t]=i;n["-moz-"+t]=i;n["-webkit-"+t]=i;n["-o-"+t]=i;n["-ms-"+t]=i;e.css(n)},getCSSTransform:function(e){return new a(e.xx,e.xy,e.yx,e.yy,0,0)},findModelResolution:function(e){return e.get("imgdata")?e.get("imgdata").pixelsPerInch||r.DefaultPPI:e.get("parentModel")?this.findModelResolution(e.get("parentModel")):r.DefaultPPI},convertUnits:function(e,t,i){var s=n.get("baseFontSizeValue");i=i||s;e=this.parseCSSMeasure(e);var a;if(e.units===r.FontUnitType.PX)a=e.val;else if(e.units===r.FontUnitType.PT)a=e.val;else if(e.units===r.FontUnitType.EMS)a=e.val*i;else{if(e.units!==r.FontUnitType.REMS)throw new Error("Unrecognized input unit: "+e.units);a=e.val*s}var o;if(t===r.FontUnitType.PX)o=a;else if(t===r.FontUnitType.PT)o=a;else if(t===r.FontUnitType.EMS)o=a/i;else{if(t!==r.FontUnitType.REMS)throw new Error("Unrecognized preferred unit: "+t);o=a/s}return o},convertPSDUnitsToPreferredUnits:function(e,t,i){var n=s.get("preferredFontUnits"),r=this.convertUnits(e,n,i);r=+parseFloat(r).toFixed(3);return t?r+n:r}};return o});define("vanilla-extract/public/js/core/models/ColorModel",["underscore","backbone","../utils/CSSUtil"],function(e,t,i){"use strict";var n=t.Model.extend({defaults:{red:"",green:"",blue:"",alpha:1},parse:function(e){var t={};t.red=Math.round(e.red);t.green=Math.round(e.green);t.blue=Math.round(e.blue);return t},isEqual:function(e,t){var i=e&&e instanceof n&&this.get("red")===e.get("red")&&this.get("green")===e.get("green")&&this.get("blue")===e.get("blue");t&&(i=i&&this.get("alpha")===e.get("alpha"));return i},toRGBString:function(e){var t="("+this.get("red")+", "+this.get("green")+", "+this.get("blue"),i="";i=1===e||null===e||void 0===e?"rgb"+t+")":"rgba"+t+", "+parseFloat(e)+")";return i},toHEXString:function(e){(null===e||void 0===e)&&(e=1);var t=i.rgbToHEX(this.get("red"),this.get("green"),this.get("blue")),n="";1!==e&&null!==e&&void 0!==e&&(n="; opacity: "+e+";");return t+n},toHSLString:function(e){var t=i.rgbaToHSL(this.get("red"),this.get("green"),this.get("blue"),e);return t}});return n});define("vanilla-extract/public/js/core/models/TextStyleModel",["underscore","backbone","../utils/CSSUtil"],function(e,t,i){"use strict";var n=t.Model.extend({defaults:{fontName:"",fontFace:"",size:"",sizeUnits:""},parse:function(e){return i.getFontInfo(e)},isEqual:function(e){return e&&e instanceof n&&this.get("fontName")===e.get("fontName")&&this.get("fontFace")===e.get("fontFace")&&this.get("size")===e.get("size")},toString:function(){return this.get("fontName")+","+this.get("fontFace")+","+this.get("size")},getCSS:function(e,t){var n=[{property:"font-family",value:this.get("fontName")},{property:"font-size",value:i.convertPSDUnitsToPreferredUnits(this.get("size"),!0)}],s=i.fontStyleNameToCSS(this.get("fontFace"));s.length>0&&(n=n.concat(s));return n}});return n});define("vanilla-extract/public/js/core/models/GradientModel",["underscore","backbone","../utils/CSSUtil"],function(e,t,i){"use strict";var n=t.Model.extend({compiledColorStops:[],defaults:{enabled:!0,reverse:!1,align:!0,opacity:100,angle:0,mode:"normal",type:"linear",gradient:null},initialize:function(){this.set("layers",[]);var e=this.get("angle"),t=this.get("type"),i=this.get("layerModel").get("bounds"),n=i.bottom-i.top,s=i.right-i.left,r=this.getGradientLineLengthPhotoshop(i),a=Math.abs(s*Math.sin(e))+Math.abs(n*Math.cos(e)),o=e%45===0||"linear"!==t?1:Math.min(r/a,1);this.set("percentageOfOriginalDimension",o);this.generateColorStops()},isEqual:function(e){return e&&this.get("reverse")===e.get("reverse")&&this.get("angle")===e.get("angle")&&this.get("type")===e.get("type")&&this.get("percentageOfOriginalDimension")===e.get("percentageOfOriginalDimension")&&JSON.stringify(this.get("gradient"))===JSON.stringify(e.get("gradient"))},toString:function(){return JSON.stringify(this.get("gradient"))+","+this.get("reverse")+","+this.get("angle")+","+this.get("type")+","+this.get("percentageOfOriginalDimension")},linearInterp:function(e,t,i){return Math.round(e*(i-t)+t)},getColorForLocation:function(t,i){if(t){var n,s,r,a,o,l=t.length,d=l-1;if(i<=t[0].location)return e.clone(t[0].color);if(i>=t[d].location)return e.clone(t[d].color);for(n=1;l>n;n++){s=t[n];if(s.location===i)return e.clone(s.color);if(s.location>i){r=t[n-1];a=(i-r.location)/(s.location-r.location);o={red:this.linearInterp(a,r.color.red,s.color.red),green:this.linearInterp(a,r.color.green,s.color.green),blue:this.linearInterp(a,r.color.blue,s.color.blue),alpha:this.linearInterp(a,r.color.alpha,s.color.alpha)};return o}}}return{}},getOpacityForLocation:function(e,t){if(e){var i,n,s,r,a,o=e.length,l=o-1;if(t<=e[0].location)return e[0].opacity;if(t>=e[l].location)return e[l].opacity;for(i=1;o>i;i++){n=e[i];if(n.location===t)return n.opacity;if(n.location>t){s=e[i-1];r=(t-s.location)/(n.location-s.location);a=this.linearInterp(r,s.opacity,n.opacity);return a}}}return 100},generateColorStopString:function(e,t,n){(null===n||void 0===n)&&(n=1);var s=i.getDefaultColorString(e.color.red,e.color.green,e.color.blue,e.color.alpha*n)+" ",r=Math.floor(e.location/4096*100),a=Math.round(r*t+100*(1-t)/2);s+=a+"%";return s},generateColorStops:function(){var t,i,n,s,r=this.get("gradient").transparency,a=r?r.length:0,o=this.get("gradient").colors,l={};if(!o)return[];this.compiledColorStops=[];for(s=0;s<o.length;s++){var d=e.clone(o[s]);if(50!==d.midpoint&&s>0){n=d.midpoint/100;i=o[s-1];var c={};c.location=this.linearInterp(n,i.location,d.location);c.color={red:this.linearInterp(c.location/4096,i.color.red,d.color.red),green:this.linearInterp(c.location/4096,i.color.green,d.color.green),blue:this.linearInterp(c.location/4096,i.color.blue,d.color.blue),alpha:this.getOpacityForLocation(r,c.location)/100};this.compiledColorStops.push(c);l[c.location]=!0}d.color.alpha=this.getOpacityForLocation(r,d.location)/100;this.compiledColorStops.push(d);l[d.location]=!0}for(s=0;a>s;s++)if(!l[r[s].location]){t=!1;a>1&&(0===s?r[0].opacity===r[1].opacity&&(t=!0):s===a-1?r[a-2].opacity===r[a-1].opacity&&(t=!0):a>2&&r[s].opacity===r[s-1].opacity&&r[s].opacity===r[s+1].opacity&&(t=!0));if(!t){var h={};h.location=r[s].location;h.color=this.getColorForLocation(this.compiledColorStops,h.location);h.color.alpha=r[s].opacity/100;this.compiledColorStops.push(h)}}this.compiledColorStops.sort(function(e,t){return e.location<t.location?-1:e.location>t.location?1:0});if(this.get("reverse")){var p,u,g,f=this.compiledColorStops.length,m=f-1;this.compiledColorStops.reverse();for(s=0;s<Math.floor(f/2);s++){u=this.compiledColorStops[s];g=this.compiledColorStops[m-s];p=u.location;u.location=g.location;g.location=p}}},getCSS:function(e,t){var i,n,s="";for(n=0;n<this.compiledColorStops.length;n++)s+=this.generateColorStopString(this.compiledColorStops[n],this.get("percentageOfOriginalDimension"),t)+", ";s=s.substring(0,s.length-2)+")";switch(this.get("type")){case"linear":i="linear-gradient("+this.get("angle")+"deg, "+s;s="linear-gradient("+(90-this.get("angle"))+"deg, "+s;break;case"radial":var r="circle ",a=Math.abs(this.get("angle")),o=(this.get("scale")||100)/100,l=this.get("layerModel").get("bounds"),d=l.bottom-l.top,c=l.right-l.left;r+=0===a||180===a?c>d?"farthest-side":"closest-side":90===a||270===a?d>c?"farthest-side":"closest-side":Math.round(o*this.getGradientLineLengthPhotoshop(l))+"px";s="radial-gradient("+r+" at 50%, "+s;i=s;break;default:console.warn("Unknown gradient type: ",this.get("type"));return[]}return e?[{property:"background",value:"-webkit-"+i},{property:"background",value:"-moz-"+i},{property:"background",value:"-o-"+i},{property:"background",value:"-ms-"+i},{property:"background",value:s}]:[{property:"background",value:s}]},getGradientLineLengthPhotoshop:function(e){var t=.5*(e.left+e.right),i=.5*(e.top+e.bottom),n=this.get("angle"),s=0>n;s&&(n=-n);var r,a,o,l,d,c={},h={},p=.5*(e.right-e.left),u=.5*(e.bottom-e.top);if(90===n){r=t;a=s?e.bottom:e.top}else{var g=p>=u?p:u;if(0===g){a=i;r=t}else{var f={top:i-g,left:t-g,bottom:i+g,right:t+g};if(45>=n){o=n/45;d=g*o;if(p>=u){a=i+d;if(a>e.bottom){r=t+g/d*u;a=e.bottom}else r=f.right}else{a=i+d/g*p;r=e.right}}else if(90>=n){n-=45;o=1-n/45;l=g*o;if(u>=p){r=t+l;if(r>e.right){a=0!==l?i+g/l*p:i;r=e.right}else a=f.bottom}else{r=t+l/g*u;a=e.bottom}}else if(135>=n){n-=90;o=n/45;l=g*o;if(u>=p){r=t-l;if(r<e.left){a=0!==l?i+g/l*p:i;r=e.left}else a=f.bottom}else{r=t-l/g*u;a=e.bottom}}else{n-=135;o=1-n/45;d=g*o;if(p>=u){a=i+d;if(a>e.bottom){r=0!==d?t-g/d*u:t;a=e.bottom}else r=f.left}else{a=i+d/g*p;r=e.left}}s||(a=i-(a-i))}}var m=0,v=0;if("linear"===this.get("type")){h.h=Math.round(r+m);h.v=Math.round(a+v);c.h=Math.round(t+(t-r)+m);c.v=Math.round(i+(i-a)+v)}else{c.h=Math.round(t+m);c.v=Math.round(i+v);h.h=Math.round(r+m);h.v=Math.round(a+v)}var y=Math.abs(c.h-h.h),b=Math.abs(c.v-h.v);return Math.sqrt(y*y+b*b)}});return n});define("vanilla-extract/public/js/core/models/LayerPropertiesModel",["underscore","backbone","../Constants","./ColorModel","./TextStyleModel","./GradientModel"],function(e,t,i,n,s,r){"use strict";var a=t.Model.extend({defaults:{layerType:"",colors:null,gradients:null,textStyles:null},enabledGradientTypes:{linear:!0,radial:!0,angle:!1,reflected:!1,diamond:!1,shapeburst:!1},enabledGradientForms:{customStops:!0,colorNoise:!1},initialize:function(e){this.layerType=e.layerType},layerEffectsAreTransparent:function(){var e=this.get("layerEffects"),t=function(e){return e.enabled&&100===e.opacity};return e&&e.solidFill.some(t)?!1:!0},getColorsFromEffects:function(t){var i,s=this.get("layerEffects"),r=this;s&&s.solidFill&&e.each(s.solidFill,function(e){if(e.enabled){i=new n;r.setColorModelAlpha(e.opacity,i);t.push(i.set(i.parse(e.color,{parse:!0})))}});return this.layerEffectsAreTransparent()},getColors:function(){var e,t=this.get("colors");if(null===t){t=[];var s,r,a,o;switch(this.layerType){case i.Type.LAYER_CONTENT:s=this.get("color");r=this.get("shape");a=this.getColorsFromEffects(t);if(s){if(a){o=new n;t.push(o.set(o.parse(s,{parse:!0})));this.checkFillOpacity(o)}if(r&&r.stroke){var l=r.stroke;if(l.strokeStyleContent){var d=l.strokeStyleContent;s=d.color;if(s){o=new n;this.checkStrokeOpacity(o);t.push(o.set(o.parse(s,{parse:!0})))}}}}break;case i.Type.LAYER_TEXT:var c=this.get("textStyleRange");if(c&&this.getColorsFromEffects(t))for(e=0;e<c.length;e++){s=c[e].textStyle.color;if(s){o=new n;t.push(o.set(o.parse(s,{parse:!0})));this.checkFillOpacity(o)}}}}return t},checkFillOpacity:function(e){var t=this.get("blendOptions"),i=this.get("shape"),n=1;if(t){t.hasOwnProperty("opacity")&&(n*=t.opacity/100);i&&i.fillEnabled&&t.hasOwnProperty("fillOpacity")&&(n*=t.fillOpacity/100);this.setColorModelAlpha(100*n,e)}},checkStrokeOpacity:function(e){var t=this.get("blendOptions"),i=this.get("shape"),n=i.stroke,s=1;if(t){t.hasOwnProperty("opacity")&&(s*=t.opacity/100);n.hasOwnProperty("strokeStyleOpacity")&&(s*=n.strokeStyleOpacity/100);i&&!i.fillEnabled&&t.hasOwnProperty("fillOpacity")&&(s*=t.fillOpacity/100);this.setColorModelAlpha(100*s,e)}},setColorModelAlpha:function(e,t){t.set("alpha",+(e/100).toFixed(2))},getGradients:function(){var e=this.get("gradients");if(null===e){e=[];if(this.layerType===i.Type.LAYER_CONTENT){e=this.getGradientEffects();if(this.layerEffectsAreTransparent()&&"gradientLayer"===this.get("class")&&this.enabledGradientTypes[this.get("type")]&&this.enabledGradientForms[this.get("gradient").gradientForm]){var t=new r(this.toJSON(),{parse:!0});e.push(t)}}}return e},getTextStyles:function(){var e,t=this.get("textStyles");if(null===t){t=[];if(this.layerType===i.Type.LAYER_TEXT&&""!==this.get("rawText")){var n,r,a=this.get("textStyleRange");if(a)for(e=0;e<a.length;e++){n=a[e].textStyle;r=new s;t.push(r.set(r.parse(n,{parse:!0})))}}}return t},getGradientEffects:function(){var e,t,n=null,s=[];if(this.layerType===i.Type.LAYER_CONTENT){t=this.get("layerEffects");if(t){if(t.gradientFill)for(var r=0;r<t.gradientFill.length;r++)if(t.gradientFill[r].enabled){e=this.getGradientEffect(t.gradientFill[r]);e&&s.push(e)}if(t.innerGlow&&t.innerGlow.gradient&&t.innerGlow.enabled){n=t.innerGlow;e=this.getGradientEffect(n);e&&s.push(e)}else if(t.outerGlow&&t.outerGlow.gradient&&t.outerGlow.enabled){n=t.outerGlow;e=this.getGradientEffect(n);e&&s.push(e)}}}return s},getGradientEffect:function(e){if(this.enabledGradientTypes[e.type]){e.layerModel=this.get("layerModel");return new r(e,{parse:!0})}return null}});return a});define("vanilla-extract/public/js/core/models/BaseStyleUsageModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{style:null,layers:null},initialize:function(){this.set("layers",[])},addUsage:function(e){var t=this.get("layers");-1===t.indexOf(e)&&t.push(e)}});return i});define("vanilla-extract/public/js/core/models/ColorUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var n=i.extend({defaults:{alphas:null},alphaMap:null,initialize:function(e){i.prototype.initialize.apply(this,arguments);this.set("alphas",[]);this.alphaMap={}},addUsage:function(e,t){i.prototype.addUsage.apply(this,arguments);var s,r,a,o,l,d,c,h=!1;if(t instanceof n){o=t.get("style");r=o.get("alpha");l=t.get("alphas");for(d=0,c=l.length;c>d;d++){a=void 0===l[d]?1:l[d];o.set("alpha",a);this.addUsage(e,o)}o.set("alpha",r)}else{s=t.get("alpha");for(a in this.alphaMap)if(this.alphaMap.hasOwnProperty(a)&&a===String(s)){h=!0;this.alphaMap[a].push(e)}if(!h){this.alphaMap[s]=[e];this.get("alphas").push(s)}}}});return n});define("vanilla-extract/public/js/core/models/GradientUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var n=i.extend({});return n});define("vanilla-extract/public/js/core/models/TextStyleUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var n=i.extend({});return n});define("vanilla-extract/public/js/core/models/LayerModelMap",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{psdLayersMap:{},layerNameMap:{}},initialize:function(){this.reset()},addLayerToMap:function(e,t,i,n){this.get("psdLayersMap")[e]={item:t,flattenedItem:i,model:n};this.get("layerNameMap")[n.get("layerName")]=n},addModel:function(e,t){this.idToModelMap[e]=t;
},getLayerInfoForId:function(e){return this.get("psdLayersMap")[e]},getLayerModelFromId:function(e){var t=this.get("psdLayersMap")[e];return t?t.model:null},getLayerModelFromName:function(e){return this.get("layerNameMap")[e]},getModel:function(e){return this.idToModelMap[e]},reset:function(){this.idToModelMap={};this.flattenedLayers=[]},addFlattenedLayer:function(e){this.flattenedLayers.push(e)},getFlattenedLayers:function(){return this.flattenedLayers}});return new i});define("vanilla-extract/public/js/core/models/UsageModelMap",["underscore","backbone","./ColorUsageModel","./GradientUsageModel","./TextStyleUsageModel"],function(e,t,i,n,s){"use strict";var r=t.Model.extend({defaults:{usageModelMap:null,colorUsageModelArray:null,gradientUsageModelArray:null,textStyleUsageModelArray:null},initialize:function(){this.reset()},addUsageModelToMap:function(e,t){if(t instanceof i){this.get("usageModelMap")[e]=t;this.get("colorUsageModelArray").push(t)}else if(t instanceof n){this.get("usageModelMap")[e]=t;this.get("gradientUsageModelArray").push(t)}else if(t instanceof s){this.get("usageModelMap")[e]=t;this.get("textStyleUsageModelArray").push(t)}else console.warn("Unknown usageModel type. Not added to map")},getColorUsageModelList:function(){return this.get("colorUsageModelArray")},getGradientUsageModelList:function(){return this.get("gradientUsageModelArray")},getTextStyleUsageModelList:function(){return this.get("textStyleUsageModelArray")},getUsageModelForStyle:function(e){return this.get("usageModelMap")[e]},reset:function(){this.set("usageModelMap",{});this.set("colorUsageModelArray",[]);this.set("gradientUsageModelArray",[]);this.set("textStyleUsageModelArray",[])}});return new r});define("vanilla-extract/public/js/core/utils/MeasurementUtil",["underscore","../models/PSDSettingsModel","../models/UserSettingsModel","../Constants"],function(e,t,i,n){"use strict";var s={calcLayerGroupBounds:function(e,t){var i,n,s;if(e&&!(e.length<1)){i=this.getVisibleBounds(e[0],t);n={top:i.top,left:i.left,bottom:i.bottom,right:i.right};for(s=1;s<e.length;s++){i=this.getVisibleBounds(e[s],t);n.top=Math.min(n.top,i.top);n.left=Math.min(n.left,i.left);n.bottom=Math.max(n.bottom,i.bottom);n.right=Math.max(n.right,i.right)}return n}},boundsIntersect:function(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top},getVisibleBounds:function(e,i,n){var s,r,a=i.get("imgdata").bounds,o=e.getArtboardParent(),l=o?o.get("bounds"):{top:0,left:0,bottom:a.bottom,right:a.right},d=t.get("designedAtMultiplier");s=e.zeroRawBounds()||n?e.get("bounds"):e.get("rawBounds");r={top:Math.max(0,s.top,l.top),left:Math.max(0,s.left,l.left),bottom:Math.min(a.bottom,s.bottom,l.bottom),right:Math.min(a.right,s.right,l.right)};r.width=r.right-r.left;r.height=r.bottom-r.top;r.displayLeft=Math.round(r.left/d);r.displayRight=Math.round(r.right/d);r.displayTop=Math.round(r.top/d);r.displayBottom=Math.round(r.bottom/d);return r},layer1ContainsLayer2:function(e,t){var i=graphite.getDetailsController().getPSDModel(),n=this.getVisibleBounds(e,i),s=this.getVisibleBounds(t,i);return this.rect1ContainsRect2(n,s)},getMeasurementsOfLayerAgainstPSDBounds:function(e){var t=this.getVisibleBounds(e,graphite.getDetailsController().getPSDModel());return e.getArtboardParent()?this.getMeasurementsOfRectInsideRect(t,e.getArtboardParent().get("bounds"),!0):this.getMeasurementsOfRectAgainstPSDBounds(t)},getMeasurementsOfRectAgainstPSDBounds:function(e){var t=graphite.getDetailsController().getPSDModel().get("imgdata").bounds;return this.getMeasurementsOfRectInsideRect(e,t,!1)},getMeasurementsOfRectInsideRect:function(s,r,a){var o=e.clone(s),l=i.get("preferredMeasurementUnits"),d=t.get("designedAtMultiplier");if(a){o.displayLeft=o.left-r.left;o.displayTop=o.top-r.top}o.width=o.right-o.left;o.height=o.bottom-o.top;r.width=r.right-r.left;r.height=r.bottom-r.top;o.percentWidth=+(o.width/r.width*100).toFixed(1);o.displayWidth=(l===n.MeasurementUnitType.PX?Math.round(o.width/d):o.percentWidth)+l;o.percentHeight=+(o.height/r.height*100).toFixed(1);o.displayHeight=(l===n.MeasurementUnitType.PX?Math.round(o.height/d):o.percentHeight)+l;return o},setLayerBounds:function(e,t,i,s,r){var a,o=i.get("bounds"),l=graphite.getDetailsController().getPSDModel().get("imgdata").bounds,d=s?s.get("bounds"):null;d||(d={top:0,left:0});var c=o.top,h=o.left,p=o.right,u=o.bottom,g=d.left,f=d.top;if(t){a=i.get("flattenedSprite");h=a.psdOrigin.left;c=a.psdOrigin.top;p=h+(a.bounds.right-a.bounds.left);u=c+(a.bounds.bottom-a.bounds.top)}if(r.clipLayersToImage){c=Math.max(0,c);h=Math.max(0,h);p=Math.min(l.right,p);u=Math.min(l.bottom,u);g=Math.max(0,g);f=Math.max(0,f)}e.css("top",c-f);e.css("left",h-g);if(i.get("type")!==n.Type.LAYER_GROUP&&i.get("type")!==n.Type.LAYER_ARTBOARD||t)if(0>p-h||0>u-c){e[0].width=0;e[0].height=0}else{e[0].width=p-h;e[0].height=u-c}else{e.css("width",p-h+"px");e.css("height",u-c+"px")}return{top:c,left:h,bottom:u,right:p}},rect1ContainsRect2:function(e,t){return e.left<=t.left&&e.top<=t.top&&e.right>=t.right&&e.bottom>=t.bottom},getClippedBounds:function(e,t){return{left:Math.max(e.left,0),top:Math.max(e.top,0),right:Math.min(t.get("width"),e.right),bottom:Math.min(t.get("height"),e.bottom)}}};return s});define("vanilla-extract/public/js/core/utils/UTF8",[],function(){"use strict";var e={decodeCharacters:function(e){e=e||"";for(var t,i,n,s={text:e,index:0,nextChar:function(){var e=null;if(this.index<this.text.length){e=this.text.charCodeAt(this.index);if(65535===e){e=parseInt(this.text.substr(this.index+3,2),16);this.index=this.index+4}this.index=this.index+1}return e},atEnd:function(){return this.index>=this.text.length}},r="";!s.atEnd();){t=s.nextChar();if(128>t)r+=String.fromCharCode(t);else if(t>191&&224>t){i=s.nextChar();r+=String.fromCharCode((31&t)<<6|63&i)}else{i=s.nextChar();n=s.nextChar();r+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&n)}}return r}};return e});define("vanilla-extract/public/js/core/utils/ExtractTextLayerCss",["underscore","plugin-dependencies","../Constants","../models/UserSettingsModel","./CSSUtil","./UTF8"],function(e,t,i,n,s,r){"use strict";var a=t.translate("Approximation due to font substitution"),o={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"};return function(l,d){var c=[],h=[],p=l.get("textStyleRange"),u=r.decodeCharacters(l.get("rawText")),g=l.get("transform")&&s.getCSSTransform(l.get("transform")),f=s.getTransformedFontScale(l);g&&1!==f&&g.scale(1/f);if(p&&p.length>0){for(var m=!1,v=function(t){return e.isEqual(b,t)},y=0;y<p.length;y++){var b=p[y].textStyle,w=p[y].paragraphStyle,S=u.substring(p[y].from,p[y].to),C=e.some(h,v);if(""!==S.trim()&&!C){if(y>=1){c.push({spacer:!0,label:"/* "+t.translate("Inline Style")+" */",property:null,value:null});m=!0}var x=s.getFontInfo(b);c.push({property:"font-family",value:s.formatCSSValue("font-family",x.fontName)});var T,E=l.get("blendOptions");if(1===d.colorUsageModels.length){T=d.colorUsageModels[0].get("style");T={red:T.get("red"),green:T.get("green"),blue:T.get("blue"),alpha:T.get("alpha")}}else T=b.color;E&&E.hasOwnProperty("fillOpacity")&&(T.alpha*=E.fillOpacity/100);c.push({property:"color",value:s.getDefaultColorString(T.red,T.green,T.blue,T.alpha)});var I=s.parseCSSMeasure(x.size);I.val=Math.round(I.val*f*100)/100;var M=s.convertUnits(I,i.FontUnitType.PX);c.push({property:"font-size",value:s.convertPSDUnitsToPreferredUnits(I,!0),comment:x.coolTypeResolved?void 0:a});x.fontFace&&(c=c.concat(s.fontStyleNameToCSS(x.fontFace)));var P;if(b.tracking&&0!==(P=parseInt(b.tracking,10))){var A=P/1e3;c.push({property:"letter-spacing",value:s.convertPSDUnitsToPreferredUnits({val:A,units:i.FontUnitType.EMS},!0,M),comment:x.coolTypeResolved?void 0:a})}if(b.leading){var L,k=s.parseCSSMeasure(b.leading),D=n.get("preferredFontUnits");L=D===i.FontUnitType.PX?+(+k.val).toFixed(3)+D:+(k.val/I.val).toFixed(3);c.push({property:"line-height",value:L,comment:x.coolTypeResolved?void 0:a})}"underlineOn"===b.underline&&c.push({property:"text-decoration",value:"underline"});o.hasOwnProperty(w.textJustification)&&c.push({property:"text-align",value:o[w.textJustification]});w.firstLineIndent&&0!==parseInt(w.firstLineIndent,10)&&c.push({property:"text-indent",value:s.convertPSDUnitsToPreferredUnits(w.firstLineIndent,!0,M)});l.get("dropShadow")&&c.push({property:"text-shadow",value:l.get("dropShadow")});h.push(b)}}g&&""!==g.toString()&&c.push({property:"transform",value:g.toString()});m&&c.push({spacer:!0,label:""})}return c}});define("vanilla-extract/public/js/core/models/LayerModel",["underscore","backbone","plugin-dependencies","../collections/SubLayerCollection","./LayerPropertiesModel","./ColorUsageModel","./GradientUsageModel","./TextStyleUsageModel","./LayerModelMap","./UsageModelMap","./UserSettingsModel","../utils/MeasurementUtil","../Constants","../utils/CSSUtil","../utils/UTF8","../utils/ExtractTextLayerCss"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f){"use strict";var m=t.Model.extend({defaults:{type:"",layerName:"",layerId:"",bounds:"",properties:"",selected:!1,rendered:!1,parentModel:null,flattenedParent:null,flattenedSprite:null,zIndex:0,toplevel:!1,psdGuid:"",layerCollection:null,colors:null,usageModels:null,visible:!1,psdVisible:!1,renderedVisible:!1,smartObjectInfo:null},initialize:function(){this.set("colors",[])},toString:function(){return"[object LayerModel name: "+this.get("layerName")+", layerId: "+this.get("layerId")+", zIndex: "+this.get("zIndex")+"]"},parse:function(t){var r,a={},o=t.children,d=new n(m);a.type=t.type;a.layerName=t.layerName;a.layerId=t.layerId;a.visible=t.visible;void 0===a.visible&&(a.visible=!0);if(t.type===p.Type.LAYER_SMARTOBJ){if(t.hasOwnProperty("smartObjectType"))a.smartObjectType=t.smartObjectType;else if(t.hasOwnProperty("smartObjectInfo")){a.smartObjectType=t.smartObjectInfo.linked?"linked":"embedded ";a.smartObjectInfo=t.smartObjectInfo}}else t.type===p.Type.LAYER_ADJUSTMENT&&t.adjustmentLayer&&(a.adjustmentLayerType=t.adjustmentLayer.type);if(t.type===p.Type.LAYER_ARTBOARD&&t.artboardRect){a.bounds=t.artboardRect;a.rawBounds=t.artboardRect}else{a.bounds=t.bounds;a.rawBounds=t.rawBounds}a.flattenedParent=t.flattenedParent;a.flattenedSprite=t.flattenedSprite;a.isFlattened=void 0!==a.flattenedSprite||void 0!==a.flattenedParent;a.psdVisible=a.renderedVisible=a.visible;if(!t.smartObjectLayer){l.addModel(a.layerId,this);if(t.clipped&&t.hasOwnProperty("clipLayerBaseId")){var c,h=l.getModel(t.clipLayerBaseId);if(h){c=h.get("clippedLayers")||[];c.push(this);h.set("clippedLayers",c);a.clipbase=h}}}a.smartObjectInfo=t.smartObjectInfo;t.hasOwnProperty("spriteSheet")&&(a.spriteSheet=t.spriteSheet);t.flattenedSprite&&l.addFlattenedLayer(this);if(o){d.reset();d.add(o,{parse:!0});a.layerCollection=d}if(!i.parfait&&t.hasOwnProperty("smartObjectData")){a.smartObjectLayers=new n(m);a.smartObjectLayers.reset();e.each(t.smartObjectData.children,function(e){e.smartObjectLayer=!0});a.smartObjectLayers.add(t.smartObjectData.children,{parse:!0})}r=new s({layerType:a.type,layerModel:this});r.set(r.parse(t.properties,{parse:!0}));a.properties=r;return a},getArtboardParent:function(){"undefined"==typeof this.artboardParent&&(this.get("type")===p.Type.LAYER_ARTBOARD?this.artboardParent=this:this.get("parentModel")instanceof m?this.artboardParent=this.get("parentModel").getArtboardParent():this.artboardParent=null);return this.artboardParent},getCSSArray:function(t){var n,s,r,a=[],o=this.get("properties"),l=h.getMeasurementsOfLayerAgainstPSDBounds(this),d=this.get("usageModels"),c=o.get("layerEffects");if(o.layerType===p.Type.LAYER_TEXT)a=a.concat(f(o,d));else if(o.layerType===p.Type.LAYER_CONTENT){s=o.get("shape");r=o.get("blendOptions");var g,m,v,y=r&&r.hasOwnProperty("opacity"),b=r&&r.hasOwnProperty("fillOpacity"),w=y?r.opacity/100:1,S=b?r.fillOpacity/100:1,C=d.gradientUsageModels[0],x=d.colorUsageModels[0],T=x||C,E=s&&s.stroke,I=c&&1===c.solidFill.length?c.solidFill[0]:null,M=c&&1===c.gradientFill.length?c.gradientFill[0]:null;if(s){s.type===p.Shape.ELLIPSE&&a.push({property:"border-radius",value:"50%"});if(s.type===p.Shape.RECTANGLE){m=u.getBorderRadiusCSS(s.bottomLeftRadius,s.bottomRightRadius,s.topLeftRadius,s.topRightRadius);m&&(a=a.concat(m))}}E&&(a=a.concat(u.strokeToCSS(s,T?null:+(w*S).toFixed(2))));c&&c.frameFX&&(a=a.concat(u.layerEffectStrokesToCSS(s,c.frameFX)));if(I&&100===I.opacity&&I.color){n=I.color;a.push({property:"background-color",value:u.getDefaultColorString(n.red,n.green,n.blue)})}else if(!I&&M&&100===M.opacity&&M.gradient){if(C){g=C.get("style");m=g.getCSS(t,v);m&&(a=a.concat(m))}}else{if(s&&s.fillEnabled&&x){v=(E?1:w)*S;v=+v.toFixed(2);n=o.get("color")||x.get("style").attributes;a.push({property:"background-color",value:u.getDefaultColorString(n.red,n.green,n.blue,v)})}if(C){g=C.get("style");m=g.getCSS(t,parseFloat(g.get("opacity"))/100);m&&(a=a.concat(m))}c&&c.solidFill&&e.each(c.solidFill,function(e){n=e.color;a.push({property:"background-color",value:u.getDefaultColorString(n.red,n.green,n.blue,parseFloat(e.opacity)/100)})})}y&&E&&T&&a.push({property:"opacity",value:+w.toFixed(2)});if(o.get("transform")){var P=u.getCSSTransform(o.get("transform"));P&&""!==P.toString()&&a.push({property:"transform",value:P})}}c&&c.masterFXSwitch!==!1&&c.dropShadow&&c.dropShadow.some(function(e){return e.enabled})&&u.addCSS(a,u.getShadowCSS(o.layerType,c.dropShadow));this.isMultipleLayerStylesCSSWarning()&&a.push({comment:i.translate(p.LayerWarnings.MULTI_LAYER_STYLES_WARNING)});if(s&&(s.type===p.Shape.RECTANGLE||s.type===p.Shape.ELLIPSE)&&s.stroke&&s.stroke.strokeStyleLineAlignment&&s.stroke.strokeStyleLineAlignment){l.right-=2*parseInt(s.stroke.strokeStyleLineWidth,10);l.bottom-=2*parseInt(s.stroke.strokeStyleLineWidth,10);l=h.getMeasurementsOfRectInsideRect(l,graphite.getDetailsController().getPSDModel().get("imgdata").bounds,!1)}if(o.get("transform")){for(var A=0;A<a.length;A++)if("transform"===a[A].property){a[A].comment=i.translate("width and height properties ommitted due to transform");break}}else a.push({property:"width",value:l.displayWidth},{property:"height",value:l.displayHeight});return a},isFontSubstitution:function(){if(void 0!==this.fontSubstitution)return this.fontSubstitution;var e,t,i,n,s,r=this.get("properties");if(r.layerType===p.Type.LAYER_TEXT){i=r.get("textStyleRange");n=g.decodeCharacters(r.get("rawText"));if(i&&i.length>0)for(e=0;e<i.length;e++){t=i[e].textStyle;s=n.substring(i[e].from,i[e].to);if(!this.isWhitespace(s)&&!u.getFontInfo(t).coolTypeResolved){this.fontSubstitution=!0;break}}}this.fontSubstitution=this.fontSubstitution||!1;return this.fontSubstitution},isLinkedSmartObject:function(){var e=this.get("smartObjectInfo");return e?e.linked:!1},isMultipleLayerStylesCSSWarning:function(){var e=this.get("properties").get("layerEffects");if(e){if(e&&e.masterFXSwitch!==!1&&(e.frameFX&&e.frameFX.length>1||e.gradientFill&&e.gradientFill.length>1||e.innerShadow&&e.innerShadow.length>1||e.solidFill&&e.solidFill.length>1))return!0;if(e.solidFill[0]&&100!==e.solidFill[0].opacity)return!0;if(e.gradientFill[0]&&100!==e.gradientFill[0].opacity)return!0}return!1},isWhitespace:function(e){e=e.replace(/\s/gm,"");return!e||0===e.length},getCSSAsString:function(e,t){var i,n,s="",r=this.getCSSArray("css"===t),a=r.length;for(i=0;a>i;i++){n=r[i];if(n.property||n.value||n.comment){s+=u.formatCSSString(n,t);i!==a-1&&(s+="\r\n")}}return s},fixupLayerEffects:function(){var e=this.get("properties").get("layerEffects"),t=function(e){return e.enabled};if(e){e.frameFX?Array.isArray(e.frameFX)||(e.frameFX=[e.frameFX]):e.frameFX=[];e.frameFX=e.frameFX.filter(t);e.innerShadow?Array.isArray(e.innerShadow)||(e.innerShadow=[e.innerShadow]):e.innerShadow=[];e.innerShadow=e.innerShadow.filter(t);e.solidFill?Array.isArray(e.solidFill)||(e.solidFill=[e.solidFill]):e.solidFill=[];e.solidFill=e.solidFill.filter(t);e.gradientFill?Array.isArray(e.gradientFill)||(e.gradientFill=[e.gradientFill]):e.gradientFill=[];e.gradientFill=e.gradientFill.filter(t);e.dropShadow?Array.isArray(e.dropShadow)||(e.dropShadow=[e.dropShadow]):e.dropShadow=[];e.dropShadow=e.dropShadow.filter(t)}},getUsageModels:function(){var t,i,n,s,r,a=this.get("usageModels"),o=this,l=function(e){e.get("layers").length=0;e.get("layers").push(o)};if(!a){a={colorUsageModels:[],gradientUsageModels:[],textStyleUsageModels:[]};t=this.get("properties");i=this.get("layerCollection");if(t){this.fixupLayerEffects();this.addColorStyles(a.colorUsageModels,t.getColors());this.addGradientStyles(a.gradientUsageModels,t.getGradients());this.addTextStyles(a.textStyleUsageModels,t.getTextStyles())}if(i)for(r=0;r<i.length;r++){n=i.at(r);s=n.getUsageModels()}i=this.get("smartObjectLayers");if(i)for(r=0;r<i.length;r++){n=i.at(r);s=n.getUsageModels();e.each(s.colorUsageModels,l);e.each(s.gradientUsageModels,l);e.each(s.textStyleUsageModels,l)}this.set("usageModels",a)}return{colorUsageModels:a.colorUsageModels,gradientUsageModels:a.gradientUsageModels,textStyleUsageModels:a.textStyleUsageModels}},addColorStyles:function(t,i){var n,s,a=null;this.set("colors",i);for(var o=0;o<i.length;o++){n=i[o];s=n.toHEXString();a=d.getUsageModelForStyle(s);if(a)a.addUsage(this,n);else{a=new r({style:n});a.addUsage(this,n);d.addUsageModelToMap(s,a)}e.contains(t,a)||t.push(a)}},addGradientStyles:function(t,i){for(var n,s,r=null,o=0;o<i.length;o++){n=i[o];s=n.toString();r=d.getUsageModelForStyle(s);if(r)r.addUsage(this);else{r=new a({style:n});r.addUsage(this);d.addUsageModelToMap(s,r)}e.contains(t,r)||t.push(r)}},addTextStyles:function(t,i){for(var n,s,r=null,a=0;a<i.length;a++){n=i[a];s=n.toString();r=d.getUsageModelForStyle(s);if(r)r.addUsage(this);else{r=new o({style:n});r.addUsage(this);d.addUsageModelToMap(s,r)}e.contains(t,r)||t.push(r)}},isEqual:function(e){return this.get("layerId")===e.get("layerId")},zeroBounds:function(){var e=this.get("bounds");return 0===e.top&&0===e.bottom&&0===e.left&&0===e.right},zeroRawBounds:function(){var e=this.get("rawBounds");return!e||0===e.top&&0===e.bottom&&0===e.left&&0===e.right},isDescendantOf:function(e){for(var t=this.get("parentModel"),i=!1;t&&t instanceof m;){if(t.isEqual(e)){i=!0;break}t=t.get("parentModel")}return i},isEffectiveRenderedVisibility:function(){return this.get("renderedVisible")===this.getEffectiveVisibility()},getEffectiveVisibility:function(){var e,t,i=this.isVisibleOnStage(),n=this.get("parentModel"),s=this.get("layerCollection");i&&n&&n instanceof m&&(i=n.getEffectiveVisibility());if(i&&s){i=!1;for(t=0;t<s.length;t++){e=s.at(t);if(e.get("visible")){i=!0;break}}}return i},getEffectiveOpacity:function(){var e,t,i=this.isVisibleOnStage()?this.getCombinedOpacity():0,n=this.get("parentModel"),s=this.get("layerCollection");0!==i&&n&&n instanceof m&&(i*=n.getEffectiveOpacity());if(i>0&&s){var r=!1;for(t=0;t<s.length;t++){e=s.at(t);if(e.get("visible")){r=!0;break}}r||(i=0)}return i},findDescendantFlattenedSprites:function(){var t=l.getFlattenedLayers(),i=[],n=this;e.each(t,function(e){e.isDescendantOf(n)&&i.push(e)});return i},isVisibleOnStage:function(){var e=this.get("visible"),t=this.get("clipbase"),i=t?t.get("visible"):!0;return e&&i},isLayerShown:function(){for(var e=this,t=!0;t&&e instanceof m;){t=e.get("visible");e=e.get("parentModel")}return t},getCombinedOpacity:function(){var e=this.get("properties")&&this.get("properties").get("blendOptions");if(e){var t=(e.opacity||100)/100,i=(e.fillOpacity||100)/100;return t*i}return 1},canBeExtracted:function(){if(this.getEffectiveVisibility()){if(this.get("type")===p.Type.LAYER_GROUP||this.get("type")===p.Type.LAYER_ARTBOARD){var t=this.get("layerCollection")?this.get("layerCollection").models:[];return e.some(t,function(e,t){return e.canBeExtracted()})}return this.get("type")!==p.Type.LAYER_ADJUSTMENT}return!1}});return m});define("vanilla-extract/public/js/core/utils/StyleUtil",["../models/BaseStyleUsageModel","../models/ColorModel","../models/GradientModel","../models/TextStyleModel"],function(e,t,i,n){"use strict";var s={areUsageStylesEqual:function(s,r){var a=!1;if(s&&r&&s instanceof e&&r instanceof e){var o=s.get("style"),l=r.get("style");(o instanceof t&&l instanceof t||o instanceof i&&l instanceof i||o instanceof n&&l instanceof n)&&(a=o.isEqual(l))}return a}};return s});define("vanilla-extract/public/js/core/controllers/SelectionController",["underscore","backbone","../Constants","../models/LayerModel","../models/LayerModelMap","../models/ColorUsageModel","../models/TextStyleUsageModel","../models/GradientUsageModel","../utils/StyleUtil","../utils/MeasurementUtil"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=t.Model.extend({selectionMap:{},focusMap:{},defaults:{psdModel:null,psdView:null,extractedStylesInSelection:null},getPSDModel:function(){return this.psdModel},setPSDModel:function(e){this.psdModel&&this.psdModel.off(null,null,this);this.psdModel=e;this.psdModel.on("change:info",this.handleModelInfoChanged,this);this.resetFocusMap();this.resetSelection();this.offscreenCanvas=null;this.offscreenContext=null;this.clipLayersToImage=!1;this.handleModelInfoChanged()},handleModelInfoChanged:function(){var e=this.psdModel.get("info");e&&e.hasOwnProperty("clipSpriteSheetLayers")&&(this.clipLayersToImage=e.clipSpriteSheetLayers)},isLayerVisible:function(e,t){var i=e.get("visible");t&&e.get("parentModel")&&i&&e.get("parentModel")instanceof n&&(i=this.isLayerVisible(e.get("parentModel"),t));return i},isSelected:function(e){return null!==this.selectionMap[e]},getSelectedLayers:function(){return e.values(this.selectionMap)},selectParent:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=s.getLayerModelFromId(e);i=t.get("parentModel");i instanceof n&&this.changeSelection([i],!1)}}},selectTopChild:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=s.getLayerModelFromId(e);i=t.get("layerCollection");i&&i.length>0&&this.changeSelection([i.at(i.length-1)],!1)}}},selectNextSibling:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i,n,r;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=s.getLayerModelFromId(e);i=t.get("parentModel");n=i.get("layerCollection");r=n.indexOf(t);r>-1&&(r>0?this.changeSelection([n.at(r-1)],!1):this.changeSelection([n.at(n.length-1)],!1))}}},selectPrevSibling:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i,n,r;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=s.getLayerModelFromId(e);i=t.get("parentModel");n=i.get("layerCollection");r=n.indexOf(t);r>-1&&(r<n.length-1?this.changeSelection([n.at(r+1)],!1):this.changeSelection([n.at(0)],!1))}}},changeSelection:function(e,t,i){var n,s,r;if(!t||!e){for(n in this.selectionMap)this.selectionMap.hasOwnProperty(n)&&this.selectionMap[n].set("selected",!1);this.selectionMap={}}if(e)for(s=0;s<e.length;s++){r=e[s];if(r&&!r.get("selected")){r.set("selected",!0);this.selectionMap[r.get("layerId")]=r}else if(r&&t){r.set("selected",!1);delete this.selectionMap[r.get("layerId")]}}graphite.events.trigger("selection-changed",i);this.updateStylesForSelection()},resetSelection:function(){this.selectionMap={}},selectItemAtPoint:function(e,t,i){var n=-1!==e&&-1!==t?this.itemAtPoint(e,t):null;this.changeSelection([n],i,!0);var s=null!==n?[n]:[];graphite.events.trigger("item-hovered-over",s,!0)},_expandGroup:function(e,t){var i,n=e.get("layerCollection"),s=!1;for(i=0;i<n.length;i++){var r=n.at(i),a=r.get("layerCollection");t.push(r);r.get("visible")===!1&&(s=!0);a&&(s=s||this._expandGroup(r,t))}return s},expandSelection:function(t){var i=[],n=[],s=[],r=t,a=this;e.each(t,function(e){for(var t=e.get("parentModel");t;){t.get("selected")&&i.push(t.get("layerId"));t=t.get("parentModel")}});i.length&&(r=e.filter(t,function(e){return-1===i.indexOf(e.get("layerId"))}));e.each(r,function(e){if(e.get("layerCollection")){var t=[],i=a._expandGroup(e,t);if(i){s.push(e.get("layerId"));n=n.concat(t)}}});r=r.concat(n);r=e.filter(r,function(e){return a.isLayerVisible(e,!0)&&-1===s.indexOf(e.get("layerId"))});return r},updateStylesForSelection:function(){var t,i=this.getSelectedLayers(),n=this.psdModel.get("extractedStyles")||{colorUsageModels:[],gradientUsageModels:[],textStyleUsageModels:[],models:[]};if(i.length){var s=[],d=[],c=[];e.each(i,function(e){t=e.getUsageModels();s=s.concat(t.colorUsageModels);d=d.concat(t.gradientUsageModels);c=c.concat(t.textStyleUsageModels)});n={colorUsageModels:s,gradientUsageModels:d,textStyleUsageModels:c,models:i}}var h;graphite.getDetailsController().get("selectedInspectItem")instanceof r?h=n.colorUsageModels:graphite.getDetailsController().get("selectedInspectItem")instanceof o?h=n.gradientUsageModels:graphite.getDetailsController().get("selectedInspectItem")instanceof a&&(h=n.textStyleUsageModels);if(h){var p=!1;e.each(h,function(e,t){if(l.areUsageStylesEqual(e,graphite.getDetailsController().get("selectedInspectItem"))){graphite.getDetailsController().set("selectedInspectItem",e);p=!0;return!1}return!0});p||graphite.getDetailsController().setSelectedInspectItem(null)}this.set("extractedStylesInSelection",n)},itemAtPoint:function(e,t){var i,n,s,r,a,o=null;for(i in this.focusMap)if(this.focusMap.hasOwnProperty(i)){n=this.focusMap[i];if(null!==n){s=n.get("layerCollection");if(s)for(r=s.length-1;r>=0;r--){a=s.at(r);o=this.hitTestItem(a,e,t,!0);if(o)break}if(o)break}}return o},findHitItem:function(e,t,i,n){var s,r,a=null,o=e.get("layerCollection");for(s=o.length-1;s>=0;s--){r=o.at(s);a=this.hitTestItem(r,t,i,n);if(null!==a)break}return a},hitTestItem:function(e,t,n,r){var a=null,o=e.get("bounds"),l=e.get("visible"),c=e.get("type")===i.Type.LAYER_ADJUSTMENT,h=e.get("type")===i.Type.LAYER_TEXT;void 0===l&&(l=!0);if(l&&!c&&this.pointInRect(t,n,o))if("complete"===this.psdModel.get("dataType")){var p=s.getLayerInfoForId(e.get("layerId")).item;if("CANVAS"===p[0].tagName)(h||this.pixelHit(p[0],t,n,o))&&(a=e);else{var u=e.get("layerCollection");null!==u&&r&&(a=this.findHitItem(e,t,n,r))}}else null!==e.get("layerCollection")&&r?a=this.findHitItem(e,t,n,r):this.pointInRect(t,n,d.getClippedBounds(o,this.psdModel))&&(a=e);return a},pointInRect:function(e,t,i){return e<=i.right&&e>=i.left&&t<=i.bottom&&t>=i.top},pixelHit:function(e,t,i,n){var s,r,a=!1,o=n.left,l=n.top;if(!this.offscreenContext){this.offscreenCanvas=document.createElement("canvas");this.offscreenCanvas.width=257;this.offscreenCanvas.height=256;this.offscreenContext=this.offscreenCanvas.getContext("2d");this.offscreenContext.webkitImageSmoothingEnabled=!1}if(this.clipLayersToImage){o=Math.max(o,0);l=Math.max(l,0)}this.offscreenContext.clearRect(0,0,1,1);this.offscreenContext.drawImage(e,t-o,i-l,1,1,0,0,1,1);s=this.offscreenContext.getImageData(0,0,1,1);for(r=0;r<s.data.length;r+=4)if(s.data[r+3]>0){a=!0;break}return a},resetFocusMap:function(){this.focusMap={root:this.psdModel}},groupExpanded:function(e){this.psdView.groupExpanded(e)},clearDOMSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},enableDropperTool:function(){if(graphite.getDetailsController().get("activeTool")!==i.Tool.DROPPER){graphite.getDetailsController().changeActiveTool(i.Tool.DROPPER);this.selectItemAtPoint(-1,-1,!1);graphite.getDetailsController().setSelectedInspectItem(null);graphite.events.trigger("dropperStart")}else this.disableDropperTool()},disableDropperTool:function(){graphite.getDetailsController().changeActiveTool(i.Tool.SELECT_DIRECT);graphite.events.trigger("dropperStop")},rectIntersectsWith:function(e,t){return e.left<t.right&&t.left<e.right&&e.top<t.bottom?t.top<e.bottom:!1},rectIntersect:function(e,t){var i=Math.max(e.left,t.left),n=Math.max(e.top,t.top),s=Math.min(e.right,t.right),r=Math.min(e.bottom,t.bottom);return s>=i&&r>=n?{left:i-t.left,top:n-t.top,width:s-i,height:r-n,destLeft:i-e.left,destTop:n-e.top}:null},findIntersectsBackToFront:function(e,t,i){var n,r,a,o,l,c,h,p,u=t||this.psdModel.get("layerCollection"),g=i||[];if(u)for(p=u.length-1;p>=0;p--){n=r=u.at(p);a=d.getVisibleBounds(n,this.psdModel,!0);o=n.get("flattenedSprite");l=n.get("flattenedParent");if(n.get("visible")&&l){n=s.getLayerModelFromId(l);o=n.get("flattenedSprite")}if(o){var f=o.altPsdOrigin||o.psdOrigin;a.left=f.left;a.top=f.top;a.bottom=a.top+(o.bounds.bottom-o.bounds.top);a.right=a.left+(o.bounds.right-o.bounds.left)}if(r.getEffectiveVisibility()){c=n.get("layerCollection");if(c&&!o)this.rectIntersectsWith(e,a)&&this.findIntersectsBackToFront(e,c,g);else{h=this.rectIntersect(e,a);h&&g.push({item:n,intersect:h})}if(o)break}}return g},canExtractAsset:function(){var t=this.expandSelection(this.getSelectedLayers());return e.some(t,function(e,t){return e.canBeExtracted()})}});return new c});define("vanilla-extract/public/js/core/utils/KeyboardUtils",["jquery","underscore","../Constants"],function(e,t,i){"use strict";var n={isMultiSelectKey:function(e){var t=e.shiftKey,n=this.getPlatform();e.metaKey&&n===i.Platform.MAC?t=!0:e.ctrlKey&&n===i.Platform.WINDOWS&&(t=!0);return t},getPlatform:function(){var e=navigator.appVersion.toLowerCase();e.indexOf("macintosh")>-1?e=i.Platform.MAC:e.indexOf("windows")>-1&&(e=i.Platform.WINDOWS);return e},getActiveFocusedElement:function(){var t=e(document.activeElement);return t},getMetaKeyName:function(e){var t=String(e).toLowerCase(),n=this.getPlatform();return"ctrl"===t||"cmd"===t?n===i.Platform.MAC?"":"Ctrl":"shift"===t?n===i.Platform.MAC?"":"Shift":"alt"===t||"option"===t?n===i.Platform.MAC?"":"Alt":e},_doesFocusedElementHaveTag:function(e){var i=this.getActiveFocusedElement();if(i&&i.length){var n=function(e){return i.is(e)};if(t.some(e,n))return i.is("input")||i.is("textarea")||i[0].isContentEditable?i:null}return null},isInputInFocus:function(){return this._doesFocusedElementHaveTag(["input","p","div","textarea"])}};return n});define("vanilla-extract/public/js/core/controllers/KeyboardController",["jquery","underscore","./SelectionController","../Constants","../utils/KeyboardUtils"],function(e,t,i,n,s){"use strict";var r={attachedElement:null,multiSelectPending:!1,attachKeyHandlers:function(i){this.attachedElement&&this.removeKeyHandlers();t.bindAll(this,"handleKeyUp","handleKeyDown");this.attachedElement=i||e(document);this.attachedElement.keyup(this.handleKeyUp);this.attachedElement.keydown(this.handleKeyDown)},removeKeyHandlers:function(){if(this.attachedElement){this.attachedElement.unbind("keyup",this.handleKeyUp);this.attachedElement.unbind("keydown",this.handleKeyDown);this.attachedElement=null}},isMultiSelectModifier:function(e){var i=s.isMultiSelectKey(e);i&&(i=t.contains([n.Shortcut.SHIFT,n.Shortcut.CTRL,n.Shortcut.CMD,n.Shortcut.SECONDARY_CMD,n.Shortcut.CMD_FF],e.keyCode));return i},setMultiSelectPending:function(e){if(this.multiSelectPending!==e){graphite.events.trigger("multiSelectPending",e);this.multiSelectPending=e}},handleKeyDown:function(e){if(this._hasFocus()){this.setMultiSelectPending(this.isMultiSelectModifier(e));switch(e.keyCode){case n.Shortcut.LEFT_ARROW:case n.Shortcut.RIGHT_ARROW:case n.Shortcut.UP_ARROW:case n.Shortcut.DOWN_ARROW:if(this.handleArrowKeys&&0!==i.getSelectedLayers().length){e.stopPropagation();e.preventDefault()}}}},_hasFocus:function(){return document.activeElement===this.attachedElement[0]||!s.isInputInFocus()},handleKeyUp:function(e){if(this._hasFocus()){this.setMultiSelectPending(!1);switch(e.keyCode){case n.Shortcut.CLEAR:graphite.events.trigger("dismiss-modal-views");graphite.events.trigger("hide-first-user-overlay");i.disableDropperTool();i.selectItemAtPoint(-1,-1,!1);graphite.getDetailsController().setSelectedInspectItem(null);break;case n.Shortcut.LEFT_ARROW:i.selectParent();break;case n.Shortcut.RIGHT_ARROW:i.selectTopChild();break;case n.Shortcut.UP_ARROW:i.selectPrevSibling();break;case n.Shortcut.DOWN_ARROW:i.selectNextSibling();
break;case n.Shortcut.TOGGLE_MEASUREMENT:graphite.getDetailsController().get("activeTool")===n.Tool.DROPPER&&i.disableDropperTool();graphite.getDetailsController().setToggleMeasurementOnHover();graphite.events.trigger("toggle-hover-measurement");break;case n.Shortcut.HELP:graphite.events.trigger("toggle-help-dialog",{from:"keyboard"});break;case n.Shortcut.COLOR_PICKER:graphite.getDetailsController().disableMeasurementOnHover();e.ctrlKey||e.shiftKey||e.metaKey||e.altKey||i.enableDropperTool();break;case n.Shortcut.FUX:graphite.events.trigger("toggle-first-user-overlay",{from:"keyboard"})}}}};return r});define("vanilla-extract/public/js/core/controllers/ZoomController",["../Constants","../utils/CSSUtil"],function(e,t){"use strict";var i={level:1,prevLevel:null,isTransitioning:!1,setZoomLevel:function(e,t){e=e>32?32:e;this.prevLevel=this.level;this.level=e;graphite.events.trigger("zoomChanged",t)},getZoomLevel:function(){return this.level},getZoomPercent:function(){return parseFloat((100*this.level).toFixed(2))+"%"},isZooming:function(){return this.isTransitioning},zoomPoint:function(e,t){var i=t?1/this.level:this.level;return{x:e.x*i,y:e.y*i}},zoomSize:function(e,t){var i=t?1/this.level:this.level;return this._calcZoomSizeForFactor(e,i)},zoomRect:function(e,t){var i=t?1/this.level:this.level;return this.zoomRectToLevel(e,i)},zoomRectToLevel:function(e,t){return{top:Math.round(e.top*t),left:Math.round(e.left*t),bottom:Math.round(e.bottom*t),right:Math.round(e.right*t),width:Math.round((e.right-e.left)*t),height:Math.round((e.bottom-e.top)*t)}},getCenterZoomRect:function(e,t,i,n){var s,r,a,o,l;if(e.left>=0)s=e.left+(e.right-e.left)/2;else{var d=t.width/2;s=d+e.left}if(e.top>=0)r=e.top+(e.bottom-e.top)/2;else{var c=t.height/2;r=c+e.top}s/=n;r/=n;a=t.width/i;o=t.height/i;l={top:Math.round(r-o/2),left:Math.round(s-a/2),bottom:Math.round(r+o/2),right:Math.round(s+a/2)};return l},zoomAndScrollElements:function(i,n,s,r,a,o,l){var d,c,h,p,u=this,g=this.level-this.prevLevel,f=this._calcZoomSizeForFactor(o,this.prevLevel),m=this._calcZoomSizeForFactor(o,this.level),v=m.width-f.width,y=m.height-f.height,b=r.position().left,w=r.position().top,S=n.outerWidth()-e.PREVIEW_SCROLLBAR_SPACING,C=n.outerHeight()-e.PREVIEW_SCROLLBAR_SPACING;s=this.zoomRect(s);s.width=s.right-s.left;s.height=s.bottom-s.top;c=Math.round((s.width-S)/2);p=Math.round((s.height-C)/2);l||(p=0);if(0>b){n.scrollLeft(0);r.css({left:b})}if(0>w){w=-n.scrollTop();n.scrollTop(0)}n.css("overflow","hidden");this._setElementTopLeft(r,w,b);b=r.position().left;w=r.position().top;d=b+s.left+c;h=w+s.top+p;var x=function(e){var n=u.prevLevel+g*e,s={width:f.width+v*e,height:f.height+y*e},o=w-h*e,l=b-d*e;t.applyPrefixedStyle(i,"transform","scale("+n+", "+n+")");t.applyPrefixedStyle(i,"transform","scale3d("+n+", "+n+", 1)");t.applyPrefixedStyle(i,"transform-origin","0 0");u._setElementSize(r,s);u._setElementSize(a,s);u._setElementTopLeft(r,o,l)},T=function(){n.css("overflow","scroll");var e,t,i=r.position().top,s=r.position().left;if(0>i){r.css({top:0});e=n.prop("scrollHeight")-n.innerHeight();Math.abs(i)>e&&r.height(r.height()+(Math.abs(i)-e));n.scrollTop(Math.abs(i))}if(0>s){r.css({left:0});t=Math.max(0,r.outerWidth()-n.innerWidth());Math.abs(s)>t&&r.width(r.width()+(Math.abs(s)-t));n.scrollLeft(Math.abs(s))}u.isTransitioning=!1;graphite.events.trigger("zoomCompleted")};if(n&&s&&r&&o){this.isTransitioning=!0;this._animate(450,x,T)}else{i&&this.zoomElementScale(i);r&&o&&this.zoomElementSize(r,o);a&&o&&this.zoomElementSize(a,o)}},_animate:function(e,t,i){function n(r){"undefined"==typeof s&&(s=r);var a=r-s;if(e>a){t(a/e);window.requestAnimationFrame(n)}else{t(1);i()}}var s;window.requestAnimationFrame(n)},zoomElementScale:function(e){t.applyPrefixedStyle(e,"transform","scale("+this.level+")");t.applyPrefixedStyle(e,"transform","scale3d("+this.level+")");t.applyPrefixedStyle(e,"transform-origin","0 0")},zoomElementSize:function(e,t){var i=this.zoomSize(t);this._setElementSize(e,i)},zoomToFitRect:function(t,i,n){var s=t.right-t.left,r=t.bottom-t.top,a=n?Math.min((i.width-2*e.PREVIEW_SCROLLBAR_SPACING)/s,(i.height-2*e.PREVIEW_SCROLLBAR_SPACING)/r):(i.width-2*e.PREVIEW_SCROLLBAR_SPACING)/s;if(!n){a=a>1||i.width<=0?1:a;t.bottom=t.bottom-t.top;t.top=0}this.setZoomLevel(a,t)},reset:function(){this.level=1},_calcZoomSizeForFactor:function(e,t){return{width:e.width*t,height:e.height*t}},_setElementSize:function(e,t){e.css({width:t.width+"px",height:t.height+"px"})},_setElementTopLeft:function(e,t,i){e.css({top:t,left:i})}};return i});define("vanilla-extract/public/js/core/utils/ScrollUtils",["underscore"],function(e){"use strict";var t={isScrollNeeded:!1,scrollRectIntoView:function(e,t){var i=e[0],n=i.getBoundingClientRect(),s={top:n.top,bottom:n.bottom,left:n.left,right:n.right,width:n.width,height:n.height},r=0,a=0;s.height<i.scrollHeight&&(s.right-=17);s.width<i.scrollWidth?s.bottom-=25:s.bottom-=10;if(t.top<s.top&&t.bottom<s.bottom)r=t.top-s.top;else if(t.bottom>s.bottom&&t.top>s.top){r=t.bottom-s.bottom;t.top-r<s.top&&(r=t.top-s.top)}if(t.left<s.left)a=t.left-s.left;else if(t.right>s.right){a=t.right-s.right;e.scrollLeft()>0&&t.left-a<s.left&&(a=t.left-s.left)}if(0!==r||0!==a){this.isScrollNeeded=!0;e.animate({scrollTop:i.scrollTop+r,scrollLeft:i.scrollLeft+a},400,null,this.onScrollComplete)}else this.isScrollNeeded=!1},onScrollComplete:function(){if(t.isScrollNeeded){graphite.events.trigger("preview-scroll-end");t.isScrollNeeded=!1}}};return t});define("vanilla-extract/public/js/core/mixins/ScrollableItem",["jquery","../utils/ScrollUtils"],function(e,t){"use strict";var i={scrollIntoView:function(i){var n=this.$el[0],s=this.findScrollableParent(n),r=n.getBoundingClientRect(),a={top:r.top,bottom:r.bottom,left:r.left,right:r.right,width:r.width,height:r.height};i&&i.itemHeight&&(a.bottom=a.top+i.itemHeight);t.scrollRectIntoView(e(s),a)},findScrollableParent:function(e){var t,i=e;do{i=i.parentElement;t=getComputedStyle(i)}while(i!==document.body&&"auto"!==t.overflow&&"scroll"!==t.overflow);return i}};return i});define("vanilla-extract/public/js/core/utils/ImageUtil",["jquery"],function(e){"use strict";var t={ImageScaleType:{FIT:"fit",FILL:"fill"},calcImageSizeToFit:function(e,t,i){var n,s,r=e.naturalWidth/e.naturalHeight;if(r*i>t){n=t;s=t/r}else{s=i;n=i*r}var a=(t-n)/2,o=(i-s)/2;return{width:n,height:s,x:a,y:o}},calcImageSizeToFill:function(e,t,i){var n,s,r=e.naturalWidth/e.naturalHeight;if(t>r*i){n=t;s=t/r}else{s=i;n=i*r}return{width:n,height:s}},sizeAndCenterImage:function(t,i,n,s,r){var a,o,l;a=s===this.ImageScaleType.FIT?this.calcImageSizeToFit(t,i,n):this.calcImageSizeToFill(t,i,n);o=a.width;l=a.height;if(!r){var d=t.naturalWidth,c=t.naturalHeight;o=0!==d?Math.min(a.width,d):a.width;l=0!==c?Math.min(a.height,c):a.height}e(t).width(o+"px");e(t).height(l+"px");e(t).css("margin-left",(i-o)/2+"px");e(t).css("margin-top",(n-l)/2+"px")}};return t});define("vanilla-extract/public/js/core/utils/SpriteSheetUtils",["jquery","./ImageUtil"],function(e,t){"use strict";var i={drawSprite:function(i,n,s,r,a){var o=s.bounds;return function(s){var l,d,c,h,p,u,g,f,m=r[0],v=m.getContext("2d");c=o.right-o.left;h=o.bottom-o.top;if(a){l=parseInt(e(i.el).find(n).css("max-width"),10);d=parseInt(e(i.el).find(n).css("max-height"),10);d&&(d=Math.min(d,h))}else{l=parseInt(e(i.el).find(n).css("width"),10);d=parseInt(e(i.el).find(n).css("height"),10);if(0===l){l=40;d=30}}p={naturalWidth:c,naturalHeight:h};u=t.calcImageSizeToFit(p,l,d||h);g=u.width;f=u.height;m=r[0];a&&(d=f);m.width=l;m.height=d;v.drawImage(s,o.left,o.top,c,h,(l-g)/2,(d-f)/2,g,f)}},drawSpriteRect:function(i,n,s,r,a,o){var l,d,c,h,p,u,g,f,m=a[0],v=m.getContext("2d");c=n.right-n.left;h=n.bottom-n.top;if(o){l=parseInt(e(i.el).find(r).css("max-width"),10);d=parseInt(e(i.el).find(r).css("max-height"),10);d&&(d=Math.min(d,h))}else{l=parseInt(e(i.el).find(r).css("width"),10);d=parseInt(e(i.el).find(r).css("height"),10);if(0===l||0===d){l=40;d=30}}p={naturalWidth:c,naturalHeight:h};u=t.calcImageSizeToFit(p,l,d||h);g=u.width;f=u.height;m=a[0];o&&(d=f);m.width=l;m.height=d;v.globalAlpha=s.opacity/255;v.beginPath();v.rect((l-g)/2,(d-f)/2,g,f);v.fillStyle="rgb("+s.color.red+","+s.color.green+","+s.color.blue+")";v.fill()},renderSpriteModel:function(e,t,i,n,s){var r=t.get("spriteSheet");if(r)r.sheetID?graphite.getDetailsController().drawSpriteSheet(r.sheetID,this.drawSprite(e,i,r,e.$el.find(n),s),this):r.color&&this.drawSpriteRect(e,t.get("bounds"),r,i,e.$el.find(n),s);else{var a={opacity:0,color:{red:0,green:0,blue:0}},o=e.$el.find(n);o.length&&this.drawSpriteRect(e,t.get("bounds"),a,i,e.$el.find(n))}}};return i});define("vanilla-extract/public/js/core/utils/TemplateUtil",["jquery","underscore","plugin-dependencies"],function(e,t,i){"use strict";var n={createTemplate:function(n,s){var r=n;if(graphite.isFeatureEnabled("ccweb")){graphite.fxnTemplateNormalize;r=n.replace(/\/images\//g,"/resource/extract/parfait/public/images/")}else graphite.fxnTemplateNormalize&&"function"==typeof graphite.fxnTemplateNormalize&&(r=graphite.fxnTemplateNormalize(n));var a=t.extend({translate:i.translate},s),o=t.template(r);return e(o(a).trim()).filter("*")}};return n});define("vanilla-extract/public/js/core/views/templates/layerListItemTemplate.html",[],function(){return'<div class="layer-item">\n    <div class="layer-bg"></div>\n    <div class="visible-button"></div>\n    <div class="image-wrapper">\n        <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\n        <div class="preview-warning"></div>\n        <div class="layer-icon"></div>\n    </div>\n    <h5 class="layer-label" title="<%- layerName %>"> <%- layerName %> </h5>\n    <div class="export-buttons">\n        <span class="asset-button"></span>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/layers/LayerItemView",["jquery","underscore","backbone","../../controllers/SelectionController","../../mixins/ScrollableItem","../../utils/SpriteSheetUtils","../../utils/KeyboardUtils","../../utils/TemplateUtil","../templates/layerListItemTemplate.html","../../Constants"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=i.View.extend({className:"layer-item-row",events:{click:"handleLayerSelect",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","click .asset-button":"handleExtractAssetClick"},adjLayerTypeToCSS:{brightnessContrast:"brightness-contrast",levels:"levels",curves:"curves",exposure:"exposure",vibrance:"vibrance",hueSaturation:"hue-saturation",colorBalance:"color-balance",blackAndWhite:"black-and-white",photoFilter:"photo-filter",channelMixer:"channel-mixer",colorLookup:"color-lookup",gradientMapClass:"gradient-map",selectiveColor:"selective-color",thresholdClassEvent:"threshold",posterization:"posterize",invert:"invert"},initialize:function(e){t.bindAll(this,"handleVisibilityToggleClick","handleThumbMouseEnter","handleThumbMouseLeave");this.model.set("psdGuid",e.psdGuid);this.model.set("toplevel",e.toplevel);this.parentView=e.parentView;this.render();this.$el.find(".image-wrapper").first().on("mouseenter",this.handleThumbMouseEnter);this.$el.find(".image-wrapper").first().on("mouseleave",this.handleThumbMouseLeave);this.$el.find(".visible-button").first().on("click",this.handleVisibilityToggleClick);this.addHandlers()},render:function(){var e=this.model.toJSON();this.$el.html(o.createTemplate(l,e));this.$previewWarning=this.$el.find("div.preview-warning");var t=this.$el.find("div.layer-icon");e.properties.attributes.shape?t.addClass("vector"):e.type===d.Type.LAYER_TEXT?t.addClass("text"):e.type===d.Type.LAYER_SMARTOBJ?t.addClass("smart-"+e.smartObjectType):t.addClass("none");e.type===d.Type.LAYER_ADJUSTMENT&&(e.adjustmentLayerType&&this.adjLayerTypeToCSS.hasOwnProperty(e.adjustmentLayerType)?this.$el.find(".image-wrapper").addClass(this.adjLayerTypeToCSS[e.adjustmentLayerType]):this.$el.find(".image-wrapper").addClass("adjustment-layer"));this.handleFlattenedChange();this.handleVisibilityChange();this.drawSpriteSheet();this.processLayerWarning();return this},addHandlers:function(){this.model.on("change:visible",this.handleVisibilityChange,this);this.model.on("change:selected",this.handleSelectionChange,this);this.model.on("change:isFlattened",this.handleFlattenedChange,this);graphite.events.on("selectedTab",this.handleSelectedTab,this);graphite.events.on("reset-layers-visibility",this.handleVisibilityReset,this)},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},drawSpriteSheet:function(){r.renderSpriteModel(this,this.model,".image-wrapper","#sprite_preview",!1)},handleExtractAssetClick:function(t){this.model.get("selected")||n.changeSelection([this.model],!1);graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:e(t.target),origin:"layerPanel"});t.stopPropagation()},handleMouseEnter:function(){this.$el.find(".layer-item").toggleClass("show-export",this.model.canBeExtracted());graphite.events.trigger("item-hovered-over",[this.model],!0)},handleMouseLeave:function(){this.model.get("selected")||this.$el.find(".layer-item").removeClass("show-export")},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);if("adjustmentLayer"!==this.model.toJSON().type){graphite.events.trigger("load-layer-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},500)}},handleThumbMouseLeave:function(){var e=this;if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},handleLayerSelect:function(e){n.changeSelection([this.model],a.isMultiSelectKey(e))},handleSelectionChange:function(){if(this.$el.hasClass("selected")){this.$el.removeClass("selected");this.parentView&&this.parentView.childSelected(!1)}if(this.model.get("selected")===!0){this.$el.addClass("selected");this.model.canBeExtracted()&&this.$el.find(".layer-item").addClass("show-export");if(this.parentView){this.parentView.childSelected(!0);this.parentView.expand()}"psdLayersTab"===graphite.getDetailsController().get("selectedTab")&&this.scrollIntoView()}else this.$el.find(".layer-item").removeClass("show-export")},handleFlattenedChange:function(){var e=this.model.get("properties"),t=this.model.get("isFlattened"),i=this.model.get("visible"),n=e?e.get("blendOptions"):null,s=!1;n&&!t&&i&&n.mode&&"passThrough"!==n.mode&&(s=!0);this.processLayerWarning(s)},processLayerWarning:function(e){e||this.model.isFontSubstitution()||this.model.isMultipleLayerStylesCSSWarning()?this.$previewWarning.show():this.$previewWarning.hide()},handleSelectedTab:function(e){if("Layers"===e.selectedTab&&this.model.get("selected")===!0&&this.parentView){this.parentView.expand();this.parentView.scrollIntoView()}},handleVisibilityChange:function(){var e=this.$el.find(".visible-button").first();e.toggleClass("off-state",!this.model.get("visible"));this.$el.find(".layer-item").toggleClass("show-export",this.model.get("selected")===!0&&this.model.canBeExtracted());this.handleFlattenedChange()},handleVisibilityToggleClick:function(e){var t=this.model.get("visible");this.model.set("visible",!t);graphite.events.trigger("layerVisiblityChanged",{layer:this.model});e.stopPropagation()},handleVisibilityReset:function(){this.model.set("visible",this.model.get("psdVisible"))},remove:function(){this.removeEventListeners();i.View.prototype.remove.call(this)}});t.extend(c.prototype,s);return c});define("vanilla-extract/public/js/core/views/layers/LayersListItemView",["underscore","backbone","../../Constants","../../controllers/SelectionController","../../mixins/ScrollableItem","../../utils/KeyboardUtils"],function(e,t,i,n,s,r){"use strict";var a=t.View.extend({className:"layer-item-row",initialize:function(e){this.parentView=e.parentView},addHandlers:function(){this.model.on("change:visible",this.handleVisibilityChange,this);this.model.on("change:selected",this.handleSelectionChange,this);graphite.events.on("reset-layers-visibility",this.handleVisibilityReset,this)},render:function(){return this},removeEventListeners:function(){this.model.off(null,null,this)},handleLayerSelect:function(e){var t=this.model;if(t.get("type")===i.Type.LAYER_ARTBOARD&&e.altKey){graphite.events.once("zoomCompleted",function(){n.changeSelection([t],!1,!1)});graphite.events.trigger("zoomToFit",t.get("bounds"));graphite.events.trigger("artboard-zoomToFit")}else n.changeSelection([t],r.isMultiSelectKey(e))},handleSelectionChange:function(){if(this.$el.hasClass("selected")){this.$el.removeClass("selected");this.parentView&&this.parentView.childSelected(!1)}if(this.model.get("selected")===!0){this.$el.addClass("selected");this.model.canBeExtracted()&&this.$el.find(".layer-group-header").first().addClass("show-export");if(this.parentView){this.parentView.childSelected(!0);this.parentView.expand()}"psdLayersTab"===graphite.getDetailsController().get("selectedTab")&&this.scrollIntoView({itemHeight:42})}else this.$el.find(".layer-group-header").first().removeClass("show-export")},handleVisibilityChange:function(){var e=this.$el.find(".visible-button").first();e.toggleClass("off-state",!this.model.get("visible"));this.$el.find(".layer-group-header").toggleClass("show-export",this.model.get("selected")===!0&&this.model.canBeExtracted())},handleVisibilityToggleClick:function(e){this.model.set("visible",!this.model.get("visible"));graphite.events.trigger("layerVisiblityChanged",{layer:this.model});e.stopPropagation()},handleVisibilityReset:function(){this.model.set("visible",this.model.get("psdVisible"))},remove:function(){this.removeEventListeners();t.View.prototype.remove.call(this)}});e.extend(a.prototype,s);return a});define("vanilla-extract/public/js/core/views/templates/layerGroupListItemTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/templates/layerGroupListItemSpritesheetTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <div class="image-wrapper">\n            <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\n            <div class="preview-warning"></div>\n            <div class="layer-icon"></div>\n        </div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/templates/layerGroupListItemNoChildrenTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <div class="image-wrapper">\n        </div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/layers/LayerGroupItemView",["jquery","underscore","../../controllers/SelectionController","./LayerItemView","./LayersListItemView","../../utils/ImageUtil","../../utils/SpriteSheetUtils","../../utils/TemplateUtil","../templates/layerGroupListItemTemplate.html","../templates/layerGroupListItemSpritesheetTemplate.html","../templates/layerGroupListItemNoChildrenTemplate.html","../../Constants"],function(e,t,i,n,s,r,a,o,l,d,c,h){"use strict";var p=s.extend({hoverTimer:null,events:{change:"handleImageLoad"},initialize:function(e){t.bindAll(this,"handleImageLoad","handleLayerSelect","handleToggleOpen","handleVisibilityToggleClick","handleExtractAssetClick","handleExtractCodeClick","handleMouseEnter","handleMouseLeave","handleThumbMouseEnter","handleThumbMouseLeave");this.model.set("psdGuid",e.psdGuid);this.model.set("toplevel",e.toplevel);this.childrenRendered=!1;this.parentView=e.parentView;this.subItems=[];this.render();this.handleVisibilityChange()},render:function(){var e;e=void 0!==this.model.get("layerCollection")&&0===this.model.get("layerCollection").length?c:d;this.$previewWarning=this.$el.find("div.preview-warning");this.$el.html(o.createTemplate(e,this.model.toJSON()));this.handleFlattenedChange();this.drawSpriteSheet();this.renderChildren();this.processLayerWarning();this.addHandlers();if(this.model.get("type")===h.Type.LAYER_ARTBOARD){this.$el.find(".layer-group-item").first().addClass("artboard");this.$el.find(".folder").first().addClass("artboard")}return this},addHandlers:function(){s.prototype.addHandlers.apply(this,arguments);this.model.on("change:selected",this.handleSelectionChange,this);this.model.on("change:isFlattened",this.handleFlattenedChange,this);this.$el.find(".image-wrapper img").load(this.handleImageLoad);this.$el.find(".image-wrapper").first().click(this.handleLayerSelect);this.$el.find(".layer-group-label").first().click(this.handleLayerSelect);this.$el.find(".folder").first().click(this.handleToggleOpen);this.$el.find(".visible-button.layer-group").first().click(this.handleVisibilityToggleClick);this.$el.find(".asset-button").first().click(this.handleExtractAssetClick);this.$el.find(".code-button").first().click(this.handleExtractCodeClick);this.$el.find(".layer-group-header").first().mouseenter(this.handleMouseEnter);this.$el.find(".layer-group-header").first().mouseleave(this.handleMouseLeave);this.$el.find(".image-wrapper").first().mouseenter(this.handleThumbMouseEnter);this.$el.find(".image-wrapper").first().mouseleave(this.handleThumbMouseLeave);this.addHandlersToChildren(this.model)},addHandlersToChildren:function(e){var t,i,n=e.get("layerCollection")||[];for(t=0;t<n.length;t++){i=n.at(t);if(i.get("type")!==h.Type.LAYER_ADJUSTMENT){i.on("change:visible",this.handleVisibilityChange,this);(i.get("type")===h.Type.LAYER_GROUP||i.get("type")===h.Type.LAYER_ARTBOARD)&&this.addHandlersToChildren(i)}}},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},drawSpriteSheet:function(){a.renderSpriteModel(this,this.model,".image-wrapper","#sprite_preview",!1)},renderChildren:function(){if(this.childrenRendered!==!0){if(void 0!==this.model.attributes.layerCollection){var e,t,n,s=this.model.attributes.layerCollection;for(n=s.length-1;n>-1;n--){e=s.at(n);t=e.get("type")!==h.Type.LAYER_GROUP&&e.get("type")!==h.Type.LAYER_ARTBOARD?graphite.getLayerItemView({model:e,parentView:this,psdGuid:i.getPSDModel().get("id")}):new p({model:e,parentView:this,psdGuid:i.getPSDModel().get("id")});this.subItems.push(t);this.$el.find(".children-list-list").first().append(t.el)}}this.childrenRendered=!0}},handleFlattenedChange:function(){var e=this.model.get("properties"),t=this.model.get("isFlattened"),i=this.model.get("visible"),n=e?e.get("blendOptions"):null;if(n&&!t&&i){if(n.mode&&"passThrough"!==n.mode){this.blendOptionsWarning=!0;return}this.blendOptionsWarning=!1}else this.blendOptionsWarning=!1;this.processLayerWarning()},processLayerWarning:function(){this.blendOptionsWarning||this.model.isFontSubstitution()||this.model.isMultipleLayerStylesCSSWarning()?this.$previewWarning.show():this.$previewWarning.hide()},handleImageLoad:function(){var e=parseInt(this.$el.find(".image-wrapper").width(),10);e&&r.sizeAndCenterImage(this.$el.find(".image-wrapper img")[0],e,parseInt(this.$el.find(".image-wrapper").height(),10),r.ImageScaleType.FIT,!1)},centerChildThumbs:function(){var t=this.$el.find(".children-list-list"),i=t?t.first()[0].children:null;e.each(i,function(t,i){var n=e(i).find(".image-wrapper img")[0];n&&r.sizeAndCenterImage(e(i).find(".image-wrapper img")[0],parseInt(e(i).find(".image-wrapper").width(),10),parseInt(e(i).find(".image-wrapper").height(),10),r.ImageScaleType.FIT,!1)});e.each(this.subItems,function(e,t){t.drawSpriteSheet()})},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);graphite.events.trigger("load-layer-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},500)},handleThumbMouseLeave:function(){if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-layer-thumb-popup",{sourceElement:this.$el.find("#sprite_preview").first(),model:this.model})},handleMouseEnter:function(){this.$el.find(".layer-group-header").first().toggleClass("show-export",this.model.canBeExtracted());graphite.events.trigger("item-hovered-over",[this.model],!0)},handleMouseLeave:function(){this.model.get("selected")||this.$el.find(".layer-group-header").first().removeClass("show-export");graphite.events.trigger("item-hovered-over",[],!0)},handleExtractAssetClick:function(t){this.model.get("selected")||i.changeSelection([this.model],!1);graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:e(t.target),origin:"layerPanel"});t.stopPropagation()},handleExtractCodeClick:function(t){this.model.get("selected")||i.changeSelection([this.model],!1);graphite.events.trigger("show-extract-code-popup",{sourceElement:e(t.target),model:this.model})},handleToggleOpen:function(){this.renderChildren();var e=this.model.get("layerCollection").length>0,t=this.$el.find(".children-list").first();if(this.$el.find(".layer-group-item").first().hasClass("closed")){e&&t.slideDown(50);i.groupExpanded(this.model);this.centerChildThumbs();this.$el.find(".layer-group-item").first().removeClass("closed")}else{t.slideUp(50);this.$el.find(".layer-group-item").first().addClass("closed")}},childSelected:function(e){e?this.$el.addClass("parent-of-selected"):this.$el.removeClass("parent-of-selected")},expand:function(){var e=this.$el.find(".children-list").first();if(e.is(":hidden")){e.slideDown(50);i.groupExpanded(this.model);this.centerChildThumbs()}this.parentView instanceof p&&this.parentView.expand();this.$el.find(".layer-group-item").first().removeClass("closed")},remove:function(){this.removeEventListeners();t.each(this.subItems,function(e){e.remove()});this.subItems.length=0;s.prototype.remove.call(this)}});return p});define("vanilla-extract/public/js/core/views/layers/LayersListView",["underscore","backbone","./LayerItemView","./LayerGroupItemView","../../Constants","plugin-dependencies"],function(e,t,i,n,s,r){"use strict";function a(e){for(var t=0,i=e.length;i>t;t++){var n=e[t];if(n.model.get("visible")!==n.model.get("psdVisible"))return!1;if(n.subItems&&!a(n.subItems))return!1}return!0}var o=t.View.extend({template:'<div class="section-wrapper"><button disabled class="topcoat-button" id="resetLayers">'+r.translate("Reset Layers")+'</button></div><div class="layers-list" tabindex="0"></div>',$layersList:null,layerItems:[],events:{"click #resetLayers":"handleResetLayers"},initialize:function(){this.render();this.model.on("change:layerCollection",this.handleModelLayerCollectionChanged,this);this.handleModelLayerCollectionChanged()},render:function(){var t=e.template(this.template),i=this;this.$el.html(t);this.$layersList=this.$el.find(".layers-list");var n=this.$el.find("#resetLayers");graphite.events.on("layerVisiblityChanged",function(){n.attr({disabled:a(i.layerItems)})},this);graphite.events.on("reset-layers-visibility",function(){n.attr({disabled:!0})},this);this.$el.keydown(function(e){switch(e.keyCode){case s.Shortcut.LEFT_ARROW:case s.Shortcut.RIGHT_ARROW:case s.Shortcut.UP_ARROW:case s.Shortcut.DOWN_ARROW:e.stopPropagation();e.preventDefault()}});return this},handleModelLayerCollectionChanged:function(){var e,t,i,r,a,o;this.layerItems.length=0;this.$layersList.empty();if(this.model.get("layerCollection")){e=this;t=this.model.get("layerCollection");for(i=t.length-1;i>-1;i--){r=t.at(i);a=r.get("type");if(a===s.Type.LAYER_GROUP||a===s.Type.LAYER_ARTBOARD){o=new n({model:r,psdGuid:e.model.get("id"),toplevel:!0});this.layerItems.push(o)}else{o=graphite.getLayerItemView({model:r,psdGuid:e.model.get("id"),toplevel:!0});this.layerItems.push(o)}this.$layersList.append(o.el)}}},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},remove:function(){if(this.$layersList){this.$layersList.remove();this.$layersList=null}e.each(this.layerItems,function(e){e.remove()});this.layerItems.length=0;this.removeEventListeners();t.View.prototype.remove.call(this)},handleResetLayers:function(){graphite.events.trigger("reset-layers-visibility",{})}});return o});define("vanilla-extract/public/js/core/views/inspect/CSSListItemView",["underscore","backbone","../../utils/TemplateUtil","../../utils/CSSUtil"],function(e,t,i,n){"use strict";var s={"background-color":1,"border-color":1,color:1},r=t.View.extend({defaults:{cssObj:null,clip:null},initialize:function(e){this.cssObj=e.cssObj;this.preProcessor=e.preProcessor;this.render()},render:function(){var e=n.cssPreprocessors[this.preProcessor].listItem(this.cssObj);this.setElement("<li>"+e+"</li>");return this},isColorProperty:function(){return this.cssObj&&s.hasOwnProperty(this.cssObj.property)},isSpacer:function(){return this.cssObj&&this.cssObj.spacer}});return r});define("vanilla-extract/public/js/core/views/templates/cssColorItemTemplate.html",[],function(){return'<li>\n    <span class="property">color:</span><span class="color-chip" style="background-color: <%- value %>;"></span> <span class="value"><%- value %>;</span>\n</li>\n'});define("vanilla-extract/public/js/core/views/templates/messageSelectSingleItemTemplate.html",[],function(){return'<li class="css-properties-message">\n    <%-translate("Select a single layer in the PSD to see its CSS properties")%>\n</li>'});define("vanilla-extract/public/js/core/views/inspect/InspectCSSView",["jquery","underscore","backbone","../../models/ColorModel","../../models/UserSettingsModel","../../controllers/SelectionController","../inspect/CSSListItemView","../../utils/CSSUtil","../../utils/TemplateUtil","../templates/cssColorItemTemplate.html","../templates/messageSelectSingleItemTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c){"use strict";var h=i.View.extend({defaults:{cssListItemViews:[],$messageEl:null},initialize:function(e){this.cssListItemViews=[];this.$messageEl=l.createTemplate(c);this.render();this.addHandlers();graphite.events.on("designedAtMultiplierChanged",this.refreshCSS,this)},render:function(){this.handleSelectionChange()},addHandlers:function(){r.on("change:extractedStylesInSelection",this.handleSelectionChange,this);graphite.events.on("preprocessorChanged",this.refreshCSS,this);graphite.events.on("updateFontCSS",this.refreshCSS,this);graphite.events.on("commitDropperColor",this.handleNewDropperColor,this);graphite.events.on("preferredMeasurementUnitsChanged",this.refreshCSS,this)},removeEventListeners:function(){r.off(null,null,this);graphite.events.off(null,null,this)},refreshCSS:function(){var e,t,i,n,o=r.getSelectedLayers(),l=s.get("preprocessor");if(1===o.length){e=o[0];t=e.getCSSArray("css"===l);this.clearCSSList();
for(i=0;i<t.length;i++){n=new a({cssObj:t[i],preProcessor:l});this.cssListItemViews.push(n);this.$el.append(n.el)}}else{this.clearCSSList();this.displayMessages()}},handleNewDropperColor:function(e){var t,i=new n(e),s=e.alpha<1?e.alpha.toFixed(2):null;this.$el.empty();t=l.createTemplate(d,{value:i.toHEXString()});this.$el.append(t);t=l.createTemplate(d,{value:i.toRGBString(s)});this.$el.append(t);t=l.createTemplate(d,{value:i.toHSLString(s)});this.$el.append(t)},handleSelectionChange:function(){this.refreshCSS()},clearCSSList:function(){var e,t;for(e=this.cssListItemViews.length-1;-1!==e;e--){t=this.cssListItemViews.pop();t.remove()}this.$messageEl.remove();this.$el.empty();r.clearDOMSelection()},displayMessages:function(){var e=r.getSelectedLayers();(0===e.length||e.length>1)&&this.$el.append(this.$messageEl)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return h});define("vanilla-extract/public/js/core/views/templates/fontFaceListItemTemplate.html",[],function(){return'<li class="font-face-list-item">\n    <p class="font-face-name"><%-fontFace%></p>\n    <ul>\n        <% _.each(sizes, function(size){ %>\n        <li class="text-style-size"><p><%-size[0]%></p></li>\n        <% }); %>\n    </ul>\n</li>\n'});define("vanilla-extract/public/js/core/views/inspect/InspectFontFaceView",["jquery","underscore","backbone","../../controllers/SelectionController","../../utils/StyleUtil","../../utils/TemplateUtil","../../utils/CSSUtil","../templates/fontFaceListItemTemplate.html"],function(e,t,i,n,s,r,a,o){"use strict";var l=i.View.extend({initialize:function(e){this.ppi=e.ppi;this.render();this.addHandlers()},render:function(){var i=this.model.styles.reduce(function(e,t){for(var i=t.get("layers"),n=a.parseCSSMeasure(t.get("style").get("size")),s=0;s<i.length;s++){var r=i[s],o=a.getTransformedFontScale(r.get("properties")),l=a.convertPSDUnitsToPreferredUnits({val:(n.val*o).toFixed(2),units:n.units},!0);if(!e[l]){e[l]=t.clone();e[l].set("layers",[])}e[l].get("layers").push(r)}return e},{});i=t.pairs(i).sort(this.sortTextSizeFunction);var n=t.extend({sizes:i},this.model);this.setElement(r.createTemplate(o,n));this.$el.find(".text-style-size").each(function(t){e(this).data("model",i[t][1])})},addHandlers:function(){var t=this;this.$el.find(".text-style-size").click(function(){if(e(this).data("model")===graphite.getDetailsController().get("selectedInspectItem")){graphite.getDetailsController().setSelectedInspectItem(null);graphite.events.trigger("hide-extract-code-popup")}else{graphite.getDetailsController().setSelectedInspectItem(e(this).data("model"));graphite.events.trigger("show-extract-code-popup",{sourceElement:e(this),model:e(this).data("model"),ppi:t.ppi})}});graphite.getDetailsController().on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);n.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},removeEventListeners:function(){graphite.getDetailsController().off(null,null,this);n.off(null,null,this)},sortTextSizeFunction:function(e,t){return parseFloat(e[0])-parseFloat(t[0])},handleSelectedInspectItemChange:function(){var t=graphite.getDetailsController().get("selectedInspectItem");this.$el.find(".text-style-size").each(function(i,n){e(n).data("model")===t?e(n).addClass("selected"):e(n).removeClass("selected")})},handleSelectionChange:function(){var t=n.getSelectedLayers();this.$el.find(".text-style-size").each(function(i,n){var s=e(n).data("model");if(s){var r=s.get("layers");r.some(function(e){return-1!==t.indexOf(e)})?e(this).addClass("selected"):e(this).removeClass("selected")}})},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return l});define("vanilla-extract/public/js/core/utils/FontUtil",["jquery","underscore"],function(e,t){"use strict";var i={TYPEKIT_LOOKUP:"https://typekit.com/api/v1/json/families/",TYPEKIT_SEARCH_URL:"http://typekit.com/search/fonts/?q=",cache:{},getTypeKitURL:function(t){var i=t.replace(/\s+/g,"-").toLowerCase(),n=this.cache[i],s=this;return e.Deferred(function(r){void 0===n?e.ajax({url:s.TYPEKIT_LOOKUP+i,dataType:"jsonp",error:function(){r.reject(new Error("TypeKit family lookup request failed"))}}).done(function(e){var n=e&&e.family&&e.family.web_link,a=n||null;s.cache[i]=a;a?r.resolve(!0,a):r.resolve(!1,s.TYPEKIT_SEARCH_URL+encodeURIComponent(t))}):n&&r.resolve(n)})}};return i});define("vanilla-extract/public/js/core/views/templates/fontFamilyListItemTemplate.html",[],function(){return'<li class="font-family-list-item">\n    <div class="arrow"></div>\n    <a class="typekit-anchor typekit-anchor-disabled" target="_blank" title=\'<%-translate("Find font on typekit.com")%>\'></a>\n    <p class="font-family-name"><%-get(\'name\')%></p>\n    <div class="font-face-count"><p></p></div>\n    <div style="clear:both;"></div>\n    <ul class="font-face-list"></ul>\n</li>'});define("vanilla-extract/public/js/core/views/inspect/InspectFontFamilyView",["underscore","backbone","../../controllers/SelectionController","../inspect/InspectFontFaceView","../../utils/TemplateUtil","../../utils/FontUtil","../templates/fontFamilyListItemTemplate.html","plugin-dependencies"],function(e,t,i,n,s,r,a,o){"use strict";var l=t.View.extend({fontFaceViews:[],events:{"click .font-family-name":"handleClick","click .typekit-anchor":"handleTypeKitLink"},initialize:function(e){this.ppi=e.ppi;this.render();this.addHandlers()},render:function(){var t,i,o,l,d,c=this,h=this.model.get("faces"),p=0;this.setElement(s.createTemplate(a,this.model));this.$el[0].id="fontFamilyListItem_"+this.model.get("name").replace(/\s+/g,"");this.$el.addClass("closed");this.$el.find(".font-face-list").hide();l=this.$el.find(".typekit-anchor");d=this.$el.find(".font-family-name");r.getTypeKitURL(this.model.get("friendlyName")).done(function(e,t){e?l.removeClass("typekit-anchor-disabled"):l.addClass("typekit-anchor-disabled");l.attr("href",t)}).fail(function(e){l.addClass("typekit-anchor-disabled")});var u=e.keys(h);u&&u.sort(this.sortFaces);e.each(u,function(e){var s=h[e];s.sort(c.sortTextSizeFunction);o=e>>>0===parseFloat(e);e=o?"font-weight "+e:e;i={fontFace:e,styles:s};t=new n({model:i,ppi:c.ppi});c.fontFaceViews.push(t);c.$el.find(".font-face-list").append(t.el);c.$el.find(".font-face-list").append('<div style="clear:both;"></div>');p++});this.$el.find(".font-face-list").append('<div class="list-bottom-padding"></div>');this.$el.find(".font-face-count p").text(p)},sortFaces:function(e,t){var i=["regular","thin","extralight","ultralight","light","normal","medium","semibold","demibold","bold","extrabold","ultrabold","black","heavy","italic","bolditalic"];return i.indexOf(e.toLowerCase().replace(/ /g,""))-i.indexOf(t.toLowerCase().replace(/ /g,""))},updateClosedStatus:function(){if(this.$el.hasClass("closed")){this.$el.find(".font-face-list").slideUp(50);this.$el.find(".font-face-count").fadeIn(100)}else{this.$el.find(".font-face-list").slideDown(50);this.$el.find(".font-face-count").fadeOut(100)}},addHandlers:function(){i.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},handleClick:function(){this.$el.toggleClass("closed");this.updateClosedStatus()},handleTypeKitLink:function(){graphite.events.trigger("typekitSearch")},removeEventListeners:function(){i.off(null,null,this)},handleSelectionChange:function(){var t=this,n=i.get("extractedStylesInSelection").textStyleUsageModels,s=i.getSelectedLayers();e.each(n,function(e,i){if(e.get("style").get("fontName")===t.model.get("name")&&s.length>0){t.$el.removeClass("closed");t.updateClosedStatus()}})},remove:function(){e.each(this.fontFaceViews,function(e){e.remove()});this.fontFaceViews.length=0;this.removeEventListeners();return t.View.prototype.remove.call(this)}});return l});define("vanilla-extract/public/js/core/views/templates/colorListItemTemplate.html",[],function(){return'<li>\n    <div class="color-chip"></div>\n</li>'});define("vanilla-extract/public/js/core/views/inspect/BaseInspectColorView",["underscore","backbone","../../controllers/SelectionController","../../models/ColorUsageModel","../../utils/StyleUtil","../../utils/TemplateUtil","../templates/colorListItemTemplate.html"],function(e,t,i,n,s,r,a){"use strict";var o=t.View.extend({events:{click:"handleClick"},initialize:function(){this.render();this.addHandlers()},render:function(){this.setElement(r.createTemplate(a))},addHandlers:function(){graphite.getDetailsController().on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);i.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},removeEventListeners:function(){graphite.getDetailsController().off(null,null,this);i.off(null,null,this)},handleClick:function(){if(this.model===graphite.getDetailsController().get("selectedInspectItem"))graphite.getDetailsController().setSelectedInspectItem(null);else{graphite.getDetailsController().setSelectedInspectItem(this.model);this.model instanceof n&&this.showInfo()}},handleSelectedInspectItemChange:function(){this.model===graphite.getDetailsController().get("selectedInspectItem")?this.$el.addClass("selected"):this.$el.removeClass("selected");graphite.getDetailsController().get("selectedInspectItem")||graphite.events.trigger("hide-color-popup",null)},handleSelectionChange:function(){var t=this.getStylesForSelection(),n=this.model,r=!1,a=i.getSelectedLayers();e.each(t,function(e,t){s.areUsageStylesEqual(n,e)&&(r=!0)});this.$el.removeClass("layer-over");r&&a.length>0?this.$el.addClass("selected"):this.$el.removeClass("selected")},getStylesForSelection:function(){},getStylesForLayer:function(e){},showInfo:function(){graphite.events.trigger("show-color-popup",{style:this.model,sourceElement:this.$el.find(".color-chip")})},remove:function(){this.removeEventListeners();return t.View.prototype.remove.call(this)}});return o});define("vanilla-extract/public/js/core/views/inspect/InspectSolidColorView",["underscore","../inspect/BaseInspectColorView","../../controllers/SelectionController"],function(e,t,i){"use strict";var n=t.extend({render:function(){t.prototype.render.apply(this,arguments);this.$el.find(".color-chip").css("background-color",this.model.get("style").toRGBString())},getStylesForSelection:function(){return i.get("extractedStylesInSelection").colorUsageModels},getStylesForLayer:function(e){return e.getUsageModels().colorUsageModels}});return n});define("vanilla-extract/public/js/core/views/templates/dropperItemTemplate.html",[],function(){return'<li class="dropper-item" title=\'<%-translate("Color Picker")%>\'>\n    <div class="color-chip"><div class="dropper"></div></div>\n</li>'});define("vanilla-extract/public/js/core/views/inspect/DropperColorView",["underscore","backbone","../../controllers/SelectionController","../../utils/TemplateUtil","../templates/dropperItemTemplate.html"],function(e,t,i,n,s){"use strict";var r=t.View.extend({events:{click:"handleClick"},initialize:function(){this.render()},render:function(){this.setElement(n.createTemplate(s))},handleClick:function(e){i.enableDropperTool();e.stopPropagation()},remove:function(){return t.View.prototype.remove.call(this)}});return r});define("vanilla-extract/public/js/core/views/inspect/InspectGradientView",["underscore","../inspect/BaseInspectColorView","../../controllers/SelectionController","../../utils/CSSUtil"],function(e,t,i,n){"use strict";var s=t.extend({render:function(){t.prototype.render.apply(this,arguments);n.applyCSS(this.$el.find(".color-chip"),this.model.get("style"),!0)},handleClick:function(){this.model===graphite.getDetailsController().get("selectedInspectItem")?graphite.events.trigger("hide-extract-code-popup"):graphite.events.trigger("show-extract-code-popup",{sourceElement:this.$el.find(".color-chip"),model:this.model});t.prototype.handleClick.apply(this,arguments)},getStylesForSelection:function(){return i.get("extractedStylesInSelection").gradientUsageModels},getStylesForLayer:function(e){return e.getUsageModels().gradientUsageModels}});return s});define("vanilla-extract/public/js/core/views/inspect/ContextMenuView",["jquery","underscore","backbone","../../Constants"],function(e,t,i,n){"use strict";var s=i.View.extend({className:"context-menu",enabled:!0,initialize:function(i){t.bindAll(this,"open","close","setItems","handleSelect");this.menuName=i.name;this.$el.addClass(i.name);i.enabled===!1&&(this.enabled=!1);this.items=i.items||[];this.$toggle=i.$toggle||e("<div>");this.$after=i.$after||this.$toggle;this.position=i.position;this.toggleEvent="click";this.itemEvent="click";this.blurEvent="mousedown";this.isOpen=!1;this.isRendered=!1;this.setItems(this.items);this.$toggle.bind(this.toggleEvent,this.open)},rebindToggle:function(){var e=this;this.close();t.delay(function(){e.$toggle.unbind(e.toggleEvent,e.open);e.$toggle.bind(e.toggleEvent,e.open)},300)},setItems:function(e){this.close();this.items=e;this.isRendered=!1;0===e.length?this.$toggle.addClass("context-menu-empty"):this.$toggle.removeClass("context-menu-empty");return this},checkItem:function(t){this.$el.find("a").removeClass("active");this.$el.find("a").each(function(){e(this).attr("data")===t&&e(this).addClass("active")})},placeMenu:function(){var e=this.$toggle.position(),t=this.$toggle.offsetParent(),i=t?t.scrollTop():0;this.position===n.MenuPosition.TOP?this.$el.css("top",e.top+i):this.position===n.MenuPosition.BELOW&&this.$el.css("top",e.top+this.$toggle.outerHeight()+i);this.$el.css("left",e.left)},open:function(){if(!this.enabled)return!1;this.placeMenu();this.$toggle.addClass("menu-open");this.$toggle.unbind(this.toggleEvent,this.open);this.$el.css("opacity",0);this.render();this.$after.after(this.$el);this.trigger("show",this.$el,this.$toggle);this.$el.find("a").bind(this.itemEvent,this.handleSelect);this.$el.bind(this.blurEvent,this.stopClickProp);e(document.body).bind(this.blurEvent,this.close);this.isOpen=!0;this.$el.animate({opacity:1},150);return!1},close:function(){if(this.isOpen!==!1){this.$toggle.removeClass("menu-open");this.$el.remove();this.trigger("hide");this.$el.find("a").unbind(this.itemEvent,this.handleSelect);this.$el.unbind(this.blurEvent,this.stopClickProp);e(document.body).unbind(this.blurEvent,this.close);this.isOpen=!1;var i=this;t.delay(function(){i.$toggle.bind(i.toggleEvent,i.open)},200);return!1}},handleSelect:function(i){var n=e(i.currentTarget).attr("data");this.trigger("selection",n);t.defer(this.close);return!1},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},render:function(){if(this.isRendered)return this;var e,t,i="";for(t=this.items.length-1;t>=0;t--){e=this.items[t];i+='<a data="'+e+'"><i class="icon-btn '+e+'"></i>'+this.labels[e]+"</a>"}this.$el.html(i);this.isRendered=!0;return this},stopClickProp:function(e){e&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}});return s});define("vanilla-extract/public/js/core/models/FontFamilyModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{name:"",faces:null},initialize:function(){this.set("faces",{})},addTextStyle:function(e){var t,i,n=e.get("style"),s=this.get("faces");for(i in s)if(s.hasOwnProperty(i)&&i===n.get("fontFace")){t=s[i];break}if(!t){t=[];s[n.get("fontFace")]=t}t.push(e)}});return i});define("vanilla-extract/public/js/core/controllers/ClipboardController",["underscore","backbone","../external/ZeroClipboard/ZeroClipboard"],function(e,t,i){"use strict";var n=t.Model.extend({clipboard:null,loaded:!1,getClipboard:function(){this.clipboard||this.initController();return this.clipboard},initController:function(){try{this.clipboard=graphite.getClipboard();this.clipboard.on("load",function(){graphite.events.trigger("clipboard-loaded")});this.clipboard.on("dataRequested",function(){graphite.events.trigger("clipboard-data-requested",this)});this.clipboard.on("complete",function(){graphite.events.trigger("clipboard-complete",this)});this.clipboard.on("mouseover",function(){graphite.events.trigger("clipboard-mouseover",this)})}catch(e){}}});return new n});define("vanilla-extract/public/js/core/views/templates/autoExtractedItemsTemplate.html",[],function(){return'<div>\n    <div id="aug21FilesHeader" class="aug21Header">\n        <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">Update:</span><span class="aug21HeaderTextLarge"> Project Parfait is now available as Extract in Creative Cloud, <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">for free</span>. Get all the same features you love and more, including sharing with others.</span><br/><br/>\n        <span class="aug21HeaderTextSmall">You can start using Extract by going to <a id="aug21CCFilesLink" href="https://assets.adobe.com/files">Creative Cloud Files</a>. Youll be able to download your uploaded PSDs until <span class="aug21HeaderTextBlackBold aug21HeaderTextSmall">December 15, 2014.</span> <a id="aug21LearnMoreLink" href="http://www.adobe.com/go/extract_transition" target="_blank">Learn more here</a></span>\n    </div>\n    <h4 class="preprocessor-header">\n        <div class="preprocessor">\n            <b><%-preprocessors[currentPreprocessor].displayName%></b><em></em>\n        </div>\n        <button class="cssInspectorCopyAllButton topcoat-button"><%-translate("Copy All")%></button>\n    </h4>\n\n    <ul class="css-properties"></ul>\n    <ul class="panel-rows">\n        <li>\n            <label for="fontUnit"><%-translate("Preferred Font Unit")%></label>\n            <div class="dropdown">\n                <div class="dropdown-btn fontUnit" id="fontUnit">\n                    <%-currentUnitType%>\n                </div>\n            </div>\n        </li>\n        <li>\n            <label for="baseFontInput" id="baseFontInputLabel"><%-translate("Base Font Size")%></label>\n            <input id="baseFontInput" class="topcoat-text-input" type="text" class="prefix-input" value="16px" size="4">\n        </li>\n    </ul>\n\n    <h4><%-translate("Fonts")%></h4>\n    <ul class="font-list"></ul>\n    <h4><%-translate("Colors")%></h4>\n    <ul class="solid-color-list"></ul>\n    <h4><%-translate("Gradients")%></h4>\n    <ul class="gradient-list"></ul>\n</div>'});define("vanilla-extract/public/js/core/views/inspect/PSDInspectView",["jquery","underscore","backbone","../inspect/InspectCSSView","../inspect/InspectFontFamilyView","../inspect/InspectSolidColorView","../inspect/DropperColorView","../inspect/InspectGradientView","../inspect/ContextMenuView","../../models/FontFamilyModel","../../controllers/ClipboardController","../../controllers/SelectionController","../../models/ColorModel","../../models/ColorUsageModel","../../models/PSDSettingsModel","../../models/UserSettingsModel","plugin-dependencies","../../utils/TemplateUtil","../../Constants","../../utils/CSSUtil","../templates/autoExtractedItemsTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f,m,v,y,b,w){"use strict";var S=i.View.extend({colorChips:[],gradientChips:[],fontFamilyViews:[],events:{"dblclick .css-properties":"handleDoubleClickEvent","change #baseFontInput":"handleBaseFontSizeChanged"},initialize:function(){this.render();this.model.on("change:extractedStyles",this.handleModelExtractedStylesChange,this);graphite.getDetailsController().on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);this.model.get("extractedStyles")&&this.handleModelExtractedStylesChange();this.initCopyToClipboard();graphite.events.on("commitDropperColor",this.handleNewDropperColor,this);graphite.events.on("psdSettingsChanged",this.handlePSDSettingsChanged,this)},render:function(){this.setElement(v.createTemplate(w,{preprocessors:b.cssPreprocessors,currentPreprocessor:f.get("preprocessor"),currentUnitType:f.get("preferredFontUnits")}));this.createCSSView();this.createFontUnitMenu();this.createPreprocessorMenu();m.parfait&&window.graphite.isFeatureEnabled("aug21")&&this.$el.find("#aug21FilesHeader").addClass("aug21");return this},createPreprocessorMenu:function(){var e=[],i={};t.each(b.cssPreprocessors,function(t,n){if(t.enabled!==!1){i[n]=t.displayName;e.unshift(n)}});this.preprocessorMenu=new l({name:"preprocessor-selector",$toggle:this.$("div.preprocessor"),$after:this.$("div.preprocessor"),items:e,position:y.MenuPosition.BELOW});this.preprocessorMenu.labels=i;this.$(".preprocessor").addClass("menu-active");this.preprocessorMenu.on("show",this.handlePreprocessorMenuShow,this);this.preprocessorMenu.on("selection",this.handlePreprocessorSelectionChange,this)},createFontUnitMenu:function(){var e=["PX","REMS","EMS"];this.fontUnitMenu=new l({name:"fontUnit-selector",$toggle:this.$("div.fontUnit"),$after:this.$("div.fontUnit"),items:e,position:y.MenuPosition.TOP});this.fontUnitMenu.labels=y.FontUnitType;this.$(".fontUnit").addClass("menu-active");this.fontUnitMenu.on("show",this.handleFontUnitMenuShow,this);this.fontUnitMenu.on("selection",this.handleFontUnitSelectionChange,this)},handleFontUnitMenuShow:function(e){var i=f.get("preferredFontUnits"),n=t.invert(y.FontUnitType)[i];this.fontUnitMenu.checkItem(n)},handleFontUnitSelectionChange:function(e){var t=y.FontUnitType[e];if(t!==f.get("preferredFontUnits")){this.handlePreferredUnitTypeChanged(t);f.set("preferredFontUnits",t);this.$(".fontUnit").text(t)}},handlePreprocessorMenuShow:function(e){var t=f.get("preprocessor");this.preprocessorMenu.checkItem(t)},handlePreprocessorSelectionChange:function(e){if(e!==f.get("preprocessor")){f.set("preprocessor",e);this.$(".preprocessor b").text(b.cssPreprocessors[e].displayName);graphite.events.trigger("preprocessorChanged",{preprocessor:e})}},handleModelExtractedStylesChange:function(){this.createTextStyleExamples();this.createSolidColorChips();this.createGradientChips()},initCopyToClipboard:function(){var t=c.getClipboard(),i=this.$el.find("button.cssInspectorCopyAllButton");t.clip(i);var n=this;graphite.events.on("clipboard-data-requested",function(s){if(e(s).is(i)){i.html(m.translate("Copied"));setTimeout(function(){i.html(m.translate("Copy All"))},1500);var r,a=h.getSelectedLayers();if(0!==a.length){if(1===a.length){a=a[0];r=a.getCSSAsString(!0,f.get("preprocessor"));graphite.events.trigger("copy-css",{origin:"CSSInspectorCopyAll"})}else r="";t.setText(r);graphite.events.trigger("clipboard-text-set",r)}else{var o=n.$el.find(".css-properties")[0],l=o.innerText||o.textContent;t.setText(l)}}})},removeEventListeners:function(){graphite.events.off(null,null,this);this.model.off(null,null,this);graphite.getDetailsController().off(null,null,this)},createCSSView:function(){var e=this.$el.find(".css-properties"),t=f.get("preferredFontUnits");t||(t=y.FontUnitType.PX);this.$el.find(".fontUnit").text(t);this.handlePreferredUnitTypeChanged(t);this.cssView=new n({el:e[0]})},createTextStyleExamples:function(){var t,i=this.$el.find(".font-list"),n=this.processTextStyles(),r=this,a=b.findModelResolution(r.model);i.empty();e.each(n,function(e,n){t=new s({model:n,ppi:a});i.append(t.el);r.fontFamilyViews.push(t)});i.append(e('<div style="clear:both;"></div>'))},processTextStyles:function(){var e,i,n=this.model.get("extractedStyles"),s=n?n.textStyleUsageModels:{},r=[];t.each(s,function(n){e=null;i=n.get("style");t.each(r,function(t){if(i.get("fontName")===t.get("name")){e=t;return!1}return!0});if(!e){e=new d({name:i.get("fontName"),friendlyName:i.get("friendlyName")});r.push(e)}e.addTextStyle(n)});return r},createSolidColorChips:function(){var n,s,o=this.$el.find(".solid-color-list"),l=this.model.get("extractedStyles").colorUsageModels,d=this;l.sort(this.sortColorFunction);o.empty();t.each(l,function(e){n=new r({model:e});o.append(n.el);d.colorChips.push(n)});s=new a({model:new i.Model});o.prepend(s.el);o.append(e('<div style="clear:both;"></div>'))},handleNewDropperColor:function(e){var t=this.$el.find(".dropper-item .color-chip");if(e){var i=new u,n=new p(e),s=this.$el.find(".dropper-item");i.set("style",n);1!==e.alpha&&i.set("alphas",[e.alpha.toFixed(2)]);this.model.get("extractedStyles").colorUsageModels.push(i);var a=new r({model:i});a.$el.insertAfter(s);this.colorChips.push(a)}t.css("background-color","")},createGradientChips:function(){var i,n=this.$el.find(".gradient-list"),s=this.model.get("extractedStyles").gradientUsageModels,r=this;s.sort(this.sortColorFunction);n.empty();t.each(s,function(e){i=new o({model:e});n.append(i.el);r.gradientChips.push(i)});n.append(e('<div style="clear:both;"></div>'))},handleBaseFontSizeChanged:function(){var e,t=this.$el.find("#baseFontInput"),i=t.val(),n=/(\d+)\s*(.*)/,s=n.exec(i),r=g.get("baseFontSizeValue"),a=g.get("baseFontSizeUnits"),o=r+a;if(s&&s.length>=1){e=parseFloat(s[1]);e>0&&1e3>e&&(r=parseFloat(s[1]));if(s.length>=2)switch(s[2].trim().toLowerCase()){case"px":a=y.FontUnitType.PX;break;default:a=y.FontUnitType.PX}}else{r=y.BaseFontDefaultSize;a=y.FontUnitType.PX}if(r){g.set("baseFontSizeValue",r);if(a){t.val(r+a);g.set("baseFontSizeUnits",a)}else t.val(r.toString()+a)}else t.val(r+a);if(o!==r+a){graphite.events.trigger("updateFontCSS");graphite.events.trigger("baseFontSizeChanged",{newBaseUnits:r+a});this.createTextStyleExamples()}},handlePreferredUnitTypeChanged:function(e){var t=g.get("baseFontSizeValue"),i=g.get("baseFontSizeUnits");if(e&&e!==y.FontUnitType.PX){if(!t){t=16;g.set("baseFontSizeValue",t)}if(!i){i=y.FontUnitType.PX;g.set("baseFontSizeUnits",i)}this.$el.find("#baseFontInputLabel").removeClass("disabledLabel");this.$el.find("#baseFontInput").prop("disabled",!1);this.$el.find("#baseFontInput").val(t+i)}else{this.$el.find("#baseFontInputLabel").addClass("disabledLabel");this.$el.find("#baseFontInput").prop("disabled",!0);this.$el.find("#baseFontInput").val("")}if(e&&e!==f.get("preferredFontUnits")){f.set("preferredFontUnits",e);graphite.events.trigger("updateFontCSS");graphite.events.trigger("preferredFontUnitsChanged",{preferredUnits:e});this.createTextStyleExamples()}},handlePSDSettingsChanged:function(){this.handlePreferredUnitTypeChanged(f.get("preferredFontUnits"))},handleSelectedInspectItemChange:function(){graphite.getDetailsController().get("selectedInspectItem")||graphite.events.trigger("hide-extract-code-popup")},handleDoubleClickEvent:function(){graphite.events.trigger("cssDoublClick")},sortColorFunction:function(e,t){return t.get("layers").length-e.get("layers").length},remove:function(){this.cssView.remove();this.cssView=null;this.removeEventListeners();t.each(this.colorChips,function(e){e.remove()});this.colorChips.length=0;t.each(this.gradientChips,function(e){e.remove()});this.gradientChips.length=0;t.each(this.fontFamilyViews,function(e){e.remove()});this.fontFamilyViews.length=0;i.View.prototype.remove.call(this)}});return S});define("vanilla-extract/public/js/core/models/DerivedAssetModel",["jquery","underscore","backbone","./LayerModelMap"],function(e,t,i,n){"use strict";function s(e){if(!e)return"";var t=e.substring(e.lastIndexOf(".")+1);return r[t]||""}var r={png:"image/png",svg:"image/svg+xml",jpg:"image/jpeg",jpeg:"image/jpeg"},a=i.Model.extend({defaults:{guid:"",name:"",mimeType:""},hasLinkedSmartObject:function(){var e,t=this.get("originatingLayers"),i=!1;t&&(i=t.some(function(t,i){e=n.getLayerModelFromId(t);return e?e.isLinkedSmartObject():!1}));return i},parse:function(e){var t={id:e.id,guid:e.id,name:e.name,mimeType:s(e.name)};return t}});return a});define("vanilla-extract/public/js/core/collections/DerivedAssetCollection",["backbone","../models/DerivedAssetModel"],function(e,t){"use strict";var i=e.Collection.extend({model:t,parse:function(e){return e}});return i});define("vanilla-extract/public/js/core/models/ExtractSettingsModel",["underscore","plugin-dependencies","../Constants","backbone"],function(e,t,i,n){"use strict";var s=n.Model.extend({initialize:function(e){var t={};switch(e.type){case"LDPI":t={id:e.type,label:e.type,suffix:"",folder:"_ldpi"};break;case"MDPI":t={id:e.type,label:"MDPI/1x",suffix:"",folder:"_mdpi"};break;case"TVDPI":t={id:e.type,label:e.type,suffix:"",folder:"_tvdpi"};break;case"HDPI":t={id:e.type,label:e.type,suffix:"",folder:"_hdpi"};break;case"XHDPI":t={id:e.type,label:"XHDPI/Retina 2x",suffix:"@2x",folder:"_xhdpi-2x"};break;case"XXHDPI":t={id:e.type,label:"XXHDPI/Retina 3x",suffix:"@3x",folder:"_xhdpi-3x"};break;case"XXXHDPI":t={id:e.type,label:e.type,suffix:"",folder:"_xxxhdpi"}}t.checked=!1;this.defaults=t;this.set(this.defaults)},reset:function(){this.clear().set(this.defaults)}});return s});define("vanilla-extract/public/js/core/controllers/DerivedAssetController",["jquery","underscore","backbone","plugin-dependencies","../collections/DerivedAssetCollection","../models/DerivedAssetModel","../models/ExtractSettingsModel","../models/LayerModelMap","../models/PSDSettingsModel"],function(e,t,i,n,s,r,a,o,l){"use strict";function d(e,t){var i={LDPI:.75,MDPI:1,TVDPI:1.33,HDPI:1.5,XHDPI:2,XXHDPI:3,XXXHDPI:4};return i.hasOwnProperty(e)?i[e]/t:1}function c(e,t){var i=e.lastIndexOf(".");t=t||"";return-1!==i?e.substr(0,i)+t:e+t}var h=i.Model.extend({downloadFrames:[],maxDownloads:3,fileExtMap:{svg:".svg",jpg:".jpg",jpeg:".jpg",png8:".png",png32:".png"},assetCatalog:new s,derivedAssetCollection:new s,_filterAssets:function(e){var t=this.assetCatalog.filter(function(t){var i=e.findWhere({name:t.get("name")});if(void 0===i)return!1;t.set("guid",i.get("guid"));t.set("mimeType",i.get("mimeType"));return!0});e.reset();this.derivedAssetCollection.reset(t)},_loadCataloguedAssets:function(e,t,i,n){var r=this;graphite.getServerAPI().loadAssetData(this.psdGuid,"extract_asset_catalog",function(a){r.assetCatalog.reset(a.data);r.assetCatalogVersion=a.etag;var o=new s;graphite.getServerAPI().loadDerivedAssetCollection(o,e,function(e){r._filterAssets(o);t.apply(n,[e])},function(e){i.apply(n,[e])})},function(e){i.apply(n,[e])})},_checkForRefresh:function(e){e.needRefresh&&graphite.events.trigger("refreshAssetsView")},_registerDerivedAsset:function(e,t,i,n,s){var a=this,o=t.get("name"),l=new r({name:o,guid:t.get("id"),scale:i.scale,layerCompId:i.layerCompId,originatingLayers:i.layerIds,encodingType:i.encodingType,encodingQualityFactor:i.encodingQualityFactor,psdModified:e.get("modified")});graphite.getServerAPI().updateAssetData(this.psdGuid,"extract_asset_catalog",function(e){a.assetCatalog.reset(e);var t=a.assetCatalog.where({name:o});a.assetCatalog.remove(t);a.assetCatalog.push(l);return a.assetCatalog.toJSON()},function(e){a.assetCatalogVersion=e.etag;a.assetCatalog.reset(e.data);a._checkForRefresh(e);graphite.events.trigger("batch_extract_start");a.applyExportSettings(l);n&&n()},function(e){s&&s()},null)},_unregisterDerivedAsset:function(e,i,n){var s=this;graphite.getServerAPI().updateAssetData(this.psdGuid,"extract_asset_catalog",function(i){s.assetCatalog.reset(i);var n=s.assetCatalog.where({name:e.get("name")});t.each(n,function(e){s.assetCatalog.remove(e)});return s.assetCatalog.toJSON()},function(e){s.assetCatalogVersion=e.etag;s.assetCatalog.reset(e.data);s._checkForRefresh(e);i&&i()},function(e){n&&n()},null)},containsALinkedSmartObjectAsset:function(){var e=!1;n.utils.hasFeature("extract_batch")&&this.derivedAssetCollection&&(e=this.derivedAssetCollection.models.some(function(e,t){return e.hasLinkedSmartObject()}));return e},getMetadataForAsset:function(e){return this.assetCatalog.findWhere({name:e.get("name")})},getDerivedAssets:function(e,t,i,r){this.derivedAssetCollection?this.psdGuid!==e.get("id")&&this.derivedAssetCollection.reset():this.derivedAssetCollection=new s;this.psdGuid=e.get("id");n.utils.hasFeature("extract_batch")?this._loadCataloguedAssets(e,t,i,r):graphite.getServerAPI().loadDerivedAssetCollection(this.derivedAssetCollection,e,t,i,r);return this.derivedAssetCollection},exportAsset:function(t,i,s,a,o,l,d,c,h,p,u){function g(e){var s=JSON.parse(e.responseText);if(i)C.queueDownload(graphite.getServerAPI().getDerivedDownloadURL(s.id,s.name));else{var a=new r;s.metadata&&s.metadata.asset&&(s.name=s.metadata.asset.fileName);a.attributes=a.parse(s);a.attributes.originatingLayers=t;var o=C.derivedAssetCollection.where({name:a.get("name")});o&&o.length&&C.derivedAssetCollection.remove(o);C.derivedAssetCollection.add(a);
n.utils.hasFeature("extract_batch")&&C._registerDerivedAsset(d,a,S,function(){h&&h.apply(u,[e])},p&&p.bind(u))}}function f(e){graphite.events.trigger("assetExtractionFailure",{});p&&p.apply(u,[e])}var m,v=parseInt(o,10),y="",b="?",w=d.get("localContent");if(w){y="";m=d.get("id");y=y+b+"layerIds="+t.join(",");b="&";y=y+b+"encodingType="+a;y=y+b+"encodingQualityFactor="+v;y=y+b+"assetName="+encodeURIComponent(s);w?this.queueDownload("/api/v1/localcontent/"+m+"/derived"+y):this.queueDownload("/api/v1/psd/"+m+"/asset/derived"+y)}else{v=parseInt(o,10);n.utils.hasFeature("extract_batch")||(s=this.generateUniqueAssetName(s,a));var S={layerIds:t,encodingType:a,encodingQualityFactor:v,psdGuid:d.get("id"),scale:l,layerCompId:d.get("layerCompId"),noCache:e.now(),assetName:s,update:c},C=this;graphite.getServerAPI().createDerivedAsset(S,i,g,f,this)}},updateAsset:function(e,t,i,n,s,r,a,o,l,d,c){var h=n+this.fileExtMap[s];if(!i&&e.get("name")!==h){var p=this,u=l,g=e.get("name");e.set("name",h);l=function(){e.set("name",g);p.deleteDerivedAsset(e,u,d,c)}}return this.exportAsset(t,i,n,s,r,a,o,!0,l,d,c)},deleteDerivedAsset:function(e,t,i,s){var r=this;n.utils.hasFeature("extract_batch")?r._unregisterDerivedAsset(e,t.bind(s,[e]),i.bind(s)):graphite.getServerAPI().deleteDerivedAsset(e.get("guid"),function(e){t.apply(s,[e])},function(e){i.apply(s,[e])})},queueDownload:function(t){var i=e('<iframe style="display:none;" class="downloader">').appendTo(e("body"));i.attr("src",t);this.downloadFrames.unshift(i);if(this.downloadFrames.length>this.maxDownloads){this.downloadFrames[this.maxDownloads].remove();this.downloadFrames.length=this.maxDownloads}},generateUniqueAssetName:function(e,t){for(var i=this.fileExtMap[t],n=e+i,s=!0,r=0,a=e;s;){var o=this.derivedAssetCollection.where({name:n});if(o&&o.length){r++;a=e+" ("+r+")";n=a+i}else s=!1}return a},initDeviceExtractionSettings:function(){this.deviceExtractSettings=new i.Collection;var e,t=["LDPI","MDPI","TVDPI","HDPI","XHDPI","XXHDPI","XXXHDPI"];for(e=0;e<t.length;e++)this.deviceExtractSettings.push(new a({type:t[e]}))},loadDeviceExtractionSettings:function(e){var t=this;this.initDeviceExtractionSettings();graphite.getServerAPI().loadAssetData&&!graphite.inPublicOneUp()&&graphite.getServerAPI().loadAssetData(e.get("id"),"extract_batch_settings",function(e){e&&e.data&&t.deviceExtractSettings.reset(e.data)},function(e){});return this.deviceExtractSettings},saveDeviceExtractionSettings:function(){var e=this;graphite.events.trigger("batch_extract_start");graphite.getServerAPI().updateAssetData(this.psdGuid,"extract_batch_settings",function(t){return e.deviceExtractSettings.toJSON()},function(t){e.applyExportSettings()},function(e){graphite.events.trigger("batch_extract_complete")},null)},applyExportSettings:function(e){var t=this,n=e?new i.Collection([e]):t.assetCatalog,s={psdGuid:this.psdGuid,jobs:[]};t.deviceExtractSettings.each(function(e){if(e.get("checked")){var t,i,r={};n.each(function(i){var n=i.get("layerCompId")||"default",s={layerIds:i.get("originatingLayers"),encodingType:i.get("encodingType"),encodingQualityFactor:i.get("encodingQualityFactor"),assetName:c(i.get("name"),e.get("suffix"))};t=r[n];if(!t){t={outputTarget:e.get("folder"),scale:d(e.get("type"),l.get("designedAtMultiplier")),assets:[]};"default"!==n&&(t.layerCompId=n);r[n]=t}t.assets.push(s)});for(i in r)r.hasOwnProperty(i)&&s.jobs.push(r[i])}});s.jobs.length?graphite.getServerAPI().batchCreateDerivedAssets(s,function(e){graphite.events.trigger("batch_extract_complete")},function(e){graphite.events.trigger("batch_extract_complete_error")},this):graphite.events.trigger("batch_extract_cancelled")}});return new h});define("vanilla-extract/public/js/core/views/templates/derivedAssetListItemTemplate.html",[],function(){return'<li class="derived-asset-list-item">\n    <div class="image-wrapper">\n        <% if (mimeType === \'image/svg+xml\') { %>\n            <div style="background: url(\'<%- graphite.getServerAPI().getDerivedDownloadURL(guid, name) %>\') center center no-repeat; background-size: contain;"></div>\n        <% } else { %>\n            <div style="background: url(\'<%- graphite.getServerAPI().getDerivedRenditionURL(guid) %>\') center center no-repeat; background-size: contain;"></div>\n        <% } %>\n        <div class="warning-icon"></div>\n    </div>\n    <span class="asset-label" title="<%-name%>"> <%-name%> </span>\n    <div class="del-button" title=\'<%-translate("Delete asset")%>\'></div>\n    <div class="settings-button" title=\'<%-translate("Update extraction parameters")%>\'></div>\n    <div class="download-button" title=\'<%-translate("Download asset")%>\'></div>\n</li>\n'});define("vanilla-extract/public/js/core/views/assets/DerivedAssetView",["jquery","underscore","backbone","../../controllers/SelectionController","../../controllers/DerivedAssetController","../../models/LayerModelMap","../../utils/ImageUtil","../../utils/TemplateUtil","plugin-dependencies","../templates/derivedAssetListItemTemplate.html"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=i.View.extend({hoverTimer:null,events:{"load img":"handleImageLoad",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","click .del-button":"handleDeleteButton","click .download-button":"handleDownload","click .image-wrapper":"handleDownload","click .settings-button":"handleSettingsClick"},initialize:function(){t.bindAll(this,"handleThumbMouseEnter","handleThumbMouseLeave");this.render()},render:function(){this.setElement(o.createTemplate(d,this.model.attributes));this.$deleteButton=this.$el.find(".del-button");this.$settingsButton=this.$el.find(".settings-button");this.$downloadButton=this.$el.find(".download-button");this.$warningIcon=this.$el.find(".warning-icon");this.$deleteButton.css("visibility","hidden");l.utils.hasFeature("extract_batch")&&this.model.hasLinkedSmartObject()&&this.$warningIcon.css("visibility","visible");this.$el.find("div.image-wrapper").mouseenter(this.handleThumbMouseEnter);this.$el.find("div.image-wrapper").first().mouseleave(this.handleThumbMouseLeave)},removeEventListeners:function(){graphite.getDetailsController().off(null,null,this)},handleImageLoad:function(t){var i=t.target,n=e(i).parent();a.sizeAndCenterImage(i,parseInt(n.width(),10),parseInt(n.height(),10),a.ImageScaleType.FIT,!1)},handleMouseEnter:function(){this.$deleteButton.css("visibility","visible");this.$downloadButton.css("visibility","visible");l.utils.hasFeature("extract_batch")&&this.$settingsButton.css("visibility","visible")},handleMouseLeave:function(){this.$deleteButton.css("visibility","hidden");this.$downloadButton.css("visibility","hidden");this.beingEdited||this.$settingsButton.css("visibility","hidden")},handleDeleteButton:function(e){this.$el.addClass("pending-delete");s.deleteDerivedAsset(this.model,this.handleDeleteSuccess,this.handleDeleteError,this);e.stopImmediatePropagation()},handleDownload:function(t){t.preventDefault();n.get("inspectedAsset")&&n.get("inspectedAsset").get("id")===this.model.get("id")?graphite.getDetailsController().setInspectedAsset(null):graphite.getDetailsController().setInspectedAsset(this.model);graphite.events.trigger("downloading-extracted-asset");if(!this.$downloadFrame){this.$downloadFrame=e('<iframe class="download-frame"/>');this.$el.append(this.$downloadFrame)}var i=graphite.getServerAPI().getDerivedDownloadURL(this.model.get("guid"),this.model.get("name"));graphite.getServerAPI().getAssetETag(this.model.get("guid"),function(e){this.$downloadFrame.attr("src",i)},function(e){401===e.status&&graphite.events.trigger("reauthenticate")},this)},handleDeleteSuccess:function(){var e=s.derivedAssetCollection;e.remove(this.model)},handleDeleteError:function(e){e&&401===e.status&&graphite.events.trigger("reauthenticate");this.$el.removeClass("pending-delete")},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);graphite.events.trigger("load-asset-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-asset-thumb-popup",{sourceElement:e.$el.find(".image-wrapper div").first(),model:e.model})},500)},handleThumbMouseLeave:function(){if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-asset-thumb-popup",{sourceElement:this.$el.find(".sprite_preview").first(),model:this.model})},handleSettingsClick:function(t){if(l.utils.hasFeature("extract_batch")){graphite.events.trigger("show-extract-asset-popup",{type:"edit",sourceElement:e(t.target),origin:"assetPanel",model:this.model});t.stopPropagation();this.beingEdited=!0;graphite.events.once("hide-extract-asset-popup",this.handleAssetPopupHide,this)}},handleAssetPopupHide:function(){this.beingEdited=!1;var e=this.el;e.querySelector(":hover")||e.parentNode.querySelector(":hover")===e||this.handleMouseLeave()},remove:function(){if(this.$downloadFrame){this.$downloadFrame.remove();this.$downloadFrame=null}this.$deleteButton=null;this.$settingsButton=null;this.$downloadButton=null;this.removeEventListeners();return i.View.prototype.remove.call(this)}});return c});define("vanilla-extract/public/js/core/views/templates/derivedAssetsListTemplate.html",[],function(){return'<div class="assets-content">\n    <div class="no-derived-assets">\n        <%-translate("Select layer(s) in the PSD to extract assets.")%> <a href="<%-translate("http://adobe.com/go/extract_help")%>#extract_image_assets" target="_blank"><%-translate("Learn more")%></a>\n    </div>\n    <div class="derived-assets">\n        <span class=\'desc\'><%-translate("Click thumbnails to download")%></span>\n        <ul class="derived-assets-list"></ul>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/templates/derivedAssetsListTemplateRedux.html",[],function(){return'<div class="assets-content">\n    <div class="no-derived-assets">\n        <%-translate("Select layer(s) in the PSD to extract assets.")%> <a href="<%-translate("http://adobe.com/go/extract_help")%>#extract_image_assets" target="_blank"><%-translate("Learn more")%></a>\n    </div>\n    <div class="derived-assets">\n\n        <button class="btn btn-primary" id="extract_for_device"><%-translate(\'Extract for Devices...\')%></button>\n        <button class="topcoat-button" id="show_files" disabled><%-translate(\'Show Files\')%></button>\n        <div class="extraction-in-progress">\n            <div class="extraction-spinner"></div>\n            <div class="msg"><%-translate(\'New assets are being extracted and optimized in the background.\')%></div>\n        </div>\n        <div class="extraction-complete">\n            <div class="close-button"></div>\n            <div class="icon"></div>\n            <div class="msg"><%=translate(\'The HiDPI assets will be on your computer shortly if you have {2}http://adobe.com/go/cc_pd_download{3}Creative Cloud{4} installed or click on {0}Show Files{1} to view them.\', \'<span class="show-files">\', \'</span>\', \'<a href="\', \'" target="_blank">\', \'</a>\')%></div>\n        </div>\n        <ul class="derived-assets-list"></ul>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/assets/PSDAssetsView",["jquery","underscore","backbone","../../controllers/DerivedAssetController","../assets/DerivedAssetView","../../Constants","plugin-dependencies","../../utils/TemplateUtil","./../templates/derivedAssetsListTemplate.html","./../templates/derivedAssetsListTemplateRedux.html"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=i.View.extend({derivedAssetCollection:null,events:{"click #extract_for_device":"handleExtractForDevicesClick","click #show_files":"handleShowFilesClick","click .extraction-complete .close-button":"handleCloseCompletePane"},initialize:function(){this.render();this.renderAssets();graphite.events.on("refreshAssetsView",this.renderAssets,this);graphite.events.on("batch_extract_start",this.handleBatchExtractStart,this);graphite.events.on("batch_extract_complete",this.handleBatchExtractComplete,this);graphite.events.on("batch_extract_cancelled",this.handleBatchExtractCancelled,this);graphite.events.on("batch_extract_complete_error",this.handleBatchExtractError,this)},render:function(){this.setElement(a.utils.hasFeature("extract_batch")?o.createTemplate(d):o.createTemplate(l));return this},renderAssets:function(){this.assetViews=[];this.$el.find(".derived-assets-list").empty();this.loadDerivedAssets()},loadDerivedAssets:function(){if(!this.model.get("localContent")){this.derivedAssetCollection&&this.derivedAssetCollection.off(null,null,this);this.derivedAssetCollection=n.getDerivedAssets(this.model,this.handleDerivedAssetSuccess,this.handleDerivedAssetError,this);this.derivedAssetCollection.on("add",this.handleDerivedAssetAdd,this);this.derivedAssetCollection.on("remove",this.handleDerivedAssetRemove,this)}},handleDerivedAssetSuccess:function(t){var i,n=this.$el.find(".derived-assets-list"),r=this;if(t&&t.collectionId){this.collectionId=t.collectionId;this.handleDerivedAssetsId()}e.each(this.derivedAssetCollection.models,function(e,t){if(!t.get("childAssets")&&"_extract.manifest"!==t.get("name")){i=new s({model:t});r.assetViews.push(i);n.append(i.el)}});var a={numExtractedAssets:this.assetViews.length,flash:!1};graphite.events.trigger("assetExtracted",a);this.update()},handleDerivedAssetAdd:function(e){var t,i=this.$el.find(".derived-assets-list");if(!e.get("childAssets")){t=new s({model:e});this.assetViews.push(t);i.prepend(t.el);var n={numExtractedAssets:this.assetViews.length,flash:!0};graphite.events.trigger("assetExtracted",n);this.$el.find("#show_files").prop("disabled")?this.handleDerivedAssetsId():this.update()}},handleDerivedAssetRemove:function(e){var t,i;for(i=0;i<this.assetViews.length;i++){t=this.assetViews[i];if(t.model.get("guid")===e.get("guid")){t.remove();this.assetViews.splice(i,1);break}}var n={};n.numExtractedAssets=this.assetViews.length;n.flash=!1;graphite.events.trigger("assetExtracted",n);this.update()},handleDerivedAssetError:function(e){404!==e.status&&401!==e.status&&0!==e.status&&a.notifyUser(a.translate("Error retrieving derived assets ({0})",e.status))},handleDerivedAssetsId:function(){var e=this;if(!this.model.get("localContent")&&!a.parfait&&!graphite.inPublicOneUp()){this.collectionId&&this.collectionId.length>0?this.filesURL="files?location="+encodeURIComponent(graphite.urlBase+"/api/v1/collections/"+this.collectionId):graphite.getServerAPI().getAssetCollectionID(this.model.get("id"),!1,function(t){if(t&&t.length>0){e.collectionId=t;e.filesURL="files?location="+encodeURIComponent(graphite.urlBase+"/api/v1/collections/"+t);e.update()}},function(){});this.update()}},handleExtractForDevicesClick:function(){graphite.events.trigger("show-extractForDevice-dialog")},handleShowFilesClick:function(){window.open(this.filesURL,"_blank")},handleCloseCompletePane:function(){this.$el.find(".extraction-complete").hide()},update:function(){var e=!!this.assetViews.length;this.$el.find(".derived-assets").toggle(e);this.$el.find(".no-derived-assets").toggle(!e);var t=e&&this.filesURL&&this.filesURL.length>0;this.$el.find("#show_files").prop("disabled",!t)},handleBeforeUnload:function(){return a.translate("Assets are still being extracted.")},handleBatchExtractStart:function(){this.$el.find("#extract_for_device").prop("disabled",!0);this.$el.find(".extraction-complete").hide();this.$el.find(".extraction-in-progress").show();e(window).on("beforeunload",this.handleBeforeUnload)},handleBatchExtractComplete:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-complete").show();this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},handleBatchExtractCancelled:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},handleBatchExtractError:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-complete").hide();this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},remove:function(){this.assetViews=[];this.collectionId=null;graphite.events.off("refreshAssetsView",this.renderAssets,this);i.View.prototype.remove.call(this);this.derivedAssetCollection&&this.derivedAssetCollection.off(null,null,this)}});return c});define("vanilla-extract/public/js/core/views/templates/detailPanelTemplate.html",[],function(){return'<div class="tabs dark media-container" id="detail-panel">\n    <button class="topcoat-button upload-button"><%-translate("Upload a PSD")%></button>\n    <nav role="tablist">\n        <a id="psdInspectTab" data-toggle="tab" class="active details-tab"><%-translate("Styles")%></a>\n        <a id="psdLayersTab" data-toggle="tab" class="disabled details-tab"><%-translate("Layers")%></a>\n        <% if (loggedIn && !graphite.inPublicOneUp()) { %>\n        <a id="psdAssetsTab" data-toggle="tab" class="disabled details-tab"><%-translate("Assets")%>&nbsp;<span id="assetCounter" style="display:none;"></span></a>\n        <% } %>\n    </nav>\n    <section id="psdInfoSection" role="tab" class="active"></section>\n    <section id="psdInspectSection" role="tab"></section>\n    <% if (loggedIn && !graphite.inPublicOneUp()) { %>\n    <section id="psdAssetsSection" role="tab"></section>\n    <% } %>\n</div>'});define("vanilla-extract/public/js/core/views/detail/DetailPanelView",["jquery","underscore","backbone","../../Constants","../layers/LayersListView","../inspect/PSDInspectView","../assets/PSDAssetsView","plugin-dependencies","../../utils/TemplateUtil","../templates/detailPanelTemplate.html"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=i.View.extend({layersListView:null,psdInspectView:null,events:{"click .details-tab":"handleTabClick","click .upload-button":"handleUploadPSD"},initialize:function(){this.render();graphite.getDetailsController().on("change:selectedTab",this.handleSelectedTabChange,this);graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish,this);graphite.events.on("assetExtracted",this.handleAssetExtracted,this);graphite.events.on("JSONPreviewReady",this.handleDrawPreviewFinish,this);this.model.on("change:extractedStyles",this.enableExtraTabs,this)},render:function(){this.setElement(l.createTemplate(d,{loggedIn:o.utils.getCurrentPage()}));if(null!==this.model){var e=this.$el.find("#psdInspectSection"),t=this.$el.find("#psdInfoSection"),i=this.$el.find("#psdAssetsSection"),n=this.model.get("localContent");this.psdInspectView=new r({model:this.model});this.layersListView=graphite.getLayersListView(this.model);e.empty();e.append(this.layersListView.el);t.empty();t.append(this.psdInspectView.el);if(!n&&!graphite.inPublicOneUp()){this.assetsListView=new a({model:this.model});i.empty();i.append(this.assetsListView.el)}this.$el.find("section").scroll(function(){graphite.events.trigger("hide-extract-asset-popup");graphite.events.trigger("hide-extract-code-popup");graphite.events.trigger("hide-color-popup")})}this.enableExtraTabs();return this},handleTabClick:function(t){graphite.getDetailsController().setSelectedTab(e(t.target).attr("id"))},handleUploadPSD:function(e){graphite.events.trigger("upload-psd-public-one-up");window.location.href="/files"},handleSelectedTabChange:function(){var t=graphite.getDetailsController().get("selectedTab"),i=this.$el.find("section");this.$el.find("a").each(function(n){if(e(this).attr("id")===t){e(this).addClass("active");e(i[n]).addClass("active");e(i[n]).children().first().trigger("activate")}else{e(this).removeClass("active");e(i[n]).removeClass("active")}});"psdAssetsTab"===t&&this.$el.find("#assetCounter").removeClass("new_asset");graphite.events.trigger("selectedTab",{selectedTab:t})},handleDrawPreviewFinish:function(){var e=graphite.getDetailsController().getSelectedTab();graphite.getDetailsController().setSelectedTab("",{silent:!0});graphite.getDetailsController().setSelectedTab(e||"psdInspectTab")},enableExtraTabs:function(){this.$el.find("#psdLayersTab").removeClass("disabled");this.$el.find("#psdAssetsTab").removeClass("disabled")},handleAssetExtracted:function(e){var t=this.$el.find("#psdAssetsTab").hasClass("active");if(e)if(e.numExtractedAssets>0){this.$el.find("#assetCounter").show();this.$el.find("#assetCounter").text(e.numExtractedAssets);if(e.flash){var i=this;this.$el.find("#assetCounter").addClass("new_asset");t&&setTimeout(function(){i.$el.find("#assetCounter").removeClass("new_asset")},n.flashTimeout)}}else this.$el.find("#assetCounter").hide()},removeEventListeners:function(){graphite.getDetailsController().off(null,null,this);graphite.events.off(null,null,this);this.model.off(null,null,this)},destroyViews:function(e){var i=this;t.each(e,function(e){if(i.hasOwnProperty(e)){i[e].remove();delete i[e]}})},remove:function(){this.removeEventListeners();this.destroyViews(["psdInspectView","layersListView","assetsListView"]);return i.View.prototype.remove.call(this)}});return c});define("vanilla-extract/public/js/core/views/modal/BaseModalView",["jquery","underscore","backbone"],function(e,t,i){"use strict";var n=i.View.extend({visible:!1,blurTargets:".psd-preview-view, #detail-panel, .selection-controlbar, .psd-header",removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},handleHide:function(){e(this.blurTargets).removeClass("blur-background");e("div.modal-window-overlay").hide()},handleShow:function(){e(this.blurTargets).addClass("blur-background");e("div.modal-window-overlay").show()}});return n});define("vanilla-extract/public/js/core/views/templates/helpDialogTemplate.html",[],function(){return'<!-- Help panel keystroke-window-wrapper -->\n    <div class="modal-wrapper" style="display:none;">\n        <div class="keystroke-header">\n            <a class="keystroke-info-icon"></a> <span class="keystroke-header-title"><%-translate("Shortcuts")%></span>\n        </div>\n\n        <div class="keystroke-main-col">\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key"><%-ctrl%></a> / <a class="keystroke-item-key"><%-shift%></a> + <a class="keystroke-item-key">Click</a>\n                </div><span class="keystroke-item-title"><%-translate("Multi-Select")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Selects or deselects a layer to add it to or remove it from a group of selected layers.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">X</a>\n                </div><span class="keystroke-item-title"><%-translate("Toggle Measurement Tooltip")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Toggles measurement tooltip on hover.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys"><a class="keystroke-item-key"><%-alt%></a> + <a class="keystroke-item-key">&minus;</a>/<a class="keystroke-item-key">+</a></div><span class="keystroke-item-title"><%-translate("Zoom")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Zoom preview canvas in and out.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys"><a class="keystroke-item-key"><%-alt%></a> + <a class="keystroke-item-key">Click</a></div><span class="keystroke-item-title"><%-translate("Zoom to Fit Artboard")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Alt + Click on an Artboard label zooms to fit that Artboard.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">E</a>\n                </div><span class="keystroke-item-title"><%-translate("Eyedropper Tool")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Allows extraction of pixel-level color values.")%></p>\n            </div>\n\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&larr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Select Parent Layer")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &larr; will select the layer that is parent to the current layer.")%></p>\n            </div>\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&rarr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Select First Child")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &rarr; will select the first child layer of the current layer. If the currently selected layer has no children, this key does nothing.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&darr;</a><a class=\n                                                                       "keystroke-item-key">&uarr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Next/Previous Sibling Layer")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Selects the next or previous sibling layer. Pressing &uarr; will select the previous sibling and pressing &darr; will select the next sibling layer.")%></p>\n            </div>\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">Esc</a>\n                </div><span class="keystroke-item-title"><%-translate("Clear/Exit")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &ldquo;Esc&rdquo; clears the current selection, exits the current mode, or dismisses a dialog.")%></p>\n            </div>\n        </div>\n    </div>\n'});define("vanilla-extract/public/js/core/views/detail/HelpView",["underscore","backbone","../../utils/TemplateUtil","../modal/BaseModalView","../templates/helpDialogTemplate.html","../../utils/KeyboardUtils"],function(e,t,i,n,s,r){"use strict";var a=n.extend({visible:!1,events:{click:"handleHide"},blurTargets:".psd-preview-view, #detail-panel, .selection-controlbar, .psd-header",initialize:function(){e.bindAll(this,"handleToggle","handleHide");this.render();graphite.events.on("toggle-help-dialog",this.handleToggle,this);graphite.events.on("hide-help-dialog",this.handleHide,this)},render:function(){this.setElement(i.createTemplate(s,{ctrl:r.getMetaKeyName("ctrl"),alt:r.getMetaKeyName("alt"),shift:r.getMetaKeyName("shift")}));return this},handleToggle:function(e){if(this.visible)this.handleHide();else{this.handleShow();e&&"keyboard"===e.from&&graphite.events.trigger("help-dialog-shortcut")}},handleHide:function(){n.prototype.handleHide.apply(this,arguments);this.$el.hide();this.visible=!1},handleShow:function(){n.prototype.handleShow.apply(this,arguments);this.$el.show();this.visible=!0;graphite.events.trigger("help-dialog")}});return a});define("vanilla-extract/public/js/core/views/templates/toolbarTemplate.html",[],function(){return'<div>\n    <div class="rendering-controlbar">\n        <div class="spinner"></div>\n        <span class="message"><%-translate("Rendering...")%></span>\n    </div>\n    <div class="selection-controlbar">\n        <button class="firstuser-shortcut-guide" title=\'<%-translate("First User Experience Guide (i)")%>\'><i class="icon-btn"></i></button>\n        <button class="keyboard-shortcut-guide" title=\'<%-translate("Keyboard Shortcuts Guide (?)")%>\'><i class="icon-btn"></i></button>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/collections/LayerCollection",["backbone","../models/LayerModel"],function(e,t){"use strict";var i=e.Collection.extend({model:t,assetID:null,version:null});return i});define("vanilla-extract/public/js/core/models/LayerCompModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({initialize:function(){}});return i});define("vanilla-extract/public/js/core/controllers/DetailsController",["underscore","backbone","../Constants"],function(e,t,i){"use strict";var n=t.Model.extend({spriteSheets:{},spritesLoaded:{},psdModel:null,defaults:{selectedTab:i.Tab.TAB_INSPECT,activeTool:i.Tool.SELECT_DIRECT,selectedInspectItem:null,inspectedAsset:null,toggleMeasurementOnHover:!1},getPSDModel:function(){return this.psdModel},setPSDModel:function(e){this.psdModel=e;this.spriteSheets={};this.spritesLoaded={};this.spriteSheetLoadedEvent=null},changeActiveTool:function(e){this.set("activeTool",e)},setSelectedTab:function(e){this.set("selectedTab",e)},getSelectedTab:function(){return this.get("selectedTab")},setSelectedInspectItem:function(e){this.set("selectedInspectItem",e)},setInspectedAsset:function(e){this.set("inspectedAsset",e)},setToggleMeasurementOnHover:function(){this.set("toggleMeasurementOnHover",!this.toggleMeasurementOnHover);this.toggleMeasurementOnHover=!this.toggleMeasurementOnHover},disableMeasurementOnHover:function(){if(this.get("toggleMeasurementOnHover")){this.setToggleMeasurementOnHover();graphite.events.trigger("toggle-hover-measurement")}},handleImageLoad:function(e,t,i){t.spritesLoaded[i]=!0;e.drawWhenFinished.forEach(function(t){t(e)});t.spriteSheetsLoaded()&&t.triggerSpriteSheetLoadedEvent()},drawSpriteSheet:function(e,t,i){var n=this.spriteSheets[e],s=this;if(void 0!==n&&null!==n)this.spritesLoaded[e]?t(n):n.drawWhenFinished.push(t);else{n=new Image;n.drawWhenFinished=[t];this.spriteSheets[e]=n;var r=this.getSpriteSheetURL(e);n.addEventListener("load",function(){var t=this;s.spritesLoaded[e]=!0;this.drawWhenFinished.forEach(function(e){e(t)});s.spriteSheetsLoaded()&&s.triggerSpriteSheetLoadedEvent()},!1);this.spritesLoaded[e]=!1;graphite.getServerAPI().loadCrossDomainImage(n,r)}},getSpriteSheetURL:function(e){var t,i=this.psdModel.get("localContent");t=i?i.directory+"/spritesheet/"+e+".png":graphite.getServerAPI().getSpriteSheetURL(this.psdModel.id,this.psdModel.get("layerCompId"),e);return t},triggerWhenSpriteSheetsLoaded:function(e){this.spriteSheetLoadedEvent=e;this.spriteSheetsLoaded()&&this.triggerSpriteSheetLoadedEvent()},triggerSpriteSheetLoadedEvent:function(e){graphite.events.trigger("hideWorkerProgress",-1);var t=e||this.spriteSheetLoadedEvent;this.spriteSheetLoadedEvent=null;t&&graphite.events.trigger(t,this.psdModel)},spriteSheetsLoaded:function(){var e;for(e in this.spriteSheets)if(this.spriteSheets.hasOwnProperty(e)&&!this.spriteSheets[e].complete)return!1;return!0}});return new n});define("vanilla-extract/public/js/core/models/PSDModel",["underscore","backbone","../Constants","../collections/LayerCollection","./LayerCompModel","./LayerModelMap","./UsageModelMap","../utils/MeasurementUtil","../utils/UTF8","../controllers/DetailsController"],function(e,t,i,n,s,r,a,o,l,d){"use strict";function c(t,i){var n=[],s=function(t){e.each(t,function(e){var t=n[e.layerId];if(t){e.spriteSheet=t.spriteSheet;t.flattenedSprite&&(e.flattenedSprite=t.flattenedSprite)}e.children&&s(e.children)})};e.each(i.layers,function(e){n[e.layerId]=e});s(t.children);t.dataType="complete";return t}var h=t.Model.extend({defaults:{id:"",info:"",imgdata:null,isArtboardPSD:!1,artboardsBounds:null,artboards:null,layerCollection:null,layerComps:null,layerCompId:null,extractedStyles:null,localContent:!1,status:0},toString:function(){return"[object PSDModel id: "+this.get("id")+", info: "+this.get("info")+"]"},initialize:function(e){this.id=e.id;this.set("imgdata",{originalFile:"",bounds:{
bottom:0,left:0,right:0,top:0}})},decodeChildNames:function(e){var t=this;e&&e.forEach(function(e){e.layerName=l.decodeCharacters(e.layerName);t.decodeChildNames(e.children)})},parse:function(e){e.dataType=e.dataType||"complete";if("spriteSheetOnly"===e.dataType){if(!this.jsonData){this.spriteSheetData=e;var t,s=function(e){};if(e.info&&e.info.totalSheets)for(t=1;t<=e.info.totalSheets;t++)d.drawSpriteSheet(t,s);return}e=c(this.jsonData,e);delete this.jsonData}else if("JSONOnly"===e.dataType){this.decodeChildNames(e.children);if(this.spriteSheetData){e=c(e,this.spriteSheetData);delete this.spriteSheetData}else this.jsonData=e}else this.decodeChildNames(e.children);e.imgdata&&e.imgdata.originalFile&&(e.imgdata.originalFile=decodeURIComponent(e.imgdata.originalFile));this.set("imgdata",e.imgdata);this.set("info",e.info);this.set("width",e.imgdata.bounds.right);this.set("height",e.imgdata.bounds.bottom);this.set("dataType",e.dataType);r.reset();a.reset();var l=new n;l.add(l.parse(e.children),{parse:!0});var h=this.extractStyles(l);this.set("layerCollection",l);var p,u=null;p=l.reduce(function(e,t){t.get("type")===i.Type.LAYER_ARTBOARD&&e.push(t);return e},[]);p.length>0&&(u=o.calcLayerGroupBounds(p,this));this.set("isArtboardPSD",p.length>0);this.set("artboardsBounds",u);this.set("artboards",e.imgdata.artboards);graphite.events.trigger("num-layers",e.imgdata);this.set("extractedStyles",h);var g=this.extractLayerComps(e.layerComps);this.set("layerComps",g);graphite.events.trigger("layerCompsLoaded");var f=this.get("layerCompId");g&&g.length&&!f&&graphite.events.trigger("layerCompShown");this.set("status",200);this.unset("errorInfo")},extractStyles:function(t){var i,n,s,r={colorUsageModels:[],gradientUsageModels:[],textStyleUsageModels:[],dataType:this.get("dataType")};for(n=0;n<t.length;n++){i=t.at(n);s=i.getUsageModels()}r.colorUsageModels=e.clone(a.getColorUsageModelList());r.gradientUsageModels=e.clone(a.getGradientUsageModelList());r.textStyleUsageModels=e.clone(a.getTextStyleUsageModelList());return r},extractLayerComps:function(e){var t,i,n,r=[];for(n=0;n<e.length;n++){t=e[n];i=new s({id:t.id,name:l.decodeCharacters(t.name),capturedInfo:t.capturedInfo});r.push(i)}return r},_resetLayerSelection:function(e){var t=this;e&&e.each(function(i){i.set("selected",!1);e=i.get("layerCollection");t._resetLayerSelection(e)})},reset:function(){this._resetLayerSelection(this.get("layerCollection"))}});return h});define("vanilla-extract/public/js/core/controllers/AssetController",["underscore","backbone","plugin-dependencies","../models/PSDModel","../Constants"],function(e,t,i,n,s){"use strict";var r=t.Model.extend({getAsset:function(e,t,r,a,o){var l=o?o.localContent:!1,d=new n({id:e,assetId:e,layerCompId:t,localContent:l}),c=function(e,t,n){if("JSON"===n){var r=e.status;if(t){t.errorCode===s.WorkerErrorCodes.GRAPHITE_REJECTED&&(r=422);t.errorCode===s.WorkerErrorCodes.GRAPHITE_PROCESSING&&(r=500)}if(r>=300){d.set("errorInfo",t);d.set("status",r)}}else{i.notifyUser(i.translate("Uh oh, The rendering step failed.  Some functionality may be disabled."));graphite.events.trigger("errorNotificationShown")}a.apply(o,[e,t,n])};l?graphite.getServerAPI().loadPsdModelFromUrl(d,o.localContent.directory+"/graphite.json",r,c,o):graphite.getServerAPI().loadPsdModel2(d,r,c,o);return d}});return new r});define("vanilla-extract/public/js/core/views/templates/designedAtTemplate.html",[],function(){return'<span class="designed-at-label"><%-translate("Designed at")%></span>\n<div id="designedAtDropdown" class="designed-at-select">\n    <div class="label" title="1x">1x</div>\n    <ul class="designedAtDropdownItem">\n        <li title="1x"><a id="1" href="#">1x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="2x"><a id="2" href="#">2x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="3x"><a id="3" href="#">3x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="4x"><a id="4" href="#">4x</a></li>\n    </ul>\n</div>\n'});define("vanilla-extract/public/js/core/views/detail/DesignedAtView",["jquery","underscore","backbone","../../models/PSDSettingsModel","../../utils/TemplateUtil","../../controllers/SelectionController","../../controllers/AssetController","../templates/designedAtTemplate.html"],function(e,t,i,n,s,r,a,o){"use strict";var l=i.View.extend({className:"designed-at-controls",events:{"click #designedAtDropdown":"handleActivate","click a":"handleSelectOption"},initialize:function(){t.bindAll(this,"handleMouseDown");this.render();this.updateDropdownValue();graphite.events.on("psdSettingsChanged",this.updateDropdownValue,this)},render:function(){this.$el.html(s.createTemplate(o));return this},remove:function(){if(this.$el){graphite.events.off(null,null,this);this.$el.empty();return i.View.prototype.remove.call(this)}},handleActivate:function(t){this.$el.find("#designedAtDropdown").toggleClass("active");e(document).on("mousedown.designedAt",this.handleMouseDown);return!1},handleMouseDown:function(t){var i=e(t.target);if(!i.is(this.$el)&&0===this.$el.find(i).length){this.$el.find("#designedAtDropdown").removeClass("active");e(document).off("mousedown.designedAt")}},handleSelectOption:function(t){var i=n.get("designedAtMultiplier"),s=e(t.target),r=parseInt(s.attr("id"),10);if(i!==r){n.set("designedAtMultiplier",r);this.$el.find("#designedAtDropdown .label").text(s.text());graphite.events.trigger("designedAtMultiplierChanged",r)}this.$el.find("#designedAtDropdown").removeClass("active");e(document).off("mousedown.designedAt");t.stopPropagation();t.preventDefault()},updateDropdownValue:function(){this.$el.find("#designedAtDropdown .label").text(n.get("designedAtMultiplier")+"x")}});return l});define("vanilla-extract/public/js/core/views/templates/layerCompsTemplate.html",[],function(){return'<div id="layerCompDropdown" class="layer-comp-select">\n    <div class="label" title="<%-layerComps[currentIndex].get(\'name\')%>"><%-layerComps[currentIndex].get(\'name\')%></div>\n    <span class="layerCompIndexLabel"><%-currentIndex + 1%> <%-translate("of")%> <%-layerComps.length%></span>\n    <% _.each(layerComps, function(layerComp) { %>\n    <ul class="layerCompDropdownItem">\n        <li title="<%-layerComp.get(\'name\')%>"><a id="<%-layerComp.get(\'id\')%>" href="#"><%-layerComp.get(\'name\')%></a></li>\n    </ul>\n    <% }); %>\n</div>\n<div class="header-separator"></div>'});define("vanilla-extract/public/js/core/views/detail/LayerCompView",["jquery","underscore","backbone","../../utils/TemplateUtil","../../controllers/SelectionController","../../controllers/AssetController","../templates/layerCompsTemplate.html","plugin-dependencies"],function(e,t,i,n,s,r,a,o){"use strict";var l=i.View.extend({className:"layer-comp-controls",previouslySelectedTab:"",events:{"click #layerCompDropdown":"handleActivate","click a":"handleSelectOption"},initialize:function(){t.bindAll(this,"handleMouseDown","requestLayerComp");graphite.events.on("layerCompsLoaded",this.handleLayerCompsLoaded,this);graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish(),this);e(document).off("mousedown.layerComps");this.render()},render:function(){this.handleLayerCompsLoaded();return this},remove:function(){if(this.$el){graphite.events.off(null,null,this);this.$el.empty();return i.View.prototype.remove.call(this)}},handleDrawPreviewFinish:function(){var e=s.getPSDModel().get("imgdata").layerCompSelectedTab;e&&graphite.getDetailsController().setSelectedTab(e)},handleLayerCompsLoaded:function(){var e,r,l=s.getPSDModel(),d=s.getPSDModel().get("layerComps"),c=l.get("imgdata").appliedLayerCompId||0,h=o.translate("Last Document State");this.$el.empty();if(d&&d.length>0){d[0].get("name")!==h&&d.unshift(new i.Model({name:h,id:0}));e=t.find(d,function(e){return e.id===c});e=e||d[0];r=d.indexOf(e);this.$el.html(n.createTemplate(a,{layerComps:d,currentIndex:r}));graphite.events.trigger("layerCompChangeComplete")}},handleActivate:function(t){this.$el.find("#layerCompDropdown").addClass("active");e(document).on("mousedown.layerComps",this.handleMouseDown);return!1},handleMouseDown:function(t){var i=e(t.target);if(!i.is(this.$el)&&0===this.$el.find(i).length){this.$el.find("#layerCompDropdown").removeClass("active");e(document).off("mousedown.layerComps")}},handleSelectOption:function(i){var n=s.getPSDModel(),r=n.get("imgdata").appliedLayerCompId,a=e(i.target),o=parseInt(a.attr("id"),10);if(o!==r){n.get("imgdata").layerCompSelectedTab=graphite.getDetailsController().get("selectedTab");this.handleLayerCompsLoaded();t.defer(this.requestLayerComp,o)}this.$el.find("#layerCompDropdown").removeClass("active");e(document).off("mousedown.layerComps");i.stopPropagation();i.preventDefault()},requestLayerComp:function(e){var i,n=s.getPSDModel();graphite.events.trigger("layerCompChanging");this.$el.find("#layerCompDropdown").addClass("disabled");i=graphite.getAssetController().getAsset(n.id,e,function(){t.delay(function(){graphite.events.trigger("layerCompChanged",i)},500)},function(){},this,n.get("path"))}});return l});define("vanilla-extract/public/js/core/views/templates/zoomControlsTemplate.html",[],function(){return'<!-- Zoom Controls -->\n<span class="file-dim"><%- imgdata.bounds.right %> &times; <%- imgdata.bounds.bottom %></span>\n<div class="header-separator"></div>\n<input type="text" class="zoom-input topcoat-text-input" title=\'<%-translate("ALT +/- to zoom in and out")%>\'>100%</input>\n<div class="zoom-fit-button" title=\'<%-translate("Zoom to fit width in view")%>\'><%-translate("FIT")%></div>\n<div class="zoom-100-button" title=\'<%-translate("Zoom to 100%")%>\'>1:1</div>\n<div class="header-separator"></div>\n'});define("vanilla-extract/public/js/core/views/detail/ZoomView",["jquery","underscore","backbone","plugin-dependencies","../../Constants","../../utils/TemplateUtil","../../controllers/ZoomController","../../controllers/SelectionController","../templates/zoomControlsTemplate.html"],function(e,t,i,n,s,r,a,o,l){"use strict";var d=i.View.extend({className:"zoom-controls",events:{"click .zoom-100-button":"handleOneToOne","click .zoom-fit-button":"handleZoomToFitClick","mouseover .zoom-fit-button":"handleZoomToFitMouseOver","focus .zoom-input":"handleFocus","keydown .zoom-input":"handleInputKey","blur .zoom-input":"handleBlur"},defaults:{previewView:null},initialize:function(e){this.previewView=e.previewView;this.render();this.addListeners()},render:function(){this.$el.html(r.createTemplate(l,o.getPSDModel().toJSON()));this.$zoomInput=this.$el.find(".zoom-input");this.setInputLabel();return this},addListeners:function(){t.bindAll(this,"handleDocumentKey","toggleZoomButtonStates","handleZoomToFitClick");graphite.events.on("zoomChanged",this.handleZoomChange,this);graphite.events.on("zoomToFit",this.handleZoomToFitRect,this);graphite.events.on("drawPreviewFinish",this.toggleZoomButtonStates,this);graphite.events.on("psdModelInfoChanged",this.render,this);graphite.events.on("dropperStart",this.handleDropperStart,this);graphite.events.on("dropperStop",this.handleDropperStop,this);e(document).on("keydown.zoomview",this.handleDocumentKey);e(window).on("resize.zoomView",t.debounce(this.toggleZoomButtonStates,300))},remove:function(){this.removeListeners();this.$zoomInput=null;this.$el.empty();this.previewView=null;return i.View.prototype.remove.call(this)},removeListeners:function(){e(document).off("keydown.zoomview",this.handleDocumentKey);e(window).off(".zoomView");graphite.events.off(null,null,this)},setInputLabel:function(){this.$zoomInput.val(a.getZoomPercent())},getCommonArtboardParent:function(e){for(var t=null,i=null,n=0;n<e.length;n++){t=e[n].getArtboardParent();if(null!==t)if(null===i)i=t;else if(i!==t){i=null;break}}return i},handleZoomToFitClick:function(){var e,t=o.getPSDModel(),i=o.getSelectedLayers(),n=null,s=t.get("isArtboardPSD");if(s){n=this.getCommonArtboardParent(i);e=n?n.get("bounds"):t.get("artboardsBounds")}else e=t.get("imgdata").bounds;this.handleZoomToFitRect(e)},handleZoomToFitMouseOver:function(){var e=o.getPSDModel(),t=o.getSelectedLayers(),i=null;if(e.get("isArtboardPSD")){i=this.getCommonArtboardParent(t);i?this.$el.find(".zoom-fit-button").attr("title",n.translate("Zoom to fit ")+i.get("layerName")):this.$el.find(".zoom-fit-button").attr("title",n.translate("Zoom to fit all artboards"))}else this.$el.find(".zoom-fit-button").attr("title",n.translate("Zoom to fit width in view"))},handleZoomToFitRect:function(e){var t=this.getPsdVisibleRect();a.zoomToFitRect(e,t,o.getPSDModel().get("isArtboardPSD"))},handleOneToOne:function(){var e=this.getCenterZoomRect(1);a.setZoomLevel(1,e)},handleZoomChange:function(){this.setInputLabel();this.toggleZoomButtonStates();this._isDropperActive&&a.getZoomLevel()<1?graphite.events.trigger("show-zoom-in-hint-popup",{sourceElement:this.$zoomInput}):graphite.events.trigger("hide-zoom-in-hint-popup")},toggleZoomButtonStates:function(){var e=this.$el.find(".zoom-fit-button"),t=this.$el.find(".zoom-100-button"),i=a.getZoomLevel(),n=o.getPSDModel(),s=this.previewView.$el.outerWidth()-50,r=n.get("imgdata").bounds,l=r.right-r.left,d=s/l;if(s){n.get("isArtboardPSD")?e.removeClass("disabled"):e.toggleClass("disabled",d===i||s>l*i&&i>=1);t.toggleClass("disabled",1===i)}},handleDropperStart:function(){a.getZoomLevel()<1&&graphite.events.trigger("show-zoom-in-hint-popup",{sourceElement:this.$zoomInput});this._isDropperActive=!0},handleDropperStop:function(){graphite.events.trigger("hide-zoom-in-hint-popup");this._isDropperActive=!1},handleInputKey:function(e){var t=e.keyCode;if(9===t||13===t||14===t){if(9!==t){e.preventDefault();e.stopPropagation()}this.commitEdit()}else if(27===t){e.preventDefault();e.stopPropagation();this.$zoomInput.val(this.revertVal)}},handleDocumentKey:function(e){var t=e.keyCode,i=1,n=null;if(e.altKey)if(189===t||109===t||173===t){e.stopPropagation();e.preventDefault();if(!a.isZooming()){i=this.getPrevZoomStep();n=this.getCenterZoomRect(i);a.setZoomLevel(i,n)}}else if(187===t||107===t||61===t){e.stopPropagation();e.preventDefault();if(!a.isZooming()){i=this.getNextZoomStep();n=this.getCenterZoomRect(i);a.setZoomLevel(i,n)}}},handleBlur:function(){this.setInputLabel()},handleFocus:function(){this.revertVal=this.$zoomInput.val()},commitEdit:function(){var e,t,i=parseFloat(this.$zoomInput.val())/100;if(!isNaN(i)&&i>0){e=i;t=this.getCenterZoomRect(e);a.setZoomLevel(e,t)}},getCenterZoomRect:function(e){var t,i=this.previewView.$el,n={width:i.outerWidth()-s.PREVIEW_SCROLLBAR_SPACING,height:i.outerHeight()-s.PREVIEW_SCROLLBAR_SPACING},r=i.find("div.preview-container"),o=0!==i.scrollLeft()?i.scrollLeft():-r.position().left,l=0!==i.scrollTop()?i.scrollTop():-r.position().top,d=Math.min(n.width,r.outerWidth()),c=Math.min(n.height,r.outerHeight()-2*s.PREVIEW_SPACING),h={left:o,top:l,right:o+d,bottom:l+c};t=a.getCenterZoomRect(h,n,e,a.getZoomLevel());return t},getNextZoomStep:function(){var e,t=a.getZoomLevel();e=.25>t?.25:.33>t?.33:.5>t?.5:.66>t?.66:1>t?1:parseInt(t+1,10);return e},getPrevZoomStep:function(){var e,t=a.getZoomLevel();e=.25>=t?.1:.33>=t?.25:.5>=t?.33:.66>=t?.5:1>=t?.66:2>=t?1:parseInt(t-1,10);return e},getPsdVisibleRect:function(){var e,t=this.previewView.$el,i=t.outerWidth(),n=t.outerHeight(),s=a.getZoomLevel();e={top:t.scrollTop()/s,left:t.scrollLeft()/s,bottom:t.scrollTop()+n,right:t.scrollLeft()+i,width:i,height:n};return e}});return d});define("vanilla-extract/public/js/core/views/detail/SelectionBarView",["underscore","backbone","../../Constants","plugin-dependencies","../templates/toolbarTemplate.html","../inspect/ContextMenuView","../../utils/TemplateUtil","./DesignedAtView","./LayerCompView","./ZoomView"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=t.View.extend({events:{"click .direct-select":"handleDirectSelectToolChange","click .firstuser-shortcut-guide":"handleFirstUserExperienceShortcutGuideClick","click .show-measurements-on-hover":"handleMeasurementToggleClick"},defaults:{previewView:null},initialize:function(e){this.bToggleMeasurementKeyDown=!1;this.previewView=e.previewView;this.render();graphite.getDetailsController().on("change:toggleMeasurementOnHover",this.handleMeasurementToggleChange,this);graphite.events.on("drawPreviewFinish",this.hideRenderingBar,this);graphite.events.on("errorNotificationShown",this.hideRenderingBar,this)},render:function(){var e={regularSelect:n.translate("Regular Select"),directSelect:n.translate("Direct Select"),showMeasurementsOnHover:n.translate("Toggle Show Info on hover")};this.setElement(a.createTemplate(s,e));this.zoomControlsView=new d({previewView:this.previewView});this.$el.find(".selection-controlbar").append(this.zoomControlsView.$el);this.layerCompControlsView=new l;this.$el.find(".selection-controlbar").append(this.layerCompControlsView.$el);if(!n.parfait&&n.utils.hasFeature("extract_batch")){this.designedAtView=new o;this.$el.find(".selection-controlbar").append(this.designedAtView.$el)}this.createHelpMenu();return this},removeEventListeners:function(){graphite.getDetailsController().off(null,null,this)},handleFirstUserExperienceShortcutGuideClick:function(){graphite.events.trigger("toggle-first-user-overlay")},handleDirectSelectToolChange:function(){graphite.getDetailsController().changeActiveTool(i.Tool.SELECT_DIRECT)},handleMeasurementToggleClick:function(){if(this.bToggleMeasurementKeyDown){this.bToggleMeasurementKeyDown=!1;this.$el.find(".show-measurements-on-hover").removeClass("active")}else{this.bToggleMeasurementKeyDown=!0;this.$el.find(".show-measurements-on-hover").addClass("active")}graphite.events.trigger("toggle-hover-measurement")},handleMeasurementToggleChange:function(){if(this.bToggleMeasurementKeyDown){this.bToggleMeasurementKeyDown=!1;this.$el.find(".show-measurements-on-hover").removeClass("active")}else{this.bToggleMeasurementKeyDown=!0;this.$el.find(".show-measurements-on-hover").addClass("active")}},handleActiveToolChange:function(){var e=graphite.getDetailsController().get("activeTool");this.$el.find("button").removeClass("active");switch(e){case i.Tool.SELECT_DIRECT:this.$el.find(".direct-select ").addClass("active");graphite.events.trigger("activeTool",{activeTool:n.translate("Direct Select")})}},hideRenderingBar:function(){this.$el.find(".rendering-controlbar").hide()},remove:function(){this.zoomControlsView.remove();this.zoomControlsView=null;this.layerCompControlsView.remove();this.layerCompControlsView=null;this.removeEventListeners();this.previewView=null;t.View.prototype.remove.call(this);graphite.events.off(null,null,this)},createHelpMenu:function(){var e=["Extract Help","Extract FAQ","Extract Forums","Keyboard Shortcuts"].reverse(),t={"Extract Help":n.translate("Extract Help"),"Extract FAQ":n.translate("Extract FAQ"),"Extract Forums":n.translate("Extract Forums"),"Keyboard Shortcuts":n.translate("Keyboard Shortcuts")},s=this.$(".keyboard-shortcut-guide");this.preprocessorMenu=new r({name:"help-selector",$toggle:s,$after:s,items:e,position:i.MenuPosition.BELOW});this.preprocessorMenu.labels=t;s.addClass("menu-active");this.preprocessorMenu.on("selection",function(e){"Keyboard Shortcuts"===e?graphite.events.trigger("toggle-help-dialog"):"Extract Help"===e?window.open(n.translate("http://adobe.com/go/extract_help"),"_blank"):"Extract FAQ"===e?window.open(n.translate("http://adobe.com/go/extract_faq"),"_blank"):"Extract Forums"===e&&window.open(n.translate("http://www.adobe.com/go/extract_forums"),"_blank")},this)}});return c});define("vanilla-extract/public/js/core/views/templates/extractForDeviceDlgTemplate.html",[],function(){return'<!-- Extract for Device Dialog -->\n    <div class="extract-for-device-dialog modal-wrapper" style="display:none;">\n        <div class="linked-smart-object-warning">\n            <span id="lsoWarningMessage"></span>\n        </div>\n        <div class="extract-for-device-header">\n            <h1><%-translate("Extract for Devices")%><span class="preview-badge" title="<%-translate(\'Extract for devices is an experimental feature. During peak periods, there might be delays while waiting for your assets.\')%>"><%-translate("Preview")%></span></h1>\n\n            <div class="description"><%-translate("Folders of resolution-specific assets will be created in the assets folder based on the assets you\'ve saved. The folders will also be updated automatically if new assets are saved to the asset list later.")%></div>\n\n            <div class="info"></div>\n        </div>\n\n        <ul class="device-list clearfix">\n            <li class="device-list-header">\n                <div class="col1"><%-translate("Extract as")%></div>\n                <div class="col2"><%-translate("Suffix")%></div>\n                <div class="col3"><%-translate("Folder")%></div>\n            </li>\n        </ul>\n        <div class="dialog-footer">\n            <button class="topcoat-button" id="cancel_dialog"><%-translate(\'Cancel\')%></button>\n            <button class="btn btn-submit btn-primary" id="apply_settings"><%-translate(\'Apply\')%></button>\n        </div>\n    </div>\n'});define("vanilla-extract/public/js/core/views/templates/extractSettingsItemTemplate.html",[],function(){return'<li class="extract-settings-item" id="extract-setting-<%- attributes.type %>">\n    <div class="col1">\n        <input type="checkbox" class="extract-setting-type" value="checkbox" <%- attributes.checked ? \'checked\' : \'\'%> />\n        <div class="setting-type-checkbox topcoat-checkbox__checkmark"></div>\n        <label><%- attributes.label %></label>\n    </div>\n    <div class="col2"><input type="text" class="topcoat-text-input extract-suffix" value="<%- attributes.suffix ? attributes.suffix : \'none\'%>"></div>\n    <div class="col3"><input type="text" class="topcoat-text-input extract-folder"  value="<%- attributes.folder + \'/\' %>"></div>\n</li>'});define("vanilla-extract/public/js/core/views/assets/ExtractForDeviceDlg",["jquery","underscore","backbone","plugin-dependencies","../../utils/TemplateUtil","../modal/BaseModalView","../templates/extractForDeviceDlgTemplate.html","../templates/extractSettingsItemTemplate.html","../../controllers/DerivedAssetController","../../models/PSDSettingsModel"],function(e,t,i,n,s,r,a,o,l,d){"use strict";var c=r.extend({visible:!1,events:{"click #cancel_dialog":"handleHide","click #apply_settings":"handleApply","blur .extract-folder":"handleFolderChange","blur .extract-suffix":"handleSuffixChange"},initialize:function(){this.settings=l.loadDeviceExtractionSettings(this.model);this.settings.on("reset",this.handleExtractionSettingsReset,this);this.render();graphite.events.on("show-extractForDevice-dialog",this.handleShow,this);graphite.events.on("hide-extractForDevice-dialog",this.handleHide,this);this.lastAppliedDesignedAt=d.get("designedAtMultiplier")},render:function(){this.setElement(s.createTemplate(a));this.addSettingsListItems();var e=this.$el.find("#lsoWarningMessage");e.html(n.translate("Your assets contain a {0}http://www.adobe.com/go/smart_objects{1}Linked Smart Object{2} that will render poorly when scaled. {3}http://www.adobe.com/go/extract_help#linked_smart_objects{4}Help{5}",'<a id="smart_obj_link" href="','" target="_blank">',"</a>",'<a id="help_link" href="','" target="_blank">',"</a>"));return this},addSettingsListItems:function(){var e,t=this.$el.find(".device-list");for(e=0;e<this.settings.length;e++)t.append(s.createTemplate(o,this.settings.at(e)))},handleHide:function(){r.prototype.handleHide.apply(this,arguments);this.$el.hide();this.visible=!1},handleShow:function(){l.containsALinkedSmartObjectAsset()?this.$el.find("div.linked-smart-object-warning").show():this.$el.find("div.linked-smart-object-warning").hide();r.prototype.handleShow.apply(this,arguments);this.updateUI();this.$el.show();this.visible=!0},handleApply:function(){var e,t,i,s,r=this.$el.find(".extract-settings-item");for(s=0;s<r.length;s++){t=r.eq(s);e=this.findModel(t);i=t.find(".extract-suffix")[0].value;e.set("checked",t.find(".extract-setting-type")[0].checked);e.set("suffix",i!==n.translate("none")?i:"");e.set("folder",t.find(".extract-folder")[0].value)}l.saveDeviceExtractionSettings();this.lastAppliedDesignedAt=d.get("designedAtMultiplier");this.handleHide()},updateUI:function(){var e,t,i,s,r,a=this.$el.find(".extract-settings-item");for(r=0;r<a.length;r++){t=a.eq(r);e=this.findModel(t);i=e.get("suffix");s=e.get("folder");t.find(".extract-setting-type")[0].checked=e.get("checked");t.find(".extract-suffix")[0].value=""===i?n.translate("none"):i;t.find(".extract-folder")[0].value=this.normalizeFolderString(s);t.find(".extract-folder").removeClass("validation-error");t.find(".extract-suffix").removeClass("validation-error")}this.updateApplyButton();var o=n.translate("This PSD was designed at "),l=o+d.get("designedAtMultiplier")+"x",c=n.translate("what's this?");this.$el.find(".info").html(l+' (<a href="http://www.adobe.com/go/extract_faq_assets" target="_blank">'+c+"</a>)")},findModel:function(e){var t,i=e.closest(".extract-settings-item")[0].id,n=i.lastIndexOf("-");i=i.substring(n+1);t=this.settings.get(i);return t},updateApplyButton:function(){var e=this.$el.find(".validation-error");this.$el.find("#apply_settings").prop("disabled",0!==e.length)},handleFolderChange:function(t){var i=!0,s=t.target,r=e.trim(s.value);if(0===r.length){i=!1;s.title=n.translate("The destination folder cannot be empty.")}if(r.match(/(\|\\|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g)){i=!1;s.title=n.translate("The folder name contains invalid characters.")}if(r.match(/.\/./)){i=!1;s.title=n.translate("The destination folder cannot be a nested subfolder.")}if(0===r.length){i=!1;s.title=n.translate("The destination folder must not be empty.")}i&&(s.value=this.normalizeFolderString(r));e(s).toggleClass("validation-error",!i);i&&(s.title="");this.updateApplyButton()},handleSuffixChange:function(t){var i=!0,s=t.target,r=e.trim(s.value);if(0===r.length){i=!1;s.title=n.translate("The suffix cannot be empty.")}if(r.match(/(\|\\|\/|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g)){i=!1;s.title=n.translate("The suffix contains invalid characters.")}e(s).toggleClass("validation-error",!i);i&&(s.title="");i&&0===r.length&&(s.value=n.translate("none"));this.updateApplyButton()},normalizeFolderString:function(e){"/"!==e.charAt(e.length-1)&&(e+="/");return e},remove:function(){this.settings.off(null,null,this);graphite.events.off(null,null,this);return i.View.prototype.remove.call(this)},handleExtractionSettingsReset:function(){this.updateUI()}});return c});define("vanilla-extract/public/js/core/views/templates/popupTemplate.html",[],function(){return'<div class="popup-contents"></div>\n<div class="notch"></div>'});define("vanilla-extract/public/js/core/views/popup/BasePopupView",["jquery","underscore","backbone","../../utils/TemplateUtil","../templates/popupTemplate.html"],function(e,t,i,n,s){"use strict";var r=i.View.extend({source:null,events:{"click .close-button":"handleCloseClick"},initialize:function(){t.bindAll(this,"handleShow","closePopup");this.source=null;this.render();this.$el.hide();this.addHandlers()},render:function(){this.$el.html(n.createTemplate(s));return this},addHandlers:function(){},handleShow:function(t){if(void 0!==this.$el.parent().offset()&&void 0!==t.sourceElement.offset()){this.source=t.sourceElement;this.$el.show();this.positionPopup();this.isMouseOver=!1;var i=this,n=this.handleMouseDown.bind(this),s=this.handleMouseEnter.bind(this),r=this.handleMouseLeave.bind(this),a=this.handleKeyUp.bind(this);i.dontListen&&i.dontListen();e(window).on("mousedown",n);i.$el.on("mouseenter",s);i.$el.on("mouseleave",r);e(document).on("keyup",a);this.dontListen=function(){e(window).off("mousedown",n);i.$el.off("mouseenter",s);i.$el.off("mouseleave",r);e(document).off("keyup",a)}}},positionPopup:function(){var t=e(".vanilla-extract");0===t.length&&(t=e("#main"));var i=t.offset().top+t.outerHeight(!0),n=this.source,s=this.$el.parent().offset().top,r=n.height()+parseInt(n.css("padding-top"),10)+parseInt(n.css("padding-bottom"),10),a=parseInt(this.$el.height(),10)+parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10),o=this.$el.find(".notch"),l=e(".psd-header");o.show();var d=this.getSourceYOffset()-s+r;if(d+a+o.height()>i-s){d=n.offset().top-s-this.$el.height()-2*parseInt(this.$el.css("padding-top"),10);this.$el.addClass("top");this.$el.removeClass("bottom")}else{d+=o.height();this.$el.addClass("bottom");this.$el.removeClass("top")}if(l.length&&l.offset()){var c=l.position().top+l.outerHeight()+13;if(c>d){d=c;o.hide()}}this.$el.css("top",d);var h=n.width()+parseInt(n.css("padding-left"),10)+parseInt(n.css("padding-right"),10),p=parseInt(this.$el.width(),10)+parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),u=this.getSourceXOffset()+(h-p)/2;u+p>e(window).width()-5&&(u=e(window).width()-p-5);this.$el.css("left",u);var g=Math.round(this.getSourceXOffset()-(u+parseInt(this.$el.css("border-left-width"),10))+parseInt(n.css("margin-left"),10)+(h-o.width())/2);o.css("left",g)},handleCloseClick:function(){this.closePopup()},handleMouseEnter:function(){this.isMouseOver=!0},handleMouseLeave:function(){this.isMouseOver=!1},handleMouseDown:function(){this.isMouseOver||this.closePopup()},handleKeyUp:function(e){27===e.keyCode&&this.closePopup()},getSourceXOffset:function(){return this.source.offset()?this.source.offset().left:0},getSourceYOffset:function(){return this.source.offset()?this.source.offset().top:0},closePopup:function(){if("none"!==this.$el.css("display")){this.$el.hide();this.dontListen&&this.dontListen()}}});return r});define("vanilla-extract/public/js/core/utils/LayerNameParser",[],function(){function e(e){var t=n(e);t&&t.length&&t.forEach(function(e){if("jpeg"===e.extension){e.extension="jpg";e.name&&(e.name=e.name.replace(/\.jpeg$/,".jpg"));e.file&&(e.file=e.file.replace(/\.jpeg$/,".jpg"))}});return t}function t(e,t){function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i}function i(e,t,i,n,s,r){this.message=e;this.expected=t;this.found=i;this.offset=n;this.line=s;this.column=r;this.name="SyntaxError"}function n(e){function t(){return e.substring(wt,bt)}function n(e){throw a(e,null,wt)}function s(t){function i(t,i,n){var s,r;for(s=i;n>s;s++){r=e.charAt(s);if("\n"===r){t.seenCR||t.line++;t.column=1;t.seenCR=!1}else if("\r"===r||"\u2028"===r||"\u2029"===r){t.line++;t.column=1;t.seenCR=!0}else{t.column++;t.seenCR=!1}}}if(St!==t){if(St>t){St=0;Ct={line:1,column:1,seenCR:!1}}i(Ct,St,t);St=t}return Ct}function r(e){if(!(xt>bt)){if(bt>xt){xt=bt;Tt=[]}Tt.push(e)}}function a(t,n,r){function a(e){var t=1;e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});for(;t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function i(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,s,r,a=new Array(e.length);for(r=0;r<e.length;r++)a[r]=e[r].description;n=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0];s=t?'"'+i(t)+'"':"end of input";return"Expected "+n+" but "+s+" found."}var l=s(r),d=r<e.length?e.charAt(r):null;null!==n&&a(n);return new i(null!==t?t:o(n,d),n,d,r,l.line,l.column)}function o(){var e,t,i=29*bt+0,n=It[i];if(n){bt=n.nextPos;return n.result}Et++;e=l();e===V&&(e=h());Et--;if(e===V){t=V;0===Et&&r(H)}It[i]={nextPos:bt,result:e};return e}function l(){var t,i,n,s=29*bt+1,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;if(e.substr(bt,7)===G){i=G;bt+=7}else{i=V;0===Et&&r(W)}if(i!==V){n=d();if(n!==V){wt=t;i=q(n);t=i}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(B)}It[s]={
nextPos:bt,result:t};return t}function d(){var t,i,n,s,a=29*bt+2,o=It[a];if(o){bt=o.nextPos;return o.result}Et++;t=bt;i=c();if(i!==V){if(Y.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===Et&&r(Z)}if(n!==V){s=d();if(s!==V){wt=t;i=J(i,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;i=c();if(i!==V){wt=t;i=K(i)}t=i}Et--;if(t===V){i=V;0===Et&&r(X)}It[a]={nextPos:bt,result:t};return t}function c(){var e,t,i,n,s,a,o,l,d=29*bt+3,c=It[d];if(c){bt=c.nextPos;return c.result}Et++;e=bt;t=[];i=R();if(i!==V)for(;i!==V;){t.push(i);i=R()}else t=z;if(t!==V){i=y();i===V&&(i=ee);if(i!==V){n=_();if(n!==V){s=[];a=u();for(;a!==V;){s.push(a);a=u()}if(s!==V){a=T();a===V&&(a=ee);if(a!==V){o=_();if(o!==V){wt=bt;l=te(i,s,a);l=l?ie:z;if(l!==V){wt=e;t=ne(i,s,a);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}Et--;if(e===V){t=V;0===Et&&r(Q)}It[d]={nextPos:bt,result:e};return e}function h(){var t,i,n,s,a=29*bt+4,o=It[a];if(o){bt=o.nextPos;return o.result}Et++;t=bt;i=p();if(i!==V){if(Y.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===Et&&r(Z)}if(n!==V){s=h();if(s!==V){wt=t;i=re(i,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;i=p();if(i!==V){wt=t;i=K(i)}t=i}Et--;if(t===V){i=V;0===Et&&r(se)}It[a]={nextPos:bt,result:t};return t}function p(){var e,t,i,n,s=29*bt+5,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;e=g();if(e===V){e=bt;t=_();if(t!==V){i=M();if(i!==V){n=_();if(n!==V){wt=e;t=oe(i);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}Et--;if(e===V){t=V;0===Et&&r(ae)}It[s]={nextPos:bt,result:e};return e}function u(){var t,i,n,s,a=29*bt+6,o=It[a];if(o){bt=o.nextPos;return o.result}Et++;t=bt;i=T();if(i!==V){if(47===e.charCodeAt(bt)){n=de;bt++}else{n=V;0===Et&&r(ce)}if(n!==V){wt=bt;s=he(i);s=s?z:ie;if(s!==V){wt=t;i=pe(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(le)}It[a]={nextPos:bt,result:t};return t}function g(){var e,t,i,n,s,a,o,l=29*bt+7,d=It[l];if(d){bt=d.nextPos;return d.result}Et++;e=bt;t=_();if(t!==V){i=y();i===V&&(i=ee);if(i!==V){n=_();if(n!==V){s=[];a=u();for(;a!==V;){s.push(a);a=u()}if(s!==V){a=f();if(a!==V){o=_();if(o!==V){wt=e;t=ge(i,s,a);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}Et--;if(e===V){t=V;0===Et&&r(ue)}It[l]={nextPos:bt,result:e};return e}function f(){var e,t,i,n=29*bt+8,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;e=bt;t=[];i=I();if(i!==V)for(;i!==V;){t.push(i);i=I()}else t=z;if(t!==V){i=m();if(i!==V){wt=e;t=me(t,i);e=t}else{bt=e;e=z}}else{bt=e;e=z}Et--;if(e===V){t=V;0===Et&&r(fe)}It[n]={nextPos:bt,result:e};return e}function m(){var t,i,n,s=29*bt+9,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;i=[];if(ye.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===Et&&r(be)}if(n!==V)for(;n!==V;){i.push(n);if(ye.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===Et&&r(be)}}else i=z;if(i!==V){n=v();n===V&&(n=ee);if(n!==V){wt=t;i=we(i,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(ve)}It[s]={nextPos:bt,result:t};return t}function v(){var t,i,n,s,a=29*bt+10,o=It[a];if(o){bt=o.nextPos;return o.result}Et++;t=bt;if(45===e.charCodeAt(bt)){i=Ce;bt++}else{i=V;0===Et&&r(xe)}i===V&&(i=ee);if(i!==V){n=D();if(n!==V){if(Te.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===Et&&r(Ee)}if(s===V)if(37===e.charCodeAt(bt)){s=Ie;bt++}else{s=V;0===Et&&r(Me)}s===V&&(s=ee);if(s!==V){wt=t;i=Pe(n,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(Se)}It[a]={nextPos:bt,result:t};return t}function y(){var t,i,n,s=29*bt+11,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=b();if(t===V){t=bt;i=w();if(i!==V){if(32===e.charCodeAt(bt)){n=Le;bt++}else{n=V;0===Et&&r(ke)}if(n!==V){wt=t;i=De(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}}Et--;if(t===V){i=V;0===Et&&r(Ae)}It[s]={nextPos:bt,result:t};return t}function b(){var e,t,i=29*bt+12,n=It[i];if(n){bt=n.nextPos;return n.result}Et++;e=bt;t=x();if(t!==V){wt=e;t=_e(t)}e=t;Et--;if(e===V){t=V;0===Et&&r(Oe)}It[i]={nextPos:bt,result:e};return e}function w(){var t,i,n,s,a,o,l=29*bt+13,d=It[l];if(d){bt=d.nextPos;return d.result}Et++;t=bt;i=S();if(i!==V){n=_();if(n!==V){if(e.substr(bt,1).toLowerCase()===Fe){s=e.charAt(bt);bt++}else{s=V;0===Et&&r(Ue)}if(s!==V){a=_();if(a!==V){o=S();if(o!==V){wt=t;i=$e(i,o);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(Re)}It[l]={nextPos:bt,result:t};return t}function S(){var t,i,n,s=29*bt+14,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;i=k();if(i!==V){n=C();n===V&&(n=ee);if(n!==V){wt=t;i=je(i,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;if(63===e.charCodeAt(bt)){i=Ne;bt++}else{i=V;0===Et&&r(He)}if(i!==V){wt=t;i=Be()}t=i}Et--;if(t===V){i=V;0===Et&&r(Ve)}It[s]={nextPos:bt,result:t};return t}function C(){var t,i,n,s=29*bt+15,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;if(Ge.test(e.charAt(bt))){i=e.charAt(bt);bt++}else{i=V;0===Et&&r(We)}if(i!==V){if(Ge.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===Et&&r(We)}if(n!==V){wt=t;i=qe(i,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(ze)}It[s]={nextPos:bt,result:t};return t}function x(){var t,i,n,s=29*bt+16,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;i=k();if(i!==V){if(37===e.charCodeAt(bt)){n=Ie;bt++}else{n=V;0===Et&&r(Me)}if(n!==V){wt=t;i=Ye(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(Xe)}It[s]={nextPos:bt,result:t};return t}function T(){var e,t,i,n=29*bt+17,s=It[n];if(s){bt=s.nextPos;return s.result}e=bt;t=[];i=E();if(i!==V)for(;i!==V;){t.push(i);i=E()}else t=z;if(t!==V){wt=e;t=Ze(t)}e=t;It[n]={nextPos:bt,result:e};return e}function E(){var t,i,n=29*bt+18,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;t=L();if(t===V)if(46===e.charCodeAt(bt)){t=Ke;bt++}else{t=V;0===Et&&r(Qe)}Et--;if(t===V){i=V;0===Et&&r(Je)}It[n]={nextPos:bt,result:t};return t}function I(){var t,i,n,s=29*bt+19,a=It[s];if(a){bt=a.nextPos;return a.result}Et++;t=bt;i=P();if(i!==V){if(46===e.charCodeAt(bt)){n=Ke;bt++}else{n=V;0===Et&&r(Qe)}if(n!==V){wt=t;i=tt(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}Et--;if(t===V){i=V;0===Et&&r(et)}It[s]={nextPos:bt,result:t};return t}function M(){var e,t,i,n=29*bt+20,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;e=bt;t=[];i=A();if(i!==V)for(;i!==V;){t.push(i);i=A()}else t=z;if(t!==V){wt=e;t=nt(t)}e=t;Et--;if(e===V){t=V;0===Et&&r(it)}It[n]={nextPos:bt,result:e};return e}function P(){var e,t,i,n=29*bt+21,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;e=bt;t=[];i=L();if(i!==V)for(;i!==V;){t.push(i);i=L()}else t=z;if(t!==V){wt=e;t=nt(t)}e=t;Et--;if(e===V){t=V;0===Et&&r(st)}It[n]={nextPos:bt,result:e};return e}function A(){var t,i,n=29*bt+22,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;if(at.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===Et&&r(ot)}Et--;if(t===V){i=V;0===Et&&r(rt)}It[n]={nextPos:bt,result:t};return t}function L(){var t,i,n=29*bt+23,s=It[n];if(s){bt=s.nextPos;return s.result}Et++;if(dt.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===Et&&r(ct)}Et--;if(t===V){i=V;0===Et&&r(lt)}It[n]={nextPos:bt,result:t};return t}function k(){var t,i,n,s,a,o,l,d=29*bt+24,c=It[d];if(c){bt=c.nextPos;return c.result}Et++;t=bt;i=bt;n=bt;s=D();if(s!==V){a=bt;if(46===e.charCodeAt(bt)){o=Ke;bt++}else{o=V;0===Et&&r(Qe)}if(o!==V){l=D();if(l!==V){o=[o,l];a=o}else{bt=a;a=z}}else{bt=a;a=z}a===V&&(a=ee);if(a!==V){s=[s,a];n=s}else{bt=n;n=z}}else{bt=n;n=z}n!==V&&(n=e.substring(i,bt));i=n;if(i!==V){wt=t;i=pt(i)}t=i;if(t===V){t=bt;i=bt;n=bt;if(46===e.charCodeAt(bt)){s=Ke;bt++}else{s=V;0===Et&&r(Qe)}if(s!==V){a=D();if(a!==V){s=[s,a];n=s}else{bt=n;n=z}}else{bt=n;n=z}n!==V&&(n=e.substring(i,bt));i=n;if(i!==V){wt=t;i=ut(i)}t=i}Et--;if(t===V){i=V;0===Et&&r(ht)}It[d]={nextPos:bt,result:t};return t}function D(){var e,t,i=29*bt+25,n=It[i];if(n){bt=n.nextPos;return n.result}e=[];t=O();if(t!==V)for(;t!==V;){e.push(t);t=O()}else e=z;It[i]={nextPos:bt,result:e};return e}function O(){var t,i=29*bt+26,n=It[i];if(n){bt=n.nextPos;return n.result}if(gt.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===Et&&r(ft)}It[i]={nextPos:bt,result:t};return t}function _(){var e,t,i=29*bt+27,n=It[i];if(n){bt=n.nextPos;return n.result}Et++;e=[];t=R();for(;t!==V;){e.push(t);t=R()}Et--;if(e===V){t=V;0===Et&&r(mt)}It[i]={nextPos:bt,result:e};return e}function R(){var t,i=29*bt+28,n=It[i];if(n){bt=n.nextPos;return n.result}if(vt.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===Et&&r(yt)}It[i]={nextPos:bt,result:t};return t}function F(e,t){if(e){e.hasOwnProperty("scale")&&(t.scale=e.scale);e.hasOwnProperty("width")&&(t.width=e.width);e.hasOwnProperty("widthUnit")&&(t.widthUnit=e.widthUnit);e.hasOwnProperty("height")&&(t.height=e.height);e.hasOwnProperty("heightUnit")&&(t.heightUnit=e.heightUnit)}}var U,$=arguments.length>1?arguments[1]:{},V={},j={start:o},N=o,H={type:"other",description:"Either a default asset specification or a layer asset specification"},B={type:"other",description:"A document defaults specification"},z=V,G="default",W={type:"literal",value:"default",description:'"default"'},q=function(e){return e},X={type:"other",description:"List of default specification components"},Y=/^[+,]/,Z={type:"class",value:"[+,]",description:"[+,]"},J=function(e,t){t.unshift(e);return t},K=function(e){return[e]},Q={type:"other",description:"A single default specification component"},ee=null,te=function(e,t,i){return e||t.length>0||i&&i.trim().length>0},ie=void 0,ne=function(e,i,n){var s={"default":!0,name:t().trim()};i.length>0&&(s.folder=i);if(n){n=n.trim();n.length>0&&(s.suffix=n)}F(e,s);return s},se={type:"other",description:"List of layer specifications"},re=function(e,t){t.unshift(e);return t},ae={type:"other",description:"Layer specification"},oe=function(e){return{name:e.trim()}},le={type:"other",description:"A single folder name that ends with a slash and does not begin with a dot"},de="/",ce={type:"literal",value:"/",description:'"/"'},he=function(e){return"."==e[0]},pe=function(e){return e},ue={type:"other",description:"A size-and-file specification"},ge=function(e,i,n){var s={name:t().trim(),file:n.filename.replace(/[\\":*?<>!|]/g,"_"),extension:n.extension};i.length>0&&(s.folder=i);n.hasOwnProperty("quality")&&(s.quality=n.quality);F(e,s);return s},fe={type:"other",description:"Filename and quality suffix"},me=function(e,t){var i=String.prototype.concat.apply("",e)+t.extension;i.match(/^\s/)&&n("Filename begins with whitespace");var s={filename:i.trim(),extension:t.extension.toLowerCase()};t.hasOwnProperty("quality")&&(s.quality=t.quality);return s},ve={type:"other",description:"File extension and quality suffix"},ye=/^[a-zA-Z]/,be={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},we=function(e,t){var i={extension:e.join("")};t&&(i.quality=t);return i},Se={type:"other",description:"Quality parameter that follows a file extension"},Ce="-",xe={type:"literal",value:"-",description:'"-"'},Te=/^[a-z]/,Ee={type:"class",value:"[a-z]",description:"[a-z]"},Ie="%",Me={type:"literal",value:"%",description:'"%"'},Pe=function(e,t){return e.join("")+(t||"")},Ae={type:"other",description:"Relative or absolute scale"},Le=" ",ke={type:"literal",value:" ",description:'" "'},De=function(e){return e},Oe={type:"other",description:"Relative scale, like 0.3"},_e=function(e){return{scale:e}},Re={type:"other",description:"Absolute scale, like 50x100cm"},Fe="x",Ue={type:"literal",value:"x",description:'"x"'},$e=function(e,t){var i={};e.hasOwnProperty("value")&&(i.width=e.value);e.hasOwnProperty("unit")&&(i.widthUnit=e.unit);t.hasOwnProperty("value")&&(i.height=t.value);t.hasOwnProperty("unit")&&(i.heightUnit=t.unit);return i},Ve={type:"other",description:"Absolute scale component, like 100cm"},je=function(e,t){var i={value:e};t&&(i.unit=t);return i},Ne="?",He={type:"literal",value:"?",description:'"?"'},Be=function(){return{}},ze={type:"other",description:"Unit abbreviation"},Ge=/^[a-z]/i,We={type:"class",value:"[a-z]i",description:"[a-z]i"},qe=function(e,t){return e+t},Xe={type:"other",description:"A percentage, like 30%"},Ye=function(e){return e/100},Ze=function(e){return e.join("")},Je={type:"other",description:"A good character or a dot"},Ke=".",Qe={type:"literal",value:".",description:'"."'},et={type:"other",description:"A sequence of characters that ends with a dot"},tt=function(e){return e.concat(".")},it={type:"other",description:"A sequence of characters, including dots"},nt=function(e){return e.join("")},st={type:"other",description:"A sequence of characters, excluding dots"},rt={type:"other",description:"A character, including dots"},at=/^[^,+]/,ot={type:"class",value:"[^,+]",description:"[^,+]"},lt={type:"other",description:"A character, excluding dots and other weird things"},dt=/^[^+,.\/\0-\x1F]/,ct={type:"class",value:"[^+,.\\/\\0-\\x1F]",description:"[^+,.\\/\\0-\\x1F]"},ht={type:"other",description:"A nonnegative number, which may or may not have leading zeros"},pt=function(e){return parseFloat(e)},ut=function(e){return parseFloat("0"+e)},gt=/^[0-9]/,ft={type:"class",value:"[0-9]",description:"[0-9]"},mt={type:"other",description:"whitespace"},vt=/^[ \t\n\r]/,yt={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},bt=0,wt=0,St=0,Ct={line:1,column:1,seenCR:!1},xt=0,Tt=[],Et=0,It={};if("startRule"in $){if(!($.startRule in j))throw new Error("Can't start parsing from rule \""+$.startRule+'".');N=j[$.startRule]}U=N();if(U!==V&&bt===e.length)return U;U!==V&&bt<e.length&&r({type:"end",description:"end of input"});throw a(null,Tt,xt)}t(i,Error);return{SyntaxError:i,parse:e}});define("vanilla-extract/public/js/core/views/templates/extractAssetTemplate.html",[],function(){return'<h3 class="title"><%-translate("Save as Image...")%></h3>\n<span class="close-button"></span>\n<input type="text" class="topcoat-text-input file-name" required>\n<div class="options">\n    <div>\n        <input type="radio" name="imagetype" value="png8"/>\n        <p><%-translate("PNG 8 Alpha")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="png32"/>\n        <p><%-translate("PNG 32")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="jpeg" checked/>\n        <p><%-translate("JPG")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="svg"/>\n        <p><%-translate("SVG")%></p>\n    </div>\n</div>\n<div class="svg-warning extract-asset-warning"><%-translate("Bitmap layer(s) will be saved as bitmap in SVG.")%></div>\n<div class="not-warning">\n    <div class="subtitle"><%-translate("Quality")%></div>\n    <div class="quality clearfix">\n        <input type="text" class="topcoat-text-input quality-percentage" value="80"/>\n        <input type="range" class="topcoat-range quality-range" value="80"/>\n        <div class="format-description"><%-translate("test")%></div>\n    </div>\n</div>\n<div class="lso-warning extract-asset-warning"></div>\n<div class="scale clearfix <%- settings.get(\'scaleExtractedAssets\') ? \'\' : \'disabled\'%>" title=\'<%-translate("Enter a value from 0.1x to 5x to extract an asset at a specific scale factor")%>\'>\n    <input type="checkbox" class="scale-enable" value="checkbox" <%- settings.get(\'scaleExtractedAssets\') ? \'checked\' : \'\'%> />\n    <div class="scale-enable-checkbox topcoat-checkbox__checkmark"></div>\n    <label><%-translate("Scale at")%></label>\n    <input type="text" class="topcoat-text-input scale-factor" value="<%- parseFloat(settings.get(\'assetScaleFactor\').toFixed()) %>x" />\n</div>\n<div class="popup-footer clearfix">\n    <button id="saveBtn" class="topcoat-button--cta btn btn-primary"><%-translate("Save")%></button>\n    <button id="downloadBtn" class="topcoat-button"><%-translate("Download Directly")%></button>\n</div>\n<div class="notch"></div>\n'});define("vanilla-extract/public/js/core/views/popup/ExtractAssetView",["jquery","underscore","backbone","plugin-dependencies","../../controllers/DerivedAssetController","../../controllers/SelectionController","./BasePopupView","../../utils/TemplateUtil","../../utils/LayerNameParser","../../models/UserSettingsModel","../templates/extractAssetTemplate.html","../../Constants"],function(e,t,i,n,s,r,a,o,l,d,c,h){"use strict";var p=80,u='/\\\\:*?"<>|,',g=u+"\\s",f="^[^"+u+"]*[^"+g+"][^"+u+"]*$",m=/(\/|\\|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g,v=a.extend({className:"extract-asset-popup popup",selectedLayers:null,qualityRange:null,qualityPercent:null,fileFormat:null,sizeSpan:null,extractSize:null,qualityLabel:null,qualityBox:null,formatDescription:null,description:{png8:n.translate("256 colors. Lowest file size. Alpha transparency to be retained if present in element."),png32:n.translate("Lossless format so better quality."),svg:n.translate("We use the standard W3C SVG format which is supported by all viewers.")},baseName:null,events:{"click #downloadBtn":"handleExportAsset","click #saveBtn":"handleExportAsset","change .scale-enable":"scaleEnabledChanged","change .scale-factor":"scaleFactorChanged"},selectedLayersContainLinkSmartObject:function(){var e,t,i=r.getSelectedLayers();e=i.some(function(e,i){t=e.get("smartObjectInfo");return t?t.linked:!1});return n.utils.hasFeature("extract_batch")&&e},initialize:function(){a.prototype.initialize.apply(this,arguments);this.onbeforeunload=this.handleClose},updateQuality:function(e){e=Math.min(100,e);e=Math.max(0,e);this.$qualityPercent.val(e);this.$qualityRange.val(e);this.updateSizeAndDescription();this.existingAsset||d.set("assetQuality",e)},updateSizeAndDescription:function(){var e=this.getFileFormat();if("jpeg"===e){this.$qualityLabel.html(n.translate("Quality"));this.$qualityBox.removeClass("quality-description");this.$qualityRange.css("display","block");this.$qualityPercent.css("display","block");this.$formatDescription.css("display","none")}else{this.$qualityLabel.html(n.translate("Description"));this.$qualityBox.addClass("quality-description");this.$qualityRange.css("display","none");this.$qualityPercent.css("display","none");this.$formatDescription.css("display","block");this.$formatDescription.html(this.description[e])}if("svg"===e&&this.bitmap){this.$svgWarning.show();this.$notWarning.hide()}else{this.$svgWarning.hide();this.$notWarning.show()}if(this.baseName){var t=s.generateUniqueAssetName(this.baseName,e);this.$fileName.val(t)}},updateFileNameValidity:function(){if(this.$fileName[0].validity.valid){this.$saveButton.prop("disabled",!1);this.$downloadButton.prop("disabled",!1)}else{this.$saveButton.prop("disabled",!0);this.$downloadButton.prop("disabled",!0)}},render:function(){a.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(o.createTemplate(c,{settings:d}));this.$fileName=this.$el.find(".file-name");this.$qualityRange=this.$el.find(".quality-range");this.$qualityPercent=this.$el.find(".quality-percentage");this.$fileFormat=this.$el.find(".options");this.$qualityLabel=this.$el.find(".subtitle");this.$qualityBox=this.$el.find(".quality");this.$formatDescription=this.$el.find(".format-description");this.$scale=this.$el.find(".scale");this.$scaleEnabled=this.$el.find(".scale-enable");this.$scaleFactor=this.$el.find(".scale-factor");this.$svgWarning=this.$el.find(".svg-warning");this.$lsoWarning=this.$el.find(".lso-warning");this.$notWarning=this.$el.find(".not-warning");this.$downloadButton=this.$el.find("#downloadBtn");this.$saveButton=this.$el.find("#saveBtn");this.$lsoWarning.html(n.translate("{0}http://www.adobe.com/go/smart_objects{1}Linked Smart Objects{2} will render poorly when scaled. {3}http://www.adobe.com/go/extract_help#linked_smart_objects{4}Help{5}",'<a id="smart_obj_link" href="','" target="_blank">',"</a>",'<a id="help_link" href="','" target="_blank">',"</a>"));this.$fileName.attr("title",n.translate("Cannot include any of the characters {0}",u.replace("\\\\","\\")));this.$fileName.attr("pattern",f);this.$downloadButton.toggle(n.utils.hasFeature("extract_batch")===!0&&!graphite.inPublicOneUp());this.$scale.toggle(!0);return this},addHandlers:function(){var e=this;a.prototype.addHandlers.apply(this,arguments);graphite.events.on("show-extract-asset-popup",this.handleShow,this);graphite.events.on("hide-extract-asset-popup",this.handleHide,this);this.$el.mousedown(function(e){e.stopPropagation()});this.$fileFormat.change(function(){e.updateSizeAndDescription()});this.$qualityRange.change(function(){e.updateQuality(this.value)});this.$qualityPercent.change(function(){e.updateQuality(this.value)});var t=this.$fileName;t.keyup(function(t){e.handleKeyUp(t);t.stopImmediatePropagation()});t.keypress(function(t){13===t.which&&e.handleExportAsset(t)});t.change(function(){e.baseName=null})},removeEventListeners:function(){graphite.events.off(null,null,this)},handleShow:function(e){var t=this.$el.find(".title");this.existingAsset=null;if("new"===e.type){var i=n.utils.getCurrentPage()?r.getSelectedLayers():r.getSelectedLayers().slice(0,1);this.bitmap=!1;for(var o=0,l=i.length;l>o;o++){var d=i[o],c=d.get("type")===h.Type.LAYER_TEXT||d.get("properties").get("shape");this.bitmap=this.bitmap||!c}var p=i[0];this.selectedVisibleLayerIds=r.expandSelection(i).map(function(e){return e.get("layerId")});if(p&&this.selectedVisibleLayerIds.length){this.deriveAssetDetailsFromLayer(p);1===this.selectedVisibleLayerIds.length?t.html(n.translate("Save as Image...")):t.html(n.translate("Save {0} Layers as Image...",this.selectedVisibleLayerIds.length));this.updateSizeAndDescription();this.updateFileNameValidity()}}else if("edit"===e.type){t.html(n.translate("Edit Image Properties"));this.existingAsset=e.model;var u=s.getMetadataForAsset(this.existingAsset);this.selectedVisibleLayerIds=u.get("originatingLayers");this.deriveAssetDetailsFromAsset(u);this.updateSizeAndDescription();this.updateFileNameValidity();a.prototype.handleShow.apply(this,arguments)}this.showHideLSOWarning();a.prototype.handleShow.apply(this,arguments)},handleHide:function(){var e=d.get("scaleExtractedAssets");this.$scaleEnabled.prop("checked",e);this.$scaleFactor.val(d.get("assetScaleFactor")+"x");this.$scale.toggleClass("disabled",!e);a.prototype.closePopup.call(this)},closePopup:function(){graphite.events.trigger("hide-extract-asset-popup")},handleKeyUp:function(e){a.prototype.handleKeyUp.apply(this,arguments);this.updateFileNameValidity()},handleExportAsset:function(t){if(this.$fileName[0].validity.valid){var i,r=graphite.inPublicOneUp()||e(t.target).is(this.$downloadButton),a=-1,o=this.$scaleEnabled.prop("checked")&&!this.$scale.hasClass("incompatible")?parseFloat(this.$scaleFactor.val()):null,l=this.getFileFormat();"jpeg"===l&&(a=this.$qualityPercent.val());i=this.normalizeFileName(this.$fileName.val());if(this.existingAsset)s.updateAsset(this.existingAsset,this.selectedVisibleLayerIds,r,i,this.getFileFormat(),a,o,this.model,this.handleExportAssetComplete,this.handleExportAssetError,this);else{s.exportAsset(this.selectedVisibleLayerIds,r,i,this.getFileFormat(),a,o,this.model,!1,this.handleExportAssetComplete,this.handleExportAssetError,this);if(n.utils.hasFeature("extract_batch"))if(r)graphite.events.trigger("extract-asset-direct-download",{fileFormatSelected:l});else{graphite.events.trigger("extract-asset-download-init",{fileFormatSelected:l});graphite.events.trigger("add-asset-to-catalog",{fileFormatSelected:l})}else graphite.events.trigger("extract-asset-download-init",{fileFormatSelected:l});o&&1!==o&&graphite.events.trigger("asset-extracted-scaled",{scaleFactor:o})}this.closePopup()}},handleExportAssetComplete:function(){},handleExportAssetError:function(e){401===e.status?graphite.events.trigger("reauthenticate"):507===e.status?n.notifyUser(n.translate("Error extracting asset. You've possibly exceeded your storage limit.")):n.notifyUser(n.translate("Error extracting asset."))},scaleEnabledChanged:function(){var e=this.$scaleEnabled.prop("checked");this.$scale.toggleClass("disabled",!e);d.set("scaleExtractedAssets",e);this.showHideLSOWarning()},scaleFactorChanged:function(){var e=parseFloat(this.$scaleFactor.val()),t=d.get("assetScaleFactor");!isNaN(e)&&e>=.1&&5>=e?t=parseFloat(e.toFixed(1)):!isNaN(e)&&e>5?t=5:!isNaN(e)&&.1>e&&(t=.1);d.set("assetScaleFactor",t);this.$scaleFactor.val(t+"x")},showHideLSOWarning:function(){var e=this.$scaleEnabled.prop("checked");this.$lsoWarning.hide();e&&n.utils.hasFeature("extract_batch")&&(this.existingAsset&&this.existingAsset.hasLinkedSmartObject()?this.$lsoWarning.show():this.selectedLayersContainLinkSmartObject()&&this.$lsoWarning.show())},getFileFormat:function(){return this.$fileFormat.find("input[name=imagetype]:checked").val()},setFileFormat:function(e){this.$fileFormat.find("input[value="+e+"]").prop("checked",!0)},remove:function(){this.removeEventListeners();a.prototype.remove.call(this)},normalizeFileName:function(t){t=e.trim(t);t=t.substr(0,t.lastIndexOf("."))||t;t=t.replace(m,"_");return t},deriveAssetDetailsFromLayer:function(e){var t,i,s,r,a,o,c=e.get("layerName"),h="png32";c=c.replace(/^(\/|\\|\.)+/,"");var u=d.get("assetQuality");"undefined"==typeof u&&(u=p);try{t=l.parse(c);if(t&&t.length>0){i=t[0];c=i.file||c;s=i.quality;a=i.scale;o=i.extension||"png";switch(o.toLowerCase()){case"jpg":case"jpeg":case"gif":h="jpeg";if(s){r=-1!==s.indexOf("%")?1:10;u=parseInt(s,10)*r}break;case"png":h="8"===s?"png8":"png32";break;case"svg":h="svg"}}}catch(g){}this.updateQuality(u);if(a&&1!==a&&a>=.1&&5>=a){this.$scaleEnabled.prop("checked",!0);this.$scale.toggleClass("disabled",!1);this.$scaleFactor.val(parseFloat(a.toFixed(1))+"x")}this.setFileFormat(h);c=this.normalizeFileName(c);n.utils.hasFeature("extract_batch")?this.baseName=c:this.$fileName.val(c)},deriveAssetDetailsFromAsset:function(e){var t=this.normalizeFileName(e.get("name")),i=e.get("encodingQualityFactor")||p,n=e.get("scale")||1,s=e.get("encodingType")||"png32";("jpg"===s||"jpeg"===s)&&this.updateQuality(i);if(n&&1!==n&&n>=.1&&5>=n){this.$scaleEnabled.prop("checked",!0);this.$scale.toggleClass("disabled",!1);this.$scaleFactor.val(parseFloat(n.toFixed(1))+"x")}this.setFileFormat(s);this.baseName=null;this.$el.find(".file-name").val(t)}});return v});define("vanilla-extract/public/js/core/views/templates/extractCodeTemplate.html",[],function(){return'<h3 class="title"><%-translate("Styles")%></h3>\n<span class="close-button"></span>\n<div class="textarea-holder">\n    <textarea class="topcoat-textarea" readonly><%-translate("Useful CSS here")%></textarea>\n</div>\n<p class="all-code"></p>\n<button class="topcoat-button action-button"></button>\n'});define("vanilla-extract/public/js/core/views/popup/ExtractCodeView",["underscore","backbone","../../controllers/ClipboardController","../../models/TextStyleUsageModel","../../models/UserSettingsModel","../../models/GradientUsageModel","../popup/BasePopupView","../../utils/CSSUtil","../../utils/TemplateUtil","../templates/extractCodeTemplate.html","plugin-dependencies"],function(e,t,i,n,s,r,a,o,l,d,c){"use strict";var h=a.extend({className:"extract-code-popup popup",copyString:c.translate("Copy"),copiedString:c.translate("Copied"),viewMoreString:c.translate("View more"),viewLessString:c.translate("View less"),events:{"click .all-code":"handleViewMoreClick","click .action-button":"handleSelectClick","dblclick .topcoat-textarea":"handleDoubleClickEvent"},initialize:function(){a.prototype.initialize.apply(this,arguments);this.initCopyToClipboard();graphite.events.on("show-extract-code-popup",this.handleShow,this);graphite.events.on("hide-extract-code-popup",this.closePopup,this)},render:function(){a.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(l.createTemplate(d));this.$actionButton=this.$el.find(".action-button");this.$actionButton.html(this.copyString);return this},initCopyToClipboard:function(){i.getClipboard().clip(this.$actionButton);graphite.events.on("clipboard-loaded",this.handleClipboardLoaded,this);graphite.events.on("clipboard-data-requested",this.handleClipboardDataRequest,this);graphite.events.on("clipboard-complete",this.handleClipboardComplete,this);graphite.events.on("clipboard-mouseover",this.handleClipboardMouseOver,this)},handleClipboardLoaded:function(){this.$actionButton.addClass("clipboard-enabled")},handleClipboardDataRequest:function(e){var t=i.getClipboard();if(e===this.$actionButton[0]){t.setText(this.$el.find("textarea").text());graphite.events.trigger("copy-css",{origin:"StylesPopup"});graphite.events.trigger("clipboard-text-set",this.$el.find("textarea").text())}},handleClipboardComplete:function(){var e=this;e.$actionButton.html(e.copiedString);e.timeout&&clearTimeout(e.timeout);e.timeout=setTimeout(function(){e.$actionButton.html(e.copyString)},1500)},handleClipboardMouseOver:function(){this.isMouseOver=!0},handleShow:function(e){this.reset();a.prototype.handleShow.apply(this,arguments);this.setCSS(e.model,e.ppi)},handleSelectClick:function(){this.$el.find("textarea").select()},handleDoubleClickEvent:function(){graphite.events.trigger("cssDoublClick")},handleViewMoreClick:function(){var e=this.$el.find("textarea"),t=this.$el.find(".all-code");if(this.$el.hasClass("expanded"))this.reset(!0);else{this.$el.addClass("expanded");t.html(this.viewLessString);e.height(e[0].scrollHeight-parseInt(e.css("padding-top"),10)-parseInt(e.css("padding-bottom"),10))}this.positionPopup()},setCSS:function(t,i){var a,l=this.$el.find("textarea"),d=s.get("preprocessor"),c=t.get("style").getCSS("css"===d,i),h=[];if(t instanceof n||t instanceof r){e.each(c,function(e){a=o.formatCSSString(e,d);a&&h.push(a)});l.text(h.join("\n"))}else l.text("Useful CSS here");this.updateViewMoreButton()},updateViewMoreButton:function(){var e,t;e=this.$el.find(".all-code");t=this.$el.find("textarea");if(t[0].scrollHeight-parseInt(t.css("padding-top"),10)-parseInt(t.css("padding-bottom"),10)>parseInt(t.height(),10)){e.html(this.viewMoreString);e.show()}else e.hide()},reset:function(e){this.$el.removeClass("expanded");this.$el.find(".all-code").html(this.viewMoreString);e||this.$el.find(".action-button").html(this.copyString);this.$el.find("textarea").height("60px")},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return t.View.prototype.remove.call(this)}});return h});define("vanilla-extract/public/js/core/views/templates/colorChipPopupTemplate.html",[],function(){return'<div class="dropdown">\n    <div class="dropdown-btn color-format">\n        <%-colorFormat%>\n    </div>\n</div>\n<textarea class="topcoat-textarea" readonly>rgba(100,100,100)</textarea>'});define("vanilla-extract/public/js/core/views/templates/alphaListPopupTemplate.html",[],function(){return'<div class="alpha-list">\n    <p class="opacities-label">Opacity:</p>\n    <ul>\n        <% _.each(alphas, function(alpha){ %>\n        <li class="color-alpha"><p><%-alpha%></p></li>\n        <% }); %>\n    </ul>\n</div>\n'});define("vanilla-extract/public/js/core/views/popup/ColorChipPopupView",["jquery","underscore","backbone","./BasePopupView","../../controllers/SelectionController","../../models/ColorUsageModel","../../utils/StyleUtil","../../utils/TemplateUtil","../inspect/ContextMenuView","../templates/colorChipPopupTemplate.html","../templates/alphaListPopupTemplate.html","../../Constants"],function(e,t,i,n,s,r,a,o,l,d,c,h){"use strict";var p=n.extend({className:"color-chip-popup popup",colorUsage:null,currentAlpha:1,handleShowColorProxied:null,handleHideColorProxied:null,colorFormat:"RGB",initialize:function(){n.prototype.initialize.apply(this,arguments);this.addHandlers()},addHandlers:function(){graphite.events.on("show-color-popup",this.handleShowColor,this);graphite.events.on("hide-color-popup",this.handleHideColor,this)},removeEventListeners:function(){graphite.events.off(null,null,this)},render:function(){n.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(o.createTemplate(d,{colorFormat:h.ColorFormat[this.colorFormat]}));this.createColorFormatMenu();return this},createColorFormatMenu:function(){var e=[],i={};t.each(h.ColorFormat,function(t,n){i[n]=t;e.unshift(n)});this.colorFormatMenu=new l({
name:"colorFormat-selector",$toggle:this.$("div.color-format"),$after:this.$("div.color-format"),items:e,position:h.MenuPosition.TOP});this.colorFormatMenu.labels=i;this.$(".color-format").addClass("menu-active");this.colorFormatMenu.on("show",this.handleColorFormatMenuShow,this);this.colorFormatMenu.on("selection",this.handleColorFormatSelectionChange,this)},handleColorFormatMenuShow:function(e){this.colorFormatMenu.checkItem(this.colorFormat)},handleColorFormatSelectionChange:function(e){if(e!==this.colorFormat){var t=h.ColorFormat[e];this.handleColorFormatChange(t);this.$(".color-format").text(t);this.colorFormat=e}},handleShowColor:function(e){if(!this.colorUsage||!this.$el.is(":visible")||!a.areUsageStylesEqual(e.style,this.colorUsage)){this.colorUsage=e.style;this.currentAlpha=null;this.handleShow({sourceElement:e.sourceElement});this.updateColorString(h.ColorFormat[this.colorFormat]);this.initAlphaList()}},handleHideColor:function(e){!this.colorUsage||e&&!a.areUsageStylesEqual(e,this.colorUsage)||this.closePopup()},handleColorFormatChange:function(e){this.updateColorString(e);graphite.events.trigger("color-format",{format:e})},initAlphaList:function(){var t=this;this.$el.find(".alpha-list").remove();var i,n=!1,s=this.colorUsage.get("alphas");e.each(s,function(e,t){1!==t&&(n=!0)});if(n){this.$el.append(o.createTemplate(c,{alphas:s}));i=this.$el.find(".color-alpha");i.each(function(i){e(this).data("alpha",s[i]);s[i]===t.currentAlpha&&e(this).addClass("selected")});i.mouseenter(function(){graphite.events.trigger("show-alpha-usage",{alpha:e(this).data("alpha")})});this.$el.find(".alpha-list ul").mouseleave(function(){graphite.events.trigger("hide-alpha-usage")});i.click(function(){e.each(i,function(){e(this).removeClass("selected")});t.currentAlpha=e(this).data("alpha");t.updateColorString(h.ColorFormat[t.colorFormat]);e(this).addClass("selected")})}},updateColorString:function(e){var t,i=this.$el.find("textarea");if(this.colorUsage instanceof r){t=this.colorUsage.get("style");e===h.ColorFormat.RGB?i.val(t.toRGBString(this.currentAlpha)):e===h.ColorFormat.HEX?i.val(t.toHEXString(this.currentAlpha)):i.val(t.toHSLString(this.currentAlpha))}i.select()},remove:function(){this.removeEventListeners();n.prototype.remove.call(this)}});return p});define("vanilla-extract/public/js/core/views/templates/layerThumbPopupTemplate.html",[],function(){return'<div class="layer-thumb">\n    <canvas class="sprite_preview preview" ></canvas>\n    <span id="layerWarningMessage" style="display: none"><%-translate("Warning: This layer contains an incompatible graphic option: blend mode")%></span>\n</div>'});define("vanilla-extract/public/js/core/views/popup/LayerThumbPopupView",["underscore","backbone","../popup/BasePopupView","plugin-dependencies","../../Constants","../../utils/ImageUtil","../../utils/TemplateUtil","../../utils/SpriteSheetUtils","../templates/layerThumbPopupTemplate.html"],function(e,t,i,n,s,r,a,o,l){"use strict";var d=i.extend({className:"layer-thumb-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("load-layer-thumb-popup",this.handleLoadThumb,this);graphite.events.on("show-layer-thumb-popup",this.handleShow,this);graphite.events.on("hide-layer-thumb-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(a.createTemplate(l));return this},removeEventListeners:function(){graphite.events.off(null,null,this)},handleLoadThumb:function(e){var t=e.get("properties"),i=t?t.get("blendOptions"):null;o.renderSpriteModel(this,e,".layer-thumb",".sprite_preview",!0);var r=this.$el.find("#layerWarningMessage"),a=[];i&&i.mode&&"passThrough"!==i.mode&&!e.get("isFlattened")&&e.get("visible")&&a.push(n.translate("This layer contains blend modes that may not be rendered correctly with the current combination of visible layers."));e.isFontSubstitution()&&a.push(n.translate("This layer contains font substitutions so the font-size CSS reported is approximate."));e.isMultipleLayerStylesCSSWarning()&&a.push(n.translate(s.LayerWarnings.MULTI_LAYER_STYLES_WARNING));if(a.length>0){r.show();r.html(a.join("<br><br>"))}else r.hide()},closePopup:function(){i.prototype.closePopup.apply(this,arguments);this.$el.find(".preview").attr("src","")},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return d});define("vanilla-extract/public/js/core/views/templates/assetThumbPopupTemplate.html",[],function(){return'<div class="layer-thumb">\n    <canvas class="sprite_preview preview" ></canvas>\n    <span id="lsoWarningMessage" style="display: none"><%-translate(\'Linked Smart Objects will render poorly when scaled.\')%></span>\n</div>'});define("vanilla-extract/public/js/core/views/popup/AssetThumbPopupView",["underscore","backbone","./BasePopupView","plugin-dependencies","../../utils/ImageUtil","../../utils/TemplateUtil","../../utils/SpriteSheetUtils","../templates/assetThumbPopupTemplate.html"],function(e,t,i,n,s,r,a,o){"use strict";var l=i.extend({className:"asset-thumb-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("load-asset-thumb-popup",this.handleLoadAssetThumb,this);graphite.events.on("show-asset-thumb-popup",this.handleShow,this);graphite.events.on("hide-asset-thumb-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(r.createTemplate(o));return this},removeEventListeners:function(){graphite.events.off(null,null,this)},handleLoadAssetThumb:function(e){var t="image/svg+xml"===e.get("mimeType")?graphite.getServerAPI().getDerivedDownloadURL(e.get("guid"),e.get("name")):graphite.getServerAPI().getDerivedRenditionURL(e.get("guid")),i=new Image,s=this.$el.find(".sprite_preview"),r=this.$el.find("#lsoWarningMessage");n.utils.hasFeature("extract_batch")&&e.hasLinkedSmartObject()?r.show():r.hide();i.addEventListener("load",function(){if("image/svg+xml"===e.get("mimeType")){var t=i.width,n=i.height;if(t>n){if(t>240){n=240*n/t;t=240}}else if(n>240){t=240*t/n;n=240}s[0].width=t;s[0].height=n}else{s[0].width=i.width;s[0].height=i.height}r.width(s[0].width+2);var a=s[0].getContext("2d");a.drawImage(i,0,0,s[0].width,s[0].height);i.removeEventListener("load")});graphite.getServerAPI().loadCrossDomainImage(i,t)},handleShow:function(){i.prototype.handleShow.apply(this,arguments)},closePopup:function(){i.prototype.closePopup.apply(this,arguments);this.$el.find(".preview").attr("src","")},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return l});define("vanilla-extract/public/js/core/views/popup/ZoomInHintPopupView",["underscore","backbone","../popup/BasePopupView","plugin-dependencies","../../utils/ImageUtil","../../utils/TemplateUtil","../../utils/SpriteSheetUtils","../templates/layerThumbPopupTemplate.html"],function(e,t,i,n,s,r,a,o){"use strict";var l=i.extend({className:"zoom-in-hint-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("show-zoom-in-hint-popup",this.handleShow,this);graphite.events.on("hide-zoom-in-hint-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").text(n.translate("Zoom to 100% for greater color picker accuracy."));this.$el.on("mouseover",this.closePopup);return this},positionPopup:function(){i.prototype.positionPopup.apply(this,arguments);this.$el.find(".notch").show()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return l});define("vanilla-extract/public/js/core/controllers/FlattenedAssetController",["jquery","underscore","../Constants","./SelectionController","../models/LayerModelMap","../models/LayerModel","../utils/MeasurementUtil"],function(e,t,i,n,s,r,a){"use strict";var o={activeRequests:{},requestDelay:1e3,cachedImages:{},invalidateSprite:function(e){var t,i=n.getPSDModel().id,s=n.getPSDModel().get("layerCompId"),r=this.deriveSpriteInfo(e,i),a=this.cachedImages[r.key()],o=this;if(!a&&this.isOriginalPSDVisibility(e)){a={image:graphite.getDetailsController().spriteSheets[e.get("flattenedSprite").sheetID],bounds:e.get("flattenedSprite").bounds};this.cachedImages[r.key()]=a}if(r.visibleLayers&&0===r.visibleLayers.length)this.replaceFlattenedSprite(e,null);else if(a&&a.image.complete)this.replaceFlattenedSprite(e,a.image,a.bounds);else{t={};t.model=e;t.psdModelID=i;t.layerCompId=s;t.info=r;t.delayTimer=setTimeout(function(){o.activateRequest(t)},this.requestDelay);this.queueRequest(t)}},validateSprite:function(e){this.cancelRequest(e)},activateRequest:function(e){var t=this,i=function(){t.imageLoaded(e)},s=function(i){t.imageError(e)};e.image=graphite.getServerAPI().getDerivedSpriteImage(n.getPSDModel(),e.info.visibleLayers,i,s);e.delayTimer=null},imageLoaded:function(e){var t=this.activeRequests[e.model.get("layerId")],i={top:0,left:0,right:e.image.width,bottom:e.image.height};this.cachedImages[e.info.key()]={image:e.image,bounds:i};if(t&&t.info.key()===e.info.key()&&e.psdModelID===n.getPSDModel().id){this.replaceFlattenedSprite(e.model,e.image,i);this.cancelRequest(e.model)}},imageError:function(e){this.activeRequests[e.model.get("layerId")]&&e.psdModelID===n.getPSDModel().id&&this.replaceFlattenedSprite(e.model,null);this.cancelRequest(e.model)},replaceFlattenedSprite:function(r,o,l){var d,c,h,p,u,g,f="flattenedLayer"+r.get("layerId"),m=e("#"+f),v=r.get("flattenedSprite"),y=n.getPSDModel(),b=y.get("imgdata").bounds;if(m.length){g=m[0].getContext("2d");g.clearRect(0,0,m.width(),m.height());if(o){m[0].width=l.right-l.left;m[0].height=l.bottom-l.top;g.drawImage(o,l.left,l.top,m[0].width,m[0].height,0,0,m[0].width,m[0].height)}p=r.getEffectiveVisibility();u=r.get("type")===i.Type.LAYER_ADJUSTMENT;r.set("renderedVisible",p);h=a.getVisibleBounds(r,y);c={top:p&&!u?h.top:b.bottom,left:p&&!u?h.left:b.right};t.each(v.includedLayers,function(e){d=s.getLayerModelFromId(e);p=d.getEffectiveVisibility();u=d.get("type")===i.Type.LAYER_ADJUSTMENT;h=a.getVisibleBounds(d,y);d.set("renderedVisible",p);if(p&&!u){c.left=Math.min(c.left,h.left);c.top=Math.min(c.top,h.top)}});if(n.clipLayersToImage){c.top=Math.max(0,c.top);c.left=Math.max(0,c.left)}this.applyParentAndPosition(r,c,m,v);graphite.events.trigger("flattenedSpriteUpdated",r)}},placeSprite:function(t,i){for(var n,s,a,o,l,d,c,h=t.get("parentModel");h&&h instanceof r&&1!=h.getEffectiveOpacity();)h=h.get("parentModel");if(h){n=h.get("layerCollection");for(c=0;c<n.length;c++){d=n.at(c);d.get("flattenedParent")===t.get("layerId")&&(a=d)}a&&(o=e("#layer"+a.get("layerId")));if(h instanceof r){l=e("#layer"+h.get("layerId"));s=h}else l=e("#psdpreview_root");l&&(o?o.before(i):l.prepend(i))}return s},applyParentAndPosition:function(e,i,s,r){var a=this.placeSprite(e,s),o=a?a.get("bounds"):null;o||(o={top:0,left:0});r&&(r.altPsdOrigin=t.clone(i));var l=i.top,d=i.left,c=o.left,h=o.top;if(n.clipLayersToImage){l=Math.max(0,l);d=Math.max(0,d);c=Math.max(0,c);h=Math.max(0,h)}s.css({left:i.left-c+"px",top:i.top-h+"px"})},queueRequest:function(t){var i=t.model,n=t.model.get("layerId");this.cancelRequest(i);this.activeRequests[n]=t;e(".spinner").show()},cancelRequest:function(t){var i=t.get("layerId"),n=this.activeRequests[i];if(n){clearTimeout(n.delayTimer);delete this.activeRequests[i]}0===Object.keys(this.activeRequests).length&&e(".spinner").hide()},isOriginalPSDVisibility:function(e){var i,n=e.getEffectiveVisibility(),r=n===e.get("psdVisible"),a=e.get("flattenedSprite");r&&t.each(a.includedLayers,function(e){i=s.getLayerModelFromId(e);n=i.getEffectiveVisibility();n!==i.get("psdVisible")&&(r=!1)});return r},deriveSpriteInfo:function(e,i){var r,a=e.get("flattenedSprite"),o=[],l={psdId:i,visibleLayers:[],key:function(){return i+","+this.visibleLayers.join(",")}};e.getEffectiveVisibility()&&o.push(e);t.each(a.includedLayers,function(e){r=s.getLayerModelFromId(e);r.getEffectiveVisibility()&&o.push(r)});o=n.expandSelection(o);l.visibleLayers=t.unique(t.map(o,function(e){return e.get("layerId")}));return l},reset:function(){this.activeRequests={};this.cachedImages={}}};return o});define("vanilla-extract/public/js/core/views/templates/inspectFontCalloutTemplate.html",[],function(){return'<div class="font-callout">\n    <p>T</p>\n    <div class="callout-notch"></div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/inspectColorCalloutTemplate.html",[],function(){return'<div class="color-callout">\n    <p class="alpha-value">1.0</p>\n    <div class="callout-notch"></div>\n</div>'});define("vanilla-extract/public/js/core/views/preview/InspectStyleOverlayView",["jquery","underscore","backbone","../../controllers/SelectionController","../../controllers/ZoomController","../../models/ColorUsageModel","../../models/TextStyleUsageModel","../../models/GradientUsageModel","../../models/LayerModelMap","../../utils/CSSUtil","../../utils/TemplateUtil","../templates/inspectFontCalloutTemplate.html","../templates/inspectColorCalloutTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h,p){"use strict";var u=i.View.extend({colorCalloutDict:{},inspectableLayers:{},initialize:function(){this.render();this.model.on("change:extractedStyles",this.handleExtractedStylesChanged,this);this.addHandlers();this.model.get("extractedStyles")&&this.handleExtractedStylesChanged()},render:function(){var t=e('<div id="inspectStyleOverlay">');this.setElement(t)},handleExtractedStylesChanged:function(){this.loadInspectableLayers()},addHandlers:function(){graphite.events.on("show-style-usage",this.handleShowStyleUsage,this);graphite.events.on("hide-style-usage",this.handleHideStyleUsage,this);graphite.events.on("show-originating-layers",this.handleShowOriginatingLayers,this);graphite.events.on("hide-originating-layers",this.handleHideOriginatingLayers,this);graphite.events.on("show-alpha-usage",this.handleShowAlphaUsage,this);graphite.events.on("hide-alpha-usage",this.handleHideAlphaUsage,this);graphite.events.on("zoomChanged",this.handleSelectedInspectItemChange,this);graphite.events.on("layerVisiblityChanged",this.handleSelectedInspectItemChange,this);graphite.getDetailsController().on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);n.on("change:extractedStylesInSelection",t.bind(this.updateCallouts,this,a,null))},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this);graphite.getDetailsController().off(null,null,this);n.off(null,null,this);n.unbind("change:extractedStylesInSelection")},attachCalloutClickHandler:function(e,t){var i=this;e.unbind("click");e.click(function(e){n.changeSelection([t],!1,!0);if(!n.isLayerVisible(t,!0))if(void 0!==t.get("spriteSheet")){var s=i.inspectableLayers.spriteSheetLayers,r=t.get("bounds");s[0].width=r.right-r.left;s[0].height=r.bottom-r.top;s.css("top",r.top+"px");s.css("left",r.left+"px");var a=s[0].getContext("2d"),o=t.get("spriteSheet").bounds,l=n.spriteSheets[t.get("spriteSheet").sheetID];a.drawImage(l,o.left,o.top,o.right-o.left,o.bottom-o.top,0,0,o.right-o.left,o.bottom-o.top);s.show()}else i.inspectableLayers[t.get("layerId")].show();e.stopPropagation()})},loadInspectableLayers:function(){var t,i,n,s;this.inspectableLayers={};t=[];i=this.model.get("extractedStyles");s=this;t=t.concat(i.colorUsageModels,i.textStyleUsageModels,i.gradientUsageModels);e.each(t,function(t,i){n=i.get("layers");e.each(n,function(e,t){s.loadInspectableLayer(t)})})},loadInspectableLayer:function(t){var i;if(void 0!==t.get("spriteSheet")&&!this.inspectableLayers.spriteSheetLayers){i=e('<canvas class="inspectable-layer">');this.inspectableLayers.spriteSheetLayers=i;this.$el.append(i)}},handleShowStyleUsage:function(e){this.updateHoverRects(e.styles);this.updateCallouts(e.styles[0].constructor,e.styles)},handleHideStyleUsage:function(e){this.updateCallouts(e[0].constructor,null);graphite.events.trigger("item-hovered-over",[],!1)},updateHoverRects:function(t){var i=[];e.each(t,function(e,t){i=i.concat(t.get("layers"))});graphite.events.trigger("item-hovered-over",i,!1)},handleSelectedInspectItemChange:function(){this.updateCallouts(a,null);this.updateCallouts(r,null);this.updateCallouts(o,null)},handleShowAlphaUsage:function(t){this.getCalloutsForStyleType(r).each(function(){if(e(this).is(":visible")){e(this).removeClass("defocused");t.alpha!==e(this).data("alpha")&&e(this).addClass("defocused")}})},handleHideAlphaUsage:function(){this.getCalloutsForStyleType(r).each(function(){e(this).is(":visible")&&e(this).removeClass("defocused")})},updateCallouts:function(t,i){this.getCalloutsForStyleType(t).each(function(){e(this).hide();e(this).removeClass("defocused")});var n=[],s=graphite.getDetailsController().get("selectedInspectItem");i&&(n=n.concat(i));s&&s.constructor===t&&s!==i&&n.push(s);n.length?this.showCalloutsForStyles(t,n):this.$el.find("canvas.inspectable-layer").hide()},showCalloutsForStyles:function(t,i){var n,s=this,r=this.getCalloutsForStyleType(t),a=0;e.each(i,function(i,o){e.each(o.get("layers"),function(i,l){if(l.isLayerShown()){if(r[a]){n=e(r[a]);a++}else{n=s.createCalloutForStyleType(t);s.$el.append(n)}s.initCallout(n,o,l)}})})},getCalloutsForStyleType:function(e){var t="";switch(e){case a:t=".font-callout";break;case r:t=".solid-color-callout";break;case o:t=".gradient-callout";break;default:console.warn("Unknown callout for model")}return this.$el.find(t)},createCalloutForStyleType:function(e,t){var i;switch(e){case a:i=c.createTemplate(h);break;case r:i=c.createTemplate(p);i.addClass("solid-color-callout");break;case o:i=c.createTemplate(p);i.addClass("gradient-callout");break;default:console.warn("Unknown callout for model")}return i},initCallout:function(t,i,s){if(i instanceof r){t.css("background","none");t.css("background-color",i.get("style").toRGBString());e.each(s.get("colors"),function(e,n){var s,r;if(n.isEqual(i.get("style"))){s=t.find(".alpha-value");r=n.get("alpha");if(1===r)s.hide();else{s.show();s.text(r)}t.data("alpha",r)}})}else if(i instanceof o){t.css("background","none");t.find(".alpha-value").hide();d.applyCSS(t,i.get("style"),!0)}t.removeClass("invisible");n.isLayerVisible(s,!0)||t.addClass("invisible");this.attachCalloutClickHandler(t,s);this.positionCallout(t,s);t.show()},handleShowOriginatingLayers:function(e){var t=e.assetModel.get("originatingLayers");this.hideShowOriginatingLayers(t,!0)},handleHideOriginatingLayers:function(e){var t=e.get("originatingLayers");this.hideShowOriginatingLayers(t,!1)},hideShowOriginatingLayers:function(t,i){var n,s;for(s=0;s<t.length;s++){n=l.getLayerInfoForId(t[s]).item;i?e(n).addClass("originating-layer"):e(n).removeClass("originating-layer")}},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},positionCallout:function(e,t){var i,n,r=s.zoomRect(t.get("bounds")),a=r.bottom-r.top,o=parseInt(e.css("width"),10),l=parseInt(e.css("height"),10),d=parseInt(e.find(".callout-notch").width(),10);i=r.top+(a-l)/2-4;0>i&&(i=0);n=r.left-o-d-7;0>n&&(n=0);e.css({top:i+"px",left:n+"px"})}});return u});define("vanilla-extract/public/js/core/views/preview/SelectionOverlayView",["jquery","underscore","backbone","../../controllers/SelectionController","../../controllers/ZoomController","../../utils/MeasurementUtil"],function(e,t,i,n,s,r){"use strict";var a=i.View.extend({selectionButtonBars:[],parentView:null,initialize:function(e){t.bindAll(this,"handleSelectionChange","handleHoverOver");this.parentView=e.parentView;this.render();graphite.events.on("selection-changed",this.handleSelectionChange,this);graphite.events.on("item-hovered-over",this.handleHoverOver,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this)},render:function(){var e=this.parentView.$el.find("#selection-overlay")[0];this.setElement(e)},drawOutline:function(t,i){var a,o,l,d,c=this.$el.width(),h=this.$el.height();d=r.getVisibleBounds(t,n.getPSDModel());d=s.zoomRect(d);l=d.top<=0||d.left<=0||d.right>=c||d.bottom>=h;o=l?-1:0;a=e('<div class="'+i+'"></div>');a.css({top:d.top+"px",left:d.left+"px",height:d.bottom-d.top,width:d.right-d.left,"outline-offset":o+"px"});this.$el.append(a)},handleSelectionChange:function(){var e,t,i=n.getSelectedLayers();for(e=0;e<this.selectionButtonBars.length;e++)this.selectionButtonBars[e].remove();this.selectionButtonBars=[];this.$el.find(".selection").remove();this.$el.find(".hover").remove();for(t=0;t<i.length;t++)this.drawOutline(i[t],"selection")},handleZoomChanged:function(){this.$el.find(".hover").remove();var e=n.getSelectedLayers();n.changeSelection([],!1,!0);graphite.events.once("zoomCompleted",function(){n.getSelectedLayers().length||n.changeSelection(e,!1,!0)})},handleHoverOver:function(e){var t;this.$el.find(".hover").remove();for(t=0;t<e.length;t++)this.isItemSelected(e[t])||this.drawOutline(e[t],"hover")},isItemSelected:function(e){var t,i;for(t in n.selectionMap)if(n.selectionMap.hasOwnProperty(t)){i=n.selectionMap[t];if(e===i)return!0}return!1},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return a});define("vanilla-extract/public/js/core/views/templates/mouseListenerOverlayTemplate.html",[],function(){return'<div id="mouseListenerOverlay"></div>'});define("vanilla-extract/public/js/core/views/preview/MouseListenerOverlayView",["jquery","underscore","backbone","plugin-dependencies","../../Constants","../../controllers/SelectionController","../../models/UserSettingsModel","../../utils/TemplateUtil","../templates/mouseListenerOverlayTemplate.html"],function(e,t,i,n,s,r,a,o,l){"use strict";var d=i.View.extend({initialize:function(){t.bindAll(this,"handleMouseMove","handleMouseLeave");this.render()},render:function(){this.setElement(o.createTemplate(l))},addHandlers:function(){this.$el.on("mousemove",this.handleMouseMove);this.$el.on("mouseleave",this.handleMouseLeave)},handleMouseMove:function(t){var i,n,a=t.clientX+e(document).scrollLeft(),o=t.clientY+e(document).scrollTop();if(graphite.getDetailsController().get("activeTool")===s.Tool.SELECT_DIRECT){var l=this.previewView.convertClientPtToPSDPt(a,o);i=r.itemAtPoint(l.x,l.y);n=i&&!this.isItemSelected(i)?[i]:[];graphite.events.trigger("item-hovered-over",n,!0);graphite.events.trigger("mouseMoved",{x:a,y:o,itemMousedOver:i},!0)}},handleMouseLeave:function(e){graphite.events.trigger("item-hovered-over",[],!0);graphite.events.trigger("mouseMoved",null,!0)},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},isItemSelected:function(e){return e?e.get("selected"):!1}});return d});define("vanilla-extract/public/js/core/views/templates/artboardOverlayTemplate.html",[],function(){return'<div id="artboardOverlay"></div>'});define("vanilla-extract/public/js/core/views/preview/ArtboardOverlayView",["jquery","underscore","backbone","../../Constants","../../utils/KeyboardUtils","../../utils/TemplateUtil","../../controllers/SelectionController","../../controllers/ZoomController","../templates/artboardOverlayTemplate.html"],function(e,t,i,n,s,r,a,o,l){"use strict";var d=i.View.extend({psdModel:null,initialize:function(e){this.psdModel=e.model;this.render();graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish,this);graphite.events.on("selection-changed",this.handleSelectionChange,this);graphite.events.on("zoomChanged",this.removeLabels,this);graphite.events.on("zoomCompleted",this.placeLabels,this)},render:function(){this.setElement(r.createTemplate(l))},handleDrawPreviewFinish:function(){this.placeLabels()},handleSelectionChange:function(){var t=a.getSelectedLayers(),i=this;this.$el.find(".artboardLabel").removeClass("selected");e.each(t,function(e,t){t.get("type")===n.Type.LAYER_ARTBOARD&&i.$el.find("#ArtboardLabel"+t.get("layerId")).addClass("selected")})},onLabelClick:function(t){var i=e(t.target).data("layerModel");a.changeSelection([i],s.isMultiSelectKey(t),!0);if(t.altKey){graphite.events.trigger("zoomToFit",i.get("bounds"));graphite.events.trigger("artboard-zoomToFit")}t.stopPropagation()},onLabelHoverIn:function(t){var i=e(t.target).data("layerModel");i&&!i.get("selected")&&graphite.events.trigger("item-hovered-over",[i],!0)},onLabelHoverOut:function(e){graphite.events.trigger("item-hovered-over",[],!0)},placeLabels:function(){var t=this,i=null;this.psdModel&&this.psdModel.get("layerCollection")&&!o.isZooming()&&this.psdModel.get("layerCollection").each(function(s){var r=null;if(s.get("type")===n.Type.LAYER_ARTBOARD){r=e("<div/>");r.attr("id","ArtboardLabel"+s.get("layerId"));r.text(s.get("layerName"));r.attr("title",s.get("layerName"));r.addClass("artboardLabel");r.data("layerModel",s);t.$el.append(r);i=o.zoomRect(s.get("bounds"));r.css({top:i.top-16,left:i.left+1,maxWidth:i.right-i.left-2});r.hover(t.onLabelHoverIn,t.onLabelHoverOut);r.bind("click",t.onLabelClick)}})},removeLabels:function(){this.$el.find(".artboardLabel").remove()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return d});define("vanilla-extract/public/js/core/views/popup/BasePreviewPopupView",["jquery","underscore","backbone","./BasePopupView"],function(e,t,i,n){"use strict";var s=n.extend({events:{mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave"},handleMouseDown:function(e){e.stopPropagation()},handleShow:function(t){if(void 0!==this.$el.parent().offset()){this.source=t.sourceElement;this.source||(this.source=null);this.$el.show();this.positionPopup();this.isMouseOver=!1;e(window).on("mousedown",e.proxy(this.handleMouseDown,this))}},positionPopup:function(){var t=e("div.psd-preview-view"),i=e("div.preview-container"),n=this.$el.find(".notch"),s=this.$el.parent().width(),r=this.getSourceOuterHeight(),a=this.getSourceOuterWidth()||s,o=this.$el.outerHeight(),l=this.$el.outerWidth(),d=t.width()-10,c=t.height(),h=parseFloat(i.css("margin-left")),p=t.scrollLeft(),u=t.scrollTop(),g=n.height(),f=n.width(),m=0,v=this.getSourceYOffset()+r+g-4,y=this.getSourceXOffset()+(a-l)/2,b=!1,w=e("div.center-helper"),S=w.outerHeight(!0);Math.abs(parseInt(w.css("margin-bottom"),10))>S&&(S=0);this.$el.removeClass("top bottom");if(v+o+g>c+u-S){b=!0;v=this.getSourceYOffset()-o+4}if(u-S>v){b=!0;v=this.getSourceYOffset()+r-o+3;if(v+o+g>c+u-S){b=!1;v=this.getSourceYOffset()+g-4}}this.$el.addClass(b?"top":"bottom");n.css("left",Math.round((l-f)/2));if(p>y){m=Math.min(p-y,(l-f)/2);n.css("left",(l-f)/2-m);y=p}if(y+l>d+p-h){m=Math.min(y-(d+p-h-l),(l-f)/2);n.css("left",(l-f)/2+m);y=d+p-h-l}this.$el.css({top:v,left:Math.round(y)})},getSourceXOffset:function(){return Math.max(0,this.source.offset().left-this.$el.parent().offset().left)},getSourceYOffset:function(){return Math.max(0,this.source.offset().top-this.$el.parent().offset().top)},getSourceOuterWidth:function(){return this.source.outerWidth()},getSourceOuterHeight:function(){return this.source.outerHeight()}});return s});define("vanilla-extract/public/js/core/views/templates/shiftClickMeasurementNotificationTemplate.html",[],function(){return'<div id="shiftClickMeasurementNotification" class="shiftClickMeasurementNotification">\n    <button class="closeButton"></button>\n    <span class="notificationText"><%-translate("You can Shift-Click to measure, or select multiple layers and save them as one image.")%></span>\n</div>\n'});define("vanilla-extract/public/js/core/views/popup/ShiftClickNotificationView",["underscore","backbone","../../Constants","../../models/UserSettingsModel","../popup/BasePreviewPopupView","../../utils/TemplateUtil","../templates/shiftClickMeasurementNotificationTemplate.html"],function(e,t,i,n,s,r,a){"use strict";var o=t.View.extend({events:{"click .closeButton":"handleCloseClick"},initialize:function(){this.render();window.graphite.events.trigger("measurement-notification-shown")},render:function(){this.$el.html(r.createTemplate(a));return this},handleCloseClick:function(e){e.stopPropagation();var t=this.$el.parent(),s=this.$el.outerHeight(),r=t.position().top;this.$el.remove();t.hasClass("top")&&t.css({top:r+s});n.setInterceptShown(i.InterceptNames.SHIFT_CLICK_MEASUREMENT,!1);window.graphite.events.trigger("measurement-notification-closed")}});return o});define("vanilla-extract/public/js/core/views/templates/measurementPopupTemplate.html",[],function(){return'<div id="measurementPopupInfo">\n    <div id="measurementPreferredUnits" class="measurementPreferredUnits"><span id="preferredUnitPx" class="selectedUnit">PX</span><br/><span id="preferredUnitPct">%</span></div>\n    <div class="measurementElementInfoDim">W: <span class="copyable width">0</span> <br/>H: <span class="copyable height">0</span></div>\n    <div class="measurementElementInfoPos">X: <span class="copyable x">0</span> <br/>Y: <span class="copyable y">0</span></div>\n    <div class="measurementElementCopyControls"><span id="copyCSSLink" class="copyable"><%-translate("Copy CSS")%></span><br/><span id="copyTextLink" class="copyable"><%-translate("Copy Text")%></span></div>\n    <div class="measurementElementAssetExtract" title=\'<%-translate("Extract asset")%>\'></div>\n    <div class="extractAssetPopupContainer"></div>\n</div>\n'});define("vanilla-extract/public/js/core/views/popup/MeasurementPopupView",["jquery","underscore","backbone","../../Constants","../popup/BasePreviewPopupView","plugin-dependencies","../../controllers/ClipboardController","../../controllers/ZoomController","../../controllers/SelectionController","../../models/LayerModelMap","../../models/PSDSettingsModel","../../models/UserSettingsModel","../../utils/TemplateUtil","../../utils/MeasurementUtil","../../utils/UTF8","./ShiftClickNotificationView","../templates/measurementPopupTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f,m){"use strict";var v=s.extend({className:"measurementPopup popup blueHUD",sourceElement:null,layerModel:null,layerList:null,displayWidth:null,displayHeight:null,displayX:null,displayY:null,extractAssetPopup:null,events:{"click #preferredUnitPx":"handlePreferredMeasurementUnitChange","mousedown #preferredUnitPx":"handleMouseDown","click #preferredUnitPct":"handlePreferredMeasurementUnitChange","mousedown #preferredUnitPct":"handleMouseDown","click #copyCSSLink":"handleCopyableClick","mousedown #copyCSSLink":"handleMouseDown","click #copyTextLink":"handleCopyableClick","click .copyable":"handleCopyableClick","mousedown #copyTextLink":"handleMouseDown"},initialize:function(){s.prototype.initialize.apply(this,arguments);this.initCopyToClipboard();graphite.events.on("layerVisiblityChanged",this.layerVisiblityChanged,this);graphite.events.on("designedAtMultiplierChanged",this.designedAtMultiplierChanged,this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},render:function(){s.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(p.createTemplate(m));var t=this.$el.find("#copyCSSLink"),i=this.$el.find("#copyTextLink"),a=this.$el.find(".measurementElementAssetExtract"),o=this.$el.find(".copyable");h.get("preferredMeasurementUnits")!==n.MeasurementUnitType.PX&&this.$el.find("#measurementPreferredUnits span").toggleClass("selectedUnit");t.html(r.translate("Copy CSS"));i.html(r.translate("Copy Text"));o.attr("title",r.translate("Click to copy"));o.hover(this.highlightLabel,this.unhighlightLabel);var l=this;a.click(function(t){graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:a,origin:"measurementPopup"});l.extractAssetPopup=e(".extract-asset-popup");l.$el.parent().append(l.extractAssetPopup);graphite.events.once("hide-extract-asset-popup",function(){if(l.extractAssetPopup){e("div.vanilla-extract").append(l.extractAssetPopup);delete l.extractAssetPopup}});var i=new s;i.$el=l.extractAssetPopup;i.source=a;i.positionPopup();t.stopPropagation()});this.layerVisiblityChanged();
return this},layerVisiblityChanged:function(e){l.canExtractAsset()?this.$el.find(".measurementElementAssetExtract").css("display","inline-block"):this.$el.find(".measurementElementAssetExtract").css("display","none")},initCopyToClipboard:function(){var i=this,s=a.getClipboard(),o=this.$el.find(".copyable"),l=this.$el.find("#copyTextLink"),d=this.$el.find("#copyCSSLink");t.each(o,function(e){s.clip(e)});graphite.events.on("clipboard-data-requested",function(t){if(t===l[0]){if(i.layerModel&&i.layerModel.get("type")===n.Type.LAYER_TEXT){var a=e.trim(i.layerModel.get("properties").get("rawText"));a.indexOf("ff")>=0&&(a=g.decodeCharacters(a));s.setText(a);graphite.events.trigger("copy-text");i.showSuccessTooltip(r.translate("Text copied to clipboard"));graphite.events.trigger("clipboard-text-set",a)}}else if(t===d[0]){if(i.layerModel){var o=i.layerModel.getCSSAsString(!0,h.get("preprocessor"));s.setText(o);graphite.events.trigger("copy-css",{origin:"HUD"});i.showSuccessTooltip(r.translate("CSS copied to clipboard"));graphite.events.trigger("clipboard-text-set",o)}}else e(t).hasClass("copyable")&&this.handleCopyableElement(e(t))},this)},handleCopyableElement:function(e){var t,i=a.getClipboard(),n=r.translate("Value copied to clipboard");if(e.hasClass("width")||e.hasClass("height")){t="width: "+this.displayWidth+";\nheight: "+this.displayHeight+";";n=r.translate("Size copied to clipboard")}else if(e.hasClass("x")||e.hasClass("y")){t="top: "+this.displayY+"px;\nleft: "+this.displayX+"px;";n=r.translate("Position copied to clipboard")}else t=e.text();i.setText(t);graphite.events.trigger("copy-value",{origin:"HUD"});this.showSuccessTooltip(n);graphite.events.trigger("clipboard-text-set",t)},showSuccessTooltip:function(t){var i=this.$el.parent().get(0);e(i).append('<div id="notificationTooltip" style="display:none"><span>'+t+"</span></div>");var s=e("#notificationTooltip"),r=s.width(),a=s.height(),l=this.layerModel?this.layerModel.attributes.bounds:this.layerGroupBounds,d=(l.left+(l.right-l.left)/2)*o.getZoomLevel()-r/2,c=(l.top+(l.bottom-l.top)/2)*o.getZoomLevel()-a/2;s.css({top:c,left:d});s.fadeIn(250);setTimeout(function(){s.remove()},n.toolTipTimeout)},designedAtMultiplierChanged:function(){this.handleShowMeasurementInfo(this.layerList?{layerList:this.layerList}:{layerModel:this.layerModel})},handleCopyableClick:function(e){e.stopPropagation()},highlightLabel:function(){e(this).addClass("zeroclipboard-is-hover")},unhighlightLabel:function(){e(this).removeClass("zeroclipboard-is-hover")},handlePreferredMeasurementUnitChange:function(e){var t="preferredUnitPx"===e.target.id?n.MeasurementUnitType.PX:n.MeasurementUnitType.PCT;if(t!==h.get("preferredMeasurementUnits")){h.set("preferredMeasurementUnits",t);this.$el.find("#measurementPreferredUnits span").toggleClass("selectedUnit");this.sourceElement=null;this.handleShowMeasurementInfo(this.layerList?{layerList:this.layerList}:{layerModel:this.layerModel});graphite.events.trigger("preferredMeasurementUnitsChanged",{preferredMeasurementUnits:t})}e.stopPropagation()},handleShowMeasurementInfo:function(e){var i,s,r,a,o,d,p=this.$el.find(".measurementElementInfoDim"),g=this.$el.find(".measurementElementInfoPos"),f=l.getPSDModel(),m=c.get("designedAtMultiplier"),v=!1;this.layerModel=null;this.layerList=null;this.layerGroupBounds=null;i=f.get("imgdata").bounds;if(e.layerList instanceof Array){s=u.calcLayerGroupBounds(e.layerList,f);if(2===e.layerList.length&&h.get("preferredMeasurementUnits")===n.MeasurementUnitType.PCT){o=u.getVisibleBounds(e.layerList[0],f);d=u.getVisibleBounds(e.layerList[1],f);r=e.layerList[0].getArtboardParent();a=e.layerList[1].getArtboardParent();if(f.get("isArtboardPSD")&&r&&r===a)i=r.get("bounds");else if(u.rect1ContainsRect2(o,d)){s=d;i=o}else if(u.rect1ContainsRect2(d,o)){s=o;i=d}}}else{r=e.layerModel.getArtboardParent();if(f.get("isArtboardPSD")&&r&&r!==e.layerModel){i=r.get("bounds");v=!0}s=u.getVisibleBounds(e.layerModel,f)}var y=u.getMeasurementsOfRectInsideRect(s,i,v);if(f.get("isArtboardPSD")&&r&&r!==e.layerModel){this.displayX=Math.round(y.displayLeft/m);this.displayY=Math.round(y.displayTop/m)}else{this.displayX=y.displayLeft;this.displayY=y.displayTop}this.displayWidth=y.displayWidth;this.displayHeight=y.displayHeight;g.find(".x").text(this.displayX+"px");g.find(".y").text(this.displayY+"px");p.find(".width").text(y.displayWidth);p.find(".height").text(y.displayHeight);if(e.layerList instanceof Array){this.layerList=e.layerList;this.lastMeasuredBounds=t.clone(s);this.layerGroupBounds=e.layerList[0].attributes.bounds;this.placePopupOutOfTheWay(e.layerList)}else{this.layerModel=e.layerModel;this.placePopupRelativeToLayerElement(e.layerModel)}},placePopupRelativeToLayerElement:function(i){var s,r=this.$el.find(".notch"),a=this.$el.find("#copyTextLink"),c=this.$el.find(".measurementElementInfoPos"),p=l.getPSDModel();r.show();c.show();i&&i.get("type")===n.Type.LAYER_TEXT?a.removeClass("disabled"):a.addClass("disabled");if(i){var g=d.getLayerInfoForId(i.attributes.layerId).item;if(this.sourceElement!==g){this.sourceElement=g;s=u.getVisibleBounds(i,p);this.lastMeasuredBounds=t.clone(s);this.layerBounds=o.zoomRect(s);var m=null,v=this.$el.find("#shiftClickMeasurementNotification");if(0===v.length&&h.shouldInterceptBeShown(n.InterceptNames.SHIFT_CLICK_MEASUREMENT)){m=new f;this.$el.append(m.$el);this.$el.find("#shiftClickMeasurementNotification").css({width:Math.floor(this.$el.width()-9)})}this.handleShow({sourceElement:e(this.sourceElement)});m&&this.$el.hasClass("top")&&this.$el.prepend(m.$el)}}else{this.closePopup();this.sourceElement=null}},placePopupOutOfTheWay:function(t){var i,n,s,r=this.$el.find(".notch"),a=this.$el.find(".measurementElementInfoPos"),o=this.$el.find("#copyCSSLink"),l=this.$el.find("#copyTextLink"),d=e("#popupOverlay"),c=e("div.psd-preview-view"),h=c.scrollLeft(),p=c.scrollTop(),g=c.height(),f=c.width()-10,m=Math.min(f,this.$el.parent().width()),v=Math.min(g,this.$el.parent().height()),y=Math.min(Math.floor(v/10),90);r.hide();a.hide();o.addClass("disabled");l.addClass("disabled");var b={left:(m-this.$el.outerWidth())/2+h,top:(v-this.$el.outerHeight())/2+p,right:(m+this.$el.outerWidth())/2+h,bottom:(v+this.$el.outerHeight())/2+p};if(2===t.length){i=d.find("div.measurementOffsetsBanner");n=i.first();s=i.slice(1).first();var w=parseInt(n.css("left"),10),S=parseInt(n.parent().css("left"),10),C=n.parent().parent().offset().left,x=parseInt(n.css("top"),10),T=parseInt(n.parent().css("top"),10),E=n.parent().parent().offset().top,I=w+S+C-d.offset().left,M=x+T+E-d.offset().top,P={left:I,top:M,right:I+n.outerWidth(),bottom:M+n.outerHeight()},A={left:0,top:0,right:0,bottom:0};if(1===s.length){w=parseInt(s.css("left"),10);S=parseInt(s.parent().css("left"),10);C=s.parent().parent().offset().left;x=parseInt(s.css("top"),10);T=parseInt(s.parent().css("top"),10);E=s.parent().parent().offset().top;I=w+S+C-d.offset().left;M=x+T+E-d.offset().top;A={left:I,top:M,right:I+s.outerWidth(),bottom:M+s.outerHeight()}}if(u.boundsIntersect(P,b)||u.boundsIntersect(A,b)){b.top=y+c.scrollTop();b.bottom=b.top+this.$el.outerHeight();if(u.boundsIntersect(P,b)||u.boundsIntersect(A,b)){b.top=v-this.$el.outerHeight()-y+e("div.psd-preview-view").scrollTop();b.bottom=b.top+this.$el.outerHeight()}}}this.$el.show();this.$el.css({left:b.left,top:b.top})},getSourceXOffset:function(){return this.layerBounds.left},getSourceYOffset:function(){return this.layerBounds.top},getSourceOuterWidth:function(){return this.layerBounds.right-this.layerBounds.left},getSourceOuterHeight:function(){return this.layerBounds.bottom-this.layerBounds.top},destroy:function(){this.extractAssetPopup&&graphite.events.trigger("hide-extract-asset-popup");graphite.events.off(null,null,this)}});return v});define("vanilla-extract/public/js/core/views/templates/measurementOffsetsBoxTemplate.html",[],function(){return'<div id="measurementOffsetsBox" class="measurementOffsetsBox">\n    <canvas id="measurementOffsetsCanvas" class="measurementOffsetsCanvas">\n    </canvas>\n</div>'});define("vanilla-extract/public/js/core/views/templates/measurementOffsetsBannerTemplate.html",[],function(){return'<div id="measurementOffsetsBanner" class="measurementOffsetsBanner measurementPopup popup measurementTooltip">\n    <span id="measurementOffsetX" class="noWrap copyable"><i class="xOffsetIcon"></i>20</span><br/>\n    <span id="measurementOffsetY" class="noWrap copyable"><i class="yOffsetIcon"></i>200</span>\n    <div class="notch"></div>\n</div>'});define("vanilla-extract/public/js/core/views/popup/MeasurementOffsetPopupView",["jquery","underscore","backbone","../../Constants","../popup/BasePreviewPopupView","../../controllers/ZoomController","../../controllers/ClipboardController","../../models/PSDSettingsModel","../../models/UserSettingsModel","../../utils/TemplateUtil","../templates/measurementOffsetsBoxTemplate.html","../templates/measurementOffsetsBannerTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h){"use strict";var p=s.extend({showParams:null,initialize:function(){s.prototype.initialize.apply(this,arguments);graphite.events.on("preferredMeasurementUnitsChanged",this.handlePreferredMeasurementUnitsChanged,this);graphite.events.on("designedAtMultiplierChanged",this.designedAtMultiplierChanged,this)},render:function(){s.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(d.createTemplate(c));return this},designedAtMultiplierChanged:function(){this.updateMeasurementDisplay()},handlePreferredMeasurementUnitsChanged:function(){this.updateMeasurementDisplay()},handleShowMeasurementInfo:function(i){this.showParams=e.extend(!0,{},i);if(i.bounds){graphite.events.trigger("show-measurement-offsets");var n=this.$el.find("#measurementOffsetsBox"),s=r.zoomRect(i.bounds),o=s.width-2,l=s.height-2;n.css({top:s.top+"px",left:s.left+"px",height:Math.max(1,l),width:Math.max(1,o)});var c=this.$el.find("#measurementOffsetsCanvas");c[0].width=Math.max(1,s.width);c[0].height=Math.max(1,s.height);var p=c[0].getContext("2d");this.$el.show();p.lineWidth=1;p.strokeStyle="#000";var u=3,g=Math.floor(o/2)+.5,f=Math.floor(l/2)+.5;p.moveTo(0,f);if(l>=5){if(o>2*(u+3)){p.lineTo(u,f-u);p.stroke();p.moveTo(0,f);p.lineTo(u,f+u);p.stroke();p.moveTo(0,f)}p.lineTo(o,f);p.stroke();if(o>2*(u+3)){p.lineTo(o-u,f-u);p.stroke();p.moveTo(o,f);p.lineTo(o-u,f+u);p.stroke()}}if(o>=5){if(l>2*(u+3)){p.moveTo(g,0);p.lineTo(g-u,u);p.stroke();p.moveTo(g,0);p.lineTo(g+u,u);p.stroke()}p.moveTo(g,0);p.lineTo(g,l);p.stroke();if(l>2*(u+3)){p.lineTo(g-u,l-u);p.stroke();p.moveTo(g,l);p.lineTo(g+u,l-u);p.stroke()}}n.append(d.createTemplate(h));var m=this.$el.find(".copyable"),v=a.getClipboard();t.each(m,function(e){v.clip(e)});this.updateMeasurementDisplay();var y=this.$el.find("#measurementOffsetsBanner");y.click(function(e){e.stopPropagation()});var b=this.$el.find(".notch");b.show();var w=(o-y.outerWidth())/2,S=0;if(o>=y.outerWidth()+2*(u+3)&&l>=y.outerHeight()+2*(u+3)){S=(l-y.outerHeight())/2;b.hide()}else{S=l+6;S+y.outerHeight()>e("#selection-overlay").height()&&(S=-y.outerHeight()-6)}y.css({top:S+"px",left:w+"px"});var C=20,x=Math.round((y.outerWidth()-C)/2);b.css({left:x,top:"-6px"})}else this.closePopup()},updateMeasurementDisplay:function(){var t=e.extend(!0,{},this.showParams),i=l.get("preferredMeasurementUnits"),s=o.get("designedAtMultiplier");if(i===n.MeasurementUnitType.PCT){t.containerBounds.width=t.containerBounds.right-t.containerBounds.left;t.containerBounds.height=t.containerBounds.bottom-t.containerBounds.top;t.bounds.width=+(t.bounds.width/t.containerBounds.width*100).toFixed(1);t.bounds.height=+(t.bounds.height/t.containerBounds.height*100).toFixed(1)}else{t.bounds.width=Math.round(t.bounds.width/s);t.bounds.height=Math.round(t.bounds.height/s)}this.$el.find("#measurementOffsetX").html('<i class="xOffsetIcon"></i>'+t.bounds.width+i);this.$el.find("#measurementOffsetY").html('<i class="yOffsetIcon"></i>'+t.bounds.height+i)}});return p});define("vanilla-extract/public/js/core/views/templates/measurementTooltipTemplate.html",[],function(){return'<div id="measurementTooltipInfo" class="measurementTooltip">\n    <div class="measurementElementInfoDim">W: 0 <br/>H: 0</div>\n    <div class="measurementElementInfoPos">X: 0 <br/>Y: 0</div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/popupOverlayTemplate.html",[],function(){return'<div id="popupOverlay"></div>'});define("vanilla-extract/public/js/core/views/preview/PopupOverlayView",["jquery","underscore","backbone","../../Constants","../../controllers/SelectionController","../../controllers/ZoomController","../../models/UserSettingsModel","../../utils/MeasurementUtil","../../utils/ScrollUtils","../../utils/TemplateUtil","../popup/MeasurementPopupView","../popup/MeasurementOffsetPopupView","../templates/measurementTooltipTemplate.html","../templates/popupOverlayTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u){"use strict";var g=i.View.extend({bShowMeasurementOnHover:!1,measurementPopupView:null,measurementTooltip:null,mouseOverElement:null,lastMouseX:0,lastMouseY:0,lastItemMousedOver:null,initialize:function(){this.bShowMeasurementOnHover=!1;this.measurementTooltip=null;this.mouseOverElement=null;this.render()},render:function(){this.setElement(d.createTemplate(u));var e=d.createTemplate(p);this.$el.append(e);this.measurementTooltip=this.$el.find("#measurementTooltipInfo");this.measurementTooltip.hide();this.addHandlers()},addHandlers:function(){graphite.events.on("selection-changed",this.refreshSelection,this);graphite.events.on("preview-scroll-end",this.showMeasurementPopups,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this);graphite.events.on("toggle-hover-measurement",this.toggleHoverMeasurement,this);graphite.events.on("multiSelectPending",this.handleMultiSelectPending,this);graphite.events.on("mouseMoved",this.handleMouseMoved,this)},handleMouseMoved:function(e){if(e){this.bShowMeasurementOnHover&&e.itemMousedOver?this.syncMeasurementTooltip(e.x,e.y,e.itemMousedOver):this.measurementTooltip.hide();this.lastMouseX=e.x;this.lastMouseY=e.y;this.lastItemMousedOver=e.itemMousedOver}else{this.lastItemMousedOver=null;this.measurementTooltip.hide()}},handleMultiSelectPending:function(e){this.isMultiSelectPending=e;this.measurementPopupView&&(e?this.measurementPopupView.hide():this.measurementPopupView.show())},handleZoomChanged:function(){this.refreshSelection()},refreshSelection:function(){var e=this;this.$el.children().remove();t.delay(function(){l.isScrollNeeded||e.showMeasurementPopups()},50)},showMeasurementPopups:function(){var e,t,i,r,l=s.getSelectedLayers(),d=s.getPSDModel();if(this.measurementPopupView){this.measurementPopupView.destroy();this.measurementPopupView=null}this.measurementTooltip.hide();this.$el.append(this.measurementTooltip);this.bShowMeasurementOnHover&&this.lastItemMousedOver&&this.syncMeasurementTooltip(this.lastMouseX,this.lastMouseY,this.lastItemMousedOver);if(1===l.length){i=l[0];e=new c;this.measurementPopupView=e;this.$el.append(e.el);e.handleShowMeasurementInfo({layerModel:i})}else if(2===l.length){var p,u=o.getVisibleBounds(l[0],d),g=o.getVisibleBounds(l[1],d);if(o.rect1ContainsRect2(u,g))p=u;else if(o.rect1ContainsRect2(g,u))p=g;else{var f=l[0],m=l[1],v=f.getArtboardParent(),y=m.getArtboardParent();p=d.get("isArtboardPSD")&&v&&v===y?v.get("bounds"):d.get("imgdata").bounds}r={top:0,left:0,right:0,bottom:0,height:100,width:100};if(u.top>=g.bottom){r.top=g.bottom;r.height=u.top-g.bottom}else if(g.top>=u.bottom){r.top=u.bottom;r.height=g.top-u.bottom}else{r.top=Math.min(u.top,g.top);r.height=Math.abs(u.top-g.top)}if(u.left>g.right){r.left=g.right;r.width=u.left-g.right}else if(g.left>u.right){r.left=u.right;r.width=g.left-u.right}else{r.left=Math.min(u.left,g.left);r.width=Math.abs(u.left-g.left)}r.right=r.left+r.width;r.bottom=r.top+r.height;t=new h;this.$el.append(t.el);t.handleShowMeasurementInfo({bounds:r,containerBounds:p});if(o.rect1ContainsRect2(u,g)||o.rect1ContainsRect2(g,u)){r.left=Math.min(u.right,g.right);r.width=Math.abs(u.right-g.right);r.top=Math.min(u.bottom,g.bottom);r.height=Math.abs(u.bottom-g.bottom);r.right=r.left+r.width;r.bottom=r.top+r.height;t=new h;this.$el.append(t.el);t.handleShowMeasurementInfo({bounds:r,containerBounds:p})}}if(l.length>=2){a.setInterceptShown(n.InterceptNames.SHIFT_CLICK_MEASUREMENT,!1);e=new c;this.measurementPopupView=e;this.$el.append(e.el);e.handleShowMeasurementInfo({layerList:l})}this.isMultiSelectPending&&e&&e.hide()},positionMeasurementTooltip:function(t,i){this.measurementTooltip.css({left:0,top:0,width:"auto"});var n=this.$el.offset(),s=this.measurementTooltip.width(),r=Math.min(t-n.left+3,this.$el.width()-s,e("#detail-panel").offset().left-s-n.left),a=Math.max(i-n.top-58,0);this.measurementTooltip.css({left:r,top:a,width:s+1+"px"})},syncMeasurementTooltip:function(e,t,i){if(i){if(i!==this.mouseOverElement){this.mouseOverElement=i;var n=o.getMeasurementsOfLayerAgainstPSDBounds(i);this.measurementTooltip.find(".measurementElementInfoDim").html("W: "+n.displayWidth+"<br/> H: "+n.displayHeight);this.measurementTooltip.find(".measurementElementInfoPos").html("X: "+n.left+"px<br/> Y: "+n.top+"px")}this.positionMeasurementTooltip(e,t);this.measurementTooltip.show()}else this.measurementTooltip.hide()},toggleHoverMeasurement:function(){this.bShowMeasurementOnHover=!this.bShowMeasurementOnHover;this.bShowMeasurementOnHover?this.syncMeasurementTooltip(this.lastMouseX,this.lastMouseY,this.lastItemMousedOver):this.measurementTooltip.hide()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return g});define("vanilla-extract/public/js/core/views/templates/lensTemplate.html",[],function(){return'<div class="lens" style="display: none;">\n    <div class="inner">\n        <canvas class="lens-grid" width="70" height="70"></canvas>\n        <div class="center"></div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/workerProgressTemplate.html",[],function(){return'<div id="workerProgress">\n    <div class="worker-status">Processing...</div>\n    <div class="worker-progress-base"><div class="worker-progress-bar"></div></div>\n    <div class="worker-status-tip"><%- tip %></div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/psdPreviewTemplate.html",[],function(){return'<% var w = width || imgdata.bounds.right; %>\n<% var h = height || imgdata.bounds.bottom; %>\n<div class="preview-container" style="width: <%- w %>px; height: <%- h %>px;">\n    <div style="width: <%- w %>px; height: <%- h %>px;" id="psdpreview_bg"></div>\n    <div style="width: <%- w %>px; height: <%- h %>px;" id="psdpreview_root"></div>\n    <img style="width: <%- w %>px; height: <%- h %>px;" id="tempPreview" class="tempPreview">\n    <div id="selection-overlay" style=" width: <%- w %>px; height: <%- h %>px;"></div>\n</div>\n<div class="spinner"></div>'});define("vanilla-extract/public/js/core/views/templates/psdPreviewDivSpriteSheetTemplate.html",[],function(){return'<div class="psd-layer-group" style="top: <%- bounds.top %>px; left: <%- bounds.left %>px; bottom: <%- bounds.bottom %>px; right: <%- bounds.right %>px;" ></div>\n'});define("vanilla-extract/public/js/core/views/templates/psdPreviewLayerTemplate.html",[],function(){return'<canvas class="psd-layer" style="top: <%- bounds.top %>px; left: <%- bounds.left %>px;" ></canvas>\n'});define("vanilla-extract/public/js/core/views/templates/errorNotificationTemplate.html",[],function(){return'<div class="error-notification">\n    <div class="centered-wrapper">\n        <div class="error-icon"></div>\n        <div class="error-msg"><%- messageText %><%= anchor %></div>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/preview/PSDPreviewView",["jquery","underscore","backbone","../../Constants","../../controllers/SelectionController","../../controllers/ZoomController","../../controllers/FlattenedAssetController","../../models/LayerModelMap","../../utils/KeyboardUtils","../../utils/ScrollUtils","../preview/InspectStyleOverlayView","../preview/SelectionOverlayView","../preview/MouseListenerOverlayView","../preview/ArtboardOverlayView","../preview/PopupOverlayView","../../utils/MeasurementUtil","../../utils/TemplateUtil","../templates/lensTemplate.html","../templates/workerProgressTemplate.html","../templates/psdPreviewTemplate.html","../templates/psdPreviewDivSpriteSheetTemplate.html","../templates/psdPreviewLayerTemplate.html","../templates/errorNotificationTemplate.html","plugin-dependencies","plugin-components/image-loader"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f,m,v,y,b,w,S,C,x,T){"use strict";var E=i.View.extend({className:"psd-preview-view",events:{click:"handleClickEvent",mousedown:"handleMouseDownEvent",mouseup:"handleMouseUpEvent",dblclick:"handleDoubleClickEvent"},isClickDrag:!1,extractionStartTime:null,selectionOverlay:null,inspectStyleOverlay:null,mouseListenerOverlay:null,artboardOverlay:null,popupOverlay:null,extractTooltip:null,tempPreviewHidden:!1,initialize:function(){t.bindAll(this,"hideTempPreview","attached","_previewImageDataReceived");this.addHandlers();this.renderProgressPane();this.$defocused=e('<div class="defocused"></div>');this.model.on("change:info",this.handleModelInfoChanged,this);this.model.on("change:extractedStyles",this.handleExtractedStylesChanged,this);this.model.on("change:status",this.handleStatusChanged,this);this.handleStatusChanged()},render:function(){this.renderContainer();this.inspectStyleOverlay=new c({model:this.model});this.selectionOverlay=new h({parentView:this});this.mouseListenerOverlay=new p({model:this.model});this.mouseListenerOverlay.previewView=this;this.artboardOverlay=new u({model:this.model});this.popupOverlay=new g({model:this.model});this.$psdLens=m.createTemplate(v);this.$el.find(".preview-container").append(this.mouseListenerOverlay.el);this.$el.find(".preview-container").append(this.artboardOverlay.el);this.$el.find(".preview-container").append(this.inspectStyleOverlay.el);this.$el.find(".preview-container").append(this.popupOverlay.el);this.mouseListenerOverlay.addHandlers();return this},attached:function(){if(!this.mouseListenerOverlay){if(this.model.get("info"))this.handleModelInfoChanged();else if(this.model.get("width")&&this.model.get("height")){var e=this.model.get("imgdata").bounds;this.renderContainer();e.bottom=this.model.get("height");e.right=this.model.get("width");graphite.events.trigger("zoomToFit",e);this.applyCurrentZoomLevel(!0)}this.model.get("extractedStyles")&&this.handleExtractedStylesChanged()}},handleStatusChanged:function(){var e=this.model.get("status");200>e?this.renderSpinner():e>=400&&this.$el.find(".preview-loading-spinner").remove()},handleModelInfoChanged:function(){graphite.events.trigger("psdModelInfoChanged");this.render()},handleExtractedStylesChanged:function(){e(".preview-loading-spinner").remove();if("complete"===this.model.get("dataType")){this.addLayerSpritesBackToFront(this.model);this.model.set("renderedSprites",!0);graphite.getDetailsController().triggerWhenSpriteSheetsLoaded("drawPreviewFinish")}else{this.populateLayerModelMap(this.model);graphite.getDetailsController().triggerSpriteSheetLoadedEvent("JSONPreviewReady")}},renderSpinner:function(){this.$el.append('<div class="spinner preview-loading-spinner" style="display:block;"></div>')},renderProgressPane:function(){var e=[x.translate("Use shift-click to measure the distance between elements in the PSD view."),x.translate("After extracting assets, find them in the Assets tab where they can be downloaded locally."),x.translate("Select a color swatch in the Styles tab to see where the color is used in your design."),x.translate("You can select multiple layers in the Layers tab and export them as a single image."),x.translate("Select layer comps with the drop down above the PSD view."),x.translate("Zoom in and out on your PSD view using ALT +/-."),x.translate("Use the arrow keys to traverse the layers in your design."),x.translate("Hover over thumbnails in the Layers tab to see a preview for a layer or layer group.")];this.$progressPane=m.createTemplate(y,{tip:x.translate("Tip: ")+e[Math.round(Math.random()*(e.length-1))]});this.$progressPane.hide();this.$el.append(this.$progressPane)},renderContainer:function(){if(0===this.$el.find(".preview-container").length){this.$el.append(m.createTemplate(b,t.defaults(this.model.toJSON(),{width:0,height:0})));this.$tempPreview=this.$el.find("#tempPreview");this._loadPreviewImage()}else{var e=this.$el.find("#psdpreview_root"),i=this.$el.find("#tempPreview"),n=this.$el.find(".center-helper"),s=this.model.get("imgdata").bounds,a={width:s.right,height:s.bottom};e.css(a);i.css(a);n.css("margin-bottom",-(s.bottom/2+50)+"px");r.zoomElementScale(e);r.zoomElementScale(i)}this.$el.removeClass("preview-rendered")},showProgressPane:function(t){if(!this.workerProgressShown){this.$el.addClass("worker-progress-shown");e(".worker-status").text(x.translate("Processing")+" 0%...");e(".worker-progress-bar").css("width",0);this.$progressPane.show();this.workerProgressShown=!0}this.workerGuid=t},hideProgressPane:function(t){if(-1===t||this.workerGuid===t){this.$el.find(".preview-loading-spinner").remove();this.$el.removeClass("worker-progress-shown");e(".worker-status").text(x.translate("Processing")+" 100%");e(".worker-progress-bar").width("100%");this.$progressPane.fadeOut(300);this.workerProgressShown=!1;this.workerGuid=null}},updateProgressPane:function(t,i,n){var s,r;this.workerProgressShown||t!==this.model.get("id")||this.showProgressPane(t);if(this.workerGuid===t){if("queued"===i){s=x.translate("Job queued...");e(".worker-progress-bar").width(0)}else{r=(isNaN(n)?0:Math.round(n))+"%";s=x.translate("Processing")+" "+r+"...";e(".worker-progress-bar").width(r)}e(".worker-status").text(s)}},addHandlers:function(){graphite.events.on("drawPreviewFinish",this.hideTempPreview,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this);graphite.events.on("flattenedSpriteUpdated",this.updateFlattenedLayers,this);graphite.events.on("layerCompChanging",this.layerCompChanging,this);graphite.events.on("showWorkerProgress",this.showProgressPane,this);graphite.events.on("hideWorkerProgress",this.hideProgressPane,this);graphite.events.on("updateWorkerProgress",this.updateProgressPane,this);graphite.events.on("jsonExtractionFailure",this.handleJSONExtractionFailure,this);graphite.events.on("dropperStart",this.handleDropperStart,this);graphite.events.on("dropperStop",this.handleDropperStop,this);graphite.events.on("extract-asset-download-init",this.handleAssetExtractInit,this);graphite.events.on("assetExtracted",this.handleAssetExtracted,this);graphite.events.on("assetExtractionFailure",this.handleAssetExtracted,this);graphite.events.on("multiSelectPending",this.handleMultiSelectPending,this);graphite.events.on("selection-changed",this.handleSelectionChanged,this)},convertClientPtToPSDPt:function(e,t){var i=this.$el.find(".preview-container"),n=i.offset(),s=i.css("padding-top"),a=i.css("padding-left"),o={x:e-n.left-parseInt(a,10),y:t-n.top-parseInt(s,10)};o=r.zoomPoint(o,!0);return o},isItemSelected:function(e){var t,i;for(t in s.selectionMap)if(s.selectionMap.hasOwnProperty(t)){i=s.selectionMap[t];if(e===i)return!0}return!1},getPriorityLayers:function(){var e,t,i,n,s,r,a=[],o={};a.push(this.model.get("extractedStyles").colorUsageModels);a.push(this.model.get("extractedStyles").textStyleUsageModels);a.push(this.model.get("extractedStyles").gradientUsageModels);for(n=0;n<a.length;n++){e=a[n];for(r=0;r<e.length;r++){t=e[r];i=t.get("layers");for(s=0;s<i.length;s++)o[i[s].get("layerId")]=!0}}return o},shouldFlattenedParentObscure:function(e,t){var i=e.getArtboardParent(),n=t.getArtboardParent();return!n||i&&i.isEqual(n)},addLayerSpritesBackToFront:function(e){for(var i,r,l,d,c,h,p,u,g=[],v=e,y=[],b=this.$el.find("#psdpreview_root"),C=0,x=[];v;){p=v.get("type")===n.Type.LAYER_GROUP||v.get("type")===n.Type.LAYER_ARTBOARD;i=v.get("parentModel");if(i){r=p?w:S;l=m.createTemplate(r,v.toJSON());v.get("type")===n.Type.LAYER_ARTBOARD&&l.addClass("artboard");d=null;c=v.get("bounds");f.setLayerBounds(l,!1,v,i,s);l.attr("id","layer"+v.get("layerId"));v.isVisibleOnStage()?l.show():l.hide();h=o.getLayerInfoForId(i.get("layerId"))?o.getLayerInfoForId(i.get("layerId")).item:null;h||(h=b);if(v.get("flattenedSprite")){d=m.createTemplate(S,v.toJSON());d.attr("id","flattenedLayer"+v.get("layerId"));var T=f.setLayerBounds(d,!0,v,i,s);h.append(d);a.applyParentAndPosition(v,T,d,v.get("flattenedSprite"));y.push(v);p||l.css("visibility","hidden");for(var E=x.length-1;E>=0;--E)if(this.shouldFlattenedParentObscure(x[E].model,v)){x[E].item.css("visibility","hidden");x.splice(E,1)}}if(v.get("flattenedParent")){var I=o.getLayerModelFromId(v.get("flattenedParent"));I?this.shouldFlattenedParentObscure(v,I)&&l.css("visibility","hidden"):x.push({item:l,model:v})}o.addLayerToMap(v.get("layerId"),l,d,v);d&&this.loadSpriteSheet(d,v,v.get("flattenedSprite"),!0);if(p){if(v.get("properties")&&v.get("properties").get("blendOptions")){var M=v.get("properties").get("blendOptions"),P=M.opacity>=0?M.opacity/100:1,A=M.fillOpacity>=0?M.fillOpacity/100:1;l.css("opacity",P*A)}}else this.loadSpriteSheet(l,v,v.get("spriteSheet"));h.append(l);this.addEventHandlers(v,h,b)}u=v.get("layerCollection");u&&u.each(function(e){e.set("parentModel",v);e.set("zIndex",C);C++;g.push(e)});v=g.shift()}t.each(y,function(e){var i,n,s=e.get("flattenedSprite"),r=!0;t.each(s.includedLayers,function(e){i=o.getLayerModelFromId(e);i.getEffectiveVisibility()&&(r=!1)});if(r){n=o.getLayerInfoForId(e.get("layerId")).flattenedItem;n&&n.css("visibility","hidden")}})},loadImage:function(e,t,i){if(t.right!==t.left&&t.top!==t.bottom){var s=new Image,r=graphite.getServerAPI().getLayerURL(this.model.id,e.get("layerId"));s.title=e.get("layerId");s.addEventListener("load",function(){var t=o.getLayerInfoForId(this.title).item;(e.get("type")===n.Type.LAYER_GROUP||e.get("type")===n.Type.LAYER_ARTBOARD)&&(t=t.children().first());var s=t[0].getContext("2d");s.drawImage(this,0,0);i||t.css("display","none");e.set("rendered",!0)},!1);graphite.getServerAPI().loadCrossDomainImage(s,r)}},populateLayerModelMap:function(e){var t,i=[],n=e,s=this.$el.find("#psdpreview_root"),r=function(e){e.set("parentModel",n);i.push(e)};o.reset();for(;n;){n.get("parentModel")&&o.addLayerToMap(n.get("layerId"),s,null,n);t=n.get("layerCollection");t&&t.each(r);n=i.shift()}},loadSpriteSheet:function(e,t,i,s){var r=t.get("type")===n.Type.LAYER_GROUP||t.get("type")===n.Type.LAYER_ARTBOARD,a=t.get("flattenedSprite");void 0===i||r&&!a||(i.sheetID?graphite.getDetailsController().drawSpriteSheet(i.sheetID,this.drawSprite(e,t,s)):i.color&&this.drawRectangle(t,i.color,i.opacity))},drawSprite:function(e,t,i){return function(n){var s=e[0].getContext("2d"),r=t.get("flattenedSprite"),a=i&&r?r.bounds:t.get("spriteSheet").bounds,o=a.right-a.left,l=a.bottom-a.top;s.drawImage(n,a.left,a.top,o,l,0,0,o,l)}},drawRectangle:function(e,t,i){var n=o.getLayerInfoForId(e.get("layerId")).item,s=e.get("bounds"),r=n[0].getContext("2d");r.globalAlpha=i/255;r.beginPath();r.rect(0,0,s.right-s.left,s.bottom-s.top);r.fillStyle="rgb("+t.red+","+t.green+","+t.blue+")";r.fill()},addEventHandlers:function(e,t,i){var n=this;e.on("change:visible",function(){n.layerVisibilityChanged(this)});e.on("focus",function(){0===i.find(n.$defocused).length&&i.append(n.$defocused);var e="#layer"+this.get("layerId");t.find(e).addClass("focused");n.groupExpanded(this)})},groupExpanded:function(e){this.refreshVisibilityForFocus(e);var t=e.get("parentModel");t.get("info")||this.groupExpanded(t)},refreshVisibilityForFocus:function(e){if(e.get("type")!==n.Type.LAYER_GROUP&&e.get("type")!==n.Type.LAYER_ARTBOARD)this.refreshVisibilityForItem(e);else{var t=e.get("layerCollection"),i=this;t&&t.each(function(e){i.refreshVisibilityForItem(e)})}},refreshVisibilityForItem:function(e){
var t=o.getLayerInfoForId(e.get("layerId")).item,i=e.get("clippedLayers"),n=this;e.isVisibleOnStage()?t.show():t.hide();i&&i.forEach(function(e){n.refreshVisibilityForItem(e)})},layerVisibilityChanged:function(e){this.updateFlattenedLayers(e);this.refreshVisibilityForItem(e)},updateFlattenedLayers:function(e){var i,s,r,l=e.get("flattenedParent"),d=o.getLayerModelFromId(l),c=e.get("flattenedSprite"),h=!0,p=[],u=[],g=[],f=this;if(d||c){d=d||e;g.push(d)}else(e.get("type")===n.Type.LAYER_GROUP||e.get("type")===n.Type.LAYER_ARTBOARD)&&(g=e.findDescendantFlattenedSprites());t.each(g,function(e){c=e.get("flattenedSprite");if(c){i=o.getLayerInfoForId(e.get("layerId")).flattenedItem;u.push({layer:e,flattenedSprite:c,$flattenedSpriteElem:i})}});t.each(u,function(e){h=!0;c=e.flattenedSprite;i=e.$flattenedSpriteElem;t.each(c.includedLayers,function(e){s=o.getLayerModelFromId(e);r=o.getLayerInfoForId(s.get("layerId")).item;p.push({model:s,$elem:r,elemVisibility:r.css("visibility")});h&&!s.isEffectiveRenderedVisibility()&&(h=!1)});if(h){i.css("visibility","visible");f._flattenLayerElems(!0,p);a.validateSprite(e.layer)}else{i.css("visibility","hidden");f._flattenLayerElems(!1,p);a.invalidateSprite(e.layer)}})},handleClickEvent:function(t){if(!e(t.target).parents(".popup").length&&!e(t.target).hasClass("popup")){var i=graphite.getDetailsController().get("activeTool");if(i===n.Tool.SELECT_DIRECT){s.set("shouldScrollLayers",!0);var r=this.convertClientPtToPSDPt(t.clientX+e(document).scrollLeft(),t.clientY+e(document).scrollTop());s.selectItemAtPoint(r.x,r.y,l.isMultiSelectKey(t));t.stopPropagation()}}},logCanvasClick:function(e,t,i){var n=this.convertClientPtToPSDPt(t,i),r=s.itemAtPoint(n.x,n.y),a=r?r.get("type"):"nothingUnderCursor";graphite.events.trigger("canvasClick",{type:e,layerType:a})},handleDoubleClickEvent:function(e){this.logCanvasClick("doubleClick",e.clientX,e.clientY)},handleMouseDownEvent:function(t){if(2===t.button)this.logCanvasClick("rightClick",t.clientX,t.clientY);else if(0===t.button){var i={x:t.pageX,y:t.pageY};e(window).on("mousemove.dragDetect",function(t){this.isClickDrag=!0;if(Math.abs(t.pageX-i.x)>20||Math.abs(t.pageY-i.y)>20){graphite.events.trigger("canvasClickDrag");e(window).off(".dragDetect")}})}},handleMouseUpEvent:function(){e(window).off(".dragDetect");this.isClickDrag=!1},layerCompChanging:function(){this.$el.find(".preview-loading-spinner").remove();this.renderSpinner()},handleAssetExtractInit:function(e){this.extractionStartTime=(new Date).getTime();graphite.inPublicOneUp()||this.showSuccessTooltip(x.translate("Extracting asset. Look for it in the Assets tab."))},handleAssetExtracted:function(e){if(this.extractTooltip){var t=n.NotificationTooltip.MIN_DURATION-((new Date).getTime()-this.extractionStartTime);if(0>=t){this.extractTooltip.remove();this.extractTooltip=null}else setTimeout(this.handleAssetExtracted.bind(this),t)}},handleMultiSelectPending:function(e){var t=s.getSelectedLayers();this.$el.toggleClass("measure-pending",e&&1===t.length)},handleSelectionChanged:function(e){var t,i,n=s.getSelectedLayers();1!==n.length&&this.$el.removeClass("measure-pending");if(n.length>=1){t=f.calcLayerGroupBounds(n,s.getPSDModel());t=r.zoomRect(t);i=this.$el[0].getBoundingClientRect();t.top+=i.top-this.$el.scrollTop();t.bottom+=i.top-this.$el.scrollTop();t.left+=i.left-this.$el.scrollLeft();t.right+=i.left-this.$el.scrollLeft();e||d.scrollRectIntoView(this.$el,t)}},showSuccessTooltip:function(t){if(!this.extractTooltip){var i=this.$el.find("div.blueHUD"),n=i.parent();n.append('<div id="notificationTooltip"><span>'+t+"</span></div>");this.extractTooltip=e("#notificationTooltip");this.extractTooltip.width(i.outerWidth()-(this.extractTooltip.outerWidth()-this.extractTooltip.width()));var s,r=Math.round(i.position().left)+13+n.scrollLeft(),a=this.extractTooltip.outerHeight();s=i.hasClass("bottom")?i.position().top+i.outerHeight():i.position().top-a-15;this.extractTooltip.css({top:s,left:r});this.extractTooltip.fadeIn(250)}},setBackgroundWhite:function(){var e=this.$el.find("#psdpreview_root");e.css("background","white")},showErrorNotification:function(e){var t=x.utils.getCurrentBasePath(),i=graphite.inPublicOneUp();e.anchor="";if("file"===t||"link"===t){var n=i?x.translate("Go to Comments to preview the PSD."):x.translate("Go to Details to preview the PSD.");e.anchor=' <a class="details-anchor">'+n+"</a>"}if(this.$notification){this.$notification.find(".details-anchor").off(".details");this.$notification.remove();this.$notification=null}this.$el.append(m.createTemplate(C,e));this.$notification=this.$el.find(".error-notification");var s=this.$el.find(".details-anchor");s.length&&s.on("click.details",function(e){e.preventDefault();x.events.trigger("plugin.show",i?"ccweb.files.activity_public":"ccweb.files.details")});this.$el.addClass("has-error");graphite.events.trigger("errorNotificationShown")},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},remove:function(){a.reset();this.inspectStyleOverlay&&this.inspectStyleOverlay.remove();this.selectionOverlay&&this.selectionOverlay.remove();this.mouseListenerOverlay&&this.mouseListenerOverlay.remove();this.artboardOverlay&&this.artboardOverlay.remove();this.popupOverlay&&this.popupOverlay.remove();if(this.$progressPane){this.$progressPane.remove();this.$progressPane=null}if(this.$psdLens){this.$psdLens.remove();this.$psdLens=null}if(this.$notification){this.$notification.find(".details-anchor").off(".details");this.$notification.remove();this.$notification=null}this.inspectStyleOverlay=null;this.selectionOverlay=null;this.mouseListenerOverlay=null;this.artboardOverlay=null;this.popupOverlay=null;this.removeEventListeners();return i.View.prototype.remove.call(this)},_loadPreviewImage:function(){if(T){var e={id:this.model.get("assetId"),modified:this.model.get("modified"),height:this.model.get("width"),width:this.model.get("height"),type:this.model.get("type"),name:this.model.get("fileName"),link:graphite.linkId};T(e,this._previewImageDataReceived)}else if(!this.model.get("localContent")&&!this.model.get("layerCompId"))if(x.utils.hasFeature("temp_extract_use_webtier")){var t=this;graphite.getStorageServiceAPI().storagePath(this.model.get("id")).then(function(e){t.$tempPreview.attr("src",graphite.getServerAPI().getDefaultRenditionURL(e))})}else this.$tempPreview.attr("src",graphite.getServerAPI().getDefaultRenditionURL(this.model.get("id")))},_previewImageDataReceived:function(t){if(t&&t.length&&-1===t.attr("src").indexOf(x.utils.getFileIconPath())){var i=this.model.get("width"),n=this.model.get("height"),s=e('<canvas id="tempPreview" class="tempPreview"></canvas>'),a=s[0].getContext("2d");s.css({width:i+"px",height:n+"px"});s[0].width=i;s[0].height=n;t[0].width&&t[0].height&&a.drawImage(t[0],0,0,t[0].width,t[0].height,0,0,i,n);this.$tempPreview.replaceWith(s);this.$tempPreview=s;r.zoomElementScale(this.$tempPreview);this.tempPreviewHidden&&this.hideTempPreview()}},_flattenLayerElems:function(e,i){var n=e?"hidden":"visible";t.each(i,function(t){t.model.set("isFlattened",e);t.elemVisibility!==n&&t.$elem&&t.$elem.css("visibility",n)})},handleZoomChanged:function(e){this.applyCurrentZoomLevel(!1,e)},hideTempPreview:function(){var e;this.$el.addClass("preview-rendered");this.tempPreviewHidden=!0;var t=s.getPSDModel();if(t.get("isArtboardPSD")){this.$el.find("div.preview-container").addClass("artboard");this.$el.find("#psdpreview_root").addClass("artboard");e=t.get("artboards");e&&this.$el.find("#psdpreview_root").css("background-color","rgb("+parseInt(e.canvasColor.red,10)+", "+parseInt(e.canvasColor.green,10)+", "+parseInt(e.canvasColor.blue,10)+")");graphite.events.trigger("zoomToFit",t.get("artboardsBounds"));graphite.events.trigger("artboardpsd-shown")}else{graphite.events.trigger("zoomToFit",t.get("imgdata").bounds);graphite.events.trigger("nonartboardpsd-shown")}},applyCurrentZoomLevel:function(e,t){var i=this.$el.find("div.preview-container"),a=this.$el.find("#psdpreview_bg"),o=this.$el.find("#psdpreview_root"),l=this.$el.find("#tempPreview"),d=this.$el.find("#selection-overlay"),c=this.model.get("imgdata").bounds,h={width:c.right,height:c.bottom};r.zoomElementSize(d,h);if(!this.tempPreviewHidden||e){var p=this.$el.outerWidth()-n.PREVIEW_SCROLLBAR_SPACING,u=this.$el.outerHeight()-n.PREVIEW_SCROLLBAR_SPACING,g=r.zoomSize(h),f=Math.max(0,Math.round((p-g.width)/2)),m=Math.max(0,Math.round((u-g.height)/2));(f>0||m>0)&&i.css({top:m,left:f});r.zoomElementScale(l);r.zoomElementSize(i,h);r.zoomElementSize(a,h);r.zoomElementScale(o)}else r.zoomAndScrollElements(o,this.$el,t,i,a,h,s.getPSDModel().get("isArtboardPSD"));o.css("overflow",r.getZoomLevel()>1?"visible":"hidden")},handleDropperStart:function(){var t,i=this.$psdLens.find(".lens-grid"),n=e("<canvas/>")[0],r=n.getContext("2d"),a=7,l=3,d=this;e(".vanilla-extract").addClass("dropper-tool");e(".vanilla-extract").append(this.$psdLens);this.$psdLens.hide();n.width=a;n.height=a;this.$el.on("mousedown.dropper",function(e){t&&graphite.events.trigger("commitDropperColor",t)});e(window).on("click.dropper",function(e){s.disableDropperTool();d.$psdLens.css("border-color","");e.preventDefault();e.stopPropagation()});this.$el.on("mouseleave.dropper",function(e){d.$psdLens.hide()});this.$el.on("mouseenter.dropper",function(e){d.$psdLens.show()});this.$el.on("mousemove.dropper",function(c){var h,p=d.convertClientPtToPSDPt(c.clientX-l,c.clientY-l),u={top:Math.round(p.y),left:Math.round(p.x),bottom:Math.round(p.y)+a,right:Math.round(p.x)+a},g=s.findIntersectsBackToFront(u);d.$psdLens.show();r.clearRect(0,0,a,a);for(h=g.length-1;h>=0;h--){var f,m,v=g[h].intersect,y=g[h].item;f=y.get("flattenedSprite")?o.getLayerInfoForId(y.get("layerId")).flattenedItem:o.getLayerInfoForId(y.get("layerId")).item;m=f[0];r.drawImage(m,v.left,v.top,v.width,v.height,v.destLeft,v.destTop,v.width,v.height)}var b=r.getImageData(l,l,1,1);t=null;if(b.data&&b.data.length>=4&&b.data[3]>0){t={};t.red=b.data[0];t.green=b.data[1];t.blue=b.data[2];t.alpha=b.data[3]/255;var w="rgb("+t.red+","+t.green+","+t.blue+")";e(".dropper-item .color-chip").css("background-color",w);d.$psdLens.css("border-color",w)}else{e(".dropper-item .color-chip").css("background-color","");d.$psdLens.css("border-color","")}var S=i[0].getContext("2d");S.webkitImageSmoothingEnabled=!1;S.mozImageSmoothingEnabled=!1;S.msImageSmoothingEnabled=!1;S.clearRect(0,0,10*a,10*a);S.drawImage(n,0,0,a,a,0,0,10*a,10*a);d.$psdLens.css({left:c.clientX+"px",top:c.clientY-e(".vanilla-extract").offset().top+"px"})})},handleDropperStop:function(){e(".vanilla-extract").removeClass("dropper-tool");e(window).off(".dropper");this.$el.off(".dropper");e(".dropper-item .color-chip").css("background-color","");this.$psdLens.hide()}});return E});define("vanilla-extract/public/js/core/views/templates/mobileWarningTemplate.html",[],function(){return'<div class="mobile-styles-toggle"></div>\n<div class="mobile-centered-container">\n    <div class="width-warning"><div class="extract-icon"></div><%-translate("Extract requires a minimum width of 800 pixels")%></div>\n    <div class="mobile-info"><%-translate("View this page on the desktop to get more out of the PSD extraction features.")%></div>\n</div>\n'});define("vanilla-extract/public/js/core/views/templates/psdHeaderTemplate.html",[],function(){return'<div class="psd-header">\n    <div class="psd-header-nowrap">\n        <a class="back-to-files" href="/#"></a>\n        <div class="header-separator"></div>\n        <span class="file-name"><%- imgdata.originalFile %></span>\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/detail/PSDDetailsView",["underscore","backbone","../../controllers/KeyboardController","../../controllers/SelectionController","../../controllers/ZoomController","./DetailPanelView","./HelpView","./SelectionBarView","../assets/ExtractForDeviceDlg","../popup/ExtractAssetView","../popup/ExtractCodeView","../popup/ColorChipPopupView","../popup/LayerThumbPopupView","../popup/AssetThumbPopupView","../popup/ZoomInHintPopupView","../preview/PSDPreviewView","../../Constants","plugin-dependencies","../templates/mobileWarningTemplate.html","../templates/psdHeaderTemplate.html","../templates/errorNotificationTemplate.html","../../utils/TemplateUtil"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f,m,v,y,b,w,S){"use strict";var C=t.View.extend({assetId:null,tagName:"section",detailPanelView:null,previewView:null,extractAssetPopup:null,extractCodePopup:null,colorChipPopup:null,layerThumbPopup:null,assetThumbPopup:null,helpView:null,selectionBar:null,events:{"click .mobile-styles-toggle":"handleMobileStylesToggle","click .modal-window-overlay":"handleClickInModalOverlay"},initialize:function(){this.model.set("previewStarted",Date.now());this.model.on("change:imgdata",this.handleModelImgdataChanged,this);this.model.on("change:renderedSprites",this.handleRenderedSpritesChanged,this);this.model.on("change:status",this.handleStatusChanged,this);this.addHandlers();this.render();this.handleModelImgdataChanged();this.handleStatusChanged()},getDetailPanelView:function(e){return new r(e)},getPSDPreviewView:function(e){return new f(e)},getSelectionBarView:function(e){return new o(e)},getExtractAssetView:function(e){return new d(e)},getExtractCodeView:function(e){return new c(e)},getColorChipPopupView:function(){return new h},getLayerThumbPopupView:function(){return new p},getAssetThumbPopupView:function(){return new u},getZoomInHintPopupView:function(){return new g},getHelpView:function(){return new a},getExtractForDeviceDlg:function(e){return new l(e)},render:function(){s.reset();n.setPSDModel(this.model);graphite.getDetailsController().setPSDModel(this.model);this.detailPanelView=this.getDetailPanelView({model:this.model});this.previewView=this.getPSDPreviewView({model:this.model});this.selectionBar=this.getSelectionBarView({previewView:this.previewView});this.extractAssetPopup=this.getExtractAssetView({model:this.model});this.extractCodePopup=this.getExtractCodeView({model:this.model});this.colorChipPopup=this.getColorChipPopupView();this.layerThumbPopup=this.getLayerThumbPopupView();this.assetThumbPopup=this.getAssetThumbPopupView();this.zoomInHintPopup=this.getZoomInHintPopupView();this.helpView=this.getHelpView();this.extractForDeviceDlg=this.getExtractForDeviceDlg({model:this.model});n.psdView=this.previewView;this.$el.append(S.createTemplate(y));this.$el.append(this.previewView.el);this.$el.append(this.selectionBar.el);this.$el.append(this.detailPanelView.el);this.$el.append(this.extractAssetPopup.el);this.$el.append(this.extractCodePopup.el);this.$el.append(this.colorChipPopup.el);this.$el.append(this.layerThumbPopup.el);this.$el.append(this.assetThumbPopup.el);this.$el.append(this.zoomInHintPopup.el);var e=this.$el.find(".modal-window-overlay");if(0===e.length){this.$el.append('<div class="modal-window-overlay" style="display:none;">');e=this.$el.find(".modal-window-overlay");e.append(this.helpView.el);e.append(this.extractForDeviceDlg.el)}graphite.events.trigger("do-first-use-overlay-check");return this},handleClickInModalOverlay:function(e){"modal-window-overlay"===e.target.className&&graphite.events.trigger("dismiss-modal-views")},handleModelImgdataChanged:function(){this.$el.find(".psd-header").remove();this.$el.append(S.createTemplate(b,this.model.toJSON()));this.$el.find(".psd-header .back-to-files").text(v.translate("Files"));if(void 0!==v.utils.getCurrentPage()){this.$el.find(".psd-header .back-to-files").css("visibility","visible");this.$el.find(".psd-header .header-separator").css("visibility","visible")}else{this.$el.find(".psd-header .back-to-files").css("visibility","hidden");this.$el.find(".psd-header .header-separator").css("visibility","hidden")}},handleMobileStylesToggle:function(){this.$el.toggleClass("mobile-styles-visible")},handleRenderedSpritesChanged:function(){},handleStatusChanged:function(){var e,t=this.model.get("status");if(t>=300){var i=this.model.get("errorInfo");if(i&&i.errorCode===m.WorkerErrorCodes.GRAPHITE_REJECTED){var n=i.errorMessage.match(/File rejected - too many layers \((\d+)\/(\d+)\)/);n||(n=i.errorMessage.match(/File rejected - limits exceeded: {"limitName":"maxLayers","value":(\d+),"limit":(\d+)/));if(n){var s=n[1],r=n[2];e=v.translate("Uh oh, this PSD has an exceptional number of layers and has failed to process. Please keep the number of layers below {0}. This PSD has {1}.",r,s)}else e=v.translate("Uh oh, this PSD has an exceptional number of layers and has failed to process.")}e=e||v.translate("Uh oh, this PSD was not successfully processed because it's not currently compatible with Extract.")}e&&this.showErrorNotification({messageText:e})},addHandlers:function(){i.attachKeyHandlers();graphite.events.on("dismiss-modal-views",this.handleHideModals,this)},handleHideModals:function(){graphite.events.trigger("hide-help-dialog");graphite.events.trigger("hide-extractForDevice-dialog")},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this);i.removeKeyHandlers()},showErrorNotification:function(e){this.previewView&&this.previewView.showErrorNotification(e)},destroyViews:function(t){var i=this;e.each(t,function(e){if(i.hasOwnProperty(e)){i[e].remove();delete i[e]}})},remove:function(){this.removeEventListeners();var e=["detailPanelView","previewView","extractAssetPopup","extractCodePopup","colorChipPopup","layerThumbPopup","assetThumbPopup","helpView","extractForDeviceDlg","selectionBar"];graphite.getDetailsController().setSelectedTab("psdInspectTab");graphite.getDetailsController().setSelectedInspectItem(null);this.destroyViews(e);n.psdView=null;this.$el.empty();this.stopListening();return this}});return C});define("views/CCWebPSDDetailsView",["../vanilla-extract/public/js/core/views/detail/PSDDetailsView"],function(e){"use strict";var t=e.extend({render:function(){e.prototype.render.apply(this,arguments);return this}});return t});define("vanilla-extract/public/js/core/models/ConfigModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{buildSHA:"***gitSHA***"},getBuildNumber:function(){return this.get("buildSHA")}});return i});define("vanilla-extract/public/js/core/models/AuthModel",["jquery","underscore","backbone"],function(e,t,i){"use strict";var n=i.Model.extend({defaults:{access_token:null,expires_in:null,user_data:null,adobeID:null},initialize:function(){var t=this;e.ajax({url:"/api/v1/user/data",type:"GET",async:!1,success:function(e){t.user_data=e.user_data;t.adobeID=e.adobeID}})},invalidate:function(){this.user_data=null},isValid:function(){return this.user_data},isValidWithUserFeature:function(e){return this.isValid()&&this.user_data.accountEnabled?e?this.user_data[e]||!1:!0:!1},isAnalyticsOptIn:function(){var e=!0;this.user_data&&(this.user_data.analyticsOptIn||(e=!1));return e},isAdobeInternalUser:function(){var e=!1;if(this.user_data){var t=this.user_data.email,i=t.lastIndexOf("@");if(-1!==i){var n=t.substr(i+1);n=n.toLowerCase();("adobe.com"===n||"adobetest.com"===n||"601t.com"===n)&&(e=!0)}}return e},setAnalyticsOptIn:function(t){var i={};i.analyticsOptIn=t;var n=JSON.stringify(i),s=this;e.ajax({type:"POST",url:"/api/v1/user/analyticsOptIn",data:n,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){s.user_data.analyticsOptIn=t},error:function(e){}})},getAdobeId:function(){return this.adobeID},getRegisterDate:function(){return this.user_data.registerDate},getAccessToken:function(){var t=this.attributes.access_token;return(new e.Deferred).resolve(t).promise()}});return n});define("vanilla-extract/public/js/core/controllers/AuthController",["jquery","underscore","backbone"],function(e,t,i){"use strict";var n=window.location.protocol+"//"+window.location.host,s=i.Model.extend({authModel:null,getLoginURL:function(){var e=graphite.getEnvironment().getImsAuthEndpoint_Login()+"?client_id="+graphite.getEnvironment().IMS_CLIENT_ID+"&redirect_uri="+n+"/api/v1/login&scope=openid,AdobeID,creative_cloud&dc="+!!window.graphite.isFeatureEnabled("aug21");return e},getLogoutURL:function(){return graphite.getEnvironment().getImsAuthEndpoint_Logout()+"?redirect_uri="+n+"/api/v1/logout&client_id="+graphite.getEnvironment().IMS_CLIENT_ID+"&access_token=null"},setAuthModel:function(e){this.authModel=e},getAuthModel:function(){return this.authModel},setCookie:function(e,t,i){var n="";if(i){var s=new Date;s.setTime(s.getTime()+60*i*60*1e3);n="; expires="+s.toGMTString()}document.cookie=e+"="+t+n+"; path=/"},getCookie:function(e){var t,i,n=document.cookie.split(";");for(t in n)if(n.hasOwnProperty(t)){i=n[t].trim().split("=");i[0].trim();if(i[0]===e)return i[1]}},login:function(){this.authModel.isValid()||graphite.events.trigger("load-login-page",this.getLoginURL())},logout:function(){this.authModel.isValid()&&(document.location=this.getLogoutURL())},reauthenticate:function(){this.authModel.invalidate();this.login()},isLoggedIn:function(){return this.authModel&&this.authModel.isValid()}});return new s});define("vanilla-extract/public/js/core/controllers/ThumbnailController",["backbone","../Constants"],function(e,t){"use strict";var i={drawThumbnail:function(i,n){var s=i.get("id"),r=i.get("md5"),a=this[s],o=this;if(a&&a.image.complete&&a.md5===r)this.makeDrawFunc(a.image,n)();else{a={md5:r,image:new Image};if("application/vnd.adobe.directory+json"===i.get("type")){a.image.addEventListener("load",o.makeDrawFunc(a.image,n));o[s]=a}else{var l,d="/",c=decodeURI(e.history.fragment)||"files",h=i.get("id"),p=i.get("name"),u=t.ThumbnailWidth,g=i.get("height"),f=i.get("width");g>f&&(u=Math.round(g/f*u));if(p){l=c+d+p;graphite.getServerAPI().getRendition(l,u,function(e,t){if(t){a.image.addEventListener("load",o.makeDrawFunc(a.image,n));a.image.src=t;o[h]=a}})}}}},makeDrawFunc:function(e,t){var i=e,n=t;return function(){n.width=e.width;n.height=e.height;var t=n.getContext("2d");t.drawImage(i,0,0)}}};return i});define("vanilla-extract/public/js/core/controllers/ErrorMessageController",["jquery","underscore","backbone","../Constants","plugin-dependencies"],function(e,t,i,n,s){"use strict";var r=i.Model.extend({getErrorMessageForWorkerResult:function(e,t){var i=e.errorCode,r=e.errorMessage;if(null===i||void 0===i)return s.translate("Unknown error generating Parfait data.");if(i===n.WorkerErrorCodes.UNSUPPORTED_INPUTFMT)return s.translate("Could not process file {0}: unsupported image format",t);if(i===n.WorkerErrorCodes.NOINPUTFILE)return s.translate("No files specified for processing");if(i===n.WorkerErrorCodes.GRAPHITE_PROCESSING)switch(r){case n.WorkerErrorMsgs.GR_JSONGENERATION:return s.translate("Error generating Parfait data for {0}",t);case n.WorkerErrorMsgs.GR_THUMBNAIL:return s.translate("Error generating thumbnail for {0}",t);case n.WorkerErrorMsgs.GR_SPRITESHEET:return s.translate("Error generating Parfait sprites for {0}",t);case n.WorkerErrorMsgs.GR_UNKNOWNENCODING:return s.translate("Error creating asset: unknown encoding");case n.WorkerErrorMsgs.GR_MISSINGLAYERSPEC:return s.translate("Error creating asset: missing layer specification");case n.WorkerErrorMsgs.GR_CREATINGASSET:return s.translate("Error creating asset: error encoding asset")}if(i===n.WorkerErrorCodes.GRAPHITE_REJECTED){var a=r.match(/File rejected - too many layers \((\d+)\/(\d+)\)/);if(a){var o=a[1],l=a[2];return s.translate("Currently, processing is limited to files with {0} layers or less. {1} contains {2} layers. Please reduce the numbers of layers in your file.",l,t,o)}return s.translate("Your file exceeds the maximum number of layers supported. Please reduce the number of layers in your file and try again.")}return s.translate("Unknown error generating Parfait data for {0}",t)}});return new r});define("vanilla-extract/public/js/core/views/templates/assetViewLoadingTemplate.html",[],function(){return'<div class="image-wrapper-progress asset-uploading">\n    <div id="stepContainer">\n        <span id="uploadStep"><%-translate("Uploading")%></span>\n        <span id="nextStep"><%-translate("processing step next")%></span>\n    </div>\n    <div id="progressbar" class="progressbar-uploading"></div>\n    <div class="asset-label folder">\n        <div class="name"><%= fileToLoad.name %></div>  \n    </div> \n</div>\n'});define("vanilla-extract/public/js/core/views/templates/assetViewTemplate.html",[],function(){return'<div class="files-list-item" draggable="true" title="<%= name %>">\n    <div class="frame">\n        <div class="imgwrapframe">\n            <div class="imgwrap">\n                <canvas id="assetThumbnail"></canvas>\n            </div>\n        </div>\n        <div class="asset-label file">\n            <div class="name"><%= name %></div>\n            <!--div class="del-button" title=<%-translate("Archive")%>></div-->\n        </div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/assetFolderViewTemplate.html",[],function(){return'<div class="files-list-item" title="<%= name %>">\n    <div class="frame frame-folder">\n        <div class="folder-tab"></div>\n        <div class="folder-body"/>\n    </div>\n    <div class="asset-label folder">\n        <div class="name"><%= name %></div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/landing/AssetView",["jquery","underscore","backbone","plugin-dependencies","../../controllers/AuthController","../../utils/TemplateUtil","../../controllers/ThumbnailController","../../controllers/ErrorMessageController","../../views/templates/assetViewLoadingTemplate.html","../../views/templates/assetViewTemplate.html","../../views/templates/assetFolderViewTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c){"use strict";var h=i.View.extend({tagName:"article",className:"card-asset",initialize:function(){if(void 0===this.model.get("fileToLoad")){var e=new Date(this.model.attributes.created);this.model.attributes.date=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+" "+e.getHours()+":"+e.getMinutes()}this.listenTo(this.model,"change:uploadProgress",this.updateProgress);this.listenTo(this.model,"destroy",this.remove);this.render();this.addHandlers()},render:function(){try{var e;e=void 0!==this.model.get("fileToLoad")?"application/vnd.adobe.directory+json"===this.model.get("type")?c:l:"application/vnd.adobe.directory+json"===this.model.get("type")?c:d;var t=this.$el;t.html(r.createTemplate(e,this.model.toJSON()));var i=t.find("#assetThumbnail");i[0]&&a.drawThumbnail(this.model,i[0])}catch(n){}return this},getAssetCCPath:function(e){var t,n=i.history.fragment||"files";n=n.replace(/\/$/,"");t=decodeURI(n);return t+"/"+e.get("name")},addHandlers:function(){graphite.events.on("uploaded",this.showUploadedAssetPreview,this);var t=this;this.$el.mouseenter(function(){e(t.el).find(".del-button, .download-button").css("opacity","1");e(t.el).find(".del-button").click(function(i){e(this).closest(".frame").css("opacity",.2);graphite.getServerAPI().deleteAsset(t.getAssetCCPath(t.model),t.handleDeleteSuccess.bind(t),t.handleDeleteError.bind(t));i.stopImmediatePropagation()});e(t.el).find(".download-button").click(function(e){t.downloadPSD();e.stopImmediatePropagation()})});this.$el.mouseleave(function(){e(t.el).find(".del-button, .download-button").css("opacity","0")});this.$el.click(function(){if(s.isLoggedIn()){if(!t.model.get("uploadProgress")){var e;if("application/vnd.adobe.directory+json"===t.model.attributes.type){e=t.getAssetCCPath(t.model);i.history.navigate(encodeURI(e),!0)}else if("image/vnd.adobe.photoshop"===t.model.attributes.type){e="asset/psd/"+t.model.get("id").replace(/\//,"_")+"/"+t.getAssetCCPath(t.model);i.history.navigate(encodeURI(e),!0)}}}else{n.notifyUser(n.translate("You are no longer logged in.  Please log in again"));window.location.href=window.location}})},handleDeleteSuccess:function(){this.remove();graphite.events.trigger("update-asset-list-view")},handleDeleteError:function(e){401===e.status&&graphite.events.trigger("reauthenticate")},updateProgress:function(){this.callCount++;var e=this.model.get("uploadProgress");if(e){if(e.status===n.translate("PROCESSING")){this.$(".image-wrapper-progress").removeClass("asset-uploading").addClass("asset-processing");this.$("#progressbar").removeClass("progressbar-uploading").addClass("progressbar-processing");this.model.unset("uploadProgress")}var t="";if(e.percentage){t=Math.floor(e.percentage)+"%";this.$("#progressbar").width(t)}this.$("#uploadStep").text(e.status+" "+t);e.nextStep&&this.$("#nextStep").text(e.nextStep);if(e.workerID){graphite.getServerAPI().setWorkerOnAsset(e.workerID,e.assetID);this.checkWorkerProgress(e.workerID,e.assetID)}}},checkWorkerProgress:function(e,t){function i(e){var t,i=JSON.parse(JSON.parse(e.responseText)),s=i.progress||0,d=null,c="";i.results&&(d=i.results.status);d=d||i.status||"Unknown";if("success"===d){r.model.set("processFinished",Date.now());t={};t.filesize=r.model.get("fileSize");t.processDuration=r.model.get("processFinished")-r.model.get("processStarted");t.totalDuration=r.model.get("processFinished")-r.model.get("uploadStarted");graphite.events.trigger("processed",t);c=n.translate("PROCESSING");r.getModelData(l)}else if("queued"===d){c=n.translate("QUEUED");setTimeout(function(){r.checkWorkerProgress(a,l)},1e3)}else if("failed"===d){t={};t.fileSize=r.model.get("fileSize");t.errorCode=i.errorCode;t.errorMessage=i.errorMessage;graphite.events.trigger("processing-failed",t);graphite.events.trigger("load-alert",o.getErrorMessageForWorkerResult(i,r.model.get("fileToLoad").name));r.model.id=l;graphite.getServerAPI().deleteAsset(r.model.id,r.handleDeleteSuccess,r.handleDeleteError,r);r.model.destroy()}else{c=n.translate("PROCESSING");setTimeout(function(){r.checkWorkerProgress(a,l)},1e3)}r.setProcessingProgressPercent(s,c)}function s(e){r.getModelData(l)}var r=this,a=e,l=t;graphite.getServerAPI().getWorkerStatus(e,i,s,this)},getModelData:function(e){function t(e){var t=JSON.parse(e.responseText);graphite.getServerAPI().setWorkerOnAsset(null,n);t.hasOwnProperty("custom")&&t.custom.hasOwnProperty("graphiteWorker")&&delete t.custom.graphiteWorker;var s={id:n,updated:t.asset.created,created:t.asset.created,mimeType:t.asset.mimeType,metadata:t};i.model.clear();i.model.set(s);i.initialize()}var i=this,n=e;graphite.getServerAPI().getAssetInfo(e,t,null,this)},setProcessingProgressPercent:function(e,t){var i=Math.floor(e)+"%";this.$("#uploadStep").text(t+" "+i);this.$("#progressbar").width(i)},showUploadedAssetPreview:function(i){var n=this;if(this.model.get("name")===i.fileName){var s=i.path||"";s=encodeURI(s);var r=graphite.getServerAPI().createAjaxOptions("GET",s+"/:metadata");e.ajax({type:"GET",url:r.url,headers:r.headers}).done(function(e){t.contains(this.dataTypes,"json")?n.model.set(e):n.model.set(JSON.parse(e));n.model.unset("fileToLoad");var i=new Date(n.model.attributes.created);n.model.attributes.date=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()+" "+i.getHours()+":"+i.getMinutes();n.render()})}},setProcessingView:function(){var e=this.$el;void 0===this.model.get("fileToLoad")&&this.model.set("fileToLoad",{name:this.model.get("metadata").asset.fileName});var t=r.createTemplate(l,this.model.toJSON());e.html(t);this.$(".image-wrapper-progress").removeClass("asset-uploading").addClass("asset-processing");this.$("#progressbar").removeClass("progressbar-uploading").addClass("progressbar-processing")},downloadPSD:function(){var t=this;graphite.events.trigger("downloading-psd");if(!t.$downloadFrame){t.$downloadFrame=e('<iframe class="download-frame"/>');t.$el.append(t.$downloadFrame)}var i=graphite.getServerAPI().getDerivedDownloadURL(t.model.get("id"));graphite.getServerAPI().getAssetETag(t.model.get("id"),function(e){t.$downloadFrame.attr("src",i)},function(e){401===e.status&&graphite.events.trigger("reauthenticate")},this)}});return h});define("vanilla-extract/public/js/core/models/AssetModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{id:null,etag:"",type:"",
url:"",updated:"",created:"",md5:"",width:"",height:"",mimeType:"",collaboration:""},initialize:function(){}});return i});var max_concurrent_uploads=2;define("vanilla-extract/public/js/core/controllers/UploadController",["jquery","../models/AssetModel","plugin-dependencies"],function(e,t,i){"use strict";var n={uploadQueue:[],uploadList:[],fakeArray:[],upload:function(e,i){var n=new t;i=i||e.name;n.set("fileToLoad",e);n.set("name",i);var s=Backbone.history.fragment||"files";n.set("ccPath",s);this.uploadQueue.push({file:e,asset:n});this.processQueue();return n},restoreUploads:function(e){this.uploadList.forEach(function(t){e.add(t.asset)});this.uploadQueue.forEach(function(t){e.add(t.asset)})},hasActiveUploads:function(){return this.uploadQueue.length>0||this.uploadList.length>0},buildQueryString:function(){var e="",t="?";if(graphite.getEnvironment().hasOwnProperty("ssCount")){e=e+t+"sheetCount="+graphite.getEnvironment().ssCount;t="&"}if(graphite.getEnvironment().hasOwnProperty("ssFormat")){e=e+t+"format="+graphite.getEnvironment().ssFormat;t="&"}if(graphite.getEnvironment().hasOwnProperty("ssScale")){e=e+t+"scale="+graphite.getEnvironment().ssScale;t="&"}return e},processQueue:function(){function e(e){s.asset.set("uploadFinished",Date.now());r.uploadList.splice(r.uploadList.indexOf(s),1);if(200===e.status||201===e.status){var t={status:i.translate("UPLOADING"),percentage:100};s.asset.set("uploadProgress",t);s.asset.set("processStarted",Date.now());var n=JSON.parse(e.responseText),o=s.asset.get("uploadFinished")-s.asset.get("uploadStarted"),l={};t={status:i.translate("PROCESSING"),nextStep:i.translate("Almost ready"),assetID:n.assetID,workerID:n.workerID};s.asset.set("uploadProgress",t);s.asset.set("assetId",n.assetID);l.fileSize=s.asset.get("fileSize");l.uploadDuration=o;l.path=a;l.fileName=s.asset.get("name");graphite.events.trigger("uploaded",l)}else 401===e.status?graphite.events.trigger("reauthenticate"):409===e.status?r.failedToUpload(s.asset,s.file,"duplicateFileUploadError"):r.failedToUpload(s.asset,s.file,"validFileUploadError");r.processQueue()}function t(){r.uploadCount=r.uploadCount-1;r.uploadList.splice(r.uploadList.indexOf(s),1);r.failedToUpload(s.asset,s.file,"validFileUploadError");r.processQueue()}function n(e){var t,n;e.lengthComputable?t=Math.floor(e.loaded/e.total*90):e.hasOwnProperty("position")&&(t=Math.floor(e.position/e.totalSize*90));n={status:i.translate("UPLOADING"),percentage:t};s.asset.set("uploadProgress",n)}var s,r=this,a=decodeURI(Backbone.history.fragment),o="/";if(r.uploadList.length<max_concurrent_uploads&&r.uploadQueue.length>0){s=r.uploadQueue.shift();""===a&&(a="/files/"+a);a=o+a+o+s.asset.get("name");a=a.replace(/\/\//,"/");r.uploadList.push(s);graphite.getServerAPI().upload(s,a,e,t,n);s.asset.get("name")||s.asset.set("name",s.file.name);s.asset.set("fileSize",s.file.size);s.asset.set("uploadStarted",Date.now())}},failedToUpload:function(e,t,i){var n={};"validFileUploadError"===i?window.graphite.events.trigger("valid-file-upload-error","validFileUploadError",e.get("name")):"duplicateFileUploadError"===i&&window.graphite.events.trigger("duplicate-file-upload-error","duplicateFileUploadError",e.get("name"));n.filesize=e.get("fileSize");graphite.events.trigger("upload-failed",n);e.destroy()}};return n});define("vanilla-extract/public/js/core/collections/AssetCollection",["backbone","../models/AssetModel"],function(e,t){"use strict";var i="/",n=e.Collection.extend({model:t,initialize:function(t,n){this.path=n&&n.path;if(this.path)this.path="files/"+this.path;else{var s=e.history.fragment||"files";s=s.slice(-1)===i?s.substring(0,s.length-1):s;this.path=s}},parse:function(e){function t(e){if(e.md5){var t=n.path.substr(n.path.length-1)===i?n.path+e.name:n.path+i+e.name;s[t]=e.md5}return"application/vnd.adobe.directory+json"===e.type||"application/x-photoshop"===e.type||"image/vnd.adobe.photoshop"===e.type||"image/x-photoshop"===e.type||"image/photoshop"===e.type||"application/psd"===e.type||"application/photoshop"===e.type}var n=this,s={},r="";e.total_children&&e.total_children>0&&e.children&&(r=e.children.filter(t));graphite.events.trigger("cc-directory-load",{pathMD5Map:s,path:this.path});return r}});return n});define("vanilla-extract/public/js/core/controllers/AssetListController",["jquery","underscore","backbone","../collections/AssetCollection"],function(e,t,i,n){"use strict";var s=i.Model.extend({assetCollection:null,getAssetList:function(e,t,i,s,r){"undefined"==typeof r&&(this.assetCollection=new n([],{path:s}));graphite.getServerAPI().loadAssetCollection(this.assetCollection,e,t,i,s,r);return this.assetCollection}});return new s});define("vanilla-extract/public/js/core/views/templates/assetListViewTemplate.html",[],function(){return'<div class="asset-list-title">\n</div>\n<div class="asset-list-container">\n    <div class="grid" id="gridContainer">\n        <div class="asset_list_view_error">\n            <div class="asset_list_view_error_frame">\n                <div class="asset_list_view_error_text"></div>\n            </div>\n        </div>\n        <img class="centeredWaitImg" id="loadingSpinner" src="/images/files-item-spinner.gif" />\n    </div>\n</div>\n'});define("vanilla-extract/public/js/core/views/templates/uploadFilesHereTemplate.html",[],function(){return'<div id="upload_files_here" class="upload_files_here">\n    <div class="upload_files_here_frame">\n        <div class="upload_files_here_guidance_text"><img src="/images/upload_scrim.png" /><%=translate("Drag and Drop a PSD here")%></div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/dragDropFileCaptureTemplate.html",[],function(){return'<div id="drag_drop_file_capture" class="drag_drop_file_capture">\n    <div class="drag_drop_file_capture_frame">\n        <div class="drag_drop_file_guidance_text"><img src="/images/upload_scrim.png" /><%-translate("Upload PSD")%></div>\n    </div>\n</div>'});define("vanilla-extract/public/js/core/views/templates/uploadTileTemplate.html",[],function(){return'<article id="upload_tile" class="card-asset">\n    <div>\n        <div class="frame upload_tile_frame">\n            <div class="upload_tile_inner_frame">\n                <div id="upload-icon"/>\n                <div class="upload_tile_guidance_text"><%=translate("Drag and Drop a PSD here")%></div>\n            </div>\n        </div>\n    </div>\n</article>'});define("vanilla-extract/public/js/core/views/landing/AssetListView",["jquery","underscore","backbone","plugin-dependencies","./AssetView","../../controllers/UploadController","../../controllers/AuthController","../../controllers/AssetListController","../../utils/TemplateUtil","../templates/assetListViewTemplate.html","../templates/uploadFilesHereTemplate.html","../templates/dragDropFileCaptureTemplate.html","../templates/uploadTileTemplate.html"],function(e,t,i,n,s,r,a,o,l,d,c,h,p){"use strict";function u(e){i.history.navigate(e,!0)}var g=i.View.extend({el:"#results",collection:null,loading:!0,childViews:[],path:null,tagName:"section",initialize:function(e,t){this.scErrorText=null;this.collection=this.getAssetList(this.onAssetCollectionSuccess,this.onAssetCollectionError,this,t);this.path=t;graphite.events.on("update-asset-list-view",function(){this.showUploadGuidance()},this);this.addHandlers();this.render()},addHandlers:function(){this.collection.on("add",this.renderNewAsset,this);this.collection.on("reset",this.onReset,this);var t=this,i=function(e){t.childViews.forEach(function(e){e.stopListening()});t.childViews.length=0;t.collection.fetch()};graphite.events.on("upload-init",this.uploadFiles,this);e(".logo").on("click",i);graphite.events.on("route-change",function(n){if("handleAsset"===n){graphite.events.off("upload-init",t.uploadFiles);e(".logo").off("click",i);t.childViews.forEach(function(e){e.stopListening()});t.childViews.length=0}});graphite.events.on("loadMoreAssets",this.loadMoreAssets,this)},loadMoreAssets:function(e){this.collection=this.getAssetList(this.onAssetCollectionSuccess,this.onAssetCollectionError,this,e.path,e.xChildrenNextStart)},removeEventListeners:function(){this.collection.off(null,null,this);graphite.events.off(null,null,this)},onAssetCollectionSuccess:function(){this.loading&&this.onReset()},onAssetCollectionError:function(e){401===e.status&&graphite.events.trigger("reauthenticate");if((null===this.scErrorText||void 0===this.scErrorText||""===this.scErrorText)&&e.status>=500){this.scErrorText="<em>SharedCloud Services currently unavailable.  Please try again</em>";this.scErrorText=this.scErrorText+'<br/><br/>(HTTP status code: " + response.status + ")'}this.loading&&this.onReset()},onReset:function(){this.loading=!1;this.render();r.restoreUploads(this.collection)},reRender:function(){this.loading=!0;this.collection=this.getAssetList(this.onAssetCollectionSuccess,this.onAssetCollectionError,this,this.path)},getAssetList:function(e,t,i,n,s){return o.getAssetList(e,t,i,n,s)},render:function(){var i=l.createTemplate(d),s=l.createTemplate(c),r=l.createTemplate(h),a=l.createTemplate(p),o=this.collection.models.length>0;this.$el[0]||this.setElement("#results");this.$el.html(i);var g=this.$el.find(".asset-list-container");g.append(s);g.append(r);o&&this.$el.find("#gridContainer").prepend(a);if(this.loading===!1){e("#loadingSpinner").hide();if(this.scErrorText){this.$el.find(".asset_list_view_error_text").html(this.scErrorText);this.$el.find(".asset_list_view_error").show()}else this.showUploadGuidance()}var f=n.translate("Creative Cloud Assets"),m="files",v=this.path?m+"/"+this.path:m,y=v.split("/"),b="",w=this.$el.find(".asset-list-title");t.each(y,function(t){if(t){var i,n=e("<span>");b=b+t+"/";i=b;n.addClass("path-segment");n.text(t.replace(/^files/i,f));w.append(n);n.click(function(e){u(i)})}});if(1===this.collection.models.length&&void 0===this.collection.models[0].id)return this;var S=this;this.$el.find('input[name="uploadPSD"]').on("change",function(i){i.preventDefault();var s=this.files,r=[],a=0,o=this;t.each(s,function(t){var i=t.slice(0,4,"UTF-8"),l=new FileReader,d=t.type,c=t,h=t.name.substr((~-t.name.lastIndexOf(".")>>>0)+2).toLowerCase();l.addEventListener("loadend",function(){"8BPS"===this.result&&r.push(c);a+=1;if(a===s.length){r.length>0&&graphite.events.trigger("upload-init",{files:r});if(r.length!==s.length){graphite.events.trigger("load-alert",n.translate("You can only upload PSD files. "+(s.length-r.length)+" of "+s.length+" files were not uploaded."));graphite.events.trigger("bad-file-type-dragdrop",{extension:h,type:d});window.graphite.events.trigger("bad-file-type-upload","badFileUpload",s.length-r.length,s.length)}e(o).val("")}});l.readAsText(i,"UTF-8")});return!1});t.each(this.collection.models,function(e){S.renderAsset(e)},this);var C=e("#dropzone");if(Modernizr.draganddrop){var x=e("#drag_drop_file_capture");e("#upload_files_here");g[0].ondragover=function(t){if(!e.contains(g[0],x)){x.show();e("#upload_files_here").hide()}return!1};x[0].ondragleave=function(t){if(e.contains(g[0],x[0])){x.hide();S.showUploadGuidance()}};x[0].ondragend=function(t){if(e.contains(g[0],x[0])){x.hide();S.showUploadGuidance()}};x[0].ondrop=function(i){if(e.contains(g[0],x[0])){x.hide();S.showUploadGuidance()}i.preventDefault();var s=i.dataTransfer.files,r=[],a=0;t.each(s,function(e){var t=e.slice(0,4,"UTF-8"),i=new FileReader,o=e.type,l=e,d=e.name.substr((~-e.name.lastIndexOf(".")>>>0)+2).toLowerCase();i.addEventListener("loadend",function(){"8BPS"===this.result&&r.push(l);a+=1;if(a===s.length){r.length>0&&graphite.events.trigger("upload-init",{files:r});if(r.length!==s.length){graphite.events.trigger("load-alert",n.translate("You can only upload PSD files. "+(s.length-r.length)+" of "+s.length+" files were not uploaded."));graphite.events.trigger("bad-file-type-dragdrop",{extension:d,type:o})}}});i.readAsText(t,"UTF-8")});return!1}}else C.hide();return this},renderAsset:function(t){var i=new s({model:t});e("#gridContainer").append(i.el);this.childViews.push(i);e("#upload_files_here").hide()},renderNewAsset:function(t){var i,n=t?t.attributes.type:null;if(!n||"application/x-photoshop"===n||"image/vnd.adobe.photoshop"===n||"image/x-photoshop"===n||"image/photoshop"===n||"application/psd"===n||"application/photoshop"===n||"application/vnd.adobe.directory+json"===n){i=new s({model:t});e("#gridContainer").prepend(i.render().el);this.childViews.push(i)}},remove:function(){this.removeEventListeners();this.$el.empty();this.stopListening();return this},showUploadGuidance:function(){if(0===e("#gridContainer .card-asset").length)e("#upload_files_here").show();else{e("#upload_files_here").hide();e("#upload_tile").show()}},uploadFiles:function(t){if(a.isLoggedIn()){var i,s=t.files;for(i=0;i<s.length;i++){var o=r.upload(s[i]);this.collection.add(o);e("#upload_files_here").hide();var d=e("#gridContainer").find("#upload_tile");0===d.length?d=l.createTemplate(p):d.detach();e("#gridContainer").prepend(d)}}else{n.notifyUser(n.translate("You are no longer logged in.  Please log in again"));window.location.href=window.location}}});return g});define("vanilla-extract/public/js/core/views/templates/interceptBinaryTemplate.html",[],function(){return'<div id="interceptPopupBinary">\n    <%-translate("Did this work as expected?")%>\n    <div class="popup-footer"><span id="interceptYesLink" class="popup-button"><%-translate("Yes")%></span> <span id="interceptNoLink" class="popup-button"><%-translate("No")%></span>\n    </div>\n    <i id="interceptCloseLink" class="popup-close">&times;</i>\n</div>'});define("vanilla-extract/public/js/core/views/popup/InterceptPopupView",["underscore","backbone","../../Constants","../popup/BasePreviewPopupView","plugin-dependencies","../../utils/TemplateUtil","../templates/interceptBinaryTemplate.html"],function(e,t,i,n,s,r,a){"use strict";var o=n.extend({className:"interceptBinary measurementTooltip popup",events:{"click #interceptYesLink":"handleYesClick","click #interceptNoLink":"handleNoClick","click #interceptCloseLink":"handleCloseClick"},initialize:function(){n.prototype.initialize.apply(this,arguments)},render:function(){n.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(r.createTemplate(a));var e=this.$el.find("#interceptYesLink"),t=this.$el.find("#interceptNoLink");e.html(s.translate("Yes"));e.hover(this.highlightLabel,this.unhighlightLabel);t.html(s.translate("No"));t.hover(this.highlightLabel,this.unhighlightLabel);return this},handleYesClick:function(e){this.tryHandler(e,"yes")},handleNoClick:function(e){this.tryHandler(e,"no")},handleCloseClick:function(e){this.tryHandler(e,"close")},tryHandler:function(e,t){e.stopPropagation();this.handlers&&this.handlers[t]&&this.handlers[t]();this.closePopup();this.remove()},setHandlers:function(e){this.handlers=e}});return o});define("vanilla-extract/public/js/core/models/InterceptModel",["jquery","underscore","backbone","../views/popup/InterceptPopupView","./UserSettingsModel"],function(e,t,i,n,s){"use strict";var r=i.Model.extend({defaults:{},configurations:[{segment:"layer-comp-binary",behavior:function(){function e(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"yes"})}function i(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"no"})}function n(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"close"})}var r=this,a=s.get("shownIntercepts");a[r.segment]||window.graphite.events.on("layerCompChanged",function(){var a=t.clone(s.get("shownIntercepts"));if(!a[r.segment]){window.graphite.events.trigger("load-intercept-binary",{style:"top: 33px",handlers:{yes:e,no:i,close:n}});a[r.segment]=!0;s.set("shownIntercepts",a)}})}}],attachListeners:function(){window.graphite.events.on("load-intercept-binary",function(i){t.delay(function(){var t=new n;t.setHandlers(i.handlers);e(t.el).addClass("bottom");i.style&&e(t.el).attr("style",i.style);e("#results").find(".layer-comp-controls").append(t.el);e(t.el).show()},500)},this)},applyBehaviors:function(){this.attachListeners();var e,t=s.get("shownIntercepts");for(e in this.configurations)this.configurations.hasOwnProperty(e)&&!t[this.configurations[e].segment]&&this.configurations[e].behavior()}});return new r});define("vanilla-extract/public/js/core/controllers/InterceptController",["underscore","backbone","../models/InterceptModel"],function(e,t,i){"use strict";var n=t.Model.extend({defaults:{applied:!1},initialize:function(){},applyBehaviors:function(){if(!this.applied){i.applyBehaviors();this.applied=!0}}});return new n});define("vanilla-extract/public/js/core/serverAPI",["jquery","underscore"],function(e,t){"use strict";function i(e,t){var i=graphite.getAuthController().getAuthModel().attributes.access_token;e.setRequestHeader("Authorization","Bearer "+i);e.setRequestHeader("x-api-key",graphite.getEnvironment().API_KEY);h&&e.setRequestHeader("Accept",h)}function n(e,t,n,s){t&&(e.success=function(e,i){t.apply(s,[i])});n&&(e.error=function(e,t){n.apply(s,[t])});e.beforeSend=i;return e}function s(e,t,i,n){t&&(e.success=function(e,i,s){t.apply(n,[s])});i&&(e.error=function(e){i.apply(n,[e])})}function r(e){return e.match(/https:\/\/cc-api/)}function a(e){return e.match(/files|archive/)}function o(e,t){return r(e)?graphite.getEnvironment().url(e+(t?"?"+t:"")):a(e)?graphite.getEnvironment().url(e+(t?"?"+t:""),graphite.getEnvironment().FILESTORAGE_HOST):e+(t?"?"+t:"")}function l(e,t,i,n){if(e.hasOwnProperty("layerId")&&e.layerId===t){e.spriteSheet=i;e.flattenedSprite=n}else{var s;for(s=0;s<Object.keys(e).length;s++)"object"==typeof e[Object.keys(e)[s]]&&l(e[Object.keys(e)[s]],t,i,n)}}function d(e,i){t.each(i.layers,function(t){l(e,t.layerId,t.spriteSheet,t.flattenedSprite)});return e}function c(e,i,n){var s=i.spritesheetJSON,r=i.spritesheets,a=d(e,s);s.pngLocations&&n.set("pngLocations",s.pngLocations);t.each(r,function(e){n.set(e.id,e.dataUrl)});n.parse(a);return n}var h,p={createAjaxOptions:function(e,t){var i="Bearer "+graphite.getAuthController().getAuthModel().attributes.access_token,n={type:e,url:o(t),headers:{Authorization:i,Accept:"*/*","X-api-key":graphite.getEnvironment().API_KEY}};return n},loadAssetCollection:function(e,t,i,s,r,a){var o,l="/files",d=r?l+"/"+r:l;h="application/vnd.adobe.directory+json";d=encodeURI(d);o={url:graphite.getEnvironment().url(d,graphite.getEnvironment().FILESTORAGE_HOST)};n(o,t,i,s);if(a){o.url=o.url+"?start="+a;o.remove=!1}var c=e.fetch(o);c.done(function(){var e=c.getResponseHeader("X-Children-Next-Start");if(e){var t={};t.path=r;t.xChildrenNextStart=e;window.graphite.events.trigger("loadMoreAssets",t)}})},loadAssetMetadata:function(e){return graphite.getStorageServiceAPI().metadata(e)},loadPsdModelFromPath:function(t,i,n,s){var r=graphite.getImageServiceAPI().introspect(t),a=graphite.getImageServiceAPI().spritesheet(t);e.when(r,a).then(function(e,n){t=c(e,n,t);i.apply(s)},function(e){graphite.events.trigger("image-service-error",encodeURI(t.get("path")),!1);n.apply(s)})},getAssetFromUrl:function(e,i){var n={url:e},s=new XMLHttpRequest,r=graphite.getAuthController().getAuthModel().attributes.access_token;s.open("get",n.url,!0);s.responseType="blob";s.setRequestHeader("Authorization","Bearer "+r);s.setRequestHeader("x-api-key",graphite.getEnvironment().API_KEY);s.setRequestHeader("Accept","image/png, image/jpeg, image/jpg, application/pdf, text/html, text/plain, */*;q=0.1");this.customHeader&&t.each(this.customHeader,function(e,t){s.setRequestHeader(t,e)});s.onload=function(e){if(200===s.status){var t=s.response,n=new FileReader;n.addEventListener("loadend",function(){i&&i.apply(null,[n.result])});n.readAsDataURL(t)}};s.onerror=function(e){};s.send(null)},loadLocalPsdModel:function(e,t,i,s,r){var a={url:t};n(a,i,s,r);e.fetch(a)},getDerivedAsset:function(e,t,i,n){return graphite.getImageServiceAPI().createWebAsset(e,t,i,n)},deleteAsset:function(e,t,i){graphite.getStorageServiceAPI().archive(e,t,i)},loadDerivedAssetCollection:function(e,t,i,s,r){var a,o={url:graphite.getEnvironment().url("/createwebasset",graphite.getEnvironment().IMAGE_SERVICE_HOST),reset:!0,post_data:a};n(o,i,s,r);e.fetch(o)},createDerivedAsset:function(t,i,n,r){var a=JSON.stringify(t),o={type:"POST",url:graphite.getEnvironment().url("/api/v1/psd/"+t.psdGuid+"/derived?nocache="+e.now()),data:a,dataType:"json"};s(o,i,n,r);e.ajax(o)},getWorkerStatus:function(t,i,n,r){var a={url:graphite.getEnvironment().url("/api/v1/worker/"+t)};s(a,i,n,r);e.ajax(a)},getSpriteSheetURL:function(e){var t=graphite.getEnvironment().url(e,graphite.getEnvironment().FILESTORAGE_HOST);return t},registerPersistentParameters:function(e){},getAssetInfo:function(t,i,n,r){var a=this.createAjaxOptions("GET","/api/v1/psd/"+t+"/info");s(a,i,n,r);e.ajax(a)},getLayerURL:function(e,t){return graphite.getEnvironment().url("/api/v1/psd/"+e+"/layer/"+t)},getRendition:function(e,t,i){var n="string"==typeof e,s=n?e:e.get&&e.get("path"),r=e.get&&e.get("authless")||!1,a=e.get&&e.get("layerCompId");r||a?graphite.getImageServiceAPI().createWebAsset(e,null,"jpeg",{q:.25}).done(function(e){i.call(null,null,e)}).fail(function(e){i.call(null,e,null)}):s?graphite.getStorageServiceAPI().rendition(s,t,i):i(null,"Invalid parameter in getRendition: "+e)},getDefaultRenditionURL:function(e){return graphite.getEnvironment().url("/api/v1/psd/"+e)},getDerivedRenditionURL:function(e){return graphite.getEnvironment().url("/api/v1/asset/"+e+"/thumbnail")},getDerivedDownloadURL:function(e,t){return graphite.getEnvironment().url("/api/v1/asset/"+e+"/download")},deleteDerivedAsset:function(t,i,n,r){var a={url:graphite.getEnvironment().url("/api/v1/psd/"+t+"/derived/delete"),type:"DELETE"};s(a,i,n,r);e.ajax(a)},getDerivedSpriteImage:function(e,t,i,n,s){var r,a=new Image;a.onload=function(){i.apply(s)};a.onerror=function(e){n.apply(s,[e])};r={layerIds:t};graphite.getImageServiceAPI().createWebAsset(e,null,"png32",r).done(function(e){a.src=e}).fail(function(){n.apply(s)});return a},upload:function(e,t,i,n,s){graphite.getStorageServiceAPI().upload(e,t,i,n,s)},loadCrossDomainImage:function(e,t){e.src=t},applyCrossDomainPolicy:function(e){}};return p});define("vanilla-extract/public/js/core/cceco/CCEcoUtils",["jquery","../controllers/AuthController"],function(e,t){"use strict";var i={getAjaxHeaders:function(i){var n={"x-api-key":graphite.getEnvironment().API_KEY};return i?(new e.Deferred).resolve(n).promise():t.getAuthModel().getAccessToken().then(function(e){n.Authorization="Bearer "+e;return n})}};return i});define("vanilla-extract/public/js/core/cceco/StorageServiceAPI",["jquery","plugin-dependencies","./CCEcoUtils"],function(e,t,i){"use strict";function n(e,t){var i=graphite.getEnvironment();t=t||230;e=e.replace(/\/*files\/*/,"");var n=i.url("/files/"+e+"/:rendition;size="+t,i.FILESTORAGE_HOST);return n}var s={_rendition:function(e,t,i,s){var r=new XMLHttpRequest,a=n(e,t);r.open("get",a,!0);r.responseType="blob";r.setRequestHeader("Authorization",i.Authorization);r.setRequestHeader("x-api-key",i["x-api-key"]);r.setRequestHeader("Accept","image/jpeg, image/jpg, */*;q=0.1");r.onload=function(e){if(200===r.status){var t=r.response,i=new FileReader;i.addEventListener("loadend",function(){s&&s(null,[i.result])});i.readAsDataURL(t)}else s(r.status,null)};r.send(null)},rendition:function(e,t,n){var s=this;i.getAjaxHeaders().done(function(i){s._rendition(e,t,i,n)})},metadata:function(t){return i.getAjaxHeaders().then(function(i){var n=graphite.getEnvironment(),s="/"+t+"/:metadata",r=e.ajax({headers:i,url:n.url(s,n.FILESTORAGE_HOST),dataType:"json"});r.fail(function(e,i,n){graphite.events.trigger("image-service-error",encodeURI(t),i)});return r})},upload:function(e,t,i,n,s){var r=new XMLHttpRequest,a=graphite.getServerAPI().createAjaxOptions("PUT",t);r.open("put",a.url);r.setRequestHeader("Content-Type","application/octet-stream");r.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(e.asset.get("name"))+'"');r.setRequestHeader("Authorization",a.headers.Authorization);r.setRequestHeader("X-api-key",a.headers["X-api-key"]);r.onload=function(){i(this)};r.onerror=n;r.upload.onprogress=function(e){s(e)};r.send(e.file)},storagePath:function(i){var n=e.Deferred(),s={type:"HEAD",url:"https://cc-api-storage-stage.adobe.io/resolve?id="+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}};e.ajax(s).fail(function(e,t,i){n.reject(e)}).done(function(e,t,i){n.resolve(i.getResponseHeader("Content-Location"))});return n.promise()},storageId:function(t){var i=e.Deferred(),n=this.metadataOptions(t);e.ajax(n).fail(function(e,t,n){i.resolve(["",""])}).done(function(e,t,n){i.resolve(e.id.split("/"))});return i.promise()},assetDirectory:function(t){var i=e.Deferred(),n=this;this.storagePath(t).then(function(e){i.resolve(n.assetDirectoryPath(e))},function(e){i.reject(e)});return i.promise()},assetDirectoryPath:function(e){var t=e.lastIndexOf(".");-1!==t&&(e=e.substr(0,t));return e+"-assets"},fetchContents:function(i){var n=e.Deferred(),s={type:"GET",url:"https://cc-api-storage-stage.adobe.io"+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}};e.ajax(s).fail(function(e,t,i){n.reject(e)}).done(function(e,t,i){n.resolve(e,i.getResponseHeader("etag"))});return n.promise()},storeContents:function(i,n,s){var r=e.Deferred(),a={type:"PUT",url:"https://cc-api-storage-stage.adobe.io"+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics","content-type":"*/*"},dataType:"text",data:s};n&&(a.headers["if-match"]=n);e.ajax(a).fail(function(e,t,i){r.reject(e)}).done(function(e,t,i){r.resolve(i.getResponseHeader("etag"))});return r.promise()},renditionURL:function(e,i,n){return"https://cc-api-storage-stage.adobe.io"+e+"/:rendition;size="+n+"?accept="+i+"&api_key=webpagraphics&user_token="+t.auth.token.substring(7)},downloadURL:function(e,i){return"https://cc-api-storage-stage.adobe.io"+e+"?content_disposition=attachment;filename="+encodeURIComponent(i)+"&api_key=webpagraphics&user_token="+t.auth.token.substring(7)},metadataOptions:function(e){return{type:"GET",url:"https://cc-api-storage-stage.adobe.io"+e+"/:metadata",headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}}},archive:function(i,n,s){var r=e.Deferred(),a=this;e.ajax(this.metadataOptions(i)).fail(function(e,t,i){r.reject(e)}).done(function(o,l,d){var c=n,h=s,p={type:"PUT",url:"https://cc-api-storage-stage.adobe.io/archive/"+encodeURI(i.substring(i.lastIndexOf("/")+1))+"?invocation_mode=async",headers:{authorization:t.auth.token,"x-api-key":"webpagraphics",link:"<"+i.substring(1)+">;rel=self",accept:"application/vnd.adobe.file+json, application/vnd.adobe.directory+json","if-match":o.etag}};e.ajax(p).fail(function(e,t,i){h?r.reject(i):r.reject(e)}).done(function(e,t,i){c?r.resolve(a):r.resolve(i)})});return r.promise()}};return s});!function(e){"use strict";e.multipart=function(t){function i(){this.headers={};this.header="";this.body=null}function n(){this.boundary=null;this.boundaryChars=null;this.lookbehind=null;this.state=r.PARSER_UNINITIALIZED;this.index=null;this.flags=0;this._part=new i}var s=0,r={PARSER_UNINITIALIZED:s++,START:s++,START_BOUNDARY:s++,HEADER_FIELD_START:s++,HEADER_FIELD:s++,HEADER_VALUE_START:s++,HEADER_VALUE:s++,HEADER_VALUE_ALMOST_DONE:s++,HEADERS_ALMOST_DONE:s++,PART_DATA_START:s++,PART_DATA:s++,PART_END:s++,END:s++},a=1,o={PART_BOUNDARY:a,LAST_BOUNDARY:a*=2},l=10,d=13,c=32,h=45,p=58,u=97,g=122,f=function(e){return 32|e};n.prototype.Uint8Concat=function(e,t){var i=e.length,n=new Uint8Array(i+t.length);n.set(e);n.set(t,i);return n};n.prototype.unpackString=function(e){var t=new Uint8Array(e.length),i=e.length,n=0;for(n=0;i>n;n++)e.charCodeAt(n)&&(t[n]=e.charCodeAt(n));return t};n.prototype.initWithBoundary=function(e){var t=0;this.boundary=new Uint8Array(e.length+4);this.boundary=this.unpackString("\r\n"+e);this.lookbehind=new Uint8Array(this.boundary.length+8);this.state=r.START;this.boundaryChars={};for(t=0;t<this.boundary.length;t++)this.boundaryChars[this.boundary[t]]=!0};n.prototype.write=function(e){var t,i,n=this,s=new Uint8Array(e),a=0,m=s.length,v=this.index,y=this.index,b=this.state,w=this.flags,S=this.lookbehind,C=this.boundary,x=this.boundaryChars,T=this.boundary.length,E=T-1,I=s.length,M=function(e){n[e+"Mark"]=a},P=function(e){delete n[e+"Mark"]},A=function(e,t,i,s){if(void 0===i||i!==s){var r="on"+e.substr(0,1).toUpperCase()+e.substr(1);r in n&&n[r](t,i,s)}},L=function(e,t){var i=e+"Mark";if(i in n)if(t){A(e,s,n[i],a);delete n[i]}else{A(e,s,n[i],s.length);n[i]=0}};for(a=0;m>a;a++){t=s[a];switch(b){case r.PARSER_UNINITIALIZED:return a;case r.START:y=0;b=r.START_BOUNDARY;case r.START_BOUNDARY:if(y===C.length-2){if(t===h)w|=o.LAST_BOUNDARY;else if(t!==d)return a;y++;break}if(y-1===C.length-2){if(w&o.LAST_BOUNDARY&&t===h){A("end");b=r.END;w=0}else{if(w&o.LAST_BOUNDARY||t!==l)return a;y=0;A("partBegin");b=r.HEADER_FIELD_START}break}t!==C[y+2]&&(y=-2);t===C[y+2]&&y++;break;case r.HEADER_FIELD_START:b=r.HEADER_FIELD;M("headerField");y=0;case r.HEADER_FIELD:if(t===d){P("headerField");b=r.HEADERS_ALMOST_DONE;break}y++;if(t===h)break;if(t===p){if(1===y)return a;L("headerField",!0);b=r.HEADER_VALUE_START;break}i=f(t);if(u>i||i>g)return a;break;case r.HEADER_VALUE_START:if(t===c)break;M("headerValue");b=r.HEADER_VALUE;case r.HEADER_VALUE:if(t===d){L("headerValue",!0);A("headerEnd");b=r.HEADER_VALUE_ALMOST_DONE}break;case r.HEADER_VALUE_ALMOST_DONE:if(t!==l)return a;b=r.HEADER_FIELD_START;break;case r.HEADERS_ALMOST_DONE:if(t!==l)return a;A("headersEnd");b=r.PART_DATA_START;break;case r.PART_DATA_START:b=r.PART_DATA;M("partData");case r.PART_DATA:v=y;if(0===y){a+=E;for(;I>a&&!(s[a]in x);)a+=T;a-=E;t=s[a]}if(y<C.length)if(C[y]===t){0===y&&L("partData",!0);y++}else y=0;else if(y===C.length){y++;t===d?w|=o.PART_BOUNDARY:t===h?w|=o.LAST_BOUNDARY:y=0}else if(y-1===C.length)if(w&o.PART_BOUNDARY){y=0;if(t===l){w&=~o.PART_BOUNDARY;A("partEnd");A("partBegin");b=r.HEADER_FIELD_START;break}}else if(w&o.LAST_BOUNDARY)if(t===h){A("partEnd");A("end");b=r.END;w=0}else y=0;else y=0;if(y>0)S[y-1]=t;else if(v>0){A("partData",S,0,v);v=0;M("partData");a--}break;case r.END:break;default:return a}}L("headerField");L("headerValue");L("partData");this.index=y;this.state=b;this.flags=w;return m};n.prototype.onHeaderField=function(e,t,i){var n=String.fromCharCode.apply(null,e.subarray(t,i));this._part.header=n};n.prototype.onHeaderValue=function(e,t,i){this._part.headers[this._part.header]=String.fromCharCode.apply(null,e.subarray(t,i))};n.prototype.onPartData=function(e,t,i){e.subarray(t,i),this._part.headers["Content-Type"];this._part.body?this._part.body=this.Uint8Concat(this._part.body,e.subarray(t,i)):this._part.body=e.subarray(t,i)};n.prototype.onPartEnd=function(){var e=this._part.headers["Content-Type"];if(t[e]&&this._part.body){t[e].call(this._part.body,this._part.headers["Content-ID"]);this._part.body=null;this._part.headers={};this._part.header=""}};n.prototype.onEnd=function(){t.hasOwnProperty("onSuccess")&&t.onSuccess.call(this)};n.prototype.end=function(){var e=function(e,t){var i="on"+t.substr(0,1).toUpperCase()+t.substr(1);i in e&&e[i]()};if(this.state===r.HEADER_FIELD_START&&0===this.index||this.state===r.PART_DATA&&this.index===this.boundary.length){e(this,"partEnd");e(this,"end")}else if(this.state!==r.END)return new Error("MultipartParser.end(): stream ended unexpectedly: "+this.state)};var m,v,y=t.url,b=t.type||"GET",w=t.data||!1,S=e("meta[name='csrf-token']").attr("content"),C=t.headers,x=function(){if(3===m.readyState){var e=m.getResponseHeader("Content-Type");-1===e.indexOf("multipart")?m.onreadystatechange=function(){m.onreadystatechange=function(){};t.hasOwnProperty("onError")&&t.onError.call(m.status)}:v="--"+/boundary=([^\x3B]+)/.exec(e)[1]}if(4===m.readyState&&200===m.status){var i=m.response,s=new n;s.initWithBoundary(v);s.write(i)}else 4===m.readyState&&200!==m.status&&t.hasOwnProperty("onError")&&t.onError.call(m.status)};try{m=new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(T){try{m=new ActiveXObject("MSXML3.XMLHTTP");
}catch(E){try{m=new XMLHttpRequest}catch(I){throw new Error("Could not find supported version of XMLHttpRequest.")}}}m.responseType="arraybuffer";m.open(b,y,!0);m.onreadystatechange=x;S&&m.setRequestHeader("X-CSRF-Token",S);C&&e.each(C,function(e,t){m.setRequestHeader(e,t)});m.send(w?w:null)}}(jQuery);define("vanilla-extract/public/js/core/external/jquery.mxhr",function(){});define("vanilla-extract/public/js/core/cceco/ImageServiceAPI",["jquery","underscore","../external/jquery.mxhr","./CCEcoUtils","../controllers/AuthController","../Constants"],function(e,t,i,n,s,r){"use strict";function a(e){var t="",i=0;for(i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t}function o(e){var t=a(e);return window.btoa(t)}function l(e){return y+o(e)}function d(e,t,i,n){var s=e.get("path"),r=e.get("authless");i.inputs={};i.inputs.image={};t["Content-Type"]=v;if(r){t["x-creativeurl-share"]=e.get("id");i.inputs.image.href=s}else i.inputs.image.href="/"+encodeURIComponent(s);n&&(i.outputs={})}function c(e,t,i){var n=a(e);n=JSON.parse(n);if(n.imgdata){n.imgdata.originalFile=i.split("/").pop();n.imgdata.psdPath=i;t&&(n.imgdata.appliedLayerCompId=parseInt(t,10))}return n}function h(e){for(var t=a(e),i=JSON.parse(t),n=[],s=1;i.outputs&&i.outputs.hasOwnProperty("sheet"+s)&&i.outputs["sheet"+s].location;){n.push(i.outputs["sheet"+s].location);s++}return{pngLocations:n,sheetJSON:i}}function p(e,i){return t.find(t.keys(e),function(t){return e[t].href===i?t:void 0})}function u(e,t,i,n){var s="cid:"+t.substring(1,t.length-1),r=p(i,s),a=(n.get("id"),y+o(e));return{image:a,sheetID:r}}var g="/introspect",f="/spritesheet",m="/createwebasset",v="application/vnd.adobe.image-operation+json",y="data:image/png;base64,",b="/public/extract",w={},S={_introspect:function(i,n){var s,r=new e.Deferred,a=i.get("authless"),o=i.get("layerCompId")&&i.get("layerCompId").toString(),l={};d(i,n,l,!a);l.options={rendtion:!0};o&&(l.options.layerCompId=o);if(a)s=graphite.getEnvironment().COLLAB_IMAGE_SERVICE_HOST+b+g;else{s=graphite.getEnvironment().url(g,graphite.getEnvironment().IMAGE_SERVICE_HOST);l.outputs.output={accept:v}}var h={headers:n,url:s,type:"POST",data:JSON.stringify(l),port:graphite.getEnvironment().IMAGE_SERVICE_PORT,"application/vnd.adobe.image-operation+json":function(e){},"application/json":function(e){var t=c(this,o,i.get("path"));r.resolve(t)},onError:function(){r.reject(this)}};!a&&this.introspectCustomHeader&&t.each(this.introspectCustomHeader,function(e,t){h.headers[t]=unescape(encodeURIComponent(e))});e.multipart(h);return r.promise()},introspect:function(e){var t=this,i=n.getAjaxHeaders(e.get("authless"));return i.then(function(i){return t._introspect(e,i)})},_spritesheet:function(i,n){var s,r,o,l=new e.Deferred,c=i.get("authless"),p=i.get("layerCompId")&&i.get("layerCompId").toString(),g=[],m={},y="",w=[];d(i,n,m,!0);m.options={includeDrawable:!1,minSheets:6,clipLayers:!0,flattenLayers:!0,layerCompId:p,rendition:!0};m.outputs.spriteInfo={accept:v};m.outputs.sheets={accept:"image/png"};o=c?graphite.getEnvironment().url(b+f,graphite.getEnvironment().COLLAB_IMAGE_SERVICE_HOST):graphite.getEnvironment().url(f,graphite.getEnvironment().IMAGE_SERVICE_HOST);var S={headers:n,url:o,type:"POST",data:JSON.stringify(m),port:graphite.getEnvironment().IMAGE_SERVICE_PORT,"application/vnd.adobe.image-operation+json":function(e){var n=h(this);g=n.pngLocations?t.union(g,n.pngLocations):void 0;s=n.sheetJSON;s.outputs&&(r=s.outputs);s.imgdata&&(s.imgdata.originalFile=i.get("path").split("/").pop());if(g){s.pngLocations=g;y=s}},"application/json":function(e){var t=a(this);y=JSON.parse(t)},"image/png":function(e){var t=u(this,e,r,i);w.push({id:t.sheetID,dataUrl:t.image})},onSuccess:function(){l.resolve({spritesheetJSON:y,spritesheets:w})},onError:function(){l.reject(this)}};!c&&this.spritesheetCustomHeader&&t.each(this.spritesheetCustomHeader,function(e,t){S.headers[t]=unescape(encodeURIComponent(e))});e.multipart(S);return l.promise()},spritesheet:function(e){var t=this,i=n.getAjaxHeaders(e.get("authless"));return i.then(function(i){return t._spritesheet(e,i)})},_createWebAsset:function(i,n,s,r,a){var o,c,h,p=new e.Deferred,u=[],g=i.get("layerCompId")&&i.get("layerCompId").toString(),f=i.get("path"),v=i.get("authless"),y={},S=v&&!n,C=S&&w[f];if(C){delete w[f];p.resolve(C);return p.promise()}d(i,a,y,!0);r=r||{};c="number"==typeof r.q?r.q:1;r.q=void 0;if(n){t.each(n,function(e){u.push(e.get("layerId"))});r.layerIds=u}g&&(r.layerCompId=g);y.options=r;h="svg"===s?"image/svg+xml":"jpeg"===s||"jpg"===s?"image/jpeg; q="+c:"png-32"!==s&&"png32"!==s&&s?"image/png; x-format="+s:"image/png";y.outputs.output={accept:h};o=v?graphite.getEnvironment().url(b+m,graphite.getEnvironment().COLLAB_IMAGE_SERVICE_HOST):graphite.getEnvironment().url(m,graphite.getEnvironment().IMAGE_SERVICE_HOST);var x=function(){var e=l(this);S&&(w[f]=e);p.resolve(e)},T={headers:a,url:o,type:"POST",data:JSON.stringify(y),port:graphite.getEnvironment().IMAGE_SERVICE_PORT,onError:function(){p.reject(this)},"application/vnd.adobe.image-operation+json":function(e){},"application/json":function(){},"image/png":x,"image/jpeg":x,"image/svg+xml":x};e.multipart(T);return p.promise()},createWebAsset:function(e,t,i,s){var r=this,a=n.getAjaxHeaders(e.get("authless"));return a.then(function(n){return r._createWebAsset(e,t,i,s,n)})}};return S});define("vanilla-extract/public/js/core/config/environment",["jquery"],function(e){"use strict";var t={IMS_HOST:"ims-na1-stg1.adobelogin.com",LOGOUT_HOST:"adobeid-na1-stg1.services.adobe.com",IMS_CLIENT_ID:"webpagraphics",ENVIRONMENT:"stage",ASSETS_HOST:"assets-stage.adobecc.com",IMAGE_SERVICE_HOST:"https://cc-api-image-stage.adobe.io",IMAGE_SERVICE_PORT:443,FILESTORAGE_HOST:"https://cc-api-storage-stage.adobe.io",API_KEY:"webpagraphics",proxies:{},getImsAuthEndpoint_Login:function(){return"https://"+t.IMS_HOST+"/ims/authorize/v1"},getImsAuthEndpoint_Logout:function(){return"https://"+t.LOGOUT_HOST+"/ims/logout/v1"},url:function(e,i){i=i||t.IMAGE_SERVICE_HOST;return i+e},setProxyURL:function(e,i){t.proxies[i]=e}};return t});define("libs/require/css/css",["./normalize"],function(e){function t(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1}if("undefined"==typeof window)return{load:function(e,t,i){i()}};var i=!1,n=document.getElementsByTagName("head")[0],s=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),r=!1;if(s)if(s[1]||s[7]){r=parseInt(s[1])<6||parseInt(s[7])<=9;s="trident"}else if(s[2]){r=!0;s="webkit"}else if(s[3]);else if(s[4]){r=parseInt(s[4])<18;s="gecko"}else i&&alert("Engine detection failed");else;var a={},o=/^\/|([^\:\/]*:)/;a.pluginBuilder="./css-builder";var l=[],d={},c=[];a.addBuffer=function(e){if(-1==t(l,e)&&-1==t(c,e)){l.push(e);c.push(e)}};a.setBuffer=function(t,i){var n=window.location.pathname.split("/");n.pop();n=n.join("/")+"/";var s=require.toUrl("base_url").split("/");s.pop();var r=s.join("/")+"/";r=e.convertURIBase(r,n,"/");r.match(o)||(r="/"+r);"/"!=r.substr(r.length-1,1)&&(r+="/");a.inject(e(t,r,n));for(var c=0;c<l.length;c++)if(i&&".less"==l[c].substr(l[c].length-5,5)||!i&&".css"==l[c].substr(l[c].length-4,4)){!function(e){d[e]=d[e]||!0;setTimeout(function(){"function"==typeof d[e]&&d[e]();delete d[e]},7)}(l[c]);l.splice(c--,1)}};a.attachBuffer=function(e,i){for(var n=0;n<l.length;n++)if(l[n]==e){d[e]=i;return!0}if(d[e]===!0){d[e]=i;return!0}if(-1!=t(c,e)){i();return!0}};var h=function(e,t){setTimeout(function(){for(var i=0;i<document.styleSheets.length;i++){var n=document.styleSheets[i];if(n.href==e.href)return t()}h(e,t)},10)},p=function(e,t){setTimeout(function(){try{e.sheet.cssRules;return t()}catch(i){}p(e,t)},10)};if("trident"==s&&r)var u=[],g=[],f=0,m=function(e,t){var i;g.push({url:e,cb:t});i=u.shift();if(!i&&f++<12){i=document.createElement("style");n.appendChild(i)}i&&v(i)},v=function(e){var t=g.shift();if(t){e.onload=function(){t.cb(t.ss);v(e)};var i=e.styleSheet;t.ss=i.imports[i.addImport(t.url)]}else{e.onload=b;u.push(e)}};var y=function(e){var t=document.createElement("link");t.type="text/css";t.rel="stylesheet";t.href=e;return t},b=function(){};a.linkLoad=function(e,t){var a=setTimeout(function(){i&&alert("timeout");t()},1e3*P-100),o=function(){clearTimeout(a);l&&(l.onload=b);setTimeout(t,7)};if(r)if("webkit"==s){var l=y(e);h(l,o);n.appendChild(l)}else if("gecko"==s){var d=document.createElement("style");d.textContent='@import "'+e+'"';p(d,o);n.appendChild(d)}else"trident"==s&&m(e,o);else{var l=y(e);l.onload=o;n.appendChild(l)}};var w,S=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],C={},x=function(e,t,i){if(C[e])t(C[e]);else{var n,s,r;if("undefined"!=typeof XMLHttpRequest)n=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(s=0;3>s;s+=1){r=S[s];try{n=new ActiveXObject(r)}catch(a){}if(n){S=[r];break}}n.open("GET",e,requirejs.inlineRequire?!1:!0);n.onreadystatechange=function(s){var r,a;if(4===n.readyState){r=n.status;if(r>399&&600>r){a=new Error(e+" HTTP status: "+r);a.xhr=n;i(a)}else{C[e]=n.responseText;t(n.responseText)}}};n.send(null)}},T=0;a.inject=function(e){if(31>T){w=document.createElement("style");w.type="text/css";n.appendChild(w);T++}w.styleSheet?w.styleSheet.cssText+=e:w.appendChild(document.createTextNode(e))};var E=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,I=window.location.pathname.split("/");I.pop();I=I.join("/")+"/";var M=function(t,i,n){t.match(o)||(t="/"+e.convertURIBase(t,I,"/"));x(t,function(s){s=e(s,t,I);for(var r,a=[],o=[],l=[];r=E.exec(s);){var d=r[4]||r[5]||r[7]||r[8]||r[9];a.push(d);o.push(E.lastIndex-r[0].length);l.push(r[0].length)}for(var c=0,h=0;h<a.length;h++)(function(e){M(a[e],function(t){s=s.substr(0,o[e])+t+s.substr(o[e]+l[e]);for(var n=t.length-l[e],r=e+1;r<a.length;r++)o[r]+=n;c++;c==a.length&&i(s)},n)})(h);0==a.length&&i(s)},n)};a.normalize=function(e,t){".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4));return t(e)};var P,A=!1;a.load=function(e,t,n,s,o){P=P||s.waitSeconds||7;var l=e+(o?".less":".css");if(!a.attachBuffer(l,n)){fileUrl=t.toUrl(l);if(!A&&i){alert(r?"hacking links":"not hacking");A=!0}o?M(fileUrl,function(e){o&&(e=o(e,function(e){a.inject(e);setTimeout(n,7)}))}):a.linkLoad(fileUrl,n)}};i&&(a.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0});return a});define("vanilla-extract/public/js/core/VanillaExtractMain",["jquery","underscore","backbone","plugin-dependencies","./Constants","./models/PSDSettingsModel","./models/ConfigModel","./models/AuthModel","./models/PSDModel","./views/detail/PSDDetailsView","./views/layers/LayersListView","./views/layers/LayerItemView","./views/landing/AssetListView","./controllers/InterceptController","./controllers/AssetController","./controllers/AuthController","./controllers/DetailsController","./controllers/SelectionController","./external/ZeroClipboard/ZeroClipboard","./serverAPI","./cceco/StorageServiceAPI","./cceco/ImageServiceAPI","./config/environment","module","require","css!./css/topcoat.css","css!./css/firstUserExp.css","css!./css/jobListing.css","css!./css/inspect.css","css!./css/layers.css","css!./css/main.css","css!./css/popup.css","css!./css/preview.css","css!./css/zIndex.css","css!./css/mobile.css"],function(e,t,i,n,s,r,a,o,l,d,c,h,p,u,g,f,m,v,y,b,w,S,C,x,T){"use strict";var E=b,I=S,M=w;window.graphite=window.graphite||{};var P=window.graphite;P.getServerAPI=function(){return E};P.events=P.events||t.extend({},i.Events);P.fflags=P.fflags||{};P.setFeatureEnabled=function(e,t){null!==e&&(window.graphite.fflags[e]=t)};P.setConfigModel=function(e){P.configModel=e};P.getConfigModel=function(){return new a};P.setAuthModel=function(e){P.authModel=e};P.getAuthModel=function(){return new a};P.setMetricsProxyModel=function(e){P.metricsProxyModel=e;P.metricsProxyModel.setAuthModel(P.authModel);P.metricsProxyModel.setConfigModel(P.configModel)};P.getMetricsProxyModel=function(){return null};P.getAssetController=function(){return g};P.events.trigger("register-defaults");P.isFeatureEnabled=function(e){var t=!1;null!==e&&P.fflags[e]&&(t=!0);return t};P.inPublicOneUp=function(){return"link"===n.utils.getCurrentBasePath()};P.clearFeatureFlags=P.clearFeatureFlags||function(){window.graphite.fflags={}};P.getGraphite=function(){return P};P.getRawPSDModel=function(e){return new l(e)};P.getCurrentPSDModel=function(){return v.getPSDModel()};P.getPSDDetailsView=function(e){return new d({model:k})};P.getLayersListView=function(e){return new c({model:e})};P.getLayerItemView=function(e){return new h(e)};P.getAssetListView=function(e,t){return new p(e,t)};P.getAuthController=function(){return f};P.getDetailsController=function(){return m};P.getClipboard=function(){return new y};P.getConstants=function(){return s};P.getImageServiceAPI=function(){return I};P.getStorageServiceAPI=function(){return M};P.getEnvironment=function(){return C};var A,L,k;return function(t){var i=t.get("id"),n=i.substr(i.lastIndexOf("/")+1),s=t.get("layerCompId"),a=t.get("path");window.graphite.urlBase=i.substr(0,i.indexOf("/api/"));window.graphite.ownerId=t.get("owner");window.graphite.linkId=t.get("linkId");this&&(this.localContent=t.get("localContent")||!1);if(A!==n||t.get("etag")!==L){k=graphite.getAssetController().getAsset(n,s,function(){window.graphite.metricsProxyModel.authModel.isAnalyticsOptIn()&&u.applyBehaviors();var e=k.get("info"),t=e.version||"";!k.get("localContent")&&k.get("path")&&graphite.events.trigger("asset-data-loaded",{path:k.get("path"),graphiteVersion:t})},function(e){401===e.status&&graphite.events.trigger("reauthenticate")},this,a);r.setup(n);A=n;L=t.get("etag")}k.set("modified",t.get("modified"));k.set("assetId",t.get("id"));k.set("fileName",t.get("name"));k.set("type",t.get("type"));var o=k.get("imgdata");if(!o||0===o.bounds.right&&0===o.bounds.bottom){k.set("height",t.get("height"));k.set("width",t.get("width"))}k.set("size",t.get("size"));var l={$el:e("<div>").addClass("vanilla-extract"),show:function(){window.graphite.inPublicOneUp()&&this.$el.addClass("public");this.psdDetailsView=P.getPSDDetailsView(k);this.$el.html(this.psdDetailsView.$el);this.addHandlers()},hide:function(){graphite.events.trigger("reset-layers-visibility");if(this.psdDetailsView){this.psdDetailsView.remove();this.psdDetailsView=null}this.removeHandlers();k.reset()},addHandlers:function(){graphite.events.on("layerCompChanged",this.layerCompChanged,this)},removeHandlers:function(){graphite.events.off("layerCompChanged",this.layerCompChanged,this)},layerCompChanged:function(e){this.hide();k&&(e.get("imgdata").layerCompSelectedTab=k.get("imgdata").layerCompSelectedTab);k=e;this.show();this.trigger("added-to-dom")},trigger:function(e){"added-to-dom"===e&&this.psdDetailsView.previewView&&this.psdDetailsView.previewView.attached()},sizeChange:function(){},getServerAPI:function(){return this._if_overriden("getServerAPI")?P.getServerAPI:P.getServerAPI},getAuthController:function(){return f}};return l}});define("models/PluginConfigModel",["underscore","backbone","plugin-dependencies"],function(e,t,i){"use strict";var n=t.Model.extend({defaults:{buildSHA:"994af8c42c77ea82614d716b3adcc767636484bc"},getBuildNumber:function(){return this.get("buildSHA")}});return n});define("models/PluginAuthModel",["underscore","backbone","plugin-dependencies"],function(e,t,i){"use strict";var n=t.Model.extend({defaults:{access_token:null,expires_in:null,user_data:null,adobeID:null},initialize:function(){},isValid:function(){return!0},isValidWithUserFeature:function(e){return!0},isAnalyticsOptIn:function(){return!0},isAdobeInternalUser:function(){var e=!1,t=i.user.get("email");if(t){var n=t.lastIndexOf("@");if(-1!==n){var s=t.substr(n+1);s=s.toLowerCase();("adobe.com"===s||"adobetest.com"===s||"601t.com"===s||"adobecc.com"===s)&&(e=!0)}}return e},setAnalyticsOptIn:function(e){},getAdobeId:function(){var e=i.user.profile().userId||"";return e},getRegisterDate:function(){return""}});return n});define("models/MetricsProxyModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{authModel:null,configModel:null},setAuthModel:function(e){this.authModel=e},setConfigModel:function(e){this.configModel=e;this.setDefaultParam("parfaitBuild",this.configModel.getBuildNumber())},initialize:function(){window.graphite=window.graphite||{};window.graphite.events=window.graphite.events||e.extend({},t.Events);window.graphite.events.on("landing-page",this.onLandingPage,this);window.graphite.events.on("login-dialog-shown",this.handleLogInDialogShown,this);window.graphite.events.on("logged-in",this.handleLoggedIn,this);window.graphite.events.on("upload-init",this.uploadInit,this);window.graphite.events.on("uploaded",this.uploaded,this);window.graphite.events.on("upload-failed",this.uploadFailed,this);window.graphite.events.on("processed",this.processed,this);window.graphite.events.on("processing-failed",this.processingFailed,this);window.graphite.events.on("drawPreviewFinish",this.drawPreviewFinish,this);window.graphite.events.on("selectedTab",this.selectedTab,this);window.graphite.events.on("help-dialog",this.helpDialog,this);window.graphite.events.on("help-dialog-shortcut",this.helpDialogShortCut,this);window.graphite.events.on("first-user-overlay-shortcut",this.FUXShortCut,this);window.graphite.events.on("show-color-popup",this.showColorPopup,this);window.graphite.events.on("show-measurement-offsets",this.showMeasurementOffsets,this);window.graphite.events.on("copy-css",this.copyCSS,this);window.graphite.events.on("copy-text",this.copyText,this);window.graphite.events.on("copy-value",this.copyValue,this);window.graphite.events.on("color-format",this.colorFormat,this);window.graphite.events.on("report-fidelity-error",this.reportFidelityError,this);window.graphite.events.on("typekitSearch",this.typekitSearch,this);window.graphite.events.on("extract-asset-download-init",this.extractAssetDownload,this);window.graphite.events.on("extract-asset-direct-download",this.extractAssetDownloadDirect,this);window.graphite.events.on("add-asset-to-catalog",this.addAssetToCatalog,this);window.graphite.events.on("asset-extracted-scaled",this.scaledAssetExtracted,this);window.graphite.events.on("canvasClick",this.canvasClicked,this);window.graphite.events.on("canvasClickDrag",this.canvasClickDrag,this);window.graphite.events.on("cssDoublClick",this.cssDoubleClick,this);window.graphite.events.on("register-defaults",this.registerDefaults,this);window.graphite.events.on("load-alert",this.loadAlert,this);window.graphite.events.on("load-calltoaction",this.loadCallToAction,this);window.graphite.events.on("bad-file-type-dragdrop",this.badFileTypeDragDrop,this);window.graphite.events.on("show-extract-asset-popup",this.showExtractAssetPopup,this);window.graphite.events.on("downloading-extracted-asset",this.downloadingExtractedAsset,this);window.graphite.events.on("downloading-psd",this.downloadingPSD,this);window.graphite.events.on("featureFlagSet",this.featureFlagSet,this);window.graphite.events.on("layerCompShown",this.layerCompShown,this);window.graphite.events.on("layerCompChanged",this.layerCompChanged,this);window.graphite.events.on("commitDropperColor",this.handleDropperExtraction,this);window.graphite.events.on("preprocessorChanged",this.handlePreprocessorChanged,this);window.graphite.events.on("catchIntercept",this.handleIntercept,this);window.graphite.events.on("baseFontSizeChanged",this.handleBaseFontSizeChanged,this);window.graphite.events.on("preferredFontUnitsChanged",this.handlePreferredFontUnitsChanged,this);window.graphite.events.on("show-job-list-overlay",this.handleShowJobListOverlay,this);window.graphite.events.on("upload-psd-public-one-up",this.handleUploadOneUp,this);window.graphite.events.on("measurement-notification-shown",this.handleMeasurementNotificationShown,this);window.graphite.events.on("measurement-notification-closed",this.handleMeasurementNotificationClosed,this);window.graphite.events.on("artboardpsd-shown",this.handleArtboardShown,this);window.graphite.events.on("nonartboardpsd-shown",this.handleNonArtboardShown,this);window.graphite.events.on("artboard-zoomToFit",this.handleArtboardZoomToFit,this);this.defaultParams={}},registerDefaults:function(){graphite.getServerAPI().registerPersistentParameters(this.defaultParams);window.graphite.events.off("register-defaults")},mergeParams:function(e){var t,i={},n=new Date;for(t in this.defaultParams)this.defaultParams.hasOwnProperty(t)&&(i[t]=this.defaultParams[t]);for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);i.timestamp=n.getTime();return i},setDefaultParam:function(e,t){this.defaultParams[e]=t},onLandingPage:function(){this.trackEvent("landing-page")},handleLogInDialogShown:function(){this.trackEvent("login-dialog-shown")},handleLoggedIn:function(){this.trackEvent("logged-in")},uploadInit:function(e){var t,i=e.files.length;for(t=0;i>t;t++){var n=e.files[t].name,s={filename:n};this.trackEvent("upload-init",s)}},uploaded:function(e){this.trackEvent("uploaded",e)},uploadFailed:function(e){this.trackEvent("upload-failed",e)},processed:function(e){this.trackEvent("processed",e)},processingFailed:function(e){this.trackEvent("processing-failed",e)},drawPreviewFinish:function(e){var t=Date.now(),i=t-e.get("previewStarted"),n={renditionDuration:i};this.setDefaultParam("assetID",e.get("id"));this.trackEvent("rendered",n)},selectedTab:function(e){this.trackEvent("selected-tab",{tabName:e.selectedTab})},helpDialog:function(){this.trackEvent("help-dialog")},helpDialogShortCut:function(){this.trackEvent("help-dialog-shortcut")},FUXShortCut:function(){this.trackEvent("first-user-overlay-shortcut")},showColorPopup:function(){this.trackEvent("show-color-popup")},showMeasurementOffsets:function(){this.trackEvent("show-measurement-offsets")},copyCSS:function(e){this.trackEvent("copy-css",e)},copyText:function(){this.trackEvent("copy-text")},copyValue:function(e){this.trackEvent("copy-value",e)},colorFormat:function(e){this.trackEvent("color-format",e)},reportFidelityError:function(){this.trackEvent("report-fidelity-error")},typekitSearch:function(){this.trackEvent("typekit-search")},extractAssetDownload:function(e){this.trackEvent("extract-asset-download-init",e)},extractAssetDownloadDirect:function(e){this.trackEvent("extract-asset-direct-download",e)},addAssetToCatalog:function(e){this.trackEvent("add-asset-to-catalog",e)},scaledAssetExtracted:function(e){this.trackEvent("asset-extracted-scaled",e)},canvasClicked:function(e){this.trackEvent("psd-preview-canvas-clicked",e)},canvasClickDrag:function(e){this.trackEvent("psd-preview-canvas-clickdrag",e)},cssDoubleClick:function(e){this.trackEvent("css-properties-doubleclick",e)},loadAlert:function(e){this.trackEvent("load-alert",{alertMessage:e})},loadCallToAction:function(e){this.trackEvent("load-calltoaction")},badFileTypeDragDrop:function(e){this.trackEvent("bad-file-type-dragdrop",e)},showExtractAssetPopup:function(e){this.trackEvent("show-extract-asset-popup",{origin:e.origin})},downloadingExtractedAsset:function(e){this.trackEvent("downloading-extracted-asset",e)},downloadingPSD:function(e){this.trackEvent("downloading-psd",e)},featureFlagSet:function(e){this.trackEvent("feature-flag-set",e)},layerCompShown:function(){this.trackEvent("layer-comp-shown")},layerCompChanged:function(){this.trackEvent("layer-comp-changed")},handleDropperExtraction:function(){this.trackEvent("dropper-color-extracted")},handlePreprocessorChanged:function(e){this.trackEvent("preprocessor-changed",e)},handleIntercept:function(e){this.trackEvent("catch-intercept",e)},handleBaseFontSizeChanged:function(e){this.trackEvent("base-font-size-changed",e)},handlePreferredFontUnitsChanged:function(e){this.trackEvent("preferred-font-units-changed",e)},handleShowJobListOverlay:function(e){this.trackEvent("show-job-list-overlay",e)},handleUploadOneUp:function(e){this.trackEvent("upload-psd-public-one-up",e)},handleMeasurementNotificationShown:function(e){this.trackEvent("measurement-notification-shown",e)},handleMeasurementNotificationClosed:function(e){this.trackEvent("measurement-notification-closed",e)},handleArtboardShown:function(e){this.trackEvent("artboardpsd-shown",e)},handleNonArtboardShown:function(e){this.trackEvent("nonartboardpsd-shown",e)},handleArtboardZoomToFit:function(e){this.trackEvent("artboard-zoomToFit",e)},trackEvent:function(e,t){function i(e){}function n(e){}var s,r,a="EDGE_EXTRACT_LANDING",o=t||{};if(this.authModel){if(!this.authModel.isAnalyticsOptIn())return;if(this.authModel.isValid()){o.adobeID=this.authModel.getAdobeId();o.internalUser=this.authModel.isAdobeInternalUser();o.registerDate=this.authModel.getRegisterDate();graphite.getServerAPI().registerPersistentParameters({internalUser:o.internalUser,registerDate:this.authModel.getRegisterDate()});a="EDGE_EXTRACT_ACTIVITY"}}o.isPublic1UpView=graphite.inPublicOneUp();s={"selected-tab":{event:a,subevent:"SELECTED_TAB"},"show-color-popup":{event:a,subevent:"SHOW_COLOR_POPUP"},"show-measurement-offsets":{event:a,subevent:"SHOW_MEASUREMENT_OFFSETS"},"copy-css":{event:a,subevent:"COPY_CSS"},"copy-text":{event:a,subevent:"COPY_TEXT"},"copy-value":{event:a,subevent:"COPY_VALUE"},"color-format":{event:a,subevent:"COLOR_FORMAT"},"dropper-color-extracted":{event:a,subevent:"DROPPER_COLOR_EXTRACTED"},"report-fidelity-error":{event:a,subevent:"FIDELITY_ERROR"},"typekit-search":{event:a,subevent:"TYPEKIT_SEARCH"},"extract-asset-download-init":{event:a,subevent:"ASSET_DOWNLOAD_INIT"},"extract-asset-direct-download":{event:a,subevent:"ASSET_DIRECT_DOWNLOAD"},"add-asset-to-catalog":{event:a,subevent:"ADD_ASSET_TO_CATALOG"},"asset-extracted-scaled":{event:a,subevent:"ASSET_EXTRACTED_SCALED"},"show-extract-asset-popup":{event:a,subevent:"SHOW_EXTRACT_ASSET_POPUP"},"downloading-extracted-asset":{event:a,subevent:"DOWNLOADING_EXTRACTED_ASSET"},"downloading-psd":{event:a,subevent:"DOWNLOADING_PSD"},"psd-preview-canvas-clicked":{event:a,subevent:"PSD_CANVAS_CLICKED"},"psd-preview-canvas-clickdrag":{event:a,subevent:"PSD_CANVAS_CLICKDRAG"},"css-properties-doubleclick":{event:a,subevent:"CSS_PROPERTIES_DOUBLECLICKED"},rendered:{event:a,subevent:"RENDERED"},"layer-comp-shown":{event:a,subevent:"LAYER_COMP_SHOWN"},"layer-comp-changed":{event:a,subevent:"LAYER_COMP_CHANGED"},"show-vendor-prefixes":{event:a,subevent:"SHOW_VENDOR_PREFIXES"},"preprocessor-changed":{event:a,subevent:"CSS_PREPROCESSOR_CHANGED"},"catch-intercept":{event:a,subevent:"CATCH_INTERCEPT"},"base-font-size-changed":{event:a,subevent:"BASE_FONT_SIZE_CHANGED"},"preferred-font-units-changed":{event:a,subevent:"PREFERRED_FONT_UNITS_CHANGED"},"upload-psd-public-one-up":{event:a,subevent:"UPLOAD_PSD_PUBLIC_ONE_UP"},"measurement-notification-shown":{event:a,subevent:"MEASUREMENT-NOTIFICATION-SHOWN"},"measurement-notification-closed":{event:a,subevent:"MEASUREMENT-NOTIFICATION-CLOSED"},"artboardpsd-shown":{event:a,subevent:"ARTBOARDPSD-SHOWN"},"nonartboardpsd-shown":{event:a,subevent:"NONARTBOARDPSD-SHOWN"},"artboard-zoomToFit":{event:a,subevent:"ARTBOARD-ZOOMTOFIT"},"load-calltoaction":{event:"EDGE_EXTRACT_LANDING",subevent:"CALLTOACTION_DIALOG"},"landing-page":{event:"EDGE_EXTRACT_LANDING",subevent:"LANDING_PAGE"},"login-dialog-shown":{event:"EDGE_EXTRACT_LANDING",subevent:"LOGIN_DIALOG"},"feature-flag-set":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"FEATURE_FLAG_SET"},"load-alert":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"ALERT_DIALOG"},"logged-in":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"SIGNON_SSO"},"upload-init":{event:"EDGE_EXTRACT_UPLOAD",subevent:"INIT"},uploaded:{event:"EDGE_EXTRACT_UPLOAD",subevent:"COMPLETE"},"upload-failed":{event:"EDGE_EXTRACT_UPLOAD",subevent:"FAILED"},processed:{event:"EDGE_EXTRACT_UPLOAD",subevent:"PROCESSED"},"processing-failed":{event:"EDGE_EXTRACT_UPLOAD",subevent:"PROCESSING_FAILED"},"bad-file-type-dragdrop":{event:"EDGE_EXTRACT_UPLOAD",subevent:"BAD_FILE_TYPE_DRAGDROP"},"help-dialog":{event:"EDGE_EXTRACT_HELP",subevent:"HELP_DIALOG"},"help-dialog-shortcut":{event:"EDGE_EXTRACT_HELP",subevent:"HELP_DIALOG_SHORTCUT"},"first-user-overlay-shortcut":{event:"EDGE_EXTRACT_HELP",subevent:"FIRST_USER_OVERLAY_SHORTCUT"},"show-job-list-overlay":{event:"EDGE_EXTRACT_HELP",subevent:"JOB_LIST_OVERLAY_SHORTCUT"}};r=s[e];if(r){var l=this.mergeParams(o);if(!l.timestamp){var d=new Date;l.timestamp=d.getTime()}l.firstUse=l.registerDate&&l.timestamp-l.registerDate<36e5;l.subevent=r.subevent;l.eventname=r.event;l.ownerId=graphite.ownerId;graphite.getServerAPI().trackEvent(l,i,n,this)}}});return i});define("utils/AutomationTestUtils",["underscore","../vanilla-extract/public/js/core/controllers/SelectionController","../vanilla-extract/public/js/core/models/LayerModelMap"],function(e,t,i){"use strict";var n=null,s={initialize:function(){graphite.events.on("clipboard-text-set",this._captureClipboardContents)},_captureClipboardContents:function(e){n=e},getClipboardContents:function(){return n},selectLayers:function(e){if(!Array.isArray(e)){if("string"!=typeof e)return!1;e=[e]}for(var n,s=[],r=0;r<e.length;r++){n=i.getLayerModelFromName(e[r]);n&&s.push(n)}t.changeSelection(s,!1,!1);return!0},getLayerBounds:function(e){if("string"!=typeof e)throw new Error("Layer name must be a string");var t=i.getLayerModelFromName(e);if(!t)throw new Error("Layer not found");var n=i.getLayerInfoForId(t.get("layerId")).item;if(!n||!n[0])throw new Error("Layer does not have an element");return n[0].getBoundingClientRect()}};return s});define("PSDExtractServerAPI",["jquery","underscore","plugin-dependencies","./vanilla-extract/public/js/core/models/DerivedAssetModel","./vanilla-extract/public/js/core/collections/DerivedAssetCollection"],function(e,t,i,n,s){"use strict";function r(e,t,i,n){t&&(e.success=function(e,i,s){t.apply(n,[s])});i&&(e.error=function(e){i.apply(n,[e])})}function a(e,t){var n=i.config.sharedcloud_proxy_url,s=i.auth.token,r=s?"&Authorization="+encodeURIComponent(s):"",a=t?"":graphite.urlBase;return n+"/api?X-Location="+a+e+r}function o(e,t){var n=i.config.sharedcloud_proxy_url,s=i.auth.token,r=s?"&Authorization="+encodeURIComponent(s):"",a=t?"":graphite.urlBase;return graphite.inPublicOneUp()&&graphite.linkId?n+"/api?link="+graphite.linkId+"&X-Location="+a+e:n+"/api?X-Location="+a+e+r}function l(e,t,n){n=n||!1;var s={type:e,url:i.config.sharedcloud_proxy_url+"/api",headers:{"x-location":n?t:graphite.urlBase+t,authorization:i.auth.token}};return s}function d(e,t,n,s){n=n||!1;s=s||!1;var r={type:e,url:i.config.sharedcloud_proxy_url+"/api",headers:{"x-location":n?t:graphite.urlBase+t}};!s&&graphite.inPublicOneUp()&&graphite.linkId?r.data={link:graphite.linkId}:r.headers.authorization=i.auth.token;return r}function c(e){return graphite.inPublicOneUp()&&graphite.linkId?i.config.sharedcloud_proxy_url+"/download?link="+graphite.linkId+"&resource="+encodeURIComponent(graphite.urlBase)+"%2Fapi%2Fv1%2Fassets%2F"+e+"&format=psd":"vnd-adobe-sharedcloud.asset:"+e}function h(t,i,n){e.ajax(l("GET",t,!0)).done(function(e,s,r){if(200===r.status)if("failed"===e.status||"canceled"===e.status){n&&graphite.events.trigger("hideWorkerProgress",n);i(e,e,r)}else if("done"===e.status){n&&graphite.events.trigger("updateWorkerProgress",n,"done",100);i(null,e,r)}else{n&&graphite.events.trigger("updateWorkerProgress",n,e.status,e.progress);setTimeout(function(){h(t,i,n)},500)}})}function p(e){return e.split("/").pop().split(":").pop()}function u(i,n,s){var r=e.Deferred(),a=l("GET","/api/v1/collections/"+i);e.ajax(a).done(function(a,o,d){if(a.hasOwnProperty("sub_collections")){var c=t.find(a.sub_collections,function(e){return e.name===n});if(c)r.resolve(c.id);else if(s){var h=l("POST","/api/v1/collections"),g={parent_collection:i,collection_name:n};h.data=JSON.stringify(g);e.ajax(h).fail(function(e,t,s){409===e.status?u(i,n,!1).then(function(e){r.resolve(e)},function(e,t){r.reject(e,t)}):r.reject(t,e)}).done(function(e,t,i){r.resolve(p(i.getResponseHeader("location")))})}else r.resolve(null);
}else r.reject(o,d)});return r.promise()}function g(t,i){var n=e.Deferred(),s={collection_name:t._links.self.name||t.asset.fileName,parent_collection:t._links.parent.href},r=s.collection_name.lastIndexOf(".");-1!==r&&(s.collection_name=s.collection_name.substr(0,r));s.collection_name+="-assets";u(p(s.parent_collection),s.collection_name,i).then(function(e){s.collectionId=e;e?n.resolve(s):n.resolve(null)},function(e,t){n.resolve(e,t)});return n.promise()}function f(t,i){var n=e.Deferred(),s=l("GET","/api/v1/assets/"+t+"/metadata");s.headers.accept="application/hal+json";e.ajax(s).fail(function(e,t,i){n.reject(t,e)}).done(function(e,t,s){200===s.status?g(e,i).then(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject(t,s)});return n.promise()}function m(t,i){var n=e.Deferred(),s=i.shift();0===s.length?n.resolve(t):u(t,s,!0).then(function(e){i.length>0?m(e,i).then(function(e){n.resolve(e)},function(e,t){n.reject(e,t)}):n.resolve(e)},function(e,t){n.reject(e,t)});return n.promise()}function v(i,n){return t.map(n,function(t){var n=e.Deferred();m(i,t.outputTarget.split("/")).then(function(e){n.resolve({name:t.outputTarget,id:e})},function(e,t){n.reject(e,t)});return n.promise()})}function y(t,n){var s=e.Deferred(),r=l("POST","/api/v1/jobs/"+$),a={parameters:{cmd:"createAsset",layerIds:t.layerIds,assetId:t.psdGuid,encodingType:D[t.encodingType].encodingType,encodingQualityFactor:t.encodingQualityFactor,scale:t.scale,assetName:t.assetName+D[t.encodingType].fileExtension,encoder:"magick"},outputMode:n,inputs:[c(t.psdGuid)]};r.headers["Content-Type"]="application/json";i.utils.hasFeature("temp_extract_use_layerrange")&&(a.parameters.encoderHints=["layerRangeComposite:on"]);t.layerCompId&&(a.parameters.layerCompId=t.layerCompId);"asset"===n&&t.hasOwnProperty("outputTarget")&&(a.outputTarget="vnd-adobe-sharedcloud.collection:"+t.outputTarget);var o=function(e,t,i){e?s.reject(e):s.resolve(t)};r.data=JSON.stringify(a);e.ajax(r).fail(function(e,t,i){s.reject(t,e)}).done(function(e,t,i){201===i.status&&h(i.getResponseHeader("location"),o)});return s.promise()}function b(e,i){var n={},s={parameters:{cmd:"createAsset",encoder:"magick",assetId:e.psdGuid},inputs:[c(e.psdGuid)],outputMode:"asset"},r=[];t.each(i,function(e){n[e.name]=e.id});t.each(e.jobs,function(e){t.each(e.assets,function(t){var i={worker_id:$,parameters:{layerIds:t.layerIds,encodingType:D[t.encodingType].encodingType,encodingQualityFactor:t.encodingQualityFactor,scale:e.scale,assetName:t.assetName+D[t.encodingType].fileExtension,outputTarget:n[e.outputTarget]}};e.layerCompId&&(i.parameters.layerCompId=e.layerCompId);r.push(i)})});s.seq=r;return JSON.stringify(s)}function w(){if(k)return k;var t=e.Deferred(),i=l("POST","/api/v1/jobs/"+$),n={parameters:{cmd:"workerInfo"},inputs:[]},s=function(e,i,n){if(e){t.reject(e,n);k=null}else if(i.results&&i.results.graphite_workerInfo)t.resolve(JSON.parse(i.results.graphite_workerInfo));else{t.reject(i);k=null}};i.headers["Content-Type"]="application/json";i.data=JSON.stringify(n);e.ajax(i).fail(function(e,i,n){t.reject(i);k=null}).done(function(e,t,i){201===i.status&&h(i.getResponseHeader("location"),s)});k=t.promise();return k}function S(e,t){var i=e.split("."),n=t.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10);i[2]=parseInt(i[2],10);n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10);n[2]=parseInt(n[2],10);return i[0]>n[0]||i[0]===n[0]&&i[1]>n[1]||i[0]===n[0]&&i[1]===n[1]&&i[2]>n[2]?!0:!1}function C(t){var i=e.Deferred(),n=function(n,s,r){if(n)i.reject(n,r);else if(s.results)if(s.results.hasOwnProperty(t.resultProp)){var a=s.results[t.resultProp];"string"==typeof a&&(a=JSON.parse(a));i.resolve(a,r)}else e.ajax(t.getOptions).done(function(e,t,n){if(200===n.status){"string"==typeof e&&(e=JSON.parse(e));i.resolve(e,n)}else i.reject(e,n)});else i.reject(s,r)},s=function(){e.ajax(t.workerOptions).fail(function(e,t,n){i.reject(n,e)}).done(function(e,s,r){if(201===r.status){t.workerID&&graphite.events.trigger("showWorkerProgress",t.workerID);h(r.getResponseHeader("location"),n,t.workerID)}else i.reject(e,r)})};e.ajax(t.getOptions).fail(function(e,t,n){404===e.status?s():i.reject(n,e)}).done(function(e,n,r){var a=JSON.parse(e);w().then(function(e){!e[t.versionProp]||a.info&&!S(e[t.versionProp],a.info.version)?i.resolve(a,r):s()},function(e){i.resolve(a,r)})});return i.promise()}function x(e){var n=e.get("layerCompId"),s=n?"-lcid"+n:"",r={},a={parameters:{cmd:"default",jsonVersion:V+".x",assetId:e.id,limits:{maxLayers:U}}};a.outputMode="rendition";a.inputs=["vnd-adobe-sharedcloud.asset:"+e.id];r.getOptions=d("GET","/api/v1/assets/"+e.id+"/renditions/graphite/default_json_data_v"+V+s);r.workerOptions=d("POST","/api/v1/jobs/"+$,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));n&&(a.parameters.layerCompId=n);r.workerOptions.headers["Content-Type"]="application/json";r.workerOptions.data=JSON.stringify(t.extend({},r.workerOptions.data,a));r.workerID=e.id;r.versionProp="json_version";r.resultProp="graphite_json";return C(r)}function T(n,s,r){var a,o=e.Deferred(),c=2|Math.floor(s/500),p=0!==Math.floor(6/c)?Math.floor(6/c):1,u=d("POST","/api/v1/jobs/workflow",!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId")),g={seq:[{parameters:{cmd:"spritesheet",assetId:n.id,spriteSheet:{minSheets:p,flattenLayers:!0,includeDrawable:!1}},par:[],child_id:"spritesheetSubJobs",outputMode:"transient"},{worker_id:$,parameters:{cmd:"mergeSpriteSheets",mergeOutputsOf:"spritesheetSubJobs"},outputMode:"rendition"}],inputs:["vnd-adobe-sharedcloud.asset:"+n.id],outputMode:"rendition"};if(n.get("layerCompId")){g.seq[0].parameters.layerCompId=n.get("layerCompId");g.seq[1].parameters.layerCompId=n.get("layerCompId")}for(a=1;c>=a;a++){var f={worker_id:$,parameters:{workflowParms:{currentJobNumber:a,totalJobNumber:c}}};g.seq[0].par.push(f)}u.data=JSON.stringify(t.extend({},u.data,g));var m=function(t,i,n){t?o.reject(t,n):i.results.graphite_spritesheet_json?o.resolve(i.results.graphite_spritesheet_json,n):e.ajax(r).done(function(e,t,i){if(200===i.status){"string"==typeof e&&(e=JSON.parse(e));o.resolve(e,i)}else o.reject(e,i)})},v=function(t){e.ajax(l("GET",t,!0)).done(function(e,i,n){200===n.status&&e.children&&e.children.childJobs&&e.children.childJobs[1]&&e.children.childJobs[1].job?h(e.children.childJobs[1].job,m):setTimeout(function(){v(t)},500)})};e.ajax(u).fail(function(e,t,i){o.reject(i,e)}).done(function(e,t,i){201===i.status?v(i.getResponseHeader("location")):o.reject(e,i)});return o.promise()}function E(n){var s=e.Deferred(),r=n.get("layerCompId"),a=r?"-lcid"+r:"",o={},l={parameters:{cmd:"spritesheet",assetId:n.id,spriteSheet:{minSheets:6,flattenLayers:!0,includeDrawable:!1},limits:{maxLayers:U}}};l.outputMode="rendition";l.inputs=["vnd-adobe-sharedcloud.asset:"+n.id];o.getOptions=d("GET","/api/v1/assets/"+n.id+"/renditions/graphite/spritesheet_json_data"+a);o.workerOptions=d("POST","/api/v1/jobs/"+$,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));o.workerOptions.headers["Content-Type"]="application/json";r&&(l.parameters.layerCompId=r);o.versionProp="spritesheet_version";o.resultProp="graphite_json";var c=function(){o.workerOptions.data=JSON.stringify(t.extend({},o.workerOptions.data,l));C(o).then(function(e,t){s.resolve(e,t)},function(e,t){if("use_workflow_job"===e.errorCode){var i=e.errorMessage.split(":")[1];T(n,i,o.getOptions).then(function(e,t){s.resolve(e,t)},function(e,t){s.reject(e,t)})}else s.reject(e,t)})};w().then(function(e){e.version&&S(e.version,"1.0.78")?l.parameters.workflowLayerLimit=750:l.parameters.undoc=["refreshVisibility"];c()},function(e){l.parameters.undoc=["refreshVisibility"];c()});return s.promise()}function I(t,i,r,a){var o=e.Deferred(),d=l("GET","/api/v1/collections/"+t),c=function(e,t){var i=new n;i.set(i.parse(e));t.push(i);return i};e.ajax(d).fail(function(e,t,n){r?o.resolve(i):o.reject(t)}).done(function(t){var n,r,l,d=[],h=[];for(n in t.assets)t.assets.hasOwnProperty(n)&&c(t.assets[n],d);if(a)for(n in t.sub_collections)if(t.sub_collections.hasOwnProperty(n)){r=c(t.sub_collections[n],d);l=new s;r.set("childAssets",l);h.push(I(r.get("id"),l,!0,a))}i.reset(d);0===h.length?o.resolve(i):e.when.apply(e,h).then(function(e){o.resolve(i)})});return o.promise()}function M(t){var i=e.Deferred();R.hasOwnProperty(t)?i.resolve(R[t]):graphite.getServerAPI().loadAssetData(t,"dummyKey",function(e){i.resolve(R[t])},function(e){i.reject(e)});return i.promise()}function P(t){var i=e.Deferred();_.hasOwnProperty(t)?i.resolve(_[t]):graphite.getServerAPI().loadGenericData(t,"dummyKey",function(e){i.resolve(_[t])},function(e){i.reject(e)});return i.promise()}function A(t){e.ajax(d("GET","/api/v1/assets/"+t+"/metadata")).done(function(e,i,n){200===n.status&&(O[t]=e.asset.updated)})}function L(t,i){var n=e.Deferred();f(t,i).then(function(t){if(t){var i=l("GET","/api/v1/collections/"+t.collectionId);e.ajax(i).then(function(e,i,s){var r,a={collectionID:t.collectionId,filename:"_extract.manifest"};for(r=0;r<e.assets.length;r++)if(e.assets[r].name===a.filename){a.manifestID=e.assets[r].id;break}n.resolve(a)},function(e,t){n.reject(t,e)})}else n.resolve({})},function(e,t){n.reject(e,t)});return n.promise()}var k,D={png8:{fileExtension:".png",encodingType:"png8"},png32:{fileExtension:".png",encodingType:"png"},svg:{fileExtension:".svg",encodingType:"svg"},jpeg:{fileExtension:".jpg",encodingType:"jpeg"}},O={},_={},R={},F=1,U=1500,$="GraphiteJSONExtractionWorker",V="2",j={loadPsdModel:function(e,n,s,r){var a=e.get("layerCompId"),o=a?"-lcid"+a:"",l={},c={parameters:{cmd:"graphiteRenditions",assetId:e.id,maxLayers:1500,spriteSheet:{minSheets:6,includeDrawable:!1,flattenLayers:!0}}},h=function(t,i){t.dataType="complete";e.parse(t);n.apply(r,[i])},p=function(e,t){s.apply(r,[t,e])};c.outputMode="rendition";c.inputs=["vnd-adobe-sharedcloud.asset:"+e.id];l.getOptions=d("GET","/api/v1/assets/"+e.id+"/renditions/graphite/json_data_v"+V+o);l.workerOptions=d("POST","/api/v1/jobs/"+$,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));l.workerOptions.headers["Content-Type"]="application/json";a&&(c.parameters.layerCompId=a);l.workerOptions.data=JSON.stringify(t.extend({},l.workerOptions.data,c));l.workerID=e.id;l.versionProp="json_version";l.resultProp="graphite_json";A(e.id);C(l).then(h,p)},loadPsdModel2:function(e,t,i,n){A(e.id);x(e).then(function(i,s){i.dataType="JSONOnly";e.parse(i);t.apply(n,[s])},function(e,t){var s=t.responseText;try{s=JSON.parse(t.responseText)}catch(r){}i.apply(n,[t,s,"JSON"])});E(e).then(function(t,i){t.dataType="spriteSheetOnly";e.parse(t)},function(e,t){i.apply(n,[t,e,"spriteSheet"])})},loadAssetData:function(t,i,n,s,r){L(t,!1).then(function(a){if(a.manifestID){var o=l("GET","/api/v1/assets/"+a.manifestID);e.ajax(o).fail(function(e,t,i){s.apply(r,[e])}).done(function(e,s,a){"string"==typeof e&&(e=JSON.parse(e));var o={etag:a.getResponseHeader("etag"),data:e};R[t]=o;var l={etag:a.getResponseHeader("etag")};e&&(l.data=e[i]);n.apply(r,[l])})}else{R[t]={};n.apply(r,[{}])}},function(e){s.apply(r,[e])})},updateAssetData:function(t,i,n,s,r,a,o){var d=this;o=void 0===o?1:o;e.when(L(t,!0),M(t)).fail(function(e,t){r.apply(a,[e||t])}).done(function(c,h){h.data||(h.data={});h.data[i]=n.apply(a,[h.data[i]]);var p;if(c.manifestID){p=l("PUT","/api/v1/assets/"+c.manifestID);p.headers["If-Match"]=h.etag}else p=l("POST","/api/v1/collections/"+c.collectionID);p.headers["Content-Type"]="application/json";p.headers["Content-Disposition"]="inline; filename="+encodeURIComponent(c.filename);p.data=JSON.stringify(h.data);p.dataType="text";e.ajax(p).fail(function(e,l,c){if(o){delete R[t];d.updateAssetData(t,i,n,s,r,a,o-1)}else r.apply(a,[e])}).done(function(e,t,n){var r={data:h.data[i],etag:n.getResponseHeader("etag"),needRefresh:o!==F};h.etag=r.etag;s.apply(a,[r])})})},loadGenericData:function(t,i,n,s,r){var a=d("GET","/api/v1/assets/"+t+"/metadata/asset_custom_metadata");e.ajax(a).error(function(e,t,i){s.apply(r,[e])}).done(function(e,s,a){var o={etag:a.getResponseHeader("etag"),data:e};_[t]=o;var l={etag:a.getResponseHeader("etag")};e&&e.custom&&e.custom[i]&&(l.data=e.custom[i]);n.apply(r,[l])})},updateGenericData:function(t,i,n,s,r,a,o){var d=this;o=void 0===o?F:o;P(t).then(function(c){c.data||(c.data={});c.data.custom||(c.data.custom={});c.data.custom[i]=n.apply(a,[c.data.custom[i]]);var h=l("PUT","/api/v1/assets/"+t+"/metadata/asset_custom_metadata");h.headers["If-Match"]=c.etag;h.headers["Content-Type"]="application/json";h.data=JSON.stringify(c.data);h.dataType="text";e.ajax(h).error(function(e,l,c){if(o&&412===e.status){delete _[t];d.updateGenericData(t,i,n,s,r,a,o-1)}else r.apply(a,[e])}).done(function(e,t,n){var r={data:c.data.custom[i],etag:n.getResponseHeader("etag"),needRefresh:o!==F};c.etag=r.etag;s.apply(a,[r])})},function(e){r.apply(a,[e])})},loadDerivedAssetCollection:function(e,t,i,n,s){f(t.get("id"),!1).then(function(t){if(t)I(t.collectionId,e,!1,!1).then(function(e){i.apply(s,[{status:e,collectionId:t.collectionId}])},function(e){n.apply(s,[e])});else{e.reset();i.apply(s,[{responseText:"",collectionId:""}])}},function(e){n.apply(s,[e])})},getAssetCollectionID:function(e,t,i,n,s){f(e,t).then(function(e){i.apply(s,[e.collectionId])},function(e){n.apply(s,[e])})},createDerivedAsset:function(e,t,i,n,s){t?y(e,"transient").then(function(e){var t={id:p(e.outputs[0]),url:e.outputs[0],name:e.results.graphite_asset.name};i.apply(s,[{responseText:JSON.stringify(t)}])},function(e){n.apply(s,[e])}):f(e.psdGuid,!0).then(function(t){e.outputTarget=t.collectionId;y(e,"asset").then(function(e){e.outputs&&e.outputs.length>0?i.apply(s,[{responseText:JSON.stringify({id:p(e.outputs[0]),url:e.outputs[0],name:e.results.graphite_asset.name})}]):n.apply(s,[{status:507}])},function(e){n.apply(s,[e])})},function(e){n.apply(s,[e])})},_batchCreateDerivedAssets:function(t,i,n,s){var r=t.jobs.length,a=function(t){var i=l("POST","/api/v1/collections/"+t.parameters.outputTarget+"?op=move"),n={resources:[{href:t.outputs[0],name:t.parameters.assetName,"if-match":'"*"'}]};i.data=JSON.stringify(n);i.headers["If-Match"]="*";i.headers["Content-Type"]="application/x-sharedcloud-resources+json";e.ajax(i).complete(function(e,t){r--})},o=function(t,i,n){if(!t){var s=l("GET","/api/v1/collections/"+i.parameters.outputTarget);e.ajax(s).fail(function(e,t,n){a(i)}).done(function(t,n,s){if(t.assets){var r,o=!0;for(r=0;r<t.assets.length;r++)if(t.assets[r].name===i.parameters.assetName){o=!1;break}if(o)a(i);else{var d=l("HEAD","/api/v1/assets/"+t.assets[r].id);e.ajax(d).done(function(t,n,s){d.headers["If-Match"]=s.getResponseHeader("etag");d.type="DELETE";e.ajax(d).done(function(e,t,n){a(i)})})}}else a(i)})}},d=function(e,t,r){if(e)n.apply(s,[e]);else{var a,l=d;"seq"===t.children.mode&&(l=o);for(a=0;a<t.children.childJobs.length;a++)h(t.children.childJobs[a].job,l);i.apply(s,[t])}};f(t.psdGuid,!0).then(function(i){e.when.apply(e,v(i.collectionId,t.jobs)).then(function(){var i=l("POST","/api/v1/jobs/workflow");i.data=b(t,arguments);e.ajax(i).fail(function(e,t,i){n.apply(s,[t])}).done(function(e,t,i){201===i.status&&h(i.getResponseHeader("location"),d)})},function(e){n.apply(s,[e])})},function(e){n.apply(s,[e])})},_batchCreateDerivedAssets2:function(i,n,s,r){var a=0,o=0,d=function(e,t,l){a++;e&&o++;a===i.jobs.length&&(o===a?s.apply(r,[a]):n.apply(r,[a,o]))};f(i.psdGuid,!0).then(function(n){t.each(i.jobs,function(s){m(n.collectionId,s.outputTarget.split("/")).then(function(n){var r=l("POST","/api/v1/jobs/"+$),a={parameters:{cmd:"batchCreateAssets",assetId:i.psdGuid,scale:s.scale,assets:[]},outputMode:"asset",inputs:[c(i.psdGuid)],outputTarget:"vnd-adobe-sharedcloud.collection:"+n};t.each(s.assets,function(e){var t={layerIds:e.layerIds,encodingType:D[e.encodingType].encodingType,encodingQualityFactor:e.encodingQualityFactor,assetName:e.assetName+D[e.encodingType].fileExtension};a.parameters.assets.push(t)});s.layerCompId&&(a.parameters.layerCompId=s.layerCompId);r.headers["Content-Type"]="application/json";r.data=JSON.stringify(a);e.ajax(r).fail(function(e,t,i){d(i,t,e)}).done(function(e,t,i){201===i.status&&h(i.getResponseHeader("location"),d)})},function(e){d(e)})})},function(e){s.apply(r,[e])})},batchCreateDerivedAssets:function(e,t,i,n){var s=this;graphite.inPublicOneUp()||w().then(function(r){r.version&&S(r.version,"1.0.73")?s._batchCreateDerivedAssets2(e,t,i,n):s._batchCreateDerivedAssets(e,t,i,n)},function(r){s._batchCreateDerivedAssets(e,t,i,n)})},getWorkerStatus:function(t,i,n,s){var a=l("GET","/api/v1/jobs/"+t);r(a,i,n,s);e.ajax(a)},getSpriteSheetURL:function(e,t,i){var n=t?"-lcid"+t:"";return o("/api/v1/assets/"+e+"/renditions/graphite/SpriteSheet-"+i+n)+(O.hasOwnProperty(e)?"&time="+O[e]:"")},getSharedUserID:function(){var e=null;if(i.utils.hasCookiesEnabled()){e=i.utils.getCookie("fid");if(!e){var t=i.utils.getCookie("s_pers");t&&(e=this.extractfid(t))}e||(e=i.utils.getCookie("s_fid"))}e||(e=this.createfid());return e},extractfid:function(e){var t=decodeURIComponent(e);if(t){var i=t.split("s_fid=");if(i.length>1){var n=i[1].split("|");if(n.length>0)return n[0]}}return null},createfid:function(){return"xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16).toUpperCase()})},registerPersistentParameters:function(e){},trackEvent:function(e,t,n,s){var r=this.getSharedUserID();r&&i.utils.hasCookiesEnabled()&&i.utils.setCookie("fid",r);e.fid=r;var a=i.log("ccweb.files.extract");a("metrics:",e);var o={code:"EDGE_EXTRACT",sub_code:"INTERACTION",ets:e.timestamp,epd:e},l=i.utils.etsSendEvent(o);l.then(t,n)},getDerivedRenditionURL:function(e){return a("/api/v1/assets/"+e+"/renditions/png/240")},getDerivedDownloadURL:function(e,t){return a("/api/v1/assets/"+e)+"&download=true&filename="+encodeURIComponent(t).replace(/'/g,"%27")},deleteDerivedAsset:function(t,i,n,s){var a=l("HEAD","/api/v1/assets/"+t);e.ajax(a).done(function(a,o,d){var c=l("DELETE","/api/v1/assets/"+t);c.headers["If-Match"]=d.getResponseHeader("etag");r(c,i,n,s);e.ajax(c)}).fail(function(e,t,i){n.apply(s,[e])})},getDefaultRenditionURL:function(e){return a("/api/v1/assets/"+e+"/renditions/jpeg/1200")},getDerivedSpriteImage:function(e,t,i,n,s){var r=new Image,o=this,l={layerIds:t,psdGuid:e.id,encodingType:"png32",encodingQualityFactor:100};e.get("layerCompId")&&(l.layerCompId=e.get("layerCompId"));if(s){r.addEventListener("load",function(){i.apply(s)});r.addEventListener("error",function(){n.apply(s)})}else{r.addEventListener("load",i);r.addEventListener("error",n)}y(l,"transient").then(function(e){o.loadCrossDomainImage(r,a(e.outputs[0],!0))},function(e){n.apply(s)});return r},getAssetETag:function(t,i,n,s){var a=l("HEAD","/api/v1/assets/"+t);r(a,i,n,s);e.ajax(a)},loadCrossDomainImage:function(e,t){try{e&&(e.crossOrigin="Anonymous")}catch(i){}if(-1!==navigator.appVersion.indexOf("MSIE 10.")&&window.URL&&window.URL.createObjectURL){e.crossOrigin="anonymous";var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(e.src=window.URL.createObjectURL(n.response))};n.open("GET",t,!0);n.responseType="blob";n.send()}else e.src=t}};return j});define("ExtractPluginViewWrapper",["jquery","underscore","backbone","plugin-dependencies","./views/CCWebPSDDetailsView","./vanilla-extract/public/js/core/VanillaExtractMain","./vanilla-extract/public/js/core/models/PSDSettingsModel","./vanilla-extract/public/js/core/controllers/InterceptController","./models/PluginConfigModel","./models/PluginAuthModel","./models/MetricsProxyModel","./utils/AutomationTestUtils","./PSDExtractServerAPI"],function(e,t,i,n,s,r,a,o,l,d,c,h,p){graphite.configModel=new l;graphite.authModel=new d;graphite.metricsProxyModel=new c;if(graphite.metricsProxyModel){graphite.metricsProxyModel.setAuthModel(graphite.authModel);graphite.metricsProxyModel.setConfigModel(graphite.configModel)}if(!window.__extractAutomation){window.__extractAutomation=h;h.initialize()}graphite.events.trigger("register-defaults");graphite.inPublicOneUp=function(){return"link"===n.utils.getCurrentBasePath()};graphite.getPSDDetailsView=function(e){return new s({model:e})};var u=p;graphite.getServerAPI=function(){return u};return function(e){var t=new r(e);return t}});define(["./ExtractPluginViewWrapper"],function(e){"use strict";return function(t){return new e(t)}});
//# sourceMappingURL=main.js.map